(function(){const ut=document.createElement("link").relList;if(ut&&ut.supports&&ut.supports("modulepreload"))return;for(const K of document.querySelectorAll('link[rel="modulepreload"]'))U(K);new MutationObserver(K=>{for(const G of K)if(G.type==="childList")for(const q of G.addedNodes)q.tagName==="LINK"&&q.rel==="modulepreload"&&U(q)}).observe(document,{childList:!0,subtree:!0});function Se(K){const G={};return K.integrity&&(G.integrity=K.integrity),K.referrerPolicy&&(G.referrerPolicy=K.referrerPolicy),K.crossOrigin==="use-credentials"?G.credentials="include":K.crossOrigin==="anonymous"?G.credentials="omit":G.credentials="same-origin",G}function U(K){if(K.ep)return;K.ep=!0;const G=Se(K);fetch(K.href,G)}})();function Cp(Le){return Le&&Le.__esModule&&Object.prototype.hasOwnProperty.call(Le,"default")?Le.default:Le}var jc={exports:{}},ba={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $f;function bp(){if($f)return ba;$f=1;var Le=Symbol.for("react.transitional.element"),ut=Symbol.for("react.fragment");function Se(U,K,G){var q=null;if(G!==void 0&&(q=""+G),K.key!==void 0&&(q=""+K.key),"key"in K){G={};for(var x in K)x!=="key"&&(G[x]=K[x])}else G=K;return K=G.ref,{$$typeof:Le,type:U,key:q,ref:K!==void 0?K:null,props:G}}return ba.Fragment=ut,ba.jsx=Se,ba.jsxs=Se,ba}var qf;function Tp(){return qf||(qf=1,jc.exports=bp()),jc.exports}var Br=Tp(),Fc={exports:{}},Ve={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vf;function Ep(){if(Vf)return Ve;Vf=1;var Le=Symbol.for("react.transitional.element"),ut=Symbol.for("react.portal"),Se=Symbol.for("react.fragment"),U=Symbol.for("react.strict_mode"),K=Symbol.for("react.profiler"),G=Symbol.for("react.consumer"),q=Symbol.for("react.context"),x=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),S=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),b=Symbol.iterator;function _(D){return D===null||typeof D!="object"?null:(D=b&&D[b]||D["@@iterator"],typeof D=="function"?D:null)}var t={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,f={};function o(D,$,j){this.props=D,this.context=$,this.refs=f,this.updater=j||t}o.prototype.isReactComponent={},o.prototype.setState=function(D,$){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,$,"setState")},o.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate")};function s(){}s.prototype=o.prototype;function n(D,$,j){this.props=D,this.context=$,this.refs=f,this.updater=j||t}var i=n.prototype=new s;i.constructor=n,m(i,o.prototype),i.isPureReactComponent=!0;var a=Array.isArray,c={H:null,A:null,T:null,S:null},u=Object.prototype.hasOwnProperty;function g(D,$,j,V,Y,Z){return j=Z.ref,{$$typeof:Le,type:D,key:$,ref:j!==void 0?j:null,props:Z}}function h(D,$){return g(D.type,$,void 0,void 0,void 0,D.props)}function C(D){return typeof D=="object"&&D!==null&&D.$$typeof===Le}function E(D){var $={"=":"=0",":":"=2"};return"$"+D.replace(/[=:]/g,function(j){return $[j]})}var y=/\/+/g;function w(D,$){return typeof D=="object"&&D!==null&&D.key!=null?E(""+D.key):$.toString(36)}function O(){}function L(D){switch(D.status){case"fulfilled":return D.value;case"rejected":throw D.reason;default:switch(typeof D.status=="string"?D.then(O,O):(D.status="pending",D.then(function($){D.status==="pending"&&(D.status="fulfilled",D.value=$)},function($){D.status==="pending"&&(D.status="rejected",D.reason=$)})),D.status){case"fulfilled":return D.value;case"rejected":throw D.reason}}throw D}function I(D,$,j,V,Y){var Z=typeof D;(Z==="undefined"||Z==="boolean")&&(D=null);var J=!1;if(D===null)J=!0;else switch(Z){case"bigint":case"string":case"number":J=!0;break;case"object":switch(D.$$typeof){case Le:case ut:J=!0;break;case p:return J=D._init,I(J(D._payload),$,j,V,Y)}}if(J)return Y=Y(D),J=V===""?"."+w(D,0):V,a(Y)?(j="",J!=null&&(j=J.replace(y,"$&/")+"/"),I(Y,$,j,"",function(Re){return Re})):Y!=null&&(C(Y)&&(Y=h(Y,j+(Y.key==null||D&&D.key===Y.key?"":(""+Y.key).replace(y,"$&/")+"/")+J)),$.push(Y)),1;J=0;var re=V===""?".":V+":";if(a(D))for(var ce=0;ce<D.length;ce++)V=D[ce],Z=re+w(V,ce),J+=I(V,$,j,Z,Y);else if(ce=_(D),typeof ce=="function")for(D=ce.call(D),ce=0;!(V=D.next()).done;)V=V.value,Z=re+w(V,ce++),J+=I(V,$,j,Z,Y);else if(Z==="object"){if(typeof D.then=="function")return I(L(D),$,j,V,Y);throw $=String(D),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.")}return J}function k(D,$,j){if(D==null)return D;var V=[],Y=0;return I(D,V,"","",function(Z){return $.call(j,Z,Y++)}),V}function P(D){if(D._status===-1){var $=D._result;$=$(),$.then(function(j){(D._status===0||D._status===-1)&&(D._status=1,D._result=j)},function(j){(D._status===0||D._status===-1)&&(D._status=2,D._result=j)}),D._status===-1&&(D._status=0,D._result=$)}if(D._status===1)return D._result.default;throw D._result}var F=typeof reportError=="function"?reportError:function(D){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var $=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof D=="object"&&D!==null&&typeof D.message=="string"?String(D.message):String(D),error:D});if(!window.dispatchEvent($))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",D);return}console.error(D)};function H(){}return Ve.Children={map:k,forEach:function(D,$,j){k(D,function(){$.apply(this,arguments)},j)},count:function(D){var $=0;return k(D,function(){$++}),$},toArray:function(D){return k(D,function($){return $})||[]},only:function(D){if(!C(D))throw Error("React.Children.only expected to receive a single React element child.");return D}},Ve.Component=o,Ve.Fragment=Se,Ve.Profiler=K,Ve.PureComponent=n,Ve.StrictMode=U,Ve.Suspense=N,Ve.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=c,Ve.act=function(){throw Error("act(...) is not supported in production builds of React.")},Ve.cache=function(D){return function(){return D.apply(null,arguments)}},Ve.cloneElement=function(D,$,j){if(D==null)throw Error("The argument must be a React element, but you passed "+D+".");var V=m({},D.props),Y=D.key,Z=void 0;if($!=null)for(J in $.ref!==void 0&&(Z=void 0),$.key!==void 0&&(Y=""+$.key),$)!u.call($,J)||J==="key"||J==="__self"||J==="__source"||J==="ref"&&$.ref===void 0||(V[J]=$[J]);var J=arguments.length-2;if(J===1)V.children=j;else if(1<J){for(var re=Array(J),ce=0;ce<J;ce++)re[ce]=arguments[ce+2];V.children=re}return g(D.type,Y,void 0,void 0,Z,V)},Ve.createContext=function(D){return D={$$typeof:q,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null},D.Provider=D,D.Consumer={$$typeof:G,_context:D},D},Ve.createElement=function(D,$,j){var V,Y={},Z=null;if($!=null)for(V in $.key!==void 0&&(Z=""+$.key),$)u.call($,V)&&V!=="key"&&V!=="__self"&&V!=="__source"&&(Y[V]=$[V]);var J=arguments.length-2;if(J===1)Y.children=j;else if(1<J){for(var re=Array(J),ce=0;ce<J;ce++)re[ce]=arguments[ce+2];Y.children=re}if(D&&D.defaultProps)for(V in J=D.defaultProps,J)Y[V]===void 0&&(Y[V]=J[V]);return g(D,Z,void 0,void 0,null,Y)},Ve.createRef=function(){return{current:null}},Ve.forwardRef=function(D){return{$$typeof:x,render:D}},Ve.isValidElement=C,Ve.lazy=function(D){return{$$typeof:p,_payload:{_status:-1,_result:D},_init:P}},Ve.memo=function(D,$){return{$$typeof:S,type:D,compare:$===void 0?null:$}},Ve.startTransition=function(D){var $=c.T,j={};c.T=j;try{var V=D(),Y=c.S;Y!==null&&Y(j,V),typeof V=="object"&&V!==null&&typeof V.then=="function"&&V.then(H,F)}catch(Z){F(Z)}finally{c.T=$}},Ve.unstable_useCacheRefresh=function(){return c.H.useCacheRefresh()},Ve.use=function(D){return c.H.use(D)},Ve.useActionState=function(D,$,j){return c.H.useActionState(D,$,j)},Ve.useCallback=function(D,$){return c.H.useCallback(D,$)},Ve.useContext=function(D){return c.H.useContext(D)},Ve.useDebugValue=function(){},Ve.useDeferredValue=function(D,$){return c.H.useDeferredValue(D,$)},Ve.useEffect=function(D,$){return c.H.useEffect(D,$)},Ve.useId=function(){return c.H.useId()},Ve.useImperativeHandle=function(D,$,j){return c.H.useImperativeHandle(D,$,j)},Ve.useInsertionEffect=function(D,$){return c.H.useInsertionEffect(D,$)},Ve.useLayoutEffect=function(D,$){return c.H.useLayoutEffect(D,$)},Ve.useMemo=function(D,$){return c.H.useMemo(D,$)},Ve.useOptimistic=function(D,$){return c.H.useOptimistic(D,$)},Ve.useReducer=function(D,$,j){return c.H.useReducer(D,$,j)},Ve.useRef=function(D){return c.H.useRef(D)},Ve.useState=function(D){return c.H.useState(D)},Ve.useSyncExternalStore=function(D,$,j){return c.H.useSyncExternalStore(D,$,j)},Ve.useTransition=function(){return c.H.useTransition()},Ve.version="19.0.0",Ve}var zf;function zc(){return zf||(zf=1,Fc.exports=Ep()),Fc.exports}var yi=zc(),Gc={exports:{}},Ta={},Hc={exports:{}},Bc={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wf;function wp(){return Wf||(Wf=1,function(Le){function ut(k,P){var F=k.length;k.push(P);e:for(;0<F;){var H=F-1>>>1,D=k[H];if(0<K(D,P))k[H]=P,k[F]=D,F=H;else break e}}function Se(k){return k.length===0?null:k[0]}function U(k){if(k.length===0)return null;var P=k[0],F=k.pop();if(F!==P){k[0]=F;e:for(var H=0,D=k.length,$=D>>>1;H<$;){var j=2*(H+1)-1,V=k[j],Y=j+1,Z=k[Y];if(0>K(V,F))Y<D&&0>K(Z,V)?(k[H]=Z,k[Y]=F,H=Y):(k[H]=V,k[j]=F,H=j);else if(Y<D&&0>K(Z,F))k[H]=Z,k[Y]=F,H=Y;else break e}}return P}function K(k,P){var F=k.sortIndex-P.sortIndex;return F!==0?F:k.id-P.id}if(Le.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var G=performance;Le.unstable_now=function(){return G.now()}}else{var q=Date,x=q.now();Le.unstable_now=function(){return q.now()-x}}var N=[],S=[],p=1,b=null,_=3,t=!1,m=!1,f=!1,o=typeof setTimeout=="function"?setTimeout:null,s=typeof clearTimeout=="function"?clearTimeout:null,n=typeof setImmediate<"u"?setImmediate:null;function i(k){for(var P=Se(S);P!==null;){if(P.callback===null)U(S);else if(P.startTime<=k)U(S),P.sortIndex=P.expirationTime,ut(N,P);else break;P=Se(S)}}function a(k){if(f=!1,i(k),!m)if(Se(N)!==null)m=!0,L();else{var P=Se(S);P!==null&&I(a,P.startTime-k)}}var c=!1,u=-1,g=5,h=-1;function C(){return!(Le.unstable_now()-h<g)}function E(){if(c){var k=Le.unstable_now();h=k;var P=!0;try{e:{m=!1,f&&(f=!1,s(u),u=-1),t=!0;var F=_;try{t:{for(i(k),b=Se(N);b!==null&&!(b.expirationTime>k&&C());){var H=b.callback;if(typeof H=="function"){b.callback=null,_=b.priorityLevel;var D=H(b.expirationTime<=k);if(k=Le.unstable_now(),typeof D=="function"){b.callback=D,i(k),P=!0;break t}b===Se(N)&&U(N),i(k)}else U(N);b=Se(N)}if(b!==null)P=!0;else{var $=Se(S);$!==null&&I(a,$.startTime-k),P=!1}}break e}finally{b=null,_=F,t=!1}P=void 0}}finally{P?y():c=!1}}}var y;if(typeof n=="function")y=function(){n(E)};else if(typeof MessageChannel<"u"){var w=new MessageChannel,O=w.port2;w.port1.onmessage=E,y=function(){O.postMessage(null)}}else y=function(){o(E,0)};function L(){c||(c=!0,y())}function I(k,P){u=o(function(){k(Le.unstable_now())},P)}Le.unstable_IdlePriority=5,Le.unstable_ImmediatePriority=1,Le.unstable_LowPriority=4,Le.unstable_NormalPriority=3,Le.unstable_Profiling=null,Le.unstable_UserBlockingPriority=2,Le.unstable_cancelCallback=function(k){k.callback=null},Le.unstable_continueExecution=function(){m||t||(m=!0,L())},Le.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):g=0<k?Math.floor(1e3/k):5},Le.unstable_getCurrentPriorityLevel=function(){return _},Le.unstable_getFirstCallbackNode=function(){return Se(N)},Le.unstable_next=function(k){switch(_){case 1:case 2:case 3:var P=3;break;default:P=_}var F=_;_=P;try{return k()}finally{_=F}},Le.unstable_pauseExecution=function(){},Le.unstable_requestPaint=function(){},Le.unstable_runWithPriority=function(k,P){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var F=_;_=k;try{return P()}finally{_=F}},Le.unstable_scheduleCallback=function(k,P,F){var H=Le.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?H+F:H):F=H,k){case 1:var D=-1;break;case 2:D=250;break;case 5:D=1073741823;break;case 4:D=1e4;break;default:D=5e3}return D=F+D,k={id:p++,callback:P,priorityLevel:k,startTime:F,expirationTime:D,sortIndex:-1},F>H?(k.sortIndex=F,ut(S,k),Se(N)===null&&k===Se(S)&&(f?(s(u),u=-1):f=!0,I(a,F-H))):(k.sortIndex=D,ut(N,k),m||t||(m=!0,L())),k},Le.unstable_shouldYield=C,Le.unstable_wrapCallback=function(k){var P=_;return function(){var F=_;_=P;try{return k.apply(this,arguments)}finally{_=F}}}}(Bc)),Bc}var Yf;function Rp(){return Yf||(Yf=1,Hc.exports=wp()),Hc.exports}var $c={exports:{}},Ft={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qf;function Ap(){if(Qf)return Ft;Qf=1;var Le=zc();function ut(N){var S="https://react.dev/errors/"+N;if(1<arguments.length){S+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)S+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+N+"; visit "+S+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Se(){}var U={d:{f:Se,r:function(){throw Error(ut(522))},D:Se,C:Se,L:Se,m:Se,X:Se,S:Se,M:Se},p:0,findDOMNode:null},K=Symbol.for("react.portal");function G(N,S,p){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:K,key:b==null?null:""+b,children:N,containerInfo:S,implementation:p}}var q=Le.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function x(N,S){if(N==="font")return"";if(typeof S=="string")return S==="use-credentials"?S:""}return Ft.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=U,Ft.createPortal=function(N,S){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!S||S.nodeType!==1&&S.nodeType!==9&&S.nodeType!==11)throw Error(ut(299));return G(N,S,null,p)},Ft.flushSync=function(N){var S=q.T,p=U.p;try{if(q.T=null,U.p=2,N)return N()}finally{q.T=S,U.p=p,U.d.f()}},Ft.preconnect=function(N,S){typeof N=="string"&&(S?(S=S.crossOrigin,S=typeof S=="string"?S==="use-credentials"?S:"":void 0):S=null,U.d.C(N,S))},Ft.prefetchDNS=function(N){typeof N=="string"&&U.d.D(N)},Ft.preinit=function(N,S){if(typeof N=="string"&&S&&typeof S.as=="string"){var p=S.as,b=x(p,S.crossOrigin),_=typeof S.integrity=="string"?S.integrity:void 0,t=typeof S.fetchPriority=="string"?S.fetchPriority:void 0;p==="style"?U.d.S(N,typeof S.precedence=="string"?S.precedence:void 0,{crossOrigin:b,integrity:_,fetchPriority:t}):p==="script"&&U.d.X(N,{crossOrigin:b,integrity:_,fetchPriority:t,nonce:typeof S.nonce=="string"?S.nonce:void 0})}},Ft.preinitModule=function(N,S){if(typeof N=="string")if(typeof S=="object"&&S!==null){if(S.as==null||S.as==="script"){var p=x(S.as,S.crossOrigin);U.d.M(N,{crossOrigin:p,integrity:typeof S.integrity=="string"?S.integrity:void 0,nonce:typeof S.nonce=="string"?S.nonce:void 0})}}else S==null&&U.d.M(N)},Ft.preload=function(N,S){if(typeof N=="string"&&typeof S=="object"&&S!==null&&typeof S.as=="string"){var p=S.as,b=x(p,S.crossOrigin);U.d.L(N,p,{crossOrigin:b,integrity:typeof S.integrity=="string"?S.integrity:void 0,nonce:typeof S.nonce=="string"?S.nonce:void 0,type:typeof S.type=="string"?S.type:void 0,fetchPriority:typeof S.fetchPriority=="string"?S.fetchPriority:void 0,referrerPolicy:typeof S.referrerPolicy=="string"?S.referrerPolicy:void 0,imageSrcSet:typeof S.imageSrcSet=="string"?S.imageSrcSet:void 0,imageSizes:typeof S.imageSizes=="string"?S.imageSizes:void 0,media:typeof S.media=="string"?S.media:void 0})}},Ft.preloadModule=function(N,S){if(typeof N=="string")if(S){var p=x(S.as,S.crossOrigin);U.d.m(N,{as:typeof S.as=="string"&&S.as!=="script"?S.as:void 0,crossOrigin:p,integrity:typeof S.integrity=="string"?S.integrity:void 0})}else U.d.m(N)},Ft.requestFormReset=function(N){U.d.r(N)},Ft.unstable_batchedUpdates=function(N,S){return N(S)},Ft.useFormState=function(N,S,p){return q.H.useFormState(N,S,p)},Ft.useFormStatus=function(){return q.H.useHostTransitionStatus()},Ft.version="19.0.0",Ft}var Kf;function Op(){if(Kf)return $c.exports;Kf=1;function Le(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Le)}catch(ut){console.error(ut)}}return Le(),$c.exports=Ap(),$c.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xf;function kp(){if(Xf)return Ta;Xf=1;var Le=Rp(),ut=zc(),Se=Op();function U(e){var r="https://react.dev/errors/"+e;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)r+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+e+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function K(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}var G=Symbol.for("react.element"),q=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),b=Symbol.for("react.provider"),_=Symbol.for("react.consumer"),t=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),o=Symbol.for("react.suspense_list"),s=Symbol.for("react.memo"),n=Symbol.for("react.lazy"),i=Symbol.for("react.offscreen"),a=Symbol.for("react.memo_cache_sentinel"),c=Symbol.iterator;function u(e){return e===null||typeof e!="object"?null:(e=c&&e[c]||e["@@iterator"],typeof e=="function"?e:null)}var g=Symbol.for("react.client.reference");function h(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===g?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case N:return"Fragment";case x:return"Portal";case p:return"Profiler";case S:return"StrictMode";case f:return"Suspense";case o:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case t:return(e.displayName||"Context")+".Provider";case _:return(e._context.displayName||"Context")+".Consumer";case m:var r=e.render;return e=e.displayName,e||(e=r.displayName||r.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case s:return r=e.displayName||null,r!==null?r:h(e.type)||"Memo";case n:r=e._payload,e=e._init;try{return h(e(r))}catch{}}return null}var C=ut.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,E=Object.assign,y,w;function O(e){if(y===void 0)try{throw Error()}catch(d){var r=d.stack.trim().match(/\n( *(at )?)/);y=r&&r[1]||"",w=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+y+e+w}var L=!1;function I(e,r){if(!e||L)return"";L=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var v={DetermineComponentFrameRoot:function(){try{if(r){var Te=function(){throw Error()};if(Object.defineProperty(Te.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Te,[])}catch(ve){var de=ve}Reflect.construct(e,[],Te)}else{try{Te.call()}catch(ve){de=ve}e.call(Te.prototype)}}else{try{throw Error()}catch(ve){de=ve}(Te=e())&&typeof Te.catch=="function"&&Te.catch(function(){})}}catch(ve){if(ve&&de&&typeof ve.stack=="string")return[ve.stack,de.stack]}return[null,null]}};v.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var R=Object.getOwnPropertyDescriptor(v.DetermineComponentFrameRoot,"name");R&&R.configurable&&Object.defineProperty(v.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var M=v.DetermineComponentFrameRoot(),W=M[0],X=M[1];if(W&&X){var ee=W.split(`
`),se=X.split(`
`);for(R=v=0;v<ee.length&&!ee[v].includes("DetermineComponentFrameRoot");)v++;for(;R<se.length&&!se[R].includes("DetermineComponentFrameRoot");)R++;if(v===ee.length||R===se.length)for(v=ee.length-1,R=se.length-1;1<=v&&0<=R&&ee[v]!==se[R];)R--;for(;1<=v&&0<=R;v--,R--)if(ee[v]!==se[R]){if(v!==1||R!==1)do if(v--,R--,0>R||ee[v]!==se[R]){var ye=`
`+ee[v].replace(" at new "," at ");return e.displayName&&ye.includes("<anonymous>")&&(ye=ye.replace("<anonymous>",e.displayName)),ye}while(1<=v&&0<=R);break}}}finally{L=!1,Error.prepareStackTrace=d}return(d=e?e.displayName||e.name:"")?O(d):""}function k(e){switch(e.tag){case 26:case 27:case 5:return O(e.type);case 16:return O("Lazy");case 13:return O("Suspense");case 19:return O("SuspenseList");case 0:case 15:return e=I(e.type,!1),e;case 11:return e=I(e.type.render,!1),e;case 1:return e=I(e.type,!0),e;default:return""}}function P(e){try{var r="";do r+=k(e),e=e.return;while(e);return r}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}function F(e){var r=e,d=e;if(e.alternate)for(;r.return;)r=r.return;else{e=r;do r=e,(r.flags&4098)!==0&&(d=r.return),e=r.return;while(e)}return r.tag===3?d:null}function H(e){if(e.tag===13){var r=e.memoizedState;if(r===null&&(e=e.alternate,e!==null&&(r=e.memoizedState)),r!==null)return r.dehydrated}return null}function D(e){if(F(e)!==e)throw Error(U(188))}function $(e){var r=e.alternate;if(!r){if(r=F(e),r===null)throw Error(U(188));return r!==e?null:e}for(var d=e,v=r;;){var R=d.return;if(R===null)break;var M=R.alternate;if(M===null){if(v=R.return,v!==null){d=v;continue}break}if(R.child===M.child){for(M=R.child;M;){if(M===d)return D(R),e;if(M===v)return D(R),r;M=M.sibling}throw Error(U(188))}if(d.return!==v.return)d=R,v=M;else{for(var W=!1,X=R.child;X;){if(X===d){W=!0,d=R,v=M;break}if(X===v){W=!0,v=R,d=M;break}X=X.sibling}if(!W){for(X=M.child;X;){if(X===d){W=!0,d=M,v=R;break}if(X===v){W=!0,v=M,d=R;break}X=X.sibling}if(!W)throw Error(U(189))}}if(d.alternate!==v)throw Error(U(190))}if(d.tag!==3)throw Error(U(188));return d.stateNode.current===d?e:r}function j(e){var r=e.tag;if(r===5||r===26||r===27||r===6)return e;for(e=e.child;e!==null;){if(r=j(e),r!==null)return r;e=e.sibling}return null}var V=Array.isArray,Y=Se.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Z={pending:!1,data:null,method:null,action:null},J=[],re=-1;function ce(e){return{current:e}}function Re(e){0>re||(e.current=J[re],J[re]=null,re--)}function pe(e,r){re++,J[re]=e.current,e.current=r}var Oe=ce(null),te=ce(null),oe=ce(null),_e=ce(null);function we(e,r){switch(pe(oe,r),pe(te,e),pe(Oe,null),e=r.nodeType,e){case 9:case 11:r=(r=r.documentElement)&&(r=r.namespaceURI)?yf(r):0;break;default:if(e=e===8?r.parentNode:r,r=e.tagName,e=e.namespaceURI)e=yf(e),r=_f(e,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}Re(Oe),pe(Oe,r)}function Ee(){Re(Oe),Re(te),Re(oe)}function De(e){e.memoizedState!==null&&pe(_e,e);var r=Oe.current,d=_f(r,e.type);r!==d&&(pe(te,e),pe(Oe,d))}function Fe(e){te.current===e&&(Re(Oe),Re(te)),_e.current===e&&(Re(_e),va._currentValue=Z)}var xe=Object.prototype.hasOwnProperty,et=Le.unstable_scheduleCallback,tt=Le.unstable_cancelCallback,nt=Le.unstable_shouldYield,Dt=Le.unstable_requestPaint,St=Le.unstable_now,_i=Le.unstable_getCurrentPriorityLevel,bn=Le.unstable_ImmediatePriority,Tn=Le.unstable_UserBlockingPriority,gn=Le.unstable_NormalPriority,$r=Le.unstable_LowPriority,nr=Le.unstable_IdlePriority,at=Le.log,fe=Le.unstable_setDisableYieldValue,ge=null,Ae=null;function Ie(e){if(Ae&&typeof Ae.onCommitFiberRoot=="function")try{Ae.onCommitFiberRoot(ge,e,void 0,(e.current.flags&128)===128)}catch{}}function Ne(e){if(typeof at=="function"&&fe(e),Ae&&typeof Ae.setStrictMode=="function")try{Ae.setStrictMode(ge,e)}catch{}}var Pe=Math.clz32?Math.clz32:rt,me=Math.log,$e=Math.LN2;function rt(e){return e>>>=0,e===0?32:31-(me(e)/$e|0)|0}var Qe=128,Gt=4194304;function ft(e){var r=e&42;if(r!==0)return r;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Et(e,r){var d=e.pendingLanes;if(d===0)return 0;var v=0,R=e.suspendedLanes,M=e.pingedLanes,W=e.warmLanes;e=e.finishedLanes!==0;var X=d&134217727;return X!==0?(d=X&~R,d!==0?v=ft(d):(M&=X,M!==0?v=ft(M):e||(W=X&~W,W!==0&&(v=ft(W))))):(X=d&~R,X!==0?v=ft(X):M!==0?v=ft(M):e||(W=d&~W,W!==0&&(v=ft(W)))),v===0?0:r!==0&&r!==v&&(r&R)===0&&(R=v&-v,W=r&-r,R>=W||R===32&&(W&4194176)!==0)?r:v}function Jt(e,r){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&r)===0}function Ea(e,r){switch(e){case 1:case 2:case 4:case 8:return r+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function hs(){var e=Qe;return Qe<<=1,(Qe&4194176)===0&&(Qe=128),e}function ps(){var e=Gt;return Gt<<=1,(Gt&62914560)===0&&(Gt=4194304),e}function Si(e){for(var r=[],d=0;31>d;d++)r.push(e);return r}function rr(e,r){e.pendingLanes|=r,r!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function wa(e,r,d,v,R,M){var W=e.pendingLanes;e.pendingLanes=d,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=d,e.entangledLanes&=d,e.errorRecoveryDisabledLanes&=d,e.shellSuspendCounter=0;var X=e.entanglements,ee=e.expirationTimes,se=e.hiddenUpdates;for(d=W&~d;0<d;){var ye=31-Pe(d),Te=1<<ye;X[ye]=0,ee[ye]=-1;var de=se[ye];if(de!==null)for(se[ye]=null,ye=0;ye<de.length;ye++){var ve=de[ye];ve!==null&&(ve.lane&=-536870913)}d&=~Te}v!==0&&gs(e,v,0),M!==0&&R===0&&e.tag!==0&&(e.suspendedLanes|=M&~(W&~r))}function gs(e,r,d){e.pendingLanes|=r,e.suspendedLanes&=~r;var v=31-Pe(r);e.entangledLanes|=r,e.entanglements[v]=e.entanglements[v]|1073741824|d&4194218}function ms(e,r){var d=e.entangledLanes|=r;for(e=e.entanglements;d;){var v=31-Pe(d),R=1<<v;R&r|e[v]&r&&(e[v]|=r),d&=~R}}function ir(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function vs(){var e=Y.p;return e!==0?e:(e=window.event,e===void 0?32:xf(e.type))}function Ra(e,r){var d=Y.p;try{return Y.p=e,r()}finally{Y.p=d}}var Wt=Math.random().toString(36).slice(2),wt="__reactFiber$"+Wt,Mt="__reactProps$"+Wt,Zt="__reactContainer$"+Wt,Ci="__reactEvents$"+Wt,Aa="__reactListeners$"+Wt,ys="__reactHandles$"+Wt,_s="__reactResources$"+Wt,sr="__reactMarker$"+Wt;function ar(e){delete e[wt],delete e[Mt],delete e[Ci],delete e[Aa],delete e[ys]}function En(e){var r=e[wt];if(r)return r;for(var d=e.parentNode;d;){if(r=d[Zt]||d[wt]){if(d=r.alternate,r.child!==null||d!==null&&d.child!==null)for(e=bf(e);e!==null;){if(d=e[wt])return d;e=bf(e)}return r}e=d,d=e.parentNode}return null}function en(e){if(e=e[wt]||e[Zt]){var r=e.tag;if(r===5||r===6||r===13||r===26||r===27||r===3)return e}return null}function or(e){var r=e.tag;if(r===5||r===26||r===27||r===6)return e.stateNode;throw Error(U(33))}function Dn(e){var r=e[_s];return r||(r=e[_s]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function ht(e){e[sr]=!0}var bi=new Set,lr={};function wn(e,r){Mn(e,r),Mn(e+"Capture",r)}function Mn(e,r){for(lr[e]=r,e=0;e<r.length;e++)bi.add(r[e])}var tn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Oa=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ss={},Ti={};function ka(e){return xe.call(Ti,e)?!0:xe.call(Ss,e)?!1:Oa.test(e)?Ti[e]=!0:(Ss[e]=!0,!1)}function qr(e,r,d){if(ka(r))if(d===null)e.removeAttribute(r);else{switch(typeof d){case"undefined":case"function":case"symbol":e.removeAttribute(r);return;case"boolean":var v=r.toLowerCase().slice(0,5);if(v!=="data-"&&v!=="aria-"){e.removeAttribute(r);return}}e.setAttribute(r,""+d)}}function Vr(e,r,d){if(d===null)e.removeAttribute(r);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(r);return}e.setAttribute(r,""+d)}}function nn(e,r,d,v){if(v===null)e.removeAttribute(d);else{switch(typeof v){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(d);return}e.setAttributeNS(r,d,""+v)}}function Ht(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Cs(e){var r=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function Ia(e){var r=Cs(e)?"checked":"value",d=Object.getOwnPropertyDescriptor(e.constructor.prototype,r),v=""+e[r];if(!e.hasOwnProperty(r)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var R=d.get,M=d.set;return Object.defineProperty(e,r,{configurable:!0,get:function(){return R.call(this)},set:function(W){v=""+W,M.call(this,W)}}),Object.defineProperty(e,r,{enumerable:d.enumerable}),{getValue:function(){return v},setValue:function(W){v=""+W},stopTracking:function(){e._valueTracker=null,delete e[r]}}}}function zr(e){e._valueTracker||(e._valueTracker=Ia(e))}function bs(e){if(!e)return!1;var r=e._valueTracker;if(!r)return!0;var d=r.getValue(),v="";return e&&(v=Cs(e)?e.checked?"true":"false":e.value),e=v,e!==d?(r.setValue(e),!0):!1}function Nn(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var La=/[\n"\\]/g;function Bt(e){return e.replace(La,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function Ei(e,r,d,v,R,M,W,X){e.name="",W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?e.type=W:e.removeAttribute("type"),r!=null?W==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+Ht(r)):e.value!==""+Ht(r)&&(e.value=""+Ht(r)):W!=="submit"&&W!=="reset"||e.removeAttribute("value"),r!=null?cr(e,W,Ht(r)):d!=null?cr(e,W,Ht(d)):v!=null&&e.removeAttribute("value"),R==null&&M!=null&&(e.defaultChecked=!!M),R!=null&&(e.checked=R&&typeof R!="function"&&typeof R!="symbol"),X!=null&&typeof X!="function"&&typeof X!="symbol"&&typeof X!="boolean"?e.name=""+Ht(X):e.removeAttribute("name")}function Ts(e,r,d,v,R,M,W,X){if(M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"&&(e.type=M),r!=null||d!=null){if(!(M!=="submit"&&M!=="reset"||r!=null))return;d=d!=null?""+Ht(d):"",r=r!=null?""+Ht(r):d,X||r===e.value||(e.value=r),e.defaultValue=r}v=v??R,v=typeof v!="function"&&typeof v!="symbol"&&!!v,e.checked=X?e.checked:!!v,e.defaultChecked=!!v,W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"&&(e.name=W)}function cr(e,r,d){r==="number"&&Nn(e.ownerDocument)===e||e.defaultValue===""+d||(e.defaultValue=""+d)}function Vt(e,r,d,v){if(e=e.options,r){r={};for(var R=0;R<d.length;R++)r["$"+d[R]]=!0;for(d=0;d<e.length;d++)R=r.hasOwnProperty("$"+e[d].value),e[d].selected!==R&&(e[d].selected=R),R&&v&&(e[d].defaultSelected=!0)}else{for(d=""+Ht(d),r=null,R=0;R<e.length;R++){if(e[R].value===d){e[R].selected=!0,v&&(e[R].defaultSelected=!0);return}r!==null||e[R].disabled||(r=e[R])}r!==null&&(r.selected=!0)}}function Wr(e,r,d){if(r!=null&&(r=""+Ht(r),r!==e.value&&(e.value=r),d==null)){e.defaultValue!==r&&(e.defaultValue=r);return}e.defaultValue=d!=null?""+Ht(d):""}function wi(e,r,d,v){if(r==null){if(v!=null){if(d!=null)throw Error(U(92));if(V(v)){if(1<v.length)throw Error(U(93));v=v[0]}d=v}d==null&&(d=""),r=d}d=Ht(r),e.defaultValue=d,v=e.textContent,v===d&&v!==""&&v!==null&&(e.value=v)}function Un(e,r){if(r){var d=e.firstChild;if(d&&d===e.lastChild&&d.nodeType===3){d.nodeValue=r;return}}e.textContent=r}var Pa=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Rn(e,r,d){var v=r.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?v?e.setProperty(r,""):r==="float"?e.cssFloat="":e[r]="":v?e.setProperty(r,d):typeof d!="number"||d===0||Pa.has(r)?r==="float"?e.cssFloat=d:e[r]=(""+d).trim():e[r]=d+"px"}function Es(e,r,d){if(r!=null&&typeof r!="object")throw Error(U(62));if(e=e.style,d!=null){for(var v in d)!d.hasOwnProperty(v)||r!=null&&r.hasOwnProperty(v)||(v.indexOf("--")===0?e.setProperty(v,""):v==="float"?e.cssFloat="":e[v]="");for(var R in r)v=r[R],r.hasOwnProperty(R)&&d[R]!==v&&Rn(e,R,v)}else for(var M in r)r.hasOwnProperty(M)&&Rn(e,M,r[M])}function dt(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Da=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ma=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ur(e){return Ma.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Ri=null;function Ai(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var xn=null,jn=null;function ws(e){var r=en(e);if(r&&(e=r.stateNode)){var d=e[Mt]||null;e:switch(e=r.stateNode,r.type){case"input":if(Ei(e,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),r=d.name,d.type==="radio"&&r!=null){for(d=e;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+Bt(""+r)+'"][type="radio"]'),r=0;r<d.length;r++){var v=d[r];if(v!==e&&v.form===e.form){var R=v[Mt]||null;if(!R)throw Error(U(90));Ei(v,R.value,R.defaultValue,R.defaultValue,R.checked,R.defaultChecked,R.type,R.name)}}for(r=0;r<d.length;r++)v=d[r],v.form===e.form&&bs(v)}break e;case"textarea":Wr(e,d.value,d.defaultValue);break e;case"select":r=d.value,r!=null&&Vt(e,!!d.multiple,r,!1)}}}var dr=!1;function Rs(e,r,d){if(dr)return e(r,d);dr=!0;try{var v=e(r);return v}finally{if(dr=!1,(xn!==null||jn!==null)&&(Lo(),xn&&(r=xn,e=jn,jn=xn=null,ws(r),e)))for(r=0;r<e.length;r++)ws(e[r])}}function fr(e,r){var d=e.stateNode;if(d===null)return null;var v=d[Mt]||null;if(v===null)return null;d=v[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(v=!v.disabled)||(e=e.type,v=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!v;break e;default:e=!1}if(e)return null;if(d&&typeof d!="function")throw Error(U(231,r,typeof d));return d}var Yr=!1;if(tn)try{var hr={};Object.defineProperty(hr,"passive",{get:function(){Yr=!0}}),window.addEventListener("test",hr,hr),window.removeEventListener("test",hr,hr)}catch{Yr=!1}var mn=null,Fn=null,pr=null;function Oi(){if(pr)return pr;var e,r=Fn,d=r.length,v,R="value"in mn?mn.value:mn.textContent,M=R.length;for(e=0;e<d&&r[e]===R[e];e++);var W=d-e;for(v=1;v<=W&&r[d-v]===R[M-v];v++);return pr=R.slice(e,1<v?1-v:void 0)}function gr(e){var r=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&r===13&&(e=13)):e=r,e===10&&(e=13),32<=e||e===13?e:0}function Qr(){return!0}function mr(){return!1}function Rt(e){function r(d,v,R,M,W){this._reactName=d,this._targetInst=R,this.type=v,this.nativeEvent=M,this.target=W,this.currentTarget=null;for(var X in e)e.hasOwnProperty(X)&&(d=e[X],this[X]=d?d(M):M[X]);return this.isDefaultPrevented=(M.defaultPrevented!=null?M.defaultPrevented:M.returnValue===!1)?Qr:mr,this.isPropagationStopped=mr,this}return E(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Qr)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Qr)},persist:function(){},isPersistent:Qr}),r}var An={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Kr=Rt(An),vr=E({},An,{view:0,detail:0}),ki=Rt(vr),Ii,Li,yr,Xr=E({},vr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xi,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==yr&&(yr&&e.type==="mousemove"?(Ii=e.screenX-yr.screenX,Li=e.screenY-yr.screenY):Li=Ii=0,yr=e),Ii)},movementY:function(e){return"movementY"in e?e.movementY:Li}}),As=Rt(Xr),Na=E({},Xr,{dataTransfer:0}),Pi=Rt(Na),Di=E({},vr,{relatedTarget:0}),Jr=Rt(Di),Ua=E({},An,{animationName:0,elapsedTime:0,pseudoElement:0}),Mi=Rt(Ua),xa=E({},An,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Os=Rt(xa),ja=E({},An,{data:0}),Ni=Rt(ja),Ui={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ks={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Fa={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ga(e){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(e):(e=Fa[e])?!!r[e]:!1}function xi(){return Ga}var Ha=E({},vr,{key:function(e){if(e.key){var r=Ui[e.key]||e.key;if(r!=="Unidentified")return r}return e.type==="keypress"?(e=gr(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?ks[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xi,charCode:function(e){return e.type==="keypress"?gr(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?gr(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Ba=Rt(Ha),$a=E({},Xr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Is=Rt($a),qa=E({},vr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xi}),Va=Rt(qa),za=E({},An,{propertyName:0,elapsedTime:0,pseudoElement:0}),Wa=Rt(za),Ya=E({},Xr,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ls=Rt(Ya),Qa=E({},An,{newState:0,oldState:0}),Ps=Rt(Qa),Ka=[9,13,27,32],ji=tn&&"CompositionEvent"in window,_r=null;tn&&"documentMode"in document&&(_r=document.documentMode);var vn=tn&&"TextEvent"in window&&!_r,Ds=tn&&(!ji||_r&&8<_r&&11>=_r),Ms=" ",Ns=!1;function Fi(e,r){switch(e){case"keyup":return Ka.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Us(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Gn=!1;function Xa(e,r){switch(e){case"compositionend":return Us(r);case"keypress":return r.which!==32?null:(Ns=!0,Ms);case"textInput":return e=r.data,e===Ms&&Ns?null:e;default:return null}}function Ja(e,r){if(Gn)return e==="compositionend"||!ji&&Fi(e,r)?(e=Oi(),pr=Fn=mn=null,Gn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Ds&&r.locale!=="ko"?null:r.data;default:return null}}var Sr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ae(e){var r=e&&e.nodeName&&e.nodeName.toLowerCase();return r==="input"?!!Sr[e.type]:r==="textarea"}function Gi(e,r,d,v){xn?jn?jn.push(v):jn=[v]:xn=v,r=Uo(r,"onChange"),0<r.length&&(d=new Kr("onChange","change",null,d,v),e.push({event:d,listeners:r}))}var Zr=null,Cr=null;function l(e){hf(e,0)}function T(e){var r=or(e);if(bs(r))return e}function A(e,r){if(e==="change")return r}var B=!1;if(tn){var z;if(tn){var Q="oninput"in document;if(!Q){var ne=document.createElement("div");ne.setAttribute("oninput","return;"),Q=typeof ne.oninput=="function"}z=Q}else z=!1;B=z&&(!document.documentMode||9<document.documentMode)}function he(){Zr&&(Zr.detachEvent("onpropertychange",ke),Cr=Zr=null)}function ke(e){if(e.propertyName==="value"&&T(Cr)){var r=[];Gi(r,Cr,e,Ai(e)),Rs(l,r)}}function Ge(e,r,d){e==="focusin"?(he(),Zr=r,Cr=d,Zr.attachEvent("onpropertychange",ke)):e==="focusout"&&he()}function kt(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return T(Cr)}function rn(e,r){if(e==="click")return T(r)}function Za(e,r){if(e==="input"||e==="change")return T(r)}function xs(e,r){return e===r&&(e!==0||1/e===1/r)||e!==e&&r!==r}var be=typeof Object.is=="function"?Object.is:xs;function Be(e,r){if(be(e,r))return!0;if(typeof e!="object"||e===null||typeof r!="object"||r===null)return!1;var d=Object.keys(e),v=Object.keys(r);if(d.length!==v.length)return!1;for(v=0;v<d.length;v++){var R=d[v];if(!xe.call(r,R)||!be(e[R],r[R]))return!1}return!0}function js(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Wc(e,r){var d=js(e);e=0;for(var v;d;){if(d.nodeType===3){if(v=e+d.textContent.length,e<=r&&v>=r)return{node:d,offset:r-e};e=v}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=js(d)}}function Yc(e,r){return e&&r?e===r?!0:e&&e.nodeType===3?!1:r&&r.nodeType===3?Yc(e,r.parentNode):"contains"in e?e.contains(r):e.compareDocumentPosition?!!(e.compareDocumentPosition(r)&16):!1:!1}function Qc(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var r=Nn(e.document);r instanceof e.HTMLIFrameElement;){try{var d=typeof r.contentWindow.location.href=="string"}catch{d=!1}if(d)e=r.contentWindow;else break;r=Nn(e.document)}return r}function Xo(e){var r=e&&e.nodeName&&e.nodeName.toLowerCase();return r&&(r==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||r==="textarea"||e.contentEditable==="true")}function nh(e,r){var d=Qc(r);r=e.focusedElem;var v=e.selectionRange;if(d!==r&&r&&r.ownerDocument&&Yc(r.ownerDocument.documentElement,r)){if(v!==null&&Xo(r)){if(e=v.start,d=v.end,d===void 0&&(d=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(d,r.value.length);else if(d=(e=r.ownerDocument||document)&&e.defaultView||window,d.getSelection){d=d.getSelection();var R=r.textContent.length,M=Math.min(v.start,R);v=v.end===void 0?M:Math.min(v.end,R),!d.extend&&M>v&&(R=v,v=M,M=R),R=Wc(r,M);var W=Wc(r,v);R&&W&&(d.rangeCount!==1||d.anchorNode!==R.node||d.anchorOffset!==R.offset||d.focusNode!==W.node||d.focusOffset!==W.offset)&&(e=e.createRange(),e.setStart(R.node,R.offset),d.removeAllRanges(),M>v?(d.addRange(e),d.extend(W.node,W.offset)):(e.setEnd(W.node,W.offset),d.addRange(e)))}}for(e=[],d=r;d=d.parentNode;)d.nodeType===1&&e.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)d=e[r],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var rh=tn&&"documentMode"in document&&11>=document.documentMode,Hi=null,Jo=null,Fs=null,Zo=!1;function Kc(e,r,d){var v=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Zo||Hi==null||Hi!==Nn(v)||(v=Hi,"selectionStart"in v&&Xo(v)?v={start:v.selectionStart,end:v.selectionEnd}:(v=(v.ownerDocument&&v.ownerDocument.defaultView||window).getSelection(),v={anchorNode:v.anchorNode,anchorOffset:v.anchorOffset,focusNode:v.focusNode,focusOffset:v.focusOffset}),Fs&&Be(Fs,v)||(Fs=v,v=Uo(Jo,"onSelect"),0<v.length&&(r=new Kr("onSelect","select",null,r,d),e.push({event:r,listeners:v}),r.target=Hi)))}function ei(e,r){var d={};return d[e.toLowerCase()]=r.toLowerCase(),d["Webkit"+e]="webkit"+r,d["Moz"+e]="moz"+r,d}var Bi={animationend:ei("Animation","AnimationEnd"),animationiteration:ei("Animation","AnimationIteration"),animationstart:ei("Animation","AnimationStart"),transitionrun:ei("Transition","TransitionRun"),transitionstart:ei("Transition","TransitionStart"),transitioncancel:ei("Transition","TransitionCancel"),transitionend:ei("Transition","TransitionEnd")},el={},Xc={};tn&&(Xc=document.createElement("div").style,"AnimationEvent"in window||(delete Bi.animationend.animation,delete Bi.animationiteration.animation,delete Bi.animationstart.animation),"TransitionEvent"in window||delete Bi.transitionend.transition);function ti(e){if(el[e])return el[e];if(!Bi[e])return e;var r=Bi[e],d;for(d in r)if(r.hasOwnProperty(d)&&d in Xc)return el[e]=r[d];return e}var Jc=ti("animationend"),Zc=ti("animationiteration"),eu=ti("animationstart"),ih=ti("transitionrun"),sh=ti("transitionstart"),ah=ti("transitioncancel"),tu=ti("transitionend"),nu=new Map,ru="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function yn(e,r){nu.set(e,r),wn(r,[e])}var sn=[],$i=0,tl=0;function eo(){for(var e=$i,r=tl=$i=0;r<e;){var d=sn[r];sn[r++]=null;var v=sn[r];sn[r++]=null;var R=sn[r];sn[r++]=null;var M=sn[r];if(sn[r++]=null,v!==null&&R!==null){var W=v.pending;W===null?R.next=R:(R.next=W.next,W.next=R),v.pending=R}M!==0&&iu(d,R,M)}}function to(e,r,d,v){sn[$i++]=e,sn[$i++]=r,sn[$i++]=d,sn[$i++]=v,tl|=v,e.lanes|=v,e=e.alternate,e!==null&&(e.lanes|=v)}function nl(e,r,d,v){return to(e,r,d,v),no(e)}function br(e,r){return to(e,null,null,r),no(e)}function iu(e,r,d){e.lanes|=d;var v=e.alternate;v!==null&&(v.lanes|=d);for(var R=!1,M=e.return;M!==null;)M.childLanes|=d,v=M.alternate,v!==null&&(v.childLanes|=d),M.tag===22&&(e=M.stateNode,e===null||e._visibility&1||(R=!0)),e=M,M=M.return;R&&r!==null&&e.tag===3&&(M=e.stateNode,R=31-Pe(d),M=M.hiddenUpdates,e=M[R],e===null?M[R]=[r]:e.push(r),r.lane=d|536870912)}function no(e){if(50<ua)throw ua=0,lc=null,Error(U(185));for(var r=e.return;r!==null;)e=r,r=e.return;return e.tag===3?e.stateNode:null}var qi={},su=new WeakMap;function an(e,r){if(typeof e=="object"&&e!==null){var d=su.get(e);return d!==void 0?d:(r={value:e,source:r,stack:P(r)},su.set(e,r),r)}return{value:e,source:r,stack:P(r)}}var Vi=[],zi=0,ro=null,io=0,on=[],ln=0,ni=null,Hn=1,Bn="";function ri(e,r){Vi[zi++]=io,Vi[zi++]=ro,ro=e,io=r}function au(e,r,d){on[ln++]=Hn,on[ln++]=Bn,on[ln++]=ni,ni=e;var v=Hn;e=Bn;var R=32-Pe(v)-1;v&=~(1<<R),d+=1;var M=32-Pe(r)+R;if(30<M){var W=R-R%5;M=(v&(1<<W)-1).toString(32),v>>=W,R-=W,Hn=1<<32-Pe(r)+R|d<<R|v,Bn=M+e}else Hn=1<<M|d<<R|v,Bn=e}function rl(e){e.return!==null&&(ri(e,1),au(e,1,0))}function il(e){for(;e===ro;)ro=Vi[--zi],Vi[zi]=null,io=Vi[--zi],Vi[zi]=null;for(;e===ni;)ni=on[--ln],on[ln]=null,Bn=on[--ln],on[ln]=null,Hn=on[--ln],on[ln]=null}var $t=null,Nt=null,Je=!1,_n=null,On=!1,sl=Error(U(519));function ii(e){var r=Error(U(418,""));throw Bs(an(r,e)),sl}function ou(e){var r=e.stateNode,d=e.type,v=e.memoizedProps;switch(r[wt]=e,r[Mt]=v,d){case"dialog":Ke("cancel",r),Ke("close",r);break;case"iframe":case"object":case"embed":Ke("load",r);break;case"video":case"audio":for(d=0;d<fa.length;d++)Ke(fa[d],r);break;case"source":Ke("error",r);break;case"img":case"image":case"link":Ke("error",r),Ke("load",r);break;case"details":Ke("toggle",r);break;case"input":Ke("invalid",r),Ts(r,v.value,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name,!0),zr(r);break;case"select":Ke("invalid",r);break;case"textarea":Ke("invalid",r),wi(r,v.value,v.defaultValue,v.children),zr(r)}d=v.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||r.textContent===""+d||v.suppressHydrationWarning===!0||vf(r.textContent,d)?(v.popover!=null&&(Ke("beforetoggle",r),Ke("toggle",r)),v.onScroll!=null&&Ke("scroll",r),v.onScrollEnd!=null&&Ke("scrollend",r),v.onClick!=null&&(r.onclick=xo),r=!0):r=!1,r||ii(e)}function lu(e){for($t=e.return;$t;)switch($t.tag){case 3:case 27:On=!0;return;case 5:case 13:On=!1;return;default:$t=$t.return}}function Gs(e){if(e!==$t)return!1;if(!Je)return lu(e),Je=!0,!1;var r=!1,d;if((d=e.tag!==3&&e.tag!==27)&&((d=e.tag===5)&&(d=e.type,d=!(d!=="form"&&d!=="button")||wc(e.type,e.memoizedProps)),d=!d),d&&(r=!0),r&&Nt&&ii(e),lu(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(U(317));e:{for(e=e.nextSibling,r=0;e;){if(e.nodeType===8)if(d=e.data,d==="/$"){if(r===0){Nt=Cn(e.nextSibling);break e}r--}else d!=="$"&&d!=="$!"&&d!=="$?"||r++;e=e.nextSibling}Nt=null}}else Nt=$t?Cn(e.stateNode.nextSibling):null;return!0}function Hs(){Nt=$t=null,Je=!1}function Bs(e){_n===null?_n=[e]:_n.push(e)}var $s=Error(U(460)),cu=Error(U(474)),al={then:function(){}};function uu(e){return e=e.status,e==="fulfilled"||e==="rejected"}function so(){}function du(e,r,d){switch(d=e[d],d===void 0?e.push(r):d!==r&&(r.then(so,so),r=d),r.status){case"fulfilled":return r.value;case"rejected":throw e=r.reason,e===$s?Error(U(483)):e;default:if(typeof r.status=="string")r.then(so,so);else{if(e=lt,e!==null&&100<e.shellSuspendCounter)throw Error(U(482));e=r,e.status="pending",e.then(function(v){if(r.status==="pending"){var R=r;R.status="fulfilled",R.value=v}},function(v){if(r.status==="pending"){var R=r;R.status="rejected",R.reason=v}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw e=r.reason,e===$s?Error(U(483)):e}throw qs=r,$s}}var qs=null;function fu(){if(qs===null)throw Error(U(459));var e=qs;return qs=null,e}var Wi=null,Vs=0;function ao(e){var r=Vs;return Vs+=1,Wi===null&&(Wi=[]),du(Wi,e,r)}function zs(e,r){r=r.props.ref,e.ref=r!==void 0?r:null}function oo(e,r){throw r.$$typeof===G?Error(U(525)):(e=Object.prototype.toString.call(r),Error(U(31,e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)))}function hu(e){var r=e._init;return r(e._payload)}function pu(e){function r(le,ie){if(e){var ue=le.deletions;ue===null?(le.deletions=[ie],le.flags|=16):ue.push(ie)}}function d(le,ie){if(!e)return null;for(;ie!==null;)r(le,ie),ie=ie.sibling;return null}function v(le){for(var ie=new Map;le!==null;)le.key!==null?ie.set(le.key,le):ie.set(le.index,le),le=le.sibling;return ie}function R(le,ie){return le=Mr(le,ie),le.index=0,le.sibling=null,le}function M(le,ie,ue){return le.index=ue,e?(ue=le.alternate,ue!==null?(ue=ue.index,ue<ie?(le.flags|=33554434,ie):ue):(le.flags|=33554434,ie)):(le.flags|=1048576,ie)}function W(le){return e&&le.alternate===null&&(le.flags|=33554434),le}function X(le,ie,ue,Ce){return ie===null||ie.tag!==6?(ie=ec(ue,le.mode,Ce),ie.return=le,ie):(ie=R(ie,ue),ie.return=le,ie)}function ee(le,ie,ue,Ce){var Me=ue.type;return Me===N?ye(le,ie,ue.props.children,Ce,ue.key):ie!==null&&(ie.elementType===Me||typeof Me=="object"&&Me!==null&&Me.$$typeof===n&&hu(Me)===ie.type)?(ie=R(ie,ue.props),zs(ie,ue),ie.return=le,ie):(ie=Ro(ue.type,ue.key,ue.props,null,le.mode,Ce),zs(ie,ue),ie.return=le,ie)}function se(le,ie,ue,Ce){return ie===null||ie.tag!==4||ie.stateNode.containerInfo!==ue.containerInfo||ie.stateNode.implementation!==ue.implementation?(ie=tc(ue,le.mode,Ce),ie.return=le,ie):(ie=R(ie,ue.children||[]),ie.return=le,ie)}function ye(le,ie,ue,Ce,Me){return ie===null||ie.tag!==7?(ie=pi(ue,le.mode,Ce,Me),ie.return=le,ie):(ie=R(ie,ue),ie.return=le,ie)}function Te(le,ie,ue){if(typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint")return ie=ec(""+ie,le.mode,ue),ie.return=le,ie;if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case q:return ue=Ro(ie.type,ie.key,ie.props,null,le.mode,ue),zs(ue,ie),ue.return=le,ue;case x:return ie=tc(ie,le.mode,ue),ie.return=le,ie;case n:var Ce=ie._init;return ie=Ce(ie._payload),Te(le,ie,ue)}if(V(ie)||u(ie))return ie=pi(ie,le.mode,ue,null),ie.return=le,ie;if(typeof ie.then=="function")return Te(le,ao(ie),ue);if(ie.$$typeof===t)return Te(le,To(le,ie),ue);oo(le,ie)}return null}function de(le,ie,ue,Ce){var Me=ie!==null?ie.key:null;if(typeof ue=="string"&&ue!==""||typeof ue=="number"||typeof ue=="bigint")return Me!==null?null:X(le,ie,""+ue,Ce);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case q:return ue.key===Me?ee(le,ie,ue,Ce):null;case x:return ue.key===Me?se(le,ie,ue,Ce):null;case n:return Me=ue._init,ue=Me(ue._payload),de(le,ie,ue,Ce)}if(V(ue)||u(ue))return Me!==null?null:ye(le,ie,ue,Ce,null);if(typeof ue.then=="function")return de(le,ie,ao(ue),Ce);if(ue.$$typeof===t)return de(le,ie,To(le,ue),Ce);oo(le,ue)}return null}function ve(le,ie,ue,Ce,Me){if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint")return le=le.get(ue)||null,X(ie,le,""+Ce,Me);if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case q:return le=le.get(Ce.key===null?ue:Ce.key)||null,ee(ie,le,Ce,Me);case x:return le=le.get(Ce.key===null?ue:Ce.key)||null,se(ie,le,Ce,Me);case n:var We=Ce._init;return Ce=We(Ce._payload),ve(le,ie,ue,Ce,Me)}if(V(Ce)||u(Ce))return le=le.get(ue)||null,ye(ie,le,Ce,Me,null);if(typeof Ce.then=="function")return ve(le,ie,ue,ao(Ce),Me);if(Ce.$$typeof===t)return ve(le,ie,ue,To(ie,Ce),Me);oo(ie,Ce)}return null}function Ue(le,ie,ue,Ce){for(var Me=null,We=null,je=ie,He=ie=0,Pt=null;je!==null&&He<ue.length;He++){je.index>He?(Pt=je,je=null):Pt=je.sibling;var Ze=de(le,je,ue[He],Ce);if(Ze===null){je===null&&(je=Pt);break}e&&je&&Ze.alternate===null&&r(le,je),ie=M(Ze,ie,He),We===null?Me=Ze:We.sibling=Ze,We=Ze,je=Pt}if(He===ue.length)return d(le,je),Je&&ri(le,He),Me;if(je===null){for(;He<ue.length;He++)je=Te(le,ue[He],Ce),je!==null&&(ie=M(je,ie,He),We===null?Me=je:We.sibling=je,We=je);return Je&&ri(le,He),Me}for(je=v(je);He<ue.length;He++)Pt=ve(je,le,He,ue[He],Ce),Pt!==null&&(e&&Pt.alternate!==null&&je.delete(Pt.key===null?He:Pt.key),ie=M(Pt,ie,He),We===null?Me=Pt:We.sibling=Pt,We=Pt);return e&&je.forEach(function(Hr){return r(le,Hr)}),Je&&ri(le,He),Me}function qe(le,ie,ue,Ce){if(ue==null)throw Error(U(151));for(var Me=null,We=null,je=ie,He=ie=0,Pt=null,Ze=ue.next();je!==null&&!Ze.done;He++,Ze=ue.next()){je.index>He?(Pt=je,je=null):Pt=je.sibling;var Hr=de(le,je,Ze.value,Ce);if(Hr===null){je===null&&(je=Pt);break}e&&je&&Hr.alternate===null&&r(le,je),ie=M(Hr,ie,He),We===null?Me=Hr:We.sibling=Hr,We=Hr,je=Pt}if(Ze.done)return d(le,je),Je&&ri(le,He),Me;if(je===null){for(;!Ze.done;He++,Ze=ue.next())Ze=Te(le,Ze.value,Ce),Ze!==null&&(ie=M(Ze,ie,He),We===null?Me=Ze:We.sibling=Ze,We=Ze);return Je&&ri(le,He),Me}for(je=v(je);!Ze.done;He++,Ze=ue.next())Ze=ve(je,le,He,Ze.value,Ce),Ze!==null&&(e&&Ze.alternate!==null&&je.delete(Ze.key===null?He:Ze.key),ie=M(Ze,ie,He),We===null?Me=Ze:We.sibling=Ze,We=Ze);return e&&je.forEach(function(Sp){return r(le,Sp)}),Je&&ri(le,He),Me}function yt(le,ie,ue,Ce){if(typeof ue=="object"&&ue!==null&&ue.type===N&&ue.key===null&&(ue=ue.props.children),typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case q:e:{for(var Me=ue.key;ie!==null;){if(ie.key===Me){if(Me=ue.type,Me===N){if(ie.tag===7){d(le,ie.sibling),Ce=R(ie,ue.props.children),Ce.return=le,le=Ce;break e}}else if(ie.elementType===Me||typeof Me=="object"&&Me!==null&&Me.$$typeof===n&&hu(Me)===ie.type){d(le,ie.sibling),Ce=R(ie,ue.props),zs(Ce,ue),Ce.return=le,le=Ce;break e}d(le,ie);break}else r(le,ie);ie=ie.sibling}ue.type===N?(Ce=pi(ue.props.children,le.mode,Ce,ue.key),Ce.return=le,le=Ce):(Ce=Ro(ue.type,ue.key,ue.props,null,le.mode,Ce),zs(Ce,ue),Ce.return=le,le=Ce)}return W(le);case x:e:{for(Me=ue.key;ie!==null;){if(ie.key===Me)if(ie.tag===4&&ie.stateNode.containerInfo===ue.containerInfo&&ie.stateNode.implementation===ue.implementation){d(le,ie.sibling),Ce=R(ie,ue.children||[]),Ce.return=le,le=Ce;break e}else{d(le,ie);break}else r(le,ie);ie=ie.sibling}Ce=tc(ue,le.mode,Ce),Ce.return=le,le=Ce}return W(le);case n:return Me=ue._init,ue=Me(ue._payload),yt(le,ie,ue,Ce)}if(V(ue))return Ue(le,ie,ue,Ce);if(u(ue)){if(Me=u(ue),typeof Me!="function")throw Error(U(150));return ue=Me.call(ue),qe(le,ie,ue,Ce)}if(typeof ue.then=="function")return yt(le,ie,ao(ue),Ce);if(ue.$$typeof===t)return yt(le,ie,To(le,ue),Ce);oo(le,ue)}return typeof ue=="string"&&ue!==""||typeof ue=="number"||typeof ue=="bigint"?(ue=""+ue,ie!==null&&ie.tag===6?(d(le,ie.sibling),Ce=R(ie,ue),Ce.return=le,le=Ce):(d(le,ie),Ce=ec(ue,le.mode,Ce),Ce.return=le,le=Ce),W(le)):d(le,ie)}return function(le,ie,ue,Ce){try{Vs=0;var Me=yt(le,ie,ue,Ce);return Wi=null,Me}catch(je){if(je===$s)throw je;var We=fn(29,je,null,le.mode);return We.lanes=Ce,We.return=le,We}finally{}}}var si=pu(!0),gu=pu(!1),Yi=ce(null),lo=ce(0);function mu(e,r){e=Zn,pe(lo,e),pe(Yi,r),Zn=e|r.baseLanes}function ol(){pe(lo,Zn),pe(Yi,Yi.current)}function ll(){Zn=lo.current,Re(Yi),Re(lo)}var cn=ce(null),kn=null;function Tr(e){var r=e.alternate;pe(At,At.current&1),pe(cn,e),kn===null&&(r===null||Yi.current!==null||r.memoizedState!==null)&&(kn=e)}function vu(e){if(e.tag===22){if(pe(At,At.current),pe(cn,e),kn===null){var r=e.alternate;r!==null&&r.memoizedState!==null&&(kn=e)}}else Er()}function Er(){pe(At,At.current),pe(cn,cn.current)}function $n(e){Re(cn),kn===e&&(kn=null),Re(At)}var At=ce(0);function co(e){for(var r=e;r!==null;){if(r.tag===13){var d=r.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var oh=typeof AbortController<"u"?AbortController:function(){var e=[],r=this.signal={aborted:!1,addEventListener:function(d,v){e.push(v)}};this.abort=function(){r.aborted=!0,e.forEach(function(d){return d()})}},lh=Le.unstable_scheduleCallback,ch=Le.unstable_NormalPriority,Ot={$$typeof:t,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function cl(){return{controller:new oh,data:new Map,refCount:0}}function Ws(e){e.refCount--,e.refCount===0&&lh(ch,function(){e.controller.abort()})}var Ys=null,ul=0,Qi=0,Ki=null;function uh(e,r){if(Ys===null){var d=Ys=[];ul=0,Qi=mc(),Ki={status:"pending",value:void 0,then:function(v){d.push(v)}}}return ul++,r.then(yu,yu),r}function yu(){if(--ul===0&&Ys!==null){Ki!==null&&(Ki.status="fulfilled");var e=Ys;Ys=null,Qi=0,Ki=null;for(var r=0;r<e.length;r++)(0,e[r])()}}function dh(e,r){var d=[],v={status:"pending",value:null,reason:null,then:function(R){d.push(R)}};return e.then(function(){v.status="fulfilled",v.value=r;for(var R=0;R<d.length;R++)(0,d[R])(r)},function(R){for(v.status="rejected",v.reason=R,R=0;R<d.length;R++)(0,d[R])(void 0)}),v}var _u=C.S;C.S=function(e,r){typeof r=="object"&&r!==null&&typeof r.then=="function"&&uh(e,r),_u!==null&&_u(e,r)};var ai=ce(null);function dl(){var e=ai.current;return e!==null?e:lt.pooledCache}function uo(e,r){r===null?pe(ai,ai.current):pe(ai,r.pool)}function Su(){var e=dl();return e===null?null:{parent:Ot._currentValue,pool:e}}var wr=0,ze=null,it=null,Ct=null,fo=!1,Xi=!1,oi=!1,ho=0,Qs=0,Ji=null,fh=0;function _t(){throw Error(U(321))}function fl(e,r){if(r===null)return!1;for(var d=0;d<r.length&&d<e.length;d++)if(!be(e[d],r[d]))return!1;return!0}function hl(e,r,d,v,R,M){return wr=M,ze=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,C.H=e===null||e.memoizedState===null?li:Rr,oi=!1,M=d(v,R),oi=!1,Xi&&(M=bu(r,d,v,R)),Cu(e),M}function Cu(e){C.H=In;var r=it!==null&&it.next!==null;if(wr=0,Ct=it=ze=null,fo=!1,Qs=0,Ji=null,r)throw Error(U(300));e===null||It||(e=e.dependencies,e!==null&&bo(e)&&(It=!0))}function bu(e,r,d,v){ze=e;var R=0;do{if(Xi&&(Ji=null),Qs=0,Xi=!1,25<=R)throw Error(U(301));if(R+=1,Ct=it=null,e.updateQueue!=null){var M=e.updateQueue;M.lastEffect=null,M.events=null,M.stores=null,M.memoCache!=null&&(M.memoCache.index=0)}C.H=ci,M=r(d,v)}while(Xi);return M}function hh(){var e=C.H,r=e.useState()[0];return r=typeof r.then=="function"?Ks(r):r,e=e.useState()[0],(it!==null?it.memoizedState:null)!==e&&(ze.flags|=1024),r}function pl(){var e=ho!==0;return ho=0,e}function gl(e,r,d){r.updateQueue=e.updateQueue,r.flags&=-2053,e.lanes&=~d}function ml(e){if(fo){for(e=e.memoizedState;e!==null;){var r=e.queue;r!==null&&(r.pending=null),e=e.next}fo=!1}wr=0,Ct=it=ze=null,Xi=!1,Qs=ho=0,Ji=null}function zt(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ct===null?ze.memoizedState=Ct=e:Ct=Ct.next=e,Ct}function bt(){if(it===null){var e=ze.alternate;e=e!==null?e.memoizedState:null}else e=it.next;var r=Ct===null?ze.memoizedState:Ct.next;if(r!==null)Ct=r,it=e;else{if(e===null)throw ze.alternate===null?Error(U(467)):Error(U(310));it=e,e={memoizedState:it.memoizedState,baseState:it.baseState,baseQueue:it.baseQueue,queue:it.queue,next:null},Ct===null?ze.memoizedState=Ct=e:Ct=Ct.next=e}return Ct}var po;po=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function Ks(e){var r=Qs;return Qs+=1,Ji===null&&(Ji=[]),e=du(Ji,e,r),r=ze,(Ct===null?r.memoizedState:Ct.next)===null&&(r=r.alternate,C.H=r===null||r.memoizedState===null?li:Rr),e}function go(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Ks(e);if(e.$$typeof===t)return jt(e)}throw Error(U(438,String(e)))}function vl(e){var r=null,d=ze.updateQueue;if(d!==null&&(r=d.memoCache),r==null){var v=ze.alternate;v!==null&&(v=v.updateQueue,v!==null&&(v=v.memoCache,v!=null&&(r={data:v.data.map(function(R){return R.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),d===null&&(d=po(),ze.updateQueue=d),d.memoCache=r,d=r.data[r.index],d===void 0)for(d=r.data[r.index]=Array(e),v=0;v<e;v++)d[v]=a;return r.index++,d}function qn(e,r){return typeof r=="function"?r(e):r}function mo(e){var r=bt();return yl(r,it,e)}function yl(e,r,d){var v=e.queue;if(v===null)throw Error(U(311));v.lastRenderedReducer=d;var R=e.baseQueue,M=v.pending;if(M!==null){if(R!==null){var W=R.next;R.next=M.next,M.next=W}r.baseQueue=R=M,v.pending=null}if(M=e.baseState,R===null)e.memoizedState=M;else{r=R.next;var X=W=null,ee=null,se=r,ye=!1;do{var Te=se.lane&-536870913;if(Te!==se.lane?(Xe&Te)===Te:(wr&Te)===Te){var de=se.revertLane;if(de===0)ee!==null&&(ee=ee.next={lane:0,revertLane:0,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null}),Te===Qi&&(ye=!0);else if((wr&de)===de){se=se.next,de===Qi&&(ye=!0);continue}else Te={lane:0,revertLane:se.revertLane,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null},ee===null?(X=ee=Te,W=M):ee=ee.next=Te,ze.lanes|=de,Nr|=de;Te=se.action,oi&&d(M,Te),M=se.hasEagerState?se.eagerState:d(M,Te)}else de={lane:Te,revertLane:se.revertLane,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null},ee===null?(X=ee=de,W=M):ee=ee.next=de,ze.lanes|=Te,Nr|=Te;se=se.next}while(se!==null&&se!==r);if(ee===null?W=M:ee.next=X,!be(M,e.memoizedState)&&(It=!0,ye&&(d=Ki,d!==null)))throw d;e.memoizedState=M,e.baseState=W,e.baseQueue=ee,v.lastRenderedState=M}return R===null&&(v.lanes=0),[e.memoizedState,v.dispatch]}function _l(e){var r=bt(),d=r.queue;if(d===null)throw Error(U(311));d.lastRenderedReducer=e;var v=d.dispatch,R=d.pending,M=r.memoizedState;if(R!==null){d.pending=null;var W=R=R.next;do M=e(M,W.action),W=W.next;while(W!==R);be(M,r.memoizedState)||(It=!0),r.memoizedState=M,r.baseQueue===null&&(r.baseState=M),d.lastRenderedState=M}return[M,v]}function Tu(e,r,d){var v=ze,R=bt(),M=Je;if(M){if(d===void 0)throw Error(U(407));d=d()}else d=r();var W=!be((it||R).memoizedState,d);if(W&&(R.memoizedState=d,It=!0),R=R.queue,bl(Ru.bind(null,v,R,e),[e]),R.getSnapshot!==r||W||Ct!==null&&Ct.memoizedState.tag&1){if(v.flags|=2048,Zi(9,wu.bind(null,v,R,d,r),{destroy:void 0},null),lt===null)throw Error(U(349));M||(wr&60)!==0||Eu(v,r,d)}return d}function Eu(e,r,d){e.flags|=16384,e={getSnapshot:r,value:d},r=ze.updateQueue,r===null?(r=po(),ze.updateQueue=r,r.stores=[e]):(d=r.stores,d===null?r.stores=[e]:d.push(e))}function wu(e,r,d,v){r.value=d,r.getSnapshot=v,Au(r)&&Ou(e)}function Ru(e,r,d){return d(function(){Au(r)&&Ou(e)})}function Au(e){var r=e.getSnapshot;e=e.value;try{var d=r();return!be(e,d)}catch{return!0}}function Ou(e){var r=br(e,2);r!==null&&qt(r,e,2)}function Sl(e){var r=zt();if(typeof e=="function"){var d=e;if(e=d(),oi){Ne(!0);try{d()}finally{Ne(!1)}}}return r.memoizedState=r.baseState=e,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:qn,lastRenderedState:e},r}function ku(e,r,d,v){return e.baseState=d,yl(e,it,typeof v=="function"?v:qn)}function ph(e,r,d,v,R){if(_o(e))throw Error(U(485));if(e=r.action,e!==null){var M={payload:R,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(W){M.listeners.push(W)}};C.T!==null?d(!0):M.isTransition=!1,v(M),d=r.pending,d===null?(M.next=r.pending=M,Iu(r,M)):(M.next=d.next,r.pending=d.next=M)}}function Iu(e,r){var d=r.action,v=r.payload,R=e.state;if(r.isTransition){var M=C.T,W={};C.T=W;try{var X=d(R,v),ee=C.S;ee!==null&&ee(W,X),Lu(e,r,X)}catch(se){Cl(e,r,se)}finally{C.T=M}}else try{M=d(R,v),Lu(e,r,M)}catch(se){Cl(e,r,se)}}function Lu(e,r,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(v){Pu(e,r,v)},function(v){return Cl(e,r,v)}):Pu(e,r,d)}function Pu(e,r,d){r.status="fulfilled",r.value=d,Du(r),e.state=d,r=e.pending,r!==null&&(d=r.next,d===r?e.pending=null:(d=d.next,r.next=d,Iu(e,d)))}function Cl(e,r,d){var v=e.pending;if(e.pending=null,v!==null){v=v.next;do r.status="rejected",r.reason=d,Du(r),r=r.next;while(r!==v)}e.action=null}function Du(e){e=e.listeners;for(var r=0;r<e.length;r++)(0,e[r])()}function Mu(e,r){return r}function Nu(e,r){if(Je){var d=lt.formState;if(d!==null){e:{var v=ze;if(Je){if(Nt){t:{for(var R=Nt,M=On;R.nodeType!==8;){if(!M){R=null;break t}if(R=Cn(R.nextSibling),R===null){R=null;break t}}M=R.data,R=M==="F!"||M==="F"?R:null}if(R){Nt=Cn(R.nextSibling),v=R.data==="F!";break e}}ii(v)}v=!1}v&&(r=d[0])}}return d=zt(),d.memoizedState=d.baseState=r,v={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Mu,lastRenderedState:r},d.queue=v,d=Zu.bind(null,ze,v),v.dispatch=d,v=Sl(!1),M=Al.bind(null,ze,!1,v.queue),v=zt(),R={state:r,dispatch:null,action:e,pending:null},v.queue=R,d=ph.bind(null,ze,R,M,d),R.dispatch=d,v.memoizedState=e,[r,d,!1]}function Uu(e){var r=bt();return xu(r,it,e)}function xu(e,r,d){r=yl(e,r,Mu)[0],e=mo(qn)[0],r=typeof r=="object"&&r!==null&&typeof r.then=="function"?Ks(r):r;var v=bt(),R=v.queue,M=R.dispatch;return d!==v.memoizedState&&(ze.flags|=2048,Zi(9,gh.bind(null,R,d),{destroy:void 0},null)),[r,M,e]}function gh(e,r){e.action=r}function ju(e){var r=bt(),d=it;if(d!==null)return xu(r,d,e);bt(),r=r.memoizedState,d=bt();var v=d.queue.dispatch;return d.memoizedState=e,[r,v,!1]}function Zi(e,r,d,v){return e={tag:e,create:r,inst:d,deps:v,next:null},r=ze.updateQueue,r===null&&(r=po(),ze.updateQueue=r),d=r.lastEffect,d===null?r.lastEffect=e.next=e:(v=d.next,d.next=e,e.next=v,r.lastEffect=e),e}function Fu(){return bt().memoizedState}function vo(e,r,d,v){var R=zt();ze.flags|=e,R.memoizedState=Zi(1|r,d,{destroy:void 0},v===void 0?null:v)}function yo(e,r,d,v){var R=bt();v=v===void 0?null:v;var M=R.memoizedState.inst;it!==null&&v!==null&&fl(v,it.memoizedState.deps)?R.memoizedState=Zi(r,d,M,v):(ze.flags|=e,R.memoizedState=Zi(1|r,d,M,v))}function Gu(e,r){vo(8390656,8,e,r)}function bl(e,r){yo(2048,8,e,r)}function Hu(e,r){return yo(4,2,e,r)}function Bu(e,r){return yo(4,4,e,r)}function $u(e,r){if(typeof r=="function"){e=e();var d=r(e);return function(){typeof d=="function"?d():r(null)}}if(r!=null)return e=e(),r.current=e,function(){r.current=null}}function qu(e,r,d){d=d!=null?d.concat([e]):null,yo(4,4,$u.bind(null,r,e),d)}function Tl(){}function Vu(e,r){var d=bt();r=r===void 0?null:r;var v=d.memoizedState;return r!==null&&fl(r,v[1])?v[0]:(d.memoizedState=[e,r],e)}function zu(e,r){var d=bt();r=r===void 0?null:r;var v=d.memoizedState;if(r!==null&&fl(r,v[1]))return v[0];if(v=e(),oi){Ne(!0);try{e()}finally{Ne(!1)}}return d.memoizedState=[v,r],v}function El(e,r,d){return d===void 0||(wr&1073741824)!==0?e.memoizedState=r:(e.memoizedState=d,e=Yd(),ze.lanes|=e,Nr|=e,d)}function Wu(e,r,d,v){return be(d,r)?d:Yi.current!==null?(e=El(e,d,v),be(e,r)||(It=!0),e):(wr&42)===0?(It=!0,e.memoizedState=d):(e=Yd(),ze.lanes|=e,Nr|=e,r)}function Yu(e,r,d,v,R){var M=Y.p;Y.p=M!==0&&8>M?M:8;var W=C.T,X={};C.T=X,Al(e,!1,r,d);try{var ee=R(),se=C.S;if(se!==null&&se(X,ee),ee!==null&&typeof ee=="object"&&typeof ee.then=="function"){var ye=dh(ee,v);Xs(e,r,ye,Xt(e))}else Xs(e,r,v,Xt(e))}catch(Te){Xs(e,r,{then:function(){},status:"rejected",reason:Te},Xt())}finally{Y.p=M,C.T=W}}function mh(){}function wl(e,r,d,v){if(e.tag!==5)throw Error(U(476));var R=Qu(e).queue;Yu(e,R,r,Z,d===null?mh:function(){return Ku(e),d(v)})}function Qu(e){var r=e.memoizedState;if(r!==null)return r;r={memoizedState:Z,baseState:Z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:qn,lastRenderedState:Z},next:null};var d={};return r.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:qn,lastRenderedState:d},next:null},e.memoizedState=r,e=e.alternate,e!==null&&(e.memoizedState=r),r}function Ku(e){var r=Qu(e).next.queue;Xs(e,r,{},Xt())}function Rl(){return jt(va)}function Xu(){return bt().memoizedState}function Ju(){return bt().memoizedState}function vh(e){for(var r=e.return;r!==null;){switch(r.tag){case 24:case 3:var d=Xt();e=kr(d);var v=Ir(r,e,d);v!==null&&(qt(v,r,d),ea(v,r,d)),r={cache:cl()},e.payload=r;return}r=r.return}}function yh(e,r,d){var v=Xt();d={lane:v,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null},_o(e)?ed(r,d):(d=nl(e,r,d,v),d!==null&&(qt(d,e,v),td(d,r,v)))}function Zu(e,r,d){var v=Xt();Xs(e,r,d,v)}function Xs(e,r,d,v){var R={lane:v,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null};if(_o(e))ed(r,R);else{var M=e.alternate;if(e.lanes===0&&(M===null||M.lanes===0)&&(M=r.lastRenderedReducer,M!==null))try{var W=r.lastRenderedState,X=M(W,d);if(R.hasEagerState=!0,R.eagerState=X,be(X,W))return to(e,r,R,0),lt===null&&eo(),!1}catch{}finally{}if(d=nl(e,r,R,v),d!==null)return qt(d,e,v),td(d,r,v),!0}return!1}function Al(e,r,d,v){if(v={lane:2,revertLane:mc(),action:v,hasEagerState:!1,eagerState:null,next:null},_o(e)){if(r)throw Error(U(479))}else r=nl(e,d,v,2),r!==null&&qt(r,e,2)}function _o(e){var r=e.alternate;return e===ze||r!==null&&r===ze}function ed(e,r){Xi=fo=!0;var d=e.pending;d===null?r.next=r:(r.next=d.next,d.next=r),e.pending=r}function td(e,r,d){if((d&4194176)!==0){var v=r.lanes;v&=e.pendingLanes,d|=v,r.lanes=d,ms(e,d)}}var In={readContext:jt,use:go,useCallback:_t,useContext:_t,useEffect:_t,useImperativeHandle:_t,useLayoutEffect:_t,useInsertionEffect:_t,useMemo:_t,useReducer:_t,useRef:_t,useState:_t,useDebugValue:_t,useDeferredValue:_t,useTransition:_t,useSyncExternalStore:_t,useId:_t};In.useCacheRefresh=_t,In.useMemoCache=_t,In.useHostTransitionStatus=_t,In.useFormState=_t,In.useActionState=_t,In.useOptimistic=_t;var li={readContext:jt,use:go,useCallback:function(e,r){return zt().memoizedState=[e,r===void 0?null:r],e},useContext:jt,useEffect:Gu,useImperativeHandle:function(e,r,d){d=d!=null?d.concat([e]):null,vo(4194308,4,$u.bind(null,r,e),d)},useLayoutEffect:function(e,r){return vo(4194308,4,e,r)},useInsertionEffect:function(e,r){vo(4,2,e,r)},useMemo:function(e,r){var d=zt();r=r===void 0?null:r;var v=e();if(oi){Ne(!0);try{e()}finally{Ne(!1)}}return d.memoizedState=[v,r],v},useReducer:function(e,r,d){var v=zt();if(d!==void 0){var R=d(r);if(oi){Ne(!0);try{d(r)}finally{Ne(!1)}}}else R=r;return v.memoizedState=v.baseState=R,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:R},v.queue=e,e=e.dispatch=yh.bind(null,ze,e),[v.memoizedState,e]},useRef:function(e){var r=zt();return e={current:e},r.memoizedState=e},useState:function(e){e=Sl(e);var r=e.queue,d=Zu.bind(null,ze,r);return r.dispatch=d,[e.memoizedState,d]},useDebugValue:Tl,useDeferredValue:function(e,r){var d=zt();return El(d,e,r)},useTransition:function(){var e=Sl(!1);return e=Yu.bind(null,ze,e.queue,!0,!1),zt().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,r,d){var v=ze,R=zt();if(Je){if(d===void 0)throw Error(U(407));d=d()}else{if(d=r(),lt===null)throw Error(U(349));(Xe&60)!==0||Eu(v,r,d)}R.memoizedState=d;var M={value:d,getSnapshot:r};return R.queue=M,Gu(Ru.bind(null,v,M,e),[e]),v.flags|=2048,Zi(9,wu.bind(null,v,M,d,r),{destroy:void 0},null),d},useId:function(){var e=zt(),r=lt.identifierPrefix;if(Je){var d=Bn,v=Hn;d=(v&~(1<<32-Pe(v)-1)).toString(32)+d,r=":"+r+"R"+d,d=ho++,0<d&&(r+="H"+d.toString(32)),r+=":"}else d=fh++,r=":"+r+"r"+d.toString(32)+":";return e.memoizedState=r},useCacheRefresh:function(){return zt().memoizedState=vh.bind(null,ze)}};li.useMemoCache=vl,li.useHostTransitionStatus=Rl,li.useFormState=Nu,li.useActionState=Nu,li.useOptimistic=function(e){var r=zt();r.memoizedState=r.baseState=e;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=d,r=Al.bind(null,ze,!0,d),d.dispatch=r,[e,r]};var Rr={readContext:jt,use:go,useCallback:Vu,useContext:jt,useEffect:bl,useImperativeHandle:qu,useInsertionEffect:Hu,useLayoutEffect:Bu,useMemo:zu,useReducer:mo,useRef:Fu,useState:function(){return mo(qn)},useDebugValue:Tl,useDeferredValue:function(e,r){var d=bt();return Wu(d,it.memoizedState,e,r)},useTransition:function(){var e=mo(qn)[0],r=bt().memoizedState;return[typeof e=="boolean"?e:Ks(e),r]},useSyncExternalStore:Tu,useId:Xu};Rr.useCacheRefresh=Ju,Rr.useMemoCache=vl,Rr.useHostTransitionStatus=Rl,Rr.useFormState=Uu,Rr.useActionState=Uu,Rr.useOptimistic=function(e,r){var d=bt();return ku(d,it,e,r)};var ci={readContext:jt,use:go,useCallback:Vu,useContext:jt,useEffect:bl,useImperativeHandle:qu,useInsertionEffect:Hu,useLayoutEffect:Bu,useMemo:zu,useReducer:_l,useRef:Fu,useState:function(){return _l(qn)},useDebugValue:Tl,useDeferredValue:function(e,r){var d=bt();return it===null?El(d,e,r):Wu(d,it.memoizedState,e,r)},useTransition:function(){var e=_l(qn)[0],r=bt().memoizedState;return[typeof e=="boolean"?e:Ks(e),r]},useSyncExternalStore:Tu,useId:Xu};ci.useCacheRefresh=Ju,ci.useMemoCache=vl,ci.useHostTransitionStatus=Rl,ci.useFormState=ju,ci.useActionState=ju,ci.useOptimistic=function(e,r){var d=bt();return it!==null?ku(d,it,e,r):(d.baseState=e,[e,d.queue.dispatch])};function Ol(e,r,d,v){r=e.memoizedState,d=d(v,r),d=d==null?r:E({},r,d),e.memoizedState=d,e.lanes===0&&(e.updateQueue.baseState=d)}var kl={isMounted:function(e){return(e=e._reactInternals)?F(e)===e:!1},enqueueSetState:function(e,r,d){e=e._reactInternals;var v=Xt(),R=kr(v);R.payload=r,d!=null&&(R.callback=d),r=Ir(e,R,v),r!==null&&(qt(r,e,v),ea(r,e,v))},enqueueReplaceState:function(e,r,d){e=e._reactInternals;var v=Xt(),R=kr(v);R.tag=1,R.payload=r,d!=null&&(R.callback=d),r=Ir(e,R,v),r!==null&&(qt(r,e,v),ea(r,e,v))},enqueueForceUpdate:function(e,r){e=e._reactInternals;var d=Xt(),v=kr(d);v.tag=2,r!=null&&(v.callback=r),r=Ir(e,v,d),r!==null&&(qt(r,e,d),ea(r,e,d))}};function nd(e,r,d,v,R,M,W){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(v,M,W):r.prototype&&r.prototype.isPureReactComponent?!Be(d,v)||!Be(R,M):!0}function rd(e,r,d,v){e=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(d,v),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(d,v),r.state!==e&&kl.enqueueReplaceState(r,r.state,null)}function ui(e,r){var d=r;if("ref"in r){d={};for(var v in r)v!=="ref"&&(d[v]=r[v])}if(e=e.defaultProps){d===r&&(d=E({},d));for(var R in e)d[R]===void 0&&(d[R]=e[R])}return d}var So=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function id(e){So(e)}function sd(e){console.error(e)}function ad(e){So(e)}function Co(e,r){try{var d=e.onUncaughtError;d(r.value,{componentStack:r.stack})}catch(v){setTimeout(function(){throw v})}}function od(e,r,d){try{var v=e.onCaughtError;v(d.value,{componentStack:d.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(R){setTimeout(function(){throw R})}}function Il(e,r,d){return d=kr(d),d.tag=3,d.payload={element:null},d.callback=function(){Co(e,r)},d}function ld(e){return e=kr(e),e.tag=3,e}function cd(e,r,d,v){var R=d.type.getDerivedStateFromError;if(typeof R=="function"){var M=v.value;e.payload=function(){return R(M)},e.callback=function(){od(r,d,v)}}var W=d.stateNode;W!==null&&typeof W.componentDidCatch=="function"&&(e.callback=function(){od(r,d,v),typeof R!="function"&&(Ur===null?Ur=new Set([this]):Ur.add(this));var X=v.stack;this.componentDidCatch(v.value,{componentStack:X!==null?X:""})})}function _h(e,r,d,v,R){if(d.flags|=32768,v!==null&&typeof v=="object"&&typeof v.then=="function"){if(r=d.alternate,r!==null&&Zs(r,d,R,!0),d=cn.current,d!==null){switch(d.tag){case 13:return kn===null?dc():d.alternate===null&&vt===0&&(vt=3),d.flags&=-257,d.flags|=65536,d.lanes=R,v===al?d.flags|=16384:(r=d.updateQueue,r===null?d.updateQueue=new Set([v]):r.add(v),hc(e,v,R)),!1;case 22:return d.flags|=65536,v===al?d.flags|=16384:(r=d.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([v])},d.updateQueue=r):(d=r.retryQueue,d===null?r.retryQueue=new Set([v]):d.add(v)),hc(e,v,R)),!1}throw Error(U(435,d.tag))}return hc(e,v,R),dc(),!1}if(Je)return r=cn.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=R,v!==sl&&(e=Error(U(422),{cause:v}),Bs(an(e,d)))):(v!==sl&&(r=Error(U(423),{cause:v}),Bs(an(r,d))),e=e.current.alternate,e.flags|=65536,R&=-R,e.lanes|=R,v=an(v,d),R=Il(e.stateNode,v,R),Vl(e,R),vt!==4&&(vt=2)),!1;var M=Error(U(520),{cause:v});if(M=an(M,d),la===null?la=[M]:la.push(M),vt!==4&&(vt=2),r===null)return!0;v=an(v,d),d=r;do{switch(d.tag){case 3:return d.flags|=65536,e=R&-R,d.lanes|=e,e=Il(d.stateNode,v,e),Vl(d,e),!1;case 1:if(r=d.type,M=d.stateNode,(d.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||M!==null&&typeof M.componentDidCatch=="function"&&(Ur===null||!Ur.has(M))))return d.flags|=65536,R&=-R,d.lanes|=R,R=ld(R),cd(R,e,d,v),Vl(d,R),!1}d=d.return}while(d!==null);return!1}var ud=Error(U(461)),It=!1;function Ut(e,r,d,v){r.child=e===null?gu(r,null,d,v):si(r,e.child,d,v)}function dd(e,r,d,v,R){d=d.render;var M=r.ref;if("ref"in v){var W={};for(var X in v)X!=="ref"&&(W[X]=v[X])}else W=v;return fi(r),v=hl(e,r,d,W,M,R),X=pl(),e!==null&&!It?(gl(e,r,R),Vn(e,r,R)):(Je&&X&&rl(r),r.flags|=1,Ut(e,r,v,R),r.child)}function fd(e,r,d,v,R){if(e===null){var M=d.type;return typeof M=="function"&&!Zl(M)&&M.defaultProps===void 0&&d.compare===null?(r.tag=15,r.type=M,hd(e,r,M,v,R)):(e=Ro(d.type,null,v,r,r.mode,R),e.ref=r.ref,e.return=r,r.child=e)}if(M=e.child,!Fl(e,R)){var W=M.memoizedProps;if(d=d.compare,d=d!==null?d:Be,d(W,v)&&e.ref===r.ref)return Vn(e,r,R)}return r.flags|=1,e=Mr(M,v),e.ref=r.ref,e.return=r,r.child=e}function hd(e,r,d,v,R){if(e!==null){var M=e.memoizedProps;if(Be(M,v)&&e.ref===r.ref)if(It=!1,r.pendingProps=v=M,Fl(e,R))(e.flags&131072)!==0&&(It=!0);else return r.lanes=e.lanes,Vn(e,r,R)}return Ll(e,r,d,v,R)}function pd(e,r,d){var v=r.pendingProps,R=v.children,M=(r.stateNode._pendingVisibility&2)!==0,W=e!==null?e.memoizedState:null;if(Js(e,r),v.mode==="hidden"||M){if((r.flags&128)!==0){if(v=W!==null?W.baseLanes|d:d,e!==null){for(R=r.child=e.child,M=0;R!==null;)M=M|R.lanes|R.childLanes,R=R.sibling;r.childLanes=M&~v}else r.childLanes=0,r.child=null;return gd(e,r,v,d)}if((d&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},e!==null&&uo(r,W!==null?W.cachePool:null),W!==null?mu(r,W):ol(),vu(r);else return r.lanes=r.childLanes=536870912,gd(e,r,W!==null?W.baseLanes|d:d,d)}else W!==null?(uo(r,W.cachePool),mu(r,W),Er(),r.memoizedState=null):(e!==null&&uo(r,null),ol(),Er());return Ut(e,r,R,d),r.child}function gd(e,r,d,v){var R=dl();return R=R===null?null:{parent:Ot._currentValue,pool:R},r.memoizedState={baseLanes:d,cachePool:R},e!==null&&uo(r,null),ol(),vu(r),e!==null&&Zs(e,r,v,!0),null}function Js(e,r){var d=r.ref;if(d===null)e!==null&&e.ref!==null&&(r.flags|=2097664);else{if(typeof d!="function"&&typeof d!="object")throw Error(U(284));(e===null||e.ref!==d)&&(r.flags|=2097664)}}function Ll(e,r,d,v,R){return fi(r),d=hl(e,r,d,v,void 0,R),v=pl(),e!==null&&!It?(gl(e,r,R),Vn(e,r,R)):(Je&&v&&rl(r),r.flags|=1,Ut(e,r,d,R),r.child)}function md(e,r,d,v,R,M){return fi(r),r.updateQueue=null,d=bu(r,v,d,R),Cu(e),v=pl(),e!==null&&!It?(gl(e,r,M),Vn(e,r,M)):(Je&&v&&rl(r),r.flags|=1,Ut(e,r,d,M),r.child)}function vd(e,r,d,v,R){if(fi(r),r.stateNode===null){var M=qi,W=d.contextType;typeof W=="object"&&W!==null&&(M=jt(W)),M=new d(v,M),r.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,M.updater=kl,r.stateNode=M,M._reactInternals=r,M=r.stateNode,M.props=v,M.state=r.memoizedState,M.refs={},$l(r),W=d.contextType,M.context=typeof W=="object"&&W!==null?jt(W):qi,M.state=r.memoizedState,W=d.getDerivedStateFromProps,typeof W=="function"&&(Ol(r,d,W,v),M.state=r.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof M.getSnapshotBeforeUpdate=="function"||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(W=M.state,typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount(),W!==M.state&&kl.enqueueReplaceState(M,M.state,null),na(r,v,M,R),ta(),M.state=r.memoizedState),typeof M.componentDidMount=="function"&&(r.flags|=4194308),v=!0}else if(e===null){M=r.stateNode;var X=r.memoizedProps,ee=ui(d,X);M.props=ee;var se=M.context,ye=d.contextType;W=qi,typeof ye=="object"&&ye!==null&&(W=jt(ye));var Te=d.getDerivedStateFromProps;ye=typeof Te=="function"||typeof M.getSnapshotBeforeUpdate=="function",X=r.pendingProps!==X,ye||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(X||se!==W)&&rd(r,M,v,W),Or=!1;var de=r.memoizedState;M.state=de,na(r,v,M,R),ta(),se=r.memoizedState,X||de!==se||Or?(typeof Te=="function"&&(Ol(r,d,Te,v),se=r.memoizedState),(ee=Or||nd(r,d,ee,v,de,se,W))?(ye||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount()),typeof M.componentDidMount=="function"&&(r.flags|=4194308)):(typeof M.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=v,r.memoizedState=se),M.props=v,M.state=se,M.context=W,v=ee):(typeof M.componentDidMount=="function"&&(r.flags|=4194308),v=!1)}else{M=r.stateNode,ql(e,r),W=r.memoizedProps,ye=ui(d,W),M.props=ye,Te=r.pendingProps,de=M.context,se=d.contextType,ee=qi,typeof se=="object"&&se!==null&&(ee=jt(se)),X=d.getDerivedStateFromProps,(se=typeof X=="function"||typeof M.getSnapshotBeforeUpdate=="function")||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(W!==Te||de!==ee)&&rd(r,M,v,ee),Or=!1,de=r.memoizedState,M.state=de,na(r,v,M,R),ta();var ve=r.memoizedState;W!==Te||de!==ve||Or||e!==null&&e.dependencies!==null&&bo(e.dependencies)?(typeof X=="function"&&(Ol(r,d,X,v),ve=r.memoizedState),(ye=Or||nd(r,d,ye,v,de,ve,ee)||e!==null&&e.dependencies!==null&&bo(e.dependencies))?(se||typeof M.UNSAFE_componentWillUpdate!="function"&&typeof M.componentWillUpdate!="function"||(typeof M.componentWillUpdate=="function"&&M.componentWillUpdate(v,ve,ee),typeof M.UNSAFE_componentWillUpdate=="function"&&M.UNSAFE_componentWillUpdate(v,ve,ee)),typeof M.componentDidUpdate=="function"&&(r.flags|=4),typeof M.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof M.componentDidUpdate!="function"||W===e.memoizedProps&&de===e.memoizedState||(r.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||W===e.memoizedProps&&de===e.memoizedState||(r.flags|=1024),r.memoizedProps=v,r.memoizedState=ve),M.props=v,M.state=ve,M.context=ee,v=ye):(typeof M.componentDidUpdate!="function"||W===e.memoizedProps&&de===e.memoizedState||(r.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||W===e.memoizedProps&&de===e.memoizedState||(r.flags|=1024),v=!1)}return M=v,Js(e,r),v=(r.flags&128)!==0,M||v?(M=r.stateNode,d=v&&typeof d.getDerivedStateFromError!="function"?null:M.render(),r.flags|=1,e!==null&&v?(r.child=si(r,e.child,null,R),r.child=si(r,null,d,R)):Ut(e,r,d,R),r.memoizedState=M.state,e=r.child):e=Vn(e,r,R),e}function yd(e,r,d,v){return Hs(),r.flags|=256,Ut(e,r,d,v),r.child}var Pl={dehydrated:null,treeContext:null,retryLane:0};function Dl(e){return{baseLanes:e,cachePool:Su()}}function Ml(e,r,d){return e=e!==null?e.childLanes&~d:0,r&&(e|=hn),e}function _d(e,r,d){var v=r.pendingProps,R=!1,M=(r.flags&128)!==0,W;if((W=M)||(W=e!==null&&e.memoizedState===null?!1:(At.current&2)!==0),W&&(R=!0,r.flags&=-129),W=(r.flags&32)!==0,r.flags&=-33,e===null){if(Je){if(R?Tr(r):Er(),Je){var X=Nt,ee;if(ee=X){e:{for(ee=X,X=On;ee.nodeType!==8;){if(!X){X=null;break e}if(ee=Cn(ee.nextSibling),ee===null){X=null;break e}}X=ee}X!==null?(r.memoizedState={dehydrated:X,treeContext:ni!==null?{id:Hn,overflow:Bn}:null,retryLane:536870912},ee=fn(18,null,null,0),ee.stateNode=X,ee.return=r,r.child=ee,$t=r,Nt=null,ee=!0):ee=!1}ee||ii(r)}if(X=r.memoizedState,X!==null&&(X=X.dehydrated,X!==null))return X.data==="$!"?r.lanes=16:r.lanes=536870912,null;$n(r)}return X=v.children,v=v.fallback,R?(Er(),R=r.mode,X=Ul({mode:"hidden",children:X},R),v=pi(v,R,d,null),X.return=r,v.return=r,X.sibling=v,r.child=X,R=r.child,R.memoizedState=Dl(d),R.childLanes=Ml(e,W,d),r.memoizedState=Pl,v):(Tr(r),Nl(r,X))}if(ee=e.memoizedState,ee!==null&&(X=ee.dehydrated,X!==null)){if(M)r.flags&256?(Tr(r),r.flags&=-257,r=xl(e,r,d)):r.memoizedState!==null?(Er(),r.child=e.child,r.flags|=128,r=null):(Er(),R=v.fallback,X=r.mode,v=Ul({mode:"visible",children:v.children},X),R=pi(R,X,d,null),R.flags|=2,v.return=r,R.return=r,v.sibling=R,r.child=v,si(r,e.child,null,d),v=r.child,v.memoizedState=Dl(d),v.childLanes=Ml(e,W,d),r.memoizedState=Pl,r=R);else if(Tr(r),X.data==="$!"){if(W=X.nextSibling&&X.nextSibling.dataset,W)var se=W.dgst;W=se,v=Error(U(419)),v.stack="",v.digest=W,Bs({value:v,source:null,stack:null}),r=xl(e,r,d)}else if(It||Zs(e,r,d,!1),W=(d&e.childLanes)!==0,It||W){if(W=lt,W!==null){if(v=d&-d,(v&42)!==0)v=1;else switch(v){case 2:v=1;break;case 8:v=4;break;case 32:v=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:v=64;break;case 268435456:v=134217728;break;default:v=0}if(v=(v&(W.suspendedLanes|d))!==0?0:v,v!==0&&v!==ee.retryLane)throw ee.retryLane=v,br(e,v),qt(W,e,v),ud}X.data==="$?"||dc(),r=xl(e,r,d)}else X.data==="$?"?(r.flags|=128,r.child=e.child,r=Mh.bind(null,e),X._reactRetry=r,r=null):(e=ee.treeContext,Nt=Cn(X.nextSibling),$t=r,Je=!0,_n=null,On=!1,e!==null&&(on[ln++]=Hn,on[ln++]=Bn,on[ln++]=ni,Hn=e.id,Bn=e.overflow,ni=r),r=Nl(r,v.children),r.flags|=4096);return r}return R?(Er(),R=v.fallback,X=r.mode,ee=e.child,se=ee.sibling,v=Mr(ee,{mode:"hidden",children:v.children}),v.subtreeFlags=ee.subtreeFlags&31457280,se!==null?R=Mr(se,R):(R=pi(R,X,d,null),R.flags|=2),R.return=r,v.return=r,v.sibling=R,r.child=v,v=R,R=r.child,X=e.child.memoizedState,X===null?X=Dl(d):(ee=X.cachePool,ee!==null?(se=Ot._currentValue,ee=ee.parent!==se?{parent:se,pool:se}:ee):ee=Su(),X={baseLanes:X.baseLanes|d,cachePool:ee}),R.memoizedState=X,R.childLanes=Ml(e,W,d),r.memoizedState=Pl,v):(Tr(r),d=e.child,e=d.sibling,d=Mr(d,{mode:"visible",children:v.children}),d.return=r,d.sibling=null,e!==null&&(W=r.deletions,W===null?(r.deletions=[e],r.flags|=16):W.push(e)),r.child=d,r.memoizedState=null,d)}function Nl(e,r){return r=Ul({mode:"visible",children:r},e.mode),r.return=e,e.child=r}function Ul(e,r){return Vd(e,r,0,null)}function xl(e,r,d){return si(r,e.child,null,d),e=Nl(r,r.pendingProps.children),e.flags|=2,r.memoizedState=null,e}function Sd(e,r,d){e.lanes|=r;var v=e.alternate;v!==null&&(v.lanes|=r),Hl(e.return,r,d)}function jl(e,r,d,v,R){var M=e.memoizedState;M===null?e.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:v,tail:d,tailMode:R}:(M.isBackwards=r,M.rendering=null,M.renderingStartTime=0,M.last=v,M.tail=d,M.tailMode=R)}function Cd(e,r,d){var v=r.pendingProps,R=v.revealOrder,M=v.tail;if(Ut(e,r,v.children,d),v=At.current,(v&2)!==0)v=v&1|2,r.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=r.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Sd(e,d,r);else if(e.tag===19)Sd(e,d,r);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break e;for(;e.sibling===null;){if(e.return===null||e.return===r)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}v&=1}switch(pe(At,v),R){case"forwards":for(d=r.child,R=null;d!==null;)e=d.alternate,e!==null&&co(e)===null&&(R=d),d=d.sibling;d=R,d===null?(R=r.child,r.child=null):(R=d.sibling,d.sibling=null),jl(r,!1,R,d,M);break;case"backwards":for(d=null,R=r.child,r.child=null;R!==null;){if(e=R.alternate,e!==null&&co(e)===null){r.child=R;break}e=R.sibling,R.sibling=d,d=R,R=e}jl(r,!0,d,null,M);break;case"together":jl(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function Vn(e,r,d){if(e!==null&&(r.dependencies=e.dependencies),Nr|=r.lanes,(d&r.childLanes)===0)if(e!==null){if(Zs(e,r,d,!1),(d&r.childLanes)===0)return null}else return null;if(e!==null&&r.child!==e.child)throw Error(U(153));if(r.child!==null){for(e=r.child,d=Mr(e,e.pendingProps),r.child=d,d.return=r;e.sibling!==null;)e=e.sibling,d=d.sibling=Mr(e,e.pendingProps),d.return=r;d.sibling=null}return r.child}function Fl(e,r){return(e.lanes&r)!==0?!0:(e=e.dependencies,!!(e!==null&&bo(e)))}function Sh(e,r,d){switch(r.tag){case 3:we(r,r.stateNode.containerInfo),Ar(r,Ot,e.memoizedState.cache),Hs();break;case 27:case 5:De(r);break;case 4:we(r,r.stateNode.containerInfo);break;case 10:Ar(r,r.type,r.memoizedProps.value);break;case 13:var v=r.memoizedState;if(v!==null)return v.dehydrated!==null?(Tr(r),r.flags|=128,null):(d&r.child.childLanes)!==0?_d(e,r,d):(Tr(r),e=Vn(e,r,d),e!==null?e.sibling:null);Tr(r);break;case 19:var R=(e.flags&128)!==0;if(v=(d&r.childLanes)!==0,v||(Zs(e,r,d,!1),v=(d&r.childLanes)!==0),R){if(v)return Cd(e,r,d);r.flags|=128}if(R=r.memoizedState,R!==null&&(R.rendering=null,R.tail=null,R.lastEffect=null),pe(At,At.current),v)break;return null;case 22:case 23:return r.lanes=0,pd(e,r,d);case 24:Ar(r,Ot,e.memoizedState.cache)}return Vn(e,r,d)}function bd(e,r,d){if(e!==null)if(e.memoizedProps!==r.pendingProps)It=!0;else{if(!Fl(e,d)&&(r.flags&128)===0)return It=!1,Sh(e,r,d);It=(e.flags&131072)!==0}else It=!1,Je&&(r.flags&1048576)!==0&&au(r,io,r.index);switch(r.lanes=0,r.tag){case 16:e:{e=r.pendingProps;var v=r.elementType,R=v._init;if(v=R(v._payload),r.type=v,typeof v=="function")Zl(v)?(e=ui(v,e),r.tag=1,r=vd(null,r,v,e,d)):(r.tag=0,r=Ll(null,r,v,e,d));else{if(v!=null){if(R=v.$$typeof,R===m){r.tag=11,r=dd(null,r,v,e,d);break e}else if(R===s){r.tag=14,r=fd(null,r,v,e,d);break e}}throw r=h(v)||v,Error(U(306,r,""))}}return r;case 0:return Ll(e,r,r.type,r.pendingProps,d);case 1:return v=r.type,R=ui(v,r.pendingProps),vd(e,r,v,R,d);case 3:e:{if(we(r,r.stateNode.containerInfo),e===null)throw Error(U(387));var M=r.pendingProps;R=r.memoizedState,v=R.element,ql(e,r),na(r,M,null,d);var W=r.memoizedState;if(M=W.cache,Ar(r,Ot,M),M!==R.cache&&Bl(r,[Ot],d,!0),ta(),M=W.element,R.isDehydrated)if(R={element:M,isDehydrated:!1,cache:W.cache},r.updateQueue.baseState=R,r.memoizedState=R,r.flags&256){r=yd(e,r,M,d);break e}else if(M!==v){v=an(Error(U(424)),r),Bs(v),r=yd(e,r,M,d);break e}else for(Nt=Cn(r.stateNode.containerInfo.firstChild),$t=r,Je=!0,_n=null,On=!0,d=gu(r,null,M,d),r.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Hs(),M===v){r=Vn(e,r,d);break e}Ut(e,r,M,d)}r=r.child}return r;case 26:return Js(e,r),e===null?(d=Rf(r.type,null,r.pendingProps,null))?r.memoizedState=d:Je||(d=r.type,e=r.pendingProps,v=jo(oe.current).createElement(d),v[wt]=r,v[Mt]=e,xt(v,d,e),ht(v),r.stateNode=v):r.memoizedState=Rf(r.type,e.memoizedProps,r.pendingProps,e.memoizedState),null;case 27:return De(r),e===null&&Je&&(v=r.stateNode=Tf(r.type,r.pendingProps,oe.current),$t=r,On=!0,Nt=Cn(v.firstChild)),v=r.pendingProps.children,e!==null||Je?Ut(e,r,v,d):r.child=si(r,null,v,d),Js(e,r),r.child;case 5:return e===null&&Je&&((R=v=Nt)&&(v=Kh(v,r.type,r.pendingProps,On),v!==null?(r.stateNode=v,$t=r,Nt=Cn(v.firstChild),On=!1,R=!0):R=!1),R||ii(r)),De(r),R=r.type,M=r.pendingProps,W=e!==null?e.memoizedProps:null,v=M.children,wc(R,M)?v=null:W!==null&&wc(R,W)&&(r.flags|=32),r.memoizedState!==null&&(R=hl(e,r,hh,null,null,d),va._currentValue=R),Js(e,r),Ut(e,r,v,d),r.child;case 6:return e===null&&Je&&((e=d=Nt)&&(d=Xh(d,r.pendingProps,On),d!==null?(r.stateNode=d,$t=r,Nt=null,e=!0):e=!1),e||ii(r)),null;case 13:return _d(e,r,d);case 4:return we(r,r.stateNode.containerInfo),v=r.pendingProps,e===null?r.child=si(r,null,v,d):Ut(e,r,v,d),r.child;case 11:return dd(e,r,r.type,r.pendingProps,d);case 7:return Ut(e,r,r.pendingProps,d),r.child;case 8:return Ut(e,r,r.pendingProps.children,d),r.child;case 12:return Ut(e,r,r.pendingProps.children,d),r.child;case 10:return v=r.pendingProps,Ar(r,r.type,v.value),Ut(e,r,v.children,d),r.child;case 9:return R=r.type._context,v=r.pendingProps.children,fi(r),R=jt(R),v=v(R),r.flags|=1,Ut(e,r,v,d),r.child;case 14:return fd(e,r,r.type,r.pendingProps,d);case 15:return hd(e,r,r.type,r.pendingProps,d);case 19:return Cd(e,r,d);case 22:return pd(e,r,d);case 24:return fi(r),v=jt(Ot),e===null?(R=dl(),R===null&&(R=lt,M=cl(),R.pooledCache=M,M.refCount++,M!==null&&(R.pooledCacheLanes|=d),R=M),r.memoizedState={parent:v,cache:R},$l(r),Ar(r,Ot,R)):((e.lanes&d)!==0&&(ql(e,r),na(r,null,null,d),ta()),R=e.memoizedState,M=r.memoizedState,R.parent!==v?(R={parent:v,cache:v},r.memoizedState=R,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=R),Ar(r,Ot,v)):(v=M.cache,Ar(r,Ot,v),v!==R.cache&&Bl(r,[Ot],d,!0))),Ut(e,r,r.pendingProps.children,d),r.child;case 29:throw r.pendingProps}throw Error(U(156,r.tag))}var Gl=ce(null),di=null,zn=null;function Ar(e,r,d){pe(Gl,r._currentValue),r._currentValue=d}function Wn(e){e._currentValue=Gl.current,Re(Gl)}function Hl(e,r,d){for(;e!==null;){var v=e.alternate;if((e.childLanes&r)!==r?(e.childLanes|=r,v!==null&&(v.childLanes|=r)):v!==null&&(v.childLanes&r)!==r&&(v.childLanes|=r),e===d)break;e=e.return}}function Bl(e,r,d,v){var R=e.child;for(R!==null&&(R.return=e);R!==null;){var M=R.dependencies;if(M!==null){var W=R.child;M=M.firstContext;e:for(;M!==null;){var X=M;M=R;for(var ee=0;ee<r.length;ee++)if(X.context===r[ee]){M.lanes|=d,X=M.alternate,X!==null&&(X.lanes|=d),Hl(M.return,d,e),v||(W=null);break e}M=X.next}}else if(R.tag===18){if(W=R.return,W===null)throw Error(U(341));W.lanes|=d,M=W.alternate,M!==null&&(M.lanes|=d),Hl(W,d,e),W=null}else W=R.child;if(W!==null)W.return=R;else for(W=R;W!==null;){if(W===e){W=null;break}if(R=W.sibling,R!==null){R.return=W.return,W=R;break}W=W.return}R=W}}function Zs(e,r,d,v){e=null;for(var R=r,M=!1;R!==null;){if(!M){if((R.flags&524288)!==0)M=!0;else if((R.flags&262144)!==0)break}if(R.tag===10){var W=R.alternate;if(W===null)throw Error(U(387));if(W=W.memoizedProps,W!==null){var X=R.type;be(R.pendingProps.value,W.value)||(e!==null?e.push(X):e=[X])}}else if(R===_e.current){if(W=R.alternate,W===null)throw Error(U(387));W.memoizedState.memoizedState!==R.memoizedState.memoizedState&&(e!==null?e.push(va):e=[va])}R=R.return}e!==null&&Bl(r,e,d,v),r.flags|=262144}function bo(e){for(e=e.firstContext;e!==null;){if(!be(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function fi(e){di=e,zn=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function jt(e){return Td(di,e)}function To(e,r){return di===null&&fi(e),Td(e,r)}function Td(e,r){var d=r._currentValue;if(r={context:r,memoizedValue:d,next:null},zn===null){if(e===null)throw Error(U(308));zn=r,e.dependencies={lanes:0,firstContext:r},e.flags|=524288}else zn=zn.next=r;return d}var Or=!1;function $l(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ql(e,r){e=e.updateQueue,r.updateQueue===e&&(r.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function kr(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Ir(e,r,d){var v=e.updateQueue;if(v===null)return null;if(v=v.shared,(gt&2)!==0){var R=v.pending;return R===null?r.next=r:(r.next=R.next,R.next=r),v.pending=r,r=no(e),iu(e,null,d),r}return to(e,v,r,d),no(e)}function ea(e,r,d){if(r=r.updateQueue,r!==null&&(r=r.shared,(d&4194176)!==0)){var v=r.lanes;v&=e.pendingLanes,d|=v,r.lanes=d,ms(e,d)}}function Vl(e,r){var d=e.updateQueue,v=e.alternate;if(v!==null&&(v=v.updateQueue,d===v)){var R=null,M=null;if(d=d.firstBaseUpdate,d!==null){do{var W={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};M===null?R=M=W:M=M.next=W,d=d.next}while(d!==null);M===null?R=M=r:M=M.next=r}else R=M=r;d={baseState:v.baseState,firstBaseUpdate:R,lastBaseUpdate:M,shared:v.shared,callbacks:v.callbacks},e.updateQueue=d;return}e=d.lastBaseUpdate,e===null?d.firstBaseUpdate=r:e.next=r,d.lastBaseUpdate=r}var zl=!1;function ta(){if(zl){var e=Ki;if(e!==null)throw e}}function na(e,r,d,v){zl=!1;var R=e.updateQueue;Or=!1;var M=R.firstBaseUpdate,W=R.lastBaseUpdate,X=R.shared.pending;if(X!==null){R.shared.pending=null;var ee=X,se=ee.next;ee.next=null,W===null?M=se:W.next=se,W=ee;var ye=e.alternate;ye!==null&&(ye=ye.updateQueue,X=ye.lastBaseUpdate,X!==W&&(X===null?ye.firstBaseUpdate=se:X.next=se,ye.lastBaseUpdate=ee))}if(M!==null){var Te=R.baseState;W=0,ye=se=ee=null,X=M;do{var de=X.lane&-536870913,ve=de!==X.lane;if(ve?(Xe&de)===de:(v&de)===de){de!==0&&de===Qi&&(zl=!0),ye!==null&&(ye=ye.next={lane:0,tag:X.tag,payload:X.payload,callback:null,next:null});e:{var Ue=e,qe=X;de=r;var yt=d;switch(qe.tag){case 1:if(Ue=qe.payload,typeof Ue=="function"){Te=Ue.call(yt,Te,de);break e}Te=Ue;break e;case 3:Ue.flags=Ue.flags&-65537|128;case 0:if(Ue=qe.payload,de=typeof Ue=="function"?Ue.call(yt,Te,de):Ue,de==null)break e;Te=E({},Te,de);break e;case 2:Or=!0}}de=X.callback,de!==null&&(e.flags|=64,ve&&(e.flags|=8192),ve=R.callbacks,ve===null?R.callbacks=[de]:ve.push(de))}else ve={lane:de,tag:X.tag,payload:X.payload,callback:X.callback,next:null},ye===null?(se=ye=ve,ee=Te):ye=ye.next=ve,W|=de;if(X=X.next,X===null){if(X=R.shared.pending,X===null)break;ve=X,X=ve.next,ve.next=null,R.lastBaseUpdate=ve,R.shared.pending=null}}while(!0);ye===null&&(ee=Te),R.baseState=ee,R.firstBaseUpdate=se,R.lastBaseUpdate=ye,M===null&&(R.shared.lanes=0),Nr|=W,e.lanes=W,e.memoizedState=Te}}function Ed(e,r){if(typeof e!="function")throw Error(U(191,e));e.call(r)}function wd(e,r){var d=e.callbacks;if(d!==null)for(e.callbacks=null,e=0;e<d.length;e++)Ed(d[e],r)}function ra(e,r){try{var d=r.updateQueue,v=d!==null?d.lastEffect:null;if(v!==null){var R=v.next;d=R;do{if((d.tag&e)===e){v=void 0;var M=d.create,W=d.inst;v=M(),W.destroy=v}d=d.next}while(d!==R)}}catch(X){ot(r,r.return,X)}}function Lr(e,r,d){try{var v=r.updateQueue,R=v!==null?v.lastEffect:null;if(R!==null){var M=R.next;v=M;do{if((v.tag&e)===e){var W=v.inst,X=W.destroy;if(X!==void 0){W.destroy=void 0,R=r;var ee=d;try{X()}catch(se){ot(R,ee,se)}}}v=v.next}while(v!==M)}}catch(se){ot(r,r.return,se)}}function Rd(e){var r=e.updateQueue;if(r!==null){var d=e.stateNode;try{wd(r,d)}catch(v){ot(e,e.return,v)}}}function Ad(e,r,d){d.props=ui(e.type,e.memoizedProps),d.state=e.memoizedState;try{d.componentWillUnmount()}catch(v){ot(e,r,v)}}function hi(e,r){try{var d=e.ref;if(d!==null){var v=e.stateNode;switch(e.tag){case 26:case 27:case 5:var R=v;break;default:R=v}typeof d=="function"?e.refCleanup=d(R):d.current=R}}catch(M){ot(e,r,M)}}function Yt(e,r){var d=e.ref,v=e.refCleanup;if(d!==null)if(typeof v=="function")try{v()}catch(R){ot(e,r,R)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(R){ot(e,r,R)}else d.current=null}function Od(e){var r=e.type,d=e.memoizedProps,v=e.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":d.autoFocus&&v.focus();break e;case"img":d.src?v.src=d.src:d.srcSet&&(v.srcset=d.srcSet)}}catch(R){ot(e,e.return,R)}}function kd(e,r,d){try{var v=e.stateNode;Vh(v,e.type,d,r),v[Mt]=r}catch(R){ot(e,e.return,R)}}function Id(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27||e.tag===4}function Wl(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Id(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==27&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Yl(e,r,d){var v=e.tag;if(v===5||v===6)e=e.stateNode,r?d.nodeType===8?d.parentNode.insertBefore(e,r):d.insertBefore(e,r):(d.nodeType===8?(r=d.parentNode,r.insertBefore(e,d)):(r=d,r.appendChild(e)),d=d._reactRootContainer,d!=null||r.onclick!==null||(r.onclick=xo));else if(v!==4&&v!==27&&(e=e.child,e!==null))for(Yl(e,r,d),e=e.sibling;e!==null;)Yl(e,r,d),e=e.sibling}function Eo(e,r,d){var v=e.tag;if(v===5||v===6)e=e.stateNode,r?d.insertBefore(e,r):d.appendChild(e);else if(v!==4&&v!==27&&(e=e.child,e!==null))for(Eo(e,r,d),e=e.sibling;e!==null;)Eo(e,r,d),e=e.sibling}var Yn=!1,mt=!1,Ql=!1,Ld=typeof WeakSet=="function"?WeakSet:Set,Lt=null,Pd=!1;function Ch(e,r){if(e=e.containerInfo,Tc=qo,e=Qc(e),Xo(e)){if("selectionStart"in e)var d={start:e.selectionStart,end:e.selectionEnd};else e:{d=(d=e.ownerDocument)&&d.defaultView||window;var v=d.getSelection&&d.getSelection();if(v&&v.rangeCount!==0){d=v.anchorNode;var R=v.anchorOffset,M=v.focusNode;v=v.focusOffset;try{d.nodeType,M.nodeType}catch{d=null;break e}var W=0,X=-1,ee=-1,se=0,ye=0,Te=e,de=null;t:for(;;){for(var ve;Te!==d||R!==0&&Te.nodeType!==3||(X=W+R),Te!==M||v!==0&&Te.nodeType!==3||(ee=W+v),Te.nodeType===3&&(W+=Te.nodeValue.length),(ve=Te.firstChild)!==null;)de=Te,Te=ve;for(;;){if(Te===e)break t;if(de===d&&++se===R&&(X=W),de===M&&++ye===v&&(ee=W),(ve=Te.nextSibling)!==null)break;Te=de,de=Te.parentNode}Te=ve}d=X===-1||ee===-1?null:{start:X,end:ee}}else d=null}d=d||{start:0,end:0}}else d=null;for(Ec={focusedElem:e,selectionRange:d},qo=!1,Lt=r;Lt!==null;)if(r=Lt,e=r.child,(r.subtreeFlags&1028)!==0&&e!==null)e.return=r,Lt=e;else for(;Lt!==null;){switch(r=Lt,M=r.alternate,e=r.flags,r.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&M!==null){e=void 0,d=r,R=M.memoizedProps,M=M.memoizedState,v=d.stateNode;try{var Ue=ui(d.type,R,d.elementType===d.type);e=v.getSnapshotBeforeUpdate(Ue,M),v.__reactInternalSnapshotBeforeUpdate=e}catch(qe){ot(d,d.return,qe)}}break;case 3:if((e&1024)!==0){if(e=r.stateNode.containerInfo,d=e.nodeType,d===9)Oc(e);else if(d===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Oc(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(U(163))}if(e=r.sibling,e!==null){e.return=r.return,Lt=e;break}Lt=r.return}return Ue=Pd,Pd=!1,Ue}function Dd(e,r,d){var v=d.flags;switch(d.tag){case 0:case 11:case 15:Kn(e,d),v&4&&ra(5,d);break;case 1:if(Kn(e,d),v&4)if(e=d.stateNode,r===null)try{e.componentDidMount()}catch(X){ot(d,d.return,X)}else{var R=ui(d.type,r.memoizedProps);r=r.memoizedState;try{e.componentDidUpdate(R,r,e.__reactInternalSnapshotBeforeUpdate)}catch(X){ot(d,d.return,X)}}v&64&&Rd(d),v&512&&hi(d,d.return);break;case 3:if(Kn(e,d),v&64&&(v=d.updateQueue,v!==null)){if(e=null,d.child!==null)switch(d.child.tag){case 27:case 5:e=d.child.stateNode;break;case 1:e=d.child.stateNode}try{wd(v,e)}catch(X){ot(d,d.return,X)}}break;case 26:Kn(e,d),v&512&&hi(d,d.return);break;case 27:case 5:Kn(e,d),r===null&&v&4&&Od(d),v&512&&hi(d,d.return);break;case 12:Kn(e,d);break;case 13:Kn(e,d),v&4&&Ud(e,d);break;case 22:if(R=d.memoizedState!==null||Yn,!R){r=r!==null&&r.memoizedState!==null||mt;var M=Yn,W=mt;Yn=R,(mt=r)&&!W?Pr(e,d,(d.subtreeFlags&8772)!==0):Kn(e,d),Yn=M,mt=W}v&512&&(d.memoizedProps.mode==="manual"?hi(d,d.return):Yt(d,d.return));break;default:Kn(e,d)}}function Md(e){var r=e.alternate;r!==null&&(e.alternate=null,Md(r)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(r=e.stateNode,r!==null&&ar(r)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Tt=null,Qt=!1;function Qn(e,r,d){for(d=d.child;d!==null;)Nd(e,r,d),d=d.sibling}function Nd(e,r,d){if(Ae&&typeof Ae.onCommitFiberUnmount=="function")try{Ae.onCommitFiberUnmount(ge,d)}catch{}switch(d.tag){case 26:mt||Yt(d,r),Qn(e,r,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:mt||Yt(d,r);var v=Tt,R=Qt;for(Tt=d.stateNode,Qn(e,r,d),d=d.stateNode,r=d.attributes;r.length;)d.removeAttributeNode(r[0]);ar(d),Tt=v,Qt=R;break;case 5:mt||Yt(d,r);case 6:R=Tt;var M=Qt;if(Tt=null,Qn(e,r,d),Tt=R,Qt=M,Tt!==null)if(Qt)try{e=Tt,v=d.stateNode,e.nodeType===8?e.parentNode.removeChild(v):e.removeChild(v)}catch(W){ot(d,r,W)}else try{Tt.removeChild(d.stateNode)}catch(W){ot(d,r,W)}break;case 18:Tt!==null&&(Qt?(r=Tt,d=d.stateNode,r.nodeType===8?Ac(r.parentNode,d):r.nodeType===1&&Ac(r,d),Ca(r)):Ac(Tt,d.stateNode));break;case 4:v=Tt,R=Qt,Tt=d.stateNode.containerInfo,Qt=!0,Qn(e,r,d),Tt=v,Qt=R;break;case 0:case 11:case 14:case 15:mt||Lr(2,d,r),mt||Lr(4,d,r),Qn(e,r,d);break;case 1:mt||(Yt(d,r),v=d.stateNode,typeof v.componentWillUnmount=="function"&&Ad(d,r,v)),Qn(e,r,d);break;case 21:Qn(e,r,d);break;case 22:mt||Yt(d,r),mt=(v=mt)||d.memoizedState!==null,Qn(e,r,d),mt=v;break;default:Qn(e,r,d)}}function Ud(e,r){if(r.memoizedState===null&&(e=r.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Ca(e)}catch(d){ot(r,r.return,d)}}function bh(e){switch(e.tag){case 13:case 19:var r=e.stateNode;return r===null&&(r=e.stateNode=new Ld),r;case 22:return e=e.stateNode,r=e._retryCache,r===null&&(r=e._retryCache=new Ld),r;default:throw Error(U(435,e.tag))}}function Kl(e,r){var d=bh(e);r.forEach(function(v){var R=Nh.bind(null,e,v);d.has(v)||(d.add(v),v.then(R,R))})}function un(e,r){var d=r.deletions;if(d!==null)for(var v=0;v<d.length;v++){var R=d[v],M=e,W=r,X=W;e:for(;X!==null;){switch(X.tag){case 27:case 5:Tt=X.stateNode,Qt=!1;break e;case 3:Tt=X.stateNode.containerInfo,Qt=!0;break e;case 4:Tt=X.stateNode.containerInfo,Qt=!0;break e}X=X.return}if(Tt===null)throw Error(U(160));Nd(M,W,R),Tt=null,Qt=!1,M=R.alternate,M!==null&&(M.return=null),R.return=null}if(r.subtreeFlags&13878)for(r=r.child;r!==null;)xd(r,e),r=r.sibling}var Sn=null;function xd(e,r){var d=e.alternate,v=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:un(r,e),dn(e),v&4&&(Lr(3,e,e.return),ra(3,e),Lr(5,e,e.return));break;case 1:un(r,e),dn(e),v&512&&(mt||d===null||Yt(d,d.return)),v&64&&Yn&&(e=e.updateQueue,e!==null&&(v=e.callbacks,v!==null&&(d=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=d===null?v:d.concat(v))));break;case 26:var R=Sn;if(un(r,e),dn(e),v&512&&(mt||d===null||Yt(d,d.return)),v&4){var M=d!==null?d.memoizedState:null;if(v=e.memoizedState,d===null)if(v===null)if(e.stateNode===null){e:{v=e.type,d=e.memoizedProps,R=R.ownerDocument||R;t:switch(v){case"title":M=R.getElementsByTagName("title")[0],(!M||M[sr]||M[wt]||M.namespaceURI==="http://www.w3.org/2000/svg"||M.hasAttribute("itemprop"))&&(M=R.createElement(v),R.head.insertBefore(M,R.querySelector("head > title"))),xt(M,v,d),M[wt]=e,ht(M),v=M;break e;case"link":var W=kf("link","href",R).get(v+(d.href||""));if(W){for(var X=0;X<W.length;X++)if(M=W[X],M.getAttribute("href")===(d.href==null?null:d.href)&&M.getAttribute("rel")===(d.rel==null?null:d.rel)&&M.getAttribute("title")===(d.title==null?null:d.title)&&M.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){W.splice(X,1);break t}}M=R.createElement(v),xt(M,v,d),R.head.appendChild(M);break;case"meta":if(W=kf("meta","content",R).get(v+(d.content||""))){for(X=0;X<W.length;X++)if(M=W[X],M.getAttribute("content")===(d.content==null?null:""+d.content)&&M.getAttribute("name")===(d.name==null?null:d.name)&&M.getAttribute("property")===(d.property==null?null:d.property)&&M.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&M.getAttribute("charset")===(d.charSet==null?null:d.charSet)){W.splice(X,1);break t}}M=R.createElement(v),xt(M,v,d),R.head.appendChild(M);break;default:throw Error(U(468,v))}M[wt]=e,ht(M),v=M}e.stateNode=v}else If(R,e.type,e.stateNode);else e.stateNode=Of(R,v,e.memoizedProps);else M!==v?(M===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):M.count--,v===null?If(R,e.type,e.stateNode):Of(R,v,e.memoizedProps)):v===null&&e.stateNode!==null&&kd(e,e.memoizedProps,d.memoizedProps)}break;case 27:if(v&4&&e.alternate===null){R=e.stateNode,M=e.memoizedProps;try{for(var ee=R.firstChild;ee;){var se=ee.nextSibling,ye=ee.nodeName;ee[sr]||ye==="HEAD"||ye==="BODY"||ye==="SCRIPT"||ye==="STYLE"||ye==="LINK"&&ee.rel.toLowerCase()==="stylesheet"||R.removeChild(ee),ee=se}for(var Te=e.type,de=R.attributes;de.length;)R.removeAttributeNode(de[0]);xt(R,Te,M),R[wt]=e,R[Mt]=M}catch(Ue){ot(e,e.return,Ue)}}case 5:if(un(r,e),dn(e),v&512&&(mt||d===null||Yt(d,d.return)),e.flags&32){R=e.stateNode;try{Un(R,"")}catch(Ue){ot(e,e.return,Ue)}}v&4&&e.stateNode!=null&&(R=e.memoizedProps,kd(e,R,d!==null?d.memoizedProps:R)),v&1024&&(Ql=!0);break;case 6:if(un(r,e),dn(e),v&4){if(e.stateNode===null)throw Error(U(162));v=e.memoizedProps,d=e.stateNode;try{d.nodeValue=v}catch(Ue){ot(e,e.return,Ue)}}break;case 3:if(Ho=null,R=Sn,Sn=Fo(r.containerInfo),un(r,e),Sn=R,dn(e),v&4&&d!==null&&d.memoizedState.isDehydrated)try{Ca(r.containerInfo)}catch(Ue){ot(e,e.return,Ue)}Ql&&(Ql=!1,jd(e));break;case 4:v=Sn,Sn=Fo(e.stateNode.containerInfo),un(r,e),dn(e),Sn=v;break;case 12:un(r,e),dn(e);break;case 13:un(r,e),dn(e),e.child.flags&8192&&e.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(sc=St()),v&4&&(v=e.updateQueue,v!==null&&(e.updateQueue=null,Kl(e,v)));break;case 22:if(v&512&&(mt||d===null||Yt(d,d.return)),ee=e.memoizedState!==null,se=d!==null&&d.memoizedState!==null,ye=Yn,Te=mt,Yn=ye||ee,mt=Te||se,un(r,e),mt=Te,Yn=ye,dn(e),r=e.stateNode,r._current=e,r._visibility&=-3,r._visibility|=r._pendingVisibility&2,v&8192&&(r._visibility=ee?r._visibility&-2:r._visibility|1,ee&&(r=Yn||mt,d===null||se||r||es(e)),e.memoizedProps===null||e.memoizedProps.mode!=="manual"))e:for(d=null,r=e;;){if(r.tag===5||r.tag===26||r.tag===27){if(d===null){se=d=r;try{if(R=se.stateNode,ee)M=R.style,typeof M.setProperty=="function"?M.setProperty("display","none","important"):M.display="none";else{W=se.stateNode,X=se.memoizedProps.style;var ve=X!=null&&X.hasOwnProperty("display")?X.display:null;W.style.display=ve==null||typeof ve=="boolean"?"":(""+ve).trim()}}catch(Ue){ot(se,se.return,Ue)}}}else if(r.tag===6){if(d===null){se=r;try{se.stateNode.nodeValue=ee?"":se.memoizedProps}catch(Ue){ot(se,se.return,Ue)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===e)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;d===r&&(d=null),r=r.return}d===r&&(d=null),r.sibling.return=r.return,r=r.sibling}v&4&&(v=e.updateQueue,v!==null&&(d=v.retryQueue,d!==null&&(v.retryQueue=null,Kl(e,d))));break;case 19:un(r,e),dn(e),v&4&&(v=e.updateQueue,v!==null&&(e.updateQueue=null,Kl(e,v)));break;case 21:break;default:un(r,e),dn(e)}}function dn(e){var r=e.flags;if(r&2){try{if(e.tag!==27){e:{for(var d=e.return;d!==null;){if(Id(d)){var v=d;break e}d=d.return}throw Error(U(160))}switch(v.tag){case 27:var R=v.stateNode,M=Wl(e);Eo(e,M,R);break;case 5:var W=v.stateNode;v.flags&32&&(Un(W,""),v.flags&=-33);var X=Wl(e);Eo(e,X,W);break;case 3:case 4:var ee=v.stateNode.containerInfo,se=Wl(e);Yl(e,se,ee);break;default:throw Error(U(161))}}}catch(ye){ot(e,e.return,ye)}e.flags&=-3}r&4096&&(e.flags&=-4097)}function jd(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var r=e;jd(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),e=e.sibling}}function Kn(e,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)Dd(e,r.alternate,r),r=r.sibling}function es(e){for(e=e.child;e!==null;){var r=e;switch(r.tag){case 0:case 11:case 14:case 15:Lr(4,r,r.return),es(r);break;case 1:Yt(r,r.return);var d=r.stateNode;typeof d.componentWillUnmount=="function"&&Ad(r,r.return,d),es(r);break;case 26:case 27:case 5:Yt(r,r.return),es(r);break;case 22:Yt(r,r.return),r.memoizedState===null&&es(r);break;default:es(r)}e=e.sibling}}function Pr(e,r,d){for(d=d&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var v=r.alternate,R=e,M=r,W=M.flags;switch(M.tag){case 0:case 11:case 15:Pr(R,M,d),ra(4,M);break;case 1:if(Pr(R,M,d),v=M,R=v.stateNode,typeof R.componentDidMount=="function")try{R.componentDidMount()}catch(se){ot(v,v.return,se)}if(v=M,R=v.updateQueue,R!==null){var X=v.stateNode;try{var ee=R.shared.hiddenCallbacks;if(ee!==null)for(R.shared.hiddenCallbacks=null,R=0;R<ee.length;R++)Ed(ee[R],X)}catch(se){ot(v,v.return,se)}}d&&W&64&&Rd(M),hi(M,M.return);break;case 26:case 27:case 5:Pr(R,M,d),d&&v===null&&W&4&&Od(M),hi(M,M.return);break;case 12:Pr(R,M,d);break;case 13:Pr(R,M,d),d&&W&4&&Ud(R,M);break;case 22:M.memoizedState===null&&Pr(R,M,d),hi(M,M.return);break;default:Pr(R,M,d)}r=r.sibling}}function Xl(e,r){var d=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(d=e.memoizedState.cachePool.pool),e=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(e=r.memoizedState.cachePool.pool),e!==d&&(e!=null&&e.refCount++,d!=null&&Ws(d))}function Jl(e,r){e=null,r.alternate!==null&&(e=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==e&&(r.refCount++,e!=null&&Ws(e))}function Dr(e,r,d,v){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Fd(e,r,d,v),r=r.sibling}function Fd(e,r,d,v){var R=r.flags;switch(r.tag){case 0:case 11:case 15:Dr(e,r,d,v),R&2048&&ra(9,r);break;case 3:Dr(e,r,d,v),R&2048&&(e=null,r.alternate!==null&&(e=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==e&&(r.refCount++,e!=null&&Ws(e)));break;case 12:if(R&2048){Dr(e,r,d,v),e=r.stateNode;try{var M=r.memoizedProps,W=M.id,X=M.onPostCommit;typeof X=="function"&&X(W,r.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(ee){ot(r,r.return,ee)}}else Dr(e,r,d,v);break;case 23:break;case 22:M=r.stateNode,r.memoizedState!==null?M._visibility&4?Dr(e,r,d,v):ia(e,r):M._visibility&4?Dr(e,r,d,v):(M._visibility|=4,ts(e,r,d,v,(r.subtreeFlags&10256)!==0)),R&2048&&Xl(r.alternate,r);break;case 24:Dr(e,r,d,v),R&2048&&Jl(r.alternate,r);break;default:Dr(e,r,d,v)}}function ts(e,r,d,v,R){for(R=R&&(r.subtreeFlags&10256)!==0,r=r.child;r!==null;){var M=e,W=r,X=d,ee=v,se=W.flags;switch(W.tag){case 0:case 11:case 15:ts(M,W,X,ee,R),ra(8,W);break;case 23:break;case 22:var ye=W.stateNode;W.memoizedState!==null?ye._visibility&4?ts(M,W,X,ee,R):ia(M,W):(ye._visibility|=4,ts(M,W,X,ee,R)),R&&se&2048&&Xl(W.alternate,W);break;case 24:ts(M,W,X,ee,R),R&&se&2048&&Jl(W.alternate,W);break;default:ts(M,W,X,ee,R)}r=r.sibling}}function ia(e,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var d=e,v=r,R=v.flags;switch(v.tag){case 22:ia(d,v),R&2048&&Xl(v.alternate,v);break;case 24:ia(d,v),R&2048&&Jl(v.alternate,v);break;default:ia(d,v)}r=r.sibling}}var sa=8192;function ns(e){if(e.subtreeFlags&sa)for(e=e.child;e!==null;)Gd(e),e=e.sibling}function Gd(e){switch(e.tag){case 26:ns(e),e.flags&sa&&e.memoizedState!==null&&up(Sn,e.memoizedState,e.memoizedProps);break;case 5:ns(e);break;case 3:case 4:var r=Sn;Sn=Fo(e.stateNode.containerInfo),ns(e),Sn=r;break;case 22:e.memoizedState===null&&(r=e.alternate,r!==null&&r.memoizedState!==null?(r=sa,sa=16777216,ns(e),sa=r):ns(e));break;default:ns(e)}}function Hd(e){var r=e.alternate;if(r!==null&&(e=r.child,e!==null)){r.child=null;do r=e.sibling,e.sibling=null,e=r;while(e!==null)}}function aa(e){var r=e.deletions;if((e.flags&16)!==0){if(r!==null)for(var d=0;d<r.length;d++){var v=r[d];Lt=v,$d(v,e)}Hd(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Bd(e),e=e.sibling}function Bd(e){switch(e.tag){case 0:case 11:case 15:aa(e),e.flags&2048&&Lr(9,e,e.return);break;case 3:aa(e);break;case 12:aa(e);break;case 22:var r=e.stateNode;e.memoizedState!==null&&r._visibility&4&&(e.return===null||e.return.tag!==13)?(r._visibility&=-5,wo(e)):aa(e);break;default:aa(e)}}function wo(e){var r=e.deletions;if((e.flags&16)!==0){if(r!==null)for(var d=0;d<r.length;d++){var v=r[d];Lt=v,$d(v,e)}Hd(e)}for(e=e.child;e!==null;){switch(r=e,r.tag){case 0:case 11:case 15:Lr(8,r,r.return),wo(r);break;case 22:d=r.stateNode,d._visibility&4&&(d._visibility&=-5,wo(r));break;default:wo(r)}e=e.sibling}}function $d(e,r){for(;Lt!==null;){var d=Lt;switch(d.tag){case 0:case 11:case 15:Lr(8,d,r);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var v=d.memoizedState.cachePool.pool;v!=null&&v.refCount++}break;case 24:Ws(d.memoizedState.cache)}if(v=d.child,v!==null)v.return=d,Lt=v;else e:for(d=e;Lt!==null;){v=Lt;var R=v.sibling,M=v.return;if(Md(v),v===d){Lt=null;break e}if(R!==null){R.return=M,Lt=R;break e}Lt=M}}}function Th(e,r,d,v){this.tag=e,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=v,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fn(e,r,d,v){return new Th(e,r,d,v)}function Zl(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Mr(e,r){var d=e.alternate;return d===null?(d=fn(e.tag,r,e.key,e.mode),d.elementType=e.elementType,d.type=e.type,d.stateNode=e.stateNode,d.alternate=e,e.alternate=d):(d.pendingProps=r,d.type=e.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=e.flags&31457280,d.childLanes=e.childLanes,d.lanes=e.lanes,d.child=e.child,d.memoizedProps=e.memoizedProps,d.memoizedState=e.memoizedState,d.updateQueue=e.updateQueue,r=e.dependencies,d.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},d.sibling=e.sibling,d.index=e.index,d.ref=e.ref,d.refCleanup=e.refCleanup,d}function qd(e,r){e.flags&=31457282;var d=e.alternate;return d===null?(e.childLanes=0,e.lanes=r,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=d.childLanes,e.lanes=d.lanes,e.child=d.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=d.memoizedProps,e.memoizedState=d.memoizedState,e.updateQueue=d.updateQueue,e.type=d.type,r=d.dependencies,e.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),e}function Ro(e,r,d,v,R,M){var W=0;if(v=e,typeof e=="function")Zl(e)&&(W=1);else if(typeof e=="string")W=lp(e,d,Oe.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case N:return pi(d.children,R,M,r);case S:W=8,R|=24;break;case p:return e=fn(12,d,r,R|2),e.elementType=p,e.lanes=M,e;case f:return e=fn(13,d,r,R),e.elementType=f,e.lanes=M,e;case o:return e=fn(19,d,r,R),e.elementType=o,e.lanes=M,e;case i:return Vd(d,R,M,r);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case b:case t:W=10;break e;case _:W=9;break e;case m:W=11;break e;case s:W=14;break e;case n:W=16,v=null;break e}W=29,d=Error(U(130,e===null?"null":typeof e,"")),v=null}return r=fn(W,d,r,R),r.elementType=e,r.type=v,r.lanes=M,r}function pi(e,r,d,v){return e=fn(7,e,v,r),e.lanes=d,e}function Vd(e,r,d,v){e=fn(22,e,v,r),e.elementType=i,e.lanes=d;var R={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var M=R._current;if(M===null)throw Error(U(456));if((R._pendingVisibility&2)===0){var W=br(M,2);W!==null&&(R._pendingVisibility|=2,qt(W,M,2))}},attach:function(){var M=R._current;if(M===null)throw Error(U(456));if((R._pendingVisibility&2)!==0){var W=br(M,2);W!==null&&(R._pendingVisibility&=-3,qt(W,M,2))}}};return e.stateNode=R,e}function ec(e,r,d){return e=fn(6,e,null,r),e.lanes=d,e}function tc(e,r,d){return r=fn(4,e.children!==null?e.children:[],e.key,r),r.lanes=d,r.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},r}function Xn(e){e.flags|=4}function zd(e,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Lf(r)){if(r=cn.current,r!==null&&((Xe&4194176)===Xe?kn!==null:(Xe&62914560)!==Xe&&(Xe&536870912)===0||r!==kn))throw qs=al,cu;e.flags|=8192}}function Ao(e,r){r!==null&&(e.flags|=4),e.flags&16384&&(r=e.tag!==22?ps():536870912,e.lanes|=r,is|=r)}function oa(e,r){if(!Je)switch(e.tailMode){case"hidden":r=e.tail;for(var d=null;r!==null;)r.alternate!==null&&(d=r),r=r.sibling;d===null?e.tail=null:d.sibling=null;break;case"collapsed":d=e.tail;for(var v=null;d!==null;)d.alternate!==null&&(v=d),d=d.sibling;v===null?r||e.tail===null?e.tail=null:e.tail.sibling=null:v.sibling=null}}function pt(e){var r=e.alternate!==null&&e.alternate.child===e.child,d=0,v=0;if(r)for(var R=e.child;R!==null;)d|=R.lanes|R.childLanes,v|=R.subtreeFlags&31457280,v|=R.flags&31457280,R.return=e,R=R.sibling;else for(R=e.child;R!==null;)d|=R.lanes|R.childLanes,v|=R.subtreeFlags,v|=R.flags,R.return=e,R=R.sibling;return e.subtreeFlags|=v,e.childLanes=d,r}function Eh(e,r,d){var v=r.pendingProps;switch(il(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return pt(r),null;case 1:return pt(r),null;case 3:return d=r.stateNode,v=null,e!==null&&(v=e.memoizedState.cache),r.memoizedState.cache!==v&&(r.flags|=2048),Wn(Ot),Ee(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(e===null||e.child===null)&&(Gs(r)?Xn(r):e===null||e.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,_n!==null&&(cc(_n),_n=null))),pt(r),null;case 26:return d=r.memoizedState,e===null?(Xn(r),d!==null?(pt(r),zd(r,d)):(pt(r),r.flags&=-16777217)):d?d!==e.memoizedState?(Xn(r),pt(r),zd(r,d)):(pt(r),r.flags&=-16777217):(e.memoizedProps!==v&&Xn(r),pt(r),r.flags&=-16777217),null;case 27:Fe(r),d=oe.current;var R=r.type;if(e!==null&&r.stateNode!=null)e.memoizedProps!==v&&Xn(r);else{if(!v){if(r.stateNode===null)throw Error(U(166));return pt(r),null}e=Oe.current,Gs(r)?ou(r):(e=Tf(R,v,d),r.stateNode=e,Xn(r))}return pt(r),null;case 5:if(Fe(r),d=r.type,e!==null&&r.stateNode!=null)e.memoizedProps!==v&&Xn(r);else{if(!v){if(r.stateNode===null)throw Error(U(166));return pt(r),null}if(e=Oe.current,Gs(r))ou(r);else{switch(R=jo(oe.current),e){case 1:e=R.createElementNS("http://www.w3.org/2000/svg",d);break;case 2:e=R.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;default:switch(d){case"svg":e=R.createElementNS("http://www.w3.org/2000/svg",d);break;case"math":e=R.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;case"script":e=R.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof v.is=="string"?R.createElement("select",{is:v.is}):R.createElement("select"),v.multiple?e.multiple=!0:v.size&&(e.size=v.size);break;default:e=typeof v.is=="string"?R.createElement(d,{is:v.is}):R.createElement(d)}}e[wt]=r,e[Mt]=v;e:for(R=r.child;R!==null;){if(R.tag===5||R.tag===6)e.appendChild(R.stateNode);else if(R.tag!==4&&R.tag!==27&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===r)break e;for(;R.sibling===null;){if(R.return===null||R.return===r)break e;R=R.return}R.sibling.return=R.return,R=R.sibling}r.stateNode=e;e:switch(xt(e,d,v),d){case"button":case"input":case"select":case"textarea":e=!!v.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Xn(r)}}return pt(r),r.flags&=-16777217,null;case 6:if(e&&r.stateNode!=null)e.memoizedProps!==v&&Xn(r);else{if(typeof v!="string"&&r.stateNode===null)throw Error(U(166));if(e=oe.current,Gs(r)){if(e=r.stateNode,d=r.memoizedProps,v=null,R=$t,R!==null)switch(R.tag){case 27:case 5:v=R.memoizedProps}e[wt]=r,e=!!(e.nodeValue===d||v!==null&&v.suppressHydrationWarning===!0||vf(e.nodeValue,d)),e||ii(r)}else e=jo(e).createTextNode(v),e[wt]=r,r.stateNode=e}return pt(r),null;case 13:if(v=r.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(R=Gs(r),v!==null&&v.dehydrated!==null){if(e===null){if(!R)throw Error(U(318));if(R=r.memoizedState,R=R!==null?R.dehydrated:null,!R)throw Error(U(317));R[wt]=r}else Hs(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;pt(r),R=!1}else _n!==null&&(cc(_n),_n=null),R=!0;if(!R)return r.flags&256?($n(r),r):($n(r),null)}if($n(r),(r.flags&128)!==0)return r.lanes=d,r;if(d=v!==null,e=e!==null&&e.memoizedState!==null,d){v=r.child,R=null,v.alternate!==null&&v.alternate.memoizedState!==null&&v.alternate.memoizedState.cachePool!==null&&(R=v.alternate.memoizedState.cachePool.pool);var M=null;v.memoizedState!==null&&v.memoizedState.cachePool!==null&&(M=v.memoizedState.cachePool.pool),M!==R&&(v.flags|=2048)}return d!==e&&d&&(r.child.flags|=8192),Ao(r,r.updateQueue),pt(r),null;case 4:return Ee(),e===null&&Sc(r.stateNode.containerInfo),pt(r),null;case 10:return Wn(r.type),pt(r),null;case 19:if(Re(At),R=r.memoizedState,R===null)return pt(r),null;if(v=(r.flags&128)!==0,M=R.rendering,M===null)if(v)oa(R,!1);else{if(vt!==0||e!==null&&(e.flags&128)!==0)for(e=r.child;e!==null;){if(M=co(e),M!==null){for(r.flags|=128,oa(R,!1),e=M.updateQueue,r.updateQueue=e,Ao(r,e),r.subtreeFlags=0,e=d,d=r.child;d!==null;)qd(d,e),d=d.sibling;return pe(At,At.current&1|2),r.child}e=e.sibling}R.tail!==null&&St()>Oo&&(r.flags|=128,v=!0,oa(R,!1),r.lanes=4194304)}else{if(!v)if(e=co(M),e!==null){if(r.flags|=128,v=!0,e=e.updateQueue,r.updateQueue=e,Ao(r,e),oa(R,!0),R.tail===null&&R.tailMode==="hidden"&&!M.alternate&&!Je)return pt(r),null}else 2*St()-R.renderingStartTime>Oo&&d!==536870912&&(r.flags|=128,v=!0,oa(R,!1),r.lanes=4194304);R.isBackwards?(M.sibling=r.child,r.child=M):(e=R.last,e!==null?e.sibling=M:r.child=M,R.last=M)}return R.tail!==null?(r=R.tail,R.rendering=r,R.tail=r.sibling,R.renderingStartTime=St(),r.sibling=null,e=At.current,pe(At,v?e&1|2:e&1),r):(pt(r),null);case 22:case 23:return $n(r),ll(),v=r.memoizedState!==null,e!==null?e.memoizedState!==null!==v&&(r.flags|=8192):v&&(r.flags|=8192),v?(d&536870912)!==0&&(r.flags&128)===0&&(pt(r),r.subtreeFlags&6&&(r.flags|=8192)):pt(r),d=r.updateQueue,d!==null&&Ao(r,d.retryQueue),d=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(d=e.memoizedState.cachePool.pool),v=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(v=r.memoizedState.cachePool.pool),v!==d&&(r.flags|=2048),e!==null&&Re(ai),null;case 24:return d=null,e!==null&&(d=e.memoizedState.cache),r.memoizedState.cache!==d&&(r.flags|=2048),Wn(Ot),pt(r),null;case 25:return null}throw Error(U(156,r.tag))}function wh(e,r){switch(il(r),r.tag){case 1:return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 3:return Wn(Ot),Ee(),e=r.flags,(e&65536)!==0&&(e&128)===0?(r.flags=e&-65537|128,r):null;case 26:case 27:case 5:return Fe(r),null;case 13:if($n(r),e=r.memoizedState,e!==null&&e.dehydrated!==null){if(r.alternate===null)throw Error(U(340));Hs()}return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 19:return Re(At),null;case 4:return Ee(),null;case 10:return Wn(r.type),null;case 22:case 23:return $n(r),ll(),e!==null&&Re(ai),e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 24:return Wn(Ot),null;case 25:return null;default:return null}}function Wd(e,r){switch(il(r),r.tag){case 3:Wn(Ot),Ee();break;case 26:case 27:case 5:Fe(r);break;case 4:Ee();break;case 13:$n(r);break;case 19:Re(At);break;case 10:Wn(r.type);break;case 22:case 23:$n(r),ll(),e!==null&&Re(ai);break;case 24:Wn(Ot)}}var Rh={getCacheForType:function(e){var r=jt(Ot),d=r.data.get(e);return d===void 0&&(d=e(),r.data.set(e,d)),d}},Ah=typeof WeakMap=="function"?WeakMap:Map,gt=0,lt=null,Ye=null,Xe=0,ct=0,Kt=null,Jn=!1,rs=!1,nc=!1,Zn=0,vt=0,Nr=0,gi=0,rc=0,hn=0,is=0,la=null,Ln=null,ic=!1,sc=0,Oo=1/0,ko=null,Ur=null,Io=!1,mi=null,ca=0,ac=0,oc=null,ua=0,lc=null;function Xt(){if((gt&2)!==0&&Xe!==0)return Xe&-Xe;if(C.T!==null){var e=Qi;return e!==0?e:mc()}return vs()}function Yd(){hn===0&&(hn=(Xe&536870912)===0||Je?hs():536870912);var e=cn.current;return e!==null&&(e.flags|=32),hn}function qt(e,r,d){(e===lt&&ct===2||e.cancelPendingCommit!==null)&&(ss(e,0),er(e,Xe,hn,!1)),rr(e,d),((gt&2)===0||e!==lt)&&(e===lt&&((gt&2)===0&&(gi|=d),vt===4&&er(e,Xe,hn,!1)),Pn(e))}function Qd(e,r,d){if((gt&6)!==0)throw Error(U(327));var v=!d&&(r&60)===0&&(r&e.expiredLanes)===0||Jt(e,r),R=v?Ih(e,r):fc(e,r,!0),M=v;do{if(R===0){rs&&!v&&er(e,r,0,!1);break}else if(R===6)er(e,r,0,!Jn);else{if(d=e.current.alternate,M&&!Oh(d)){R=fc(e,r,!1),M=!1;continue}if(R===2){if(M=r,e.errorRecoveryDisabledLanes&M)var W=0;else W=e.pendingLanes&-536870913,W=W!==0?W:W&536870912?536870912:0;if(W!==0){r=W;e:{var X=e;R=la;var ee=X.current.memoizedState.isDehydrated;if(ee&&(ss(X,W).flags|=256),W=fc(X,W,!1),W!==2){if(nc&&!ee){X.errorRecoveryDisabledLanes|=M,gi|=M,R=4;break e}M=Ln,Ln=R,M!==null&&cc(M)}R=W}if(M=!1,R!==2)continue}}if(R===1){ss(e,0),er(e,r,0,!0);break}e:{switch(v=e,R){case 0:case 1:throw Error(U(345));case 4:if((r&4194176)===r){er(v,r,hn,!Jn);break e}break;case 2:Ln=null;break;case 3:case 5:break;default:throw Error(U(329))}if(v.finishedWork=d,v.finishedLanes=r,(r&62914560)===r&&(M=sc+300-St(),10<M)){if(er(v,r,hn,!Jn),Et(v,0)!==0)break e;v.timeoutHandle=Sf(Kd.bind(null,v,d,Ln,ko,ic,r,hn,gi,is,Jn,2,-0,0),M);break e}Kd(v,d,Ln,ko,ic,r,hn,gi,is,Jn,0,-0,0)}}break}while(!0);Pn(e)}function cc(e){Ln===null?Ln=e:Ln.push.apply(Ln,e)}function Kd(e,r,d,v,R,M,W,X,ee,se,ye,Te,de){var ve=r.subtreeFlags;if((ve&8192||(ve&16785408)===16785408)&&(ma={stylesheets:null,count:0,unsuspend:cp},Gd(r),r=dp(),r!==null)){e.cancelPendingCommit=r(rf.bind(null,e,d,v,R,W,X,ee,1,Te,de)),er(e,M,W,!se);return}rf(e,d,v,R,W,X,ee,ye,Te,de)}function Oh(e){for(var r=e;;){var d=r.tag;if((d===0||d===11||d===15)&&r.flags&16384&&(d=r.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var v=0;v<d.length;v++){var R=d[v],M=R.getSnapshot;R=R.value;try{if(!be(M(),R))return!1}catch{return!1}}if(d=r.child,r.subtreeFlags&16384&&d!==null)d.return=r,r=d;else{if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function er(e,r,d,v){r&=~rc,r&=~gi,e.suspendedLanes|=r,e.pingedLanes&=~r,v&&(e.warmLanes|=r),v=e.expirationTimes;for(var R=r;0<R;){var M=31-Pe(R),W=1<<M;v[M]=-1,R&=~W}d!==0&&gs(e,d,r)}function Lo(){return(gt&6)===0?(da(0),!1):!0}function uc(){if(Ye!==null){if(ct===0)var e=Ye.return;else e=Ye,zn=di=null,ml(e),Wi=null,Vs=0,e=Ye;for(;e!==null;)Wd(e.alternate,e),e=e.return;Ye=null}}function ss(e,r){e.finishedWork=null,e.finishedLanes=0;var d=e.timeoutHandle;d!==-1&&(e.timeoutHandle=-1,Wh(d)),d=e.cancelPendingCommit,d!==null&&(e.cancelPendingCommit=null,d()),uc(),lt=e,Ye=d=Mr(e.current,null),Xe=r,ct=0,Kt=null,Jn=!1,rs=Jt(e,r),nc=!1,is=hn=rc=gi=Nr=vt=0,Ln=la=null,ic=!1,(r&8)!==0&&(r|=r&32);var v=e.entangledLanes;if(v!==0)for(e=e.entanglements,v&=r;0<v;){var R=31-Pe(v),M=1<<R;r|=e[R],v&=~M}return Zn=r,eo(),d}function Xd(e,r){ze=null,C.H=In,r===$s?(r=fu(),ct=3):r===cu?(r=fu(),ct=4):ct=r===ud?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,Kt=r,Ye===null&&(vt=1,Co(e,an(r,e.current)))}function Jd(){var e=C.H;return C.H=In,e===null?In:e}function Zd(){var e=C.A;return C.A=Rh,e}function dc(){vt=4,Jn||(Xe&4194176)!==Xe&&cn.current!==null||(rs=!0),(Nr&134217727)===0&&(gi&134217727)===0||lt===null||er(lt,Xe,hn,!1)}function fc(e,r,d){var v=gt;gt|=2;var R=Jd(),M=Zd();(lt!==e||Xe!==r)&&(ko=null,ss(e,r)),r=!1;var W=vt;e:do try{if(ct!==0&&Ye!==null){var X=Ye,ee=Kt;switch(ct){case 8:uc(),W=6;break e;case 3:case 2:case 6:cn.current===null&&(r=!0);var se=ct;if(ct=0,Kt=null,as(e,X,ee,se),d&&rs){W=0;break e}break;default:se=ct,ct=0,Kt=null,as(e,X,ee,se)}}kh(),W=vt;break}catch(ye){Xd(e,ye)}while(!0);return r&&e.shellSuspendCounter++,zn=di=null,gt=v,C.H=R,C.A=M,Ye===null&&(lt=null,Xe=0,eo()),W}function kh(){for(;Ye!==null;)ef(Ye)}function Ih(e,r){var d=gt;gt|=2;var v=Jd(),R=Zd();lt!==e||Xe!==r?(ko=null,Oo=St()+500,ss(e,r)):rs=Jt(e,r);e:do try{if(ct!==0&&Ye!==null){r=Ye;var M=Kt;t:switch(ct){case 1:ct=0,Kt=null,as(e,r,M,1);break;case 2:if(uu(M)){ct=0,Kt=null,tf(r);break}r=function(){ct===2&&lt===e&&(ct=7),Pn(e)},M.then(r,r);break e;case 3:ct=7;break e;case 4:ct=5;break e;case 7:uu(M)?(ct=0,Kt=null,tf(r)):(ct=0,Kt=null,as(e,r,M,7));break;case 5:var W=null;switch(Ye.tag){case 26:W=Ye.memoizedState;case 5:case 27:var X=Ye;if(!W||Lf(W)){ct=0,Kt=null;var ee=X.sibling;if(ee!==null)Ye=ee;else{var se=X.return;se!==null?(Ye=se,Po(se)):Ye=null}break t}}ct=0,Kt=null,as(e,r,M,5);break;case 6:ct=0,Kt=null,as(e,r,M,6);break;case 8:uc(),vt=6;break e;default:throw Error(U(462))}}Lh();break}catch(ye){Xd(e,ye)}while(!0);return zn=di=null,C.H=v,C.A=R,gt=d,Ye!==null?0:(lt=null,Xe=0,eo(),vt)}function Lh(){for(;Ye!==null&&!nt();)ef(Ye)}function ef(e){var r=bd(e.alternate,e,Zn);e.memoizedProps=e.pendingProps,r===null?Po(e):Ye=r}function tf(e){var r=e,d=r.alternate;switch(r.tag){case 15:case 0:r=md(d,r,r.pendingProps,r.type,void 0,Xe);break;case 11:r=md(d,r,r.pendingProps,r.type.render,r.ref,Xe);break;case 5:ml(r);default:Wd(d,r),r=Ye=qd(r,Zn),r=bd(d,r,Zn)}e.memoizedProps=e.pendingProps,r===null?Po(e):Ye=r}function as(e,r,d,v){zn=di=null,ml(r),Wi=null,Vs=0;var R=r.return;try{if(_h(e,R,r,d,Xe)){vt=1,Co(e,an(d,e.current)),Ye=null;return}}catch(M){if(R!==null)throw Ye=R,M;vt=1,Co(e,an(d,e.current)),Ye=null;return}r.flags&32768?(Je||v===1?e=!0:rs||(Xe&536870912)!==0?e=!1:(Jn=e=!0,(v===2||v===3||v===6)&&(v=cn.current,v!==null&&v.tag===13&&(v.flags|=16384))),nf(r,e)):Po(r)}function Po(e){var r=e;do{if((r.flags&32768)!==0){nf(r,Jn);return}e=r.return;var d=Eh(r.alternate,r,Zn);if(d!==null){Ye=d;return}if(r=r.sibling,r!==null){Ye=r;return}Ye=r=e}while(r!==null);vt===0&&(vt=5)}function nf(e,r){do{var d=wh(e.alternate,e);if(d!==null){d.flags&=32767,Ye=d;return}if(d=e.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!r&&(e=e.sibling,e!==null)){Ye=e;return}Ye=e=d}while(e!==null);vt=6,Ye=null}function rf(e,r,d,v,R,M,W,X,ee,se){var ye=C.T,Te=Y.p;try{Y.p=2,C.T=null,Ph(e,r,d,v,Te,R,M,W,X,ee,se)}finally{C.T=ye,Y.p=Te}}function Ph(e,r,d,v,R,M,W,X){do os();while(mi!==null);if((gt&6)!==0)throw Error(U(327));var ee=e.finishedWork;if(v=e.finishedLanes,ee===null)return null;if(e.finishedWork=null,e.finishedLanes=0,ee===e.current)throw Error(U(177));e.callbackNode=null,e.callbackPriority=0,e.cancelPendingCommit=null;var se=ee.lanes|ee.childLanes;if(se|=tl,wa(e,v,se,M,W,X),e===lt&&(Ye=lt=null,Xe=0),(ee.subtreeFlags&10256)===0&&(ee.flags&10256)===0||Io||(Io=!0,ac=se,oc=d,Uh(gn,function(){return os(),null})),d=(ee.flags&15990)!==0,(ee.subtreeFlags&15990)!==0||d?(d=C.T,C.T=null,M=Y.p,Y.p=2,W=gt,gt|=4,Ch(e,ee),xd(ee,e),nh(Ec,e.containerInfo),qo=!!Tc,Ec=Tc=null,e.current=ee,Dd(e,ee.alternate,ee),Dt(),gt=W,Y.p=M,C.T=d):e.current=ee,Io?(Io=!1,mi=e,ca=v):sf(e,se),se=e.pendingLanes,se===0&&(Ur=null),Ie(ee.stateNode),Pn(e),r!==null)for(R=e.onRecoverableError,ee=0;ee<r.length;ee++)se=r[ee],R(se.value,{componentStack:se.stack});return(ca&3)!==0&&os(),se=e.pendingLanes,(v&4194218)!==0&&(se&42)!==0?e===lc?ua++:(ua=0,lc=e):ua=0,da(0),null}function sf(e,r){(e.pooledCacheLanes&=r)===0&&(r=e.pooledCache,r!=null&&(e.pooledCache=null,Ws(r)))}function os(){if(mi!==null){var e=mi,r=ac;ac=0;var d=ir(ca),v=C.T,R=Y.p;try{if(Y.p=32>d?32:d,C.T=null,mi===null)var M=!1;else{d=oc,oc=null;var W=mi,X=ca;if(mi=null,ca=0,(gt&6)!==0)throw Error(U(331));var ee=gt;if(gt|=4,Bd(W.current),Fd(W,W.current,X,d),gt=ee,da(0,!1),Ae&&typeof Ae.onPostCommitFiberRoot=="function")try{Ae.onPostCommitFiberRoot(ge,W)}catch{}M=!0}return M}finally{Y.p=R,C.T=v,sf(e,r)}}return!1}function af(e,r,d){r=an(d,r),r=Il(e.stateNode,r,2),e=Ir(e,r,2),e!==null&&(rr(e,2),Pn(e))}function ot(e,r,d){if(e.tag===3)af(e,e,d);else for(;r!==null;){if(r.tag===3){af(r,e,d);break}else if(r.tag===1){var v=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof v.componentDidCatch=="function"&&(Ur===null||!Ur.has(v))){e=an(d,e),d=ld(2),v=Ir(r,d,2),v!==null&&(cd(d,v,r,e),rr(v,2),Pn(v));break}}r=r.return}}function hc(e,r,d){var v=e.pingCache;if(v===null){v=e.pingCache=new Ah;var R=new Set;v.set(r,R)}else R=v.get(r),R===void 0&&(R=new Set,v.set(r,R));R.has(d)||(nc=!0,R.add(d),e=Dh.bind(null,e,r,d),r.then(e,e))}function Dh(e,r,d){var v=e.pingCache;v!==null&&v.delete(r),e.pingedLanes|=e.suspendedLanes&d,e.warmLanes&=~d,lt===e&&(Xe&d)===d&&(vt===4||vt===3&&(Xe&62914560)===Xe&&300>St()-sc?(gt&2)===0&&ss(e,0):rc|=d,is===Xe&&(is=0)),Pn(e)}function of(e,r){r===0&&(r=ps()),e=br(e,r),e!==null&&(rr(e,r),Pn(e))}function Mh(e){var r=e.memoizedState,d=0;r!==null&&(d=r.retryLane),of(e,d)}function Nh(e,r){var d=0;switch(e.tag){case 13:var v=e.stateNode,R=e.memoizedState;R!==null&&(d=R.retryLane);break;case 19:v=e.stateNode;break;case 22:v=e.stateNode._retryCache;break;default:throw Error(U(314))}v!==null&&v.delete(r),of(e,d)}function Uh(e,r){return et(e,r)}var Do=null,ls=null,pc=!1,Mo=!1,gc=!1,vi=0;function Pn(e){e!==ls&&e.next===null&&(ls===null?Do=ls=e:ls=ls.next=e),Mo=!0,pc||(pc=!0,jh(xh))}function da(e,r){if(!gc&&Mo){gc=!0;do for(var d=!1,v=Do;v!==null;){if(e!==0){var R=v.pendingLanes;if(R===0)var M=0;else{var W=v.suspendedLanes,X=v.pingedLanes;M=(1<<31-Pe(42|e)+1)-1,M&=R&~(W&~X),M=M&201326677?M&201326677|1:M?M|2:0}M!==0&&(d=!0,uf(v,M))}else M=Xe,M=Et(v,v===lt?M:0),(M&3)===0||Jt(v,M)||(d=!0,uf(v,M));v=v.next}while(d);gc=!1}}function xh(){Mo=pc=!1;var e=0;vi!==0&&(zh()&&(e=vi),vi=0);for(var r=St(),d=null,v=Do;v!==null;){var R=v.next,M=lf(v,r);M===0?(v.next=null,d===null?Do=R:d.next=R,R===null&&(ls=d)):(d=v,(e!==0||(M&3)!==0)&&(Mo=!0)),v=R}da(e)}function lf(e,r){for(var d=e.suspendedLanes,v=e.pingedLanes,R=e.expirationTimes,M=e.pendingLanes&-62914561;0<M;){var W=31-Pe(M),X=1<<W,ee=R[W];ee===-1?((X&d)===0||(X&v)!==0)&&(R[W]=Ea(X,r)):ee<=r&&(e.expiredLanes|=X),M&=~X}if(r=lt,d=Xe,d=Et(e,e===r?d:0),v=e.callbackNode,d===0||e===r&&ct===2||e.cancelPendingCommit!==null)return v!==null&&v!==null&&tt(v),e.callbackNode=null,e.callbackPriority=0;if((d&3)===0||Jt(e,d)){if(r=d&-d,r===e.callbackPriority)return r;switch(v!==null&&tt(v),ir(d)){case 2:case 8:d=Tn;break;case 32:d=gn;break;case 268435456:d=nr;break;default:d=gn}return v=cf.bind(null,e),d=et(d,v),e.callbackPriority=r,e.callbackNode=d,r}return v!==null&&v!==null&&tt(v),e.callbackPriority=2,e.callbackNode=null,2}function cf(e,r){var d=e.callbackNode;if(os()&&e.callbackNode!==d)return null;var v=Xe;return v=Et(e,e===lt?v:0),v===0?null:(Qd(e,v,r),lf(e,St()),e.callbackNode!=null&&e.callbackNode===d?cf.bind(null,e):null)}function uf(e,r){if(os())return null;Qd(e,r,!0)}function jh(e){Yh(function(){(gt&6)!==0?et(bn,e):e()})}function mc(){return vi===0&&(vi=hs()),vi}function df(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:ur(""+e)}function ff(e,r){var d=r.ownerDocument.createElement("input");return d.name=r.name,d.value=r.value,e.id&&d.setAttribute("form",e.id),r.parentNode.insertBefore(d,r),e=new FormData(e),d.parentNode.removeChild(d),e}function Fh(e,r,d,v,R){if(r==="submit"&&d&&d.stateNode===R){var M=df((R[Mt]||null).action),W=v.submitter;W&&(r=(r=W[Mt]||null)?df(r.formAction):W.getAttribute("formAction"),r!==null&&(M=r,W=null));var X=new Kr("action","action",null,v,R);e.push({event:X,listeners:[{instance:null,listener:function(){if(v.defaultPrevented){if(vi!==0){var ee=W?ff(R,W):new FormData(R);wl(d,{pending:!0,data:ee,method:R.method,action:M},null,ee)}}else typeof M=="function"&&(X.preventDefault(),ee=W?ff(R,W):new FormData(R),wl(d,{pending:!0,data:ee,method:R.method,action:M},M,ee))},currentTarget:R}]})}}for(var vc=0;vc<ru.length;vc++){var yc=ru[vc],Gh=yc.toLowerCase(),Hh=yc[0].toUpperCase()+yc.slice(1);yn(Gh,"on"+Hh)}yn(Jc,"onAnimationEnd"),yn(Zc,"onAnimationIteration"),yn(eu,"onAnimationStart"),yn("dblclick","onDoubleClick"),yn("focusin","onFocus"),yn("focusout","onBlur"),yn(ih,"onTransitionRun"),yn(sh,"onTransitionStart"),yn(ah,"onTransitionCancel"),yn(tu,"onTransitionEnd"),Mn("onMouseEnter",["mouseout","mouseover"]),Mn("onMouseLeave",["mouseout","mouseover"]),Mn("onPointerEnter",["pointerout","pointerover"]),Mn("onPointerLeave",["pointerout","pointerover"]),wn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),wn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),wn("onBeforeInput",["compositionend","keypress","textInput","paste"]),wn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),wn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),wn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var fa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Bh=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(fa));function hf(e,r){r=(r&4)!==0;for(var d=0;d<e.length;d++){var v=e[d],R=v.event;v=v.listeners;e:{var M=void 0;if(r)for(var W=v.length-1;0<=W;W--){var X=v[W],ee=X.instance,se=X.currentTarget;if(X=X.listener,ee!==M&&R.isPropagationStopped())break e;M=X,R.currentTarget=se;try{M(R)}catch(ye){So(ye)}R.currentTarget=null,M=ee}else for(W=0;W<v.length;W++){if(X=v[W],ee=X.instance,se=X.currentTarget,X=X.listener,ee!==M&&R.isPropagationStopped())break e;M=X,R.currentTarget=se;try{M(R)}catch(ye){So(ye)}R.currentTarget=null,M=ee}}}}function Ke(e,r){var d=r[Ci];d===void 0&&(d=r[Ci]=new Set);var v=e+"__bubble";d.has(v)||(pf(r,e,2,!1),d.add(v))}function _c(e,r,d){var v=0;r&&(v|=4),pf(d,e,v,r)}var No="_reactListening"+Math.random().toString(36).slice(2);function Sc(e){if(!e[No]){e[No]=!0,bi.forEach(function(d){d!=="selectionchange"&&(Bh.has(d)||_c(d,!1,e),_c(d,!0,e))});var r=e.nodeType===9?e:e.ownerDocument;r===null||r[No]||(r[No]=!0,_c("selectionchange",!1,r))}}function pf(e,r,d,v){switch(xf(r)){case 2:var R=pp;break;case 8:R=gp;break;default:R=Dc}d=R.bind(null,r,d,e),R=void 0,!Yr||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(R=!0),v?R!==void 0?e.addEventListener(r,d,{capture:!0,passive:R}):e.addEventListener(r,d,!0):R!==void 0?e.addEventListener(r,d,{passive:R}):e.addEventListener(r,d,!1)}function Cc(e,r,d,v,R){var M=v;if((r&1)===0&&(r&2)===0&&v!==null)e:for(;;){if(v===null)return;var W=v.tag;if(W===3||W===4){var X=v.stateNode.containerInfo;if(X===R||X.nodeType===8&&X.parentNode===R)break;if(W===4)for(W=v.return;W!==null;){var ee=W.tag;if((ee===3||ee===4)&&(ee=W.stateNode.containerInfo,ee===R||ee.nodeType===8&&ee.parentNode===R))return;W=W.return}for(;X!==null;){if(W=En(X),W===null)return;if(ee=W.tag,ee===5||ee===6||ee===26||ee===27){v=M=W;continue e}X=X.parentNode}}v=v.return}Rs(function(){var se=M,ye=Ai(d),Te=[];e:{var de=nu.get(e);if(de!==void 0){var ve=Kr,Ue=e;switch(e){case"keypress":if(gr(d)===0)break e;case"keydown":case"keyup":ve=Ba;break;case"focusin":Ue="focus",ve=Jr;break;case"focusout":Ue="blur",ve=Jr;break;case"beforeblur":case"afterblur":ve=Jr;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ve=As;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ve=Pi;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ve=Va;break;case Jc:case Zc:case eu:ve=Mi;break;case tu:ve=Wa;break;case"scroll":case"scrollend":ve=ki;break;case"wheel":ve=Ls;break;case"copy":case"cut":case"paste":ve=Os;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ve=Is;break;case"toggle":case"beforetoggle":ve=Ps}var qe=(r&4)!==0,yt=!qe&&(e==="scroll"||e==="scrollend"),le=qe?de!==null?de+"Capture":null:de;qe=[];for(var ie=se,ue;ie!==null;){var Ce=ie;if(ue=Ce.stateNode,Ce=Ce.tag,Ce!==5&&Ce!==26&&Ce!==27||ue===null||le===null||(Ce=fr(ie,le),Ce!=null&&qe.push(ha(ie,Ce,ue))),yt)break;ie=ie.return}0<qe.length&&(de=new ve(de,Ue,null,d,ye),Te.push({event:de,listeners:qe}))}}if((r&7)===0){e:{if(de=e==="mouseover"||e==="pointerover",ve=e==="mouseout"||e==="pointerout",de&&d!==Ri&&(Ue=d.relatedTarget||d.fromElement)&&(En(Ue)||Ue[Zt]))break e;if((ve||de)&&(de=ye.window===ye?ye:(de=ye.ownerDocument)?de.defaultView||de.parentWindow:window,ve?(Ue=d.relatedTarget||d.toElement,ve=se,Ue=Ue?En(Ue):null,Ue!==null&&(yt=F(Ue),qe=Ue.tag,Ue!==yt||qe!==5&&qe!==27&&qe!==6)&&(Ue=null)):(ve=null,Ue=se),ve!==Ue)){if(qe=As,Ce="onMouseLeave",le="onMouseEnter",ie="mouse",(e==="pointerout"||e==="pointerover")&&(qe=Is,Ce="onPointerLeave",le="onPointerEnter",ie="pointer"),yt=ve==null?de:or(ve),ue=Ue==null?de:or(Ue),de=new qe(Ce,ie+"leave",ve,d,ye),de.target=yt,de.relatedTarget=ue,Ce=null,En(ye)===se&&(qe=new qe(le,ie+"enter",Ue,d,ye),qe.target=ue,qe.relatedTarget=yt,Ce=qe),yt=Ce,ve&&Ue)t:{for(qe=ve,le=Ue,ie=0,ue=qe;ue;ue=cs(ue))ie++;for(ue=0,Ce=le;Ce;Ce=cs(Ce))ue++;for(;0<ie-ue;)qe=cs(qe),ie--;for(;0<ue-ie;)le=cs(le),ue--;for(;ie--;){if(qe===le||le!==null&&qe===le.alternate)break t;qe=cs(qe),le=cs(le)}qe=null}else qe=null;ve!==null&&gf(Te,de,ve,qe,!1),Ue!==null&&yt!==null&&gf(Te,yt,Ue,qe,!0)}}e:{if(de=se?or(se):window,ve=de.nodeName&&de.nodeName.toLowerCase(),ve==="select"||ve==="input"&&de.type==="file")var Me=A;else if(ae(de))if(B)Me=Za;else{Me=kt;var We=Ge}else ve=de.nodeName,!ve||ve.toLowerCase()!=="input"||de.type!=="checkbox"&&de.type!=="radio"?se&&dt(se.elementType)&&(Me=A):Me=rn;if(Me&&(Me=Me(e,se))){Gi(Te,Me,d,ye);break e}We&&We(e,de,se),e==="focusout"&&se&&de.type==="number"&&se.memoizedProps.value!=null&&cr(de,"number",de.value)}switch(We=se?or(se):window,e){case"focusin":(ae(We)||We.contentEditable==="true")&&(Hi=We,Jo=se,Fs=null);break;case"focusout":Fs=Jo=Hi=null;break;case"mousedown":Zo=!0;break;case"contextmenu":case"mouseup":case"dragend":Zo=!1,Kc(Te,d,ye);break;case"selectionchange":if(rh)break;case"keydown":case"keyup":Kc(Te,d,ye)}var je;if(ji)e:{switch(e){case"compositionstart":var He="onCompositionStart";break e;case"compositionend":He="onCompositionEnd";break e;case"compositionupdate":He="onCompositionUpdate";break e}He=void 0}else Gn?Fi(e,d)&&(He="onCompositionEnd"):e==="keydown"&&d.keyCode===229&&(He="onCompositionStart");He&&(Ds&&d.locale!=="ko"&&(Gn||He!=="onCompositionStart"?He==="onCompositionEnd"&&Gn&&(je=Oi()):(mn=ye,Fn="value"in mn?mn.value:mn.textContent,Gn=!0)),We=Uo(se,He),0<We.length&&(He=new Ni(He,e,null,d,ye),Te.push({event:He,listeners:We}),je?He.data=je:(je=Us(d),je!==null&&(He.data=je)))),(je=vn?Xa(e,d):Ja(e,d))&&(He=Uo(se,"onBeforeInput"),0<He.length&&(We=new Ni("onBeforeInput","beforeinput",null,d,ye),Te.push({event:We,listeners:He}),We.data=je)),Fh(Te,e,se,d,ye)}hf(Te,r)})}function ha(e,r,d){return{instance:e,listener:r,currentTarget:d}}function Uo(e,r){for(var d=r+"Capture",v=[];e!==null;){var R=e,M=R.stateNode;R=R.tag,R!==5&&R!==26&&R!==27||M===null||(R=fr(e,d),R!=null&&v.unshift(ha(e,R,M)),R=fr(e,r),R!=null&&v.push(ha(e,R,M))),e=e.return}return v}function cs(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function gf(e,r,d,v,R){for(var M=r._reactName,W=[];d!==null&&d!==v;){var X=d,ee=X.alternate,se=X.stateNode;if(X=X.tag,ee!==null&&ee===v)break;X!==5&&X!==26&&X!==27||se===null||(ee=se,R?(se=fr(d,M),se!=null&&W.unshift(ha(d,se,ee))):R||(se=fr(d,M),se!=null&&W.push(ha(d,se,ee)))),d=d.return}W.length!==0&&e.push({event:r,listeners:W})}var $h=/\r\n?/g,qh=/\u0000|\uFFFD/g;function mf(e){return(typeof e=="string"?e:""+e).replace($h,`
`).replace(qh,"")}function vf(e,r){return r=mf(r),mf(e)===r}function xo(){}function st(e,r,d,v,R,M){switch(d){case"children":typeof v=="string"?r==="body"||r==="textarea"&&v===""||Un(e,v):(typeof v=="number"||typeof v=="bigint")&&r!=="body"&&Un(e,""+v);break;case"className":Vr(e,"class",v);break;case"tabIndex":Vr(e,"tabindex",v);break;case"dir":case"role":case"viewBox":case"width":case"height":Vr(e,d,v);break;case"style":Es(e,v,M);break;case"data":if(r!=="object"){Vr(e,"data",v);break}case"src":case"href":if(v===""&&(r!=="a"||d!=="href")){e.removeAttribute(d);break}if(v==null||typeof v=="function"||typeof v=="symbol"||typeof v=="boolean"){e.removeAttribute(d);break}v=ur(""+v),e.setAttribute(d,v);break;case"action":case"formAction":if(typeof v=="function"){e.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof M=="function"&&(d==="formAction"?(r!=="input"&&st(e,r,"name",R.name,R,null),st(e,r,"formEncType",R.formEncType,R,null),st(e,r,"formMethod",R.formMethod,R,null),st(e,r,"formTarget",R.formTarget,R,null)):(st(e,r,"encType",R.encType,R,null),st(e,r,"method",R.method,R,null),st(e,r,"target",R.target,R,null)));if(v==null||typeof v=="symbol"||typeof v=="boolean"){e.removeAttribute(d);break}v=ur(""+v),e.setAttribute(d,v);break;case"onClick":v!=null&&(e.onclick=xo);break;case"onScroll":v!=null&&Ke("scroll",e);break;case"onScrollEnd":v!=null&&Ke("scrollend",e);break;case"dangerouslySetInnerHTML":if(v!=null){if(typeof v!="object"||!("__html"in v))throw Error(U(61));if(d=v.__html,d!=null){if(R.children!=null)throw Error(U(60));e.innerHTML=d}}break;case"multiple":e.multiple=v&&typeof v!="function"&&typeof v!="symbol";break;case"muted":e.muted=v&&typeof v!="function"&&typeof v!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(v==null||typeof v=="function"||typeof v=="boolean"||typeof v=="symbol"){e.removeAttribute("xlink:href");break}d=ur(""+v),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":v!=null&&typeof v!="function"&&typeof v!="symbol"?e.setAttribute(d,""+v):e.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":v&&typeof v!="function"&&typeof v!="symbol"?e.setAttribute(d,""):e.removeAttribute(d);break;case"capture":case"download":v===!0?e.setAttribute(d,""):v!==!1&&v!=null&&typeof v!="function"&&typeof v!="symbol"?e.setAttribute(d,v):e.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":v!=null&&typeof v!="function"&&typeof v!="symbol"&&!isNaN(v)&&1<=v?e.setAttribute(d,v):e.removeAttribute(d);break;case"rowSpan":case"start":v==null||typeof v=="function"||typeof v=="symbol"||isNaN(v)?e.removeAttribute(d):e.setAttribute(d,v);break;case"popover":Ke("beforetoggle",e),Ke("toggle",e),qr(e,"popover",v);break;case"xlinkActuate":nn(e,"http://www.w3.org/1999/xlink","xlink:actuate",v);break;case"xlinkArcrole":nn(e,"http://www.w3.org/1999/xlink","xlink:arcrole",v);break;case"xlinkRole":nn(e,"http://www.w3.org/1999/xlink","xlink:role",v);break;case"xlinkShow":nn(e,"http://www.w3.org/1999/xlink","xlink:show",v);break;case"xlinkTitle":nn(e,"http://www.w3.org/1999/xlink","xlink:title",v);break;case"xlinkType":nn(e,"http://www.w3.org/1999/xlink","xlink:type",v);break;case"xmlBase":nn(e,"http://www.w3.org/XML/1998/namespace","xml:base",v);break;case"xmlLang":nn(e,"http://www.w3.org/XML/1998/namespace","xml:lang",v);break;case"xmlSpace":nn(e,"http://www.w3.org/XML/1998/namespace","xml:space",v);break;case"is":qr(e,"is",v);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=Da.get(d)||d,qr(e,d,v))}}function bc(e,r,d,v,R,M){switch(d){case"style":Es(e,v,M);break;case"dangerouslySetInnerHTML":if(v!=null){if(typeof v!="object"||!("__html"in v))throw Error(U(61));if(d=v.__html,d!=null){if(R.children!=null)throw Error(U(60));e.innerHTML=d}}break;case"children":typeof v=="string"?Un(e,v):(typeof v=="number"||typeof v=="bigint")&&Un(e,""+v);break;case"onScroll":v!=null&&Ke("scroll",e);break;case"onScrollEnd":v!=null&&Ke("scrollend",e);break;case"onClick":v!=null&&(e.onclick=xo);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!lr.hasOwnProperty(d))e:{if(d[0]==="o"&&d[1]==="n"&&(R=d.endsWith("Capture"),r=d.slice(2,R?d.length-7:void 0),M=e[Mt]||null,M=M!=null?M[d]:null,typeof M=="function"&&e.removeEventListener(r,M,R),typeof v=="function")){typeof M!="function"&&M!==null&&(d in e?e[d]=null:e.hasAttribute(d)&&e.removeAttribute(d)),e.addEventListener(r,v,R);break e}d in e?e[d]=v:v===!0?e.setAttribute(d,""):qr(e,d,v)}}}function xt(e,r,d){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ke("error",e),Ke("load",e);var v=!1,R=!1,M;for(M in d)if(d.hasOwnProperty(M)){var W=d[M];if(W!=null)switch(M){case"src":v=!0;break;case"srcSet":R=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(U(137,r));default:st(e,r,M,W,d,null)}}R&&st(e,r,"srcSet",d.srcSet,d,null),v&&st(e,r,"src",d.src,d,null);return;case"input":Ke("invalid",e);var X=M=W=R=null,ee=null,se=null;for(v in d)if(d.hasOwnProperty(v)){var ye=d[v];if(ye!=null)switch(v){case"name":R=ye;break;case"type":W=ye;break;case"checked":ee=ye;break;case"defaultChecked":se=ye;break;case"value":M=ye;break;case"defaultValue":X=ye;break;case"children":case"dangerouslySetInnerHTML":if(ye!=null)throw Error(U(137,r));break;default:st(e,r,v,ye,d,null)}}Ts(e,M,X,ee,se,W,R,!1),zr(e);return;case"select":Ke("invalid",e),v=W=M=null;for(R in d)if(d.hasOwnProperty(R)&&(X=d[R],X!=null))switch(R){case"value":M=X;break;case"defaultValue":W=X;break;case"multiple":v=X;default:st(e,r,R,X,d,null)}r=M,d=W,e.multiple=!!v,r!=null?Vt(e,!!v,r,!1):d!=null&&Vt(e,!!v,d,!0);return;case"textarea":Ke("invalid",e),M=R=v=null;for(W in d)if(d.hasOwnProperty(W)&&(X=d[W],X!=null))switch(W){case"value":v=X;break;case"defaultValue":R=X;break;case"children":M=X;break;case"dangerouslySetInnerHTML":if(X!=null)throw Error(U(91));break;default:st(e,r,W,X,d,null)}wi(e,v,R,M),zr(e);return;case"option":for(ee in d)if(d.hasOwnProperty(ee)&&(v=d[ee],v!=null))switch(ee){case"selected":e.selected=v&&typeof v!="function"&&typeof v!="symbol";break;default:st(e,r,ee,v,d,null)}return;case"dialog":Ke("cancel",e),Ke("close",e);break;case"iframe":case"object":Ke("load",e);break;case"video":case"audio":for(v=0;v<fa.length;v++)Ke(fa[v],e);break;case"image":Ke("error",e),Ke("load",e);break;case"details":Ke("toggle",e);break;case"embed":case"source":case"link":Ke("error",e),Ke("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(se in d)if(d.hasOwnProperty(se)&&(v=d[se],v!=null))switch(se){case"children":case"dangerouslySetInnerHTML":throw Error(U(137,r));default:st(e,r,se,v,d,null)}return;default:if(dt(r)){for(ye in d)d.hasOwnProperty(ye)&&(v=d[ye],v!==void 0&&bc(e,r,ye,v,d,void 0));return}}for(X in d)d.hasOwnProperty(X)&&(v=d[X],v!=null&&st(e,r,X,v,d,null))}function Vh(e,r,d,v){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var R=null,M=null,W=null,X=null,ee=null,se=null,ye=null;for(ve in d){var Te=d[ve];if(d.hasOwnProperty(ve)&&Te!=null)switch(ve){case"checked":break;case"value":break;case"defaultValue":ee=Te;default:v.hasOwnProperty(ve)||st(e,r,ve,null,v,Te)}}for(var de in v){var ve=v[de];if(Te=d[de],v.hasOwnProperty(de)&&(ve!=null||Te!=null))switch(de){case"type":M=ve;break;case"name":R=ve;break;case"checked":se=ve;break;case"defaultChecked":ye=ve;break;case"value":W=ve;break;case"defaultValue":X=ve;break;case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(U(137,r));break;default:ve!==Te&&st(e,r,de,ve,v,Te)}}Ei(e,W,X,ee,se,ye,M,R);return;case"select":ve=W=X=de=null;for(M in d)if(ee=d[M],d.hasOwnProperty(M)&&ee!=null)switch(M){case"value":break;case"multiple":ve=ee;default:v.hasOwnProperty(M)||st(e,r,M,null,v,ee)}for(R in v)if(M=v[R],ee=d[R],v.hasOwnProperty(R)&&(M!=null||ee!=null))switch(R){case"value":de=M;break;case"defaultValue":X=M;break;case"multiple":W=M;default:M!==ee&&st(e,r,R,M,v,ee)}r=X,d=W,v=ve,de!=null?Vt(e,!!d,de,!1):!!v!=!!d&&(r!=null?Vt(e,!!d,r,!0):Vt(e,!!d,d?[]:"",!1));return;case"textarea":ve=de=null;for(X in d)if(R=d[X],d.hasOwnProperty(X)&&R!=null&&!v.hasOwnProperty(X))switch(X){case"value":break;case"children":break;default:st(e,r,X,null,v,R)}for(W in v)if(R=v[W],M=d[W],v.hasOwnProperty(W)&&(R!=null||M!=null))switch(W){case"value":de=R;break;case"defaultValue":ve=R;break;case"children":break;case"dangerouslySetInnerHTML":if(R!=null)throw Error(U(91));break;default:R!==M&&st(e,r,W,R,v,M)}Wr(e,de,ve);return;case"option":for(var Ue in d)if(de=d[Ue],d.hasOwnProperty(Ue)&&de!=null&&!v.hasOwnProperty(Ue))switch(Ue){case"selected":e.selected=!1;break;default:st(e,r,Ue,null,v,de)}for(ee in v)if(de=v[ee],ve=d[ee],v.hasOwnProperty(ee)&&de!==ve&&(de!=null||ve!=null))switch(ee){case"selected":e.selected=de&&typeof de!="function"&&typeof de!="symbol";break;default:st(e,r,ee,de,v,ve)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var qe in d)de=d[qe],d.hasOwnProperty(qe)&&de!=null&&!v.hasOwnProperty(qe)&&st(e,r,qe,null,v,de);for(se in v)if(de=v[se],ve=d[se],v.hasOwnProperty(se)&&de!==ve&&(de!=null||ve!=null))switch(se){case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(U(137,r));break;default:st(e,r,se,de,v,ve)}return;default:if(dt(r)){for(var yt in d)de=d[yt],d.hasOwnProperty(yt)&&de!==void 0&&!v.hasOwnProperty(yt)&&bc(e,r,yt,void 0,v,de);for(ye in v)de=v[ye],ve=d[ye],!v.hasOwnProperty(ye)||de===ve||de===void 0&&ve===void 0||bc(e,r,ye,de,v,ve);return}}for(var le in d)de=d[le],d.hasOwnProperty(le)&&de!=null&&!v.hasOwnProperty(le)&&st(e,r,le,null,v,de);for(Te in v)de=v[Te],ve=d[Te],!v.hasOwnProperty(Te)||de===ve||de==null&&ve==null||st(e,r,Te,de,v,ve)}var Tc=null,Ec=null;function jo(e){return e.nodeType===9?e:e.ownerDocument}function yf(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function _f(e,r){if(e===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&r==="foreignObject"?0:e}function wc(e,r){return e==="textarea"||e==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Rc=null;function zh(){var e=window.event;return e&&e.type==="popstate"?e===Rc?!1:(Rc=e,!0):(Rc=null,!1)}var Sf=typeof setTimeout=="function"?setTimeout:void 0,Wh=typeof clearTimeout=="function"?clearTimeout:void 0,Cf=typeof Promise=="function"?Promise:void 0,Yh=typeof queueMicrotask=="function"?queueMicrotask:typeof Cf<"u"?function(e){return Cf.resolve(null).then(e).catch(Qh)}:Sf;function Qh(e){setTimeout(function(){throw e})}function Ac(e,r){var d=r,v=0;do{var R=d.nextSibling;if(e.removeChild(d),R&&R.nodeType===8)if(d=R.data,d==="/$"){if(v===0){e.removeChild(R),Ca(r);return}v--}else d!=="$"&&d!=="$?"&&d!=="$!"||v++;d=R}while(d);Ca(r)}function Oc(e){var r=e.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var d=r;switch(r=r.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":Oc(d),ar(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}e.removeChild(d)}}function Kh(e,r,d,v){for(;e.nodeType===1;){var R=d;if(e.nodeName.toLowerCase()!==r.toLowerCase()){if(!v&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(v){if(!e[sr])switch(r){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(M=e.getAttribute("rel"),M==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(M!==R.rel||e.getAttribute("href")!==(R.href==null?null:R.href)||e.getAttribute("crossorigin")!==(R.crossOrigin==null?null:R.crossOrigin)||e.getAttribute("title")!==(R.title==null?null:R.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(M=e.getAttribute("src"),(M!==(R.src==null?null:R.src)||e.getAttribute("type")!==(R.type==null?null:R.type)||e.getAttribute("crossorigin")!==(R.crossOrigin==null?null:R.crossOrigin))&&M&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(r==="input"&&e.type==="hidden"){var M=R.name==null?null:""+R.name;if(R.type==="hidden"&&e.getAttribute("name")===M)return e}else return e;if(e=Cn(e.nextSibling),e===null)break}return null}function Xh(e,r,d){if(r==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!d||(e=Cn(e.nextSibling),e===null))return null;return e}function Cn(e){for(;e!=null;e=e.nextSibling){var r=e.nodeType;if(r===1||r===3)break;if(r===8){if(r=e.data,r==="$"||r==="$!"||r==="$?"||r==="F!"||r==="F")break;if(r==="/$")return null}}return e}function bf(e){e=e.previousSibling;for(var r=0;e;){if(e.nodeType===8){var d=e.data;if(d==="$"||d==="$!"||d==="$?"){if(r===0)return e;r--}else d==="/$"&&r++}e=e.previousSibling}return null}function Tf(e,r,d){switch(r=jo(d),e){case"html":if(e=r.documentElement,!e)throw Error(U(452));return e;case"head":if(e=r.head,!e)throw Error(U(453));return e;case"body":if(e=r.body,!e)throw Error(U(454));return e;default:throw Error(U(451))}}var pn=new Map,Ef=new Set;function Fo(e){return typeof e.getRootNode=="function"?e.getRootNode():e.ownerDocument}var tr=Y.d;Y.d={f:Jh,r:Zh,D:ep,C:tp,L:np,m:rp,X:sp,S:ip,M:ap};function Jh(){var e=tr.f(),r=Lo();return e||r}function Zh(e){var r=en(e);r!==null&&r.tag===5&&r.type==="form"?Ku(r):tr.r(e)}var us=typeof document>"u"?null:document;function wf(e,r,d){var v=us;if(v&&typeof r=="string"&&r){var R=Bt(r);R='link[rel="'+e+'"][href="'+R+'"]',typeof d=="string"&&(R+='[crossorigin="'+d+'"]'),Ef.has(R)||(Ef.add(R),e={rel:e,crossOrigin:d,href:r},v.querySelector(R)===null&&(r=v.createElement("link"),xt(r,"link",e),ht(r),v.head.appendChild(r)))}}function ep(e){tr.D(e),wf("dns-prefetch",e,null)}function tp(e,r){tr.C(e,r),wf("preconnect",e,r)}function np(e,r,d){tr.L(e,r,d);var v=us;if(v&&e&&r){var R='link[rel="preload"][as="'+Bt(r)+'"]';r==="image"&&d&&d.imageSrcSet?(R+='[imagesrcset="'+Bt(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(R+='[imagesizes="'+Bt(d.imageSizes)+'"]')):R+='[href="'+Bt(e)+'"]';var M=R;switch(r){case"style":M=ds(e);break;case"script":M=fs(e)}pn.has(M)||(e=E({rel:"preload",href:r==="image"&&d&&d.imageSrcSet?void 0:e,as:r},d),pn.set(M,e),v.querySelector(R)!==null||r==="style"&&v.querySelector(pa(M))||r==="script"&&v.querySelector(ga(M))||(r=v.createElement("link"),xt(r,"link",e),ht(r),v.head.appendChild(r)))}}function rp(e,r){tr.m(e,r);var d=us;if(d&&e){var v=r&&typeof r.as=="string"?r.as:"script",R='link[rel="modulepreload"][as="'+Bt(v)+'"][href="'+Bt(e)+'"]',M=R;switch(v){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":M=fs(e)}if(!pn.has(M)&&(e=E({rel:"modulepreload",href:e},r),pn.set(M,e),d.querySelector(R)===null)){switch(v){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(ga(M)))return}v=d.createElement("link"),xt(v,"link",e),ht(v),d.head.appendChild(v)}}}function ip(e,r,d){tr.S(e,r,d);var v=us;if(v&&e){var R=Dn(v).hoistableStyles,M=ds(e);r=r||"default";var W=R.get(M);if(!W){var X={loading:0,preload:null};if(W=v.querySelector(pa(M)))X.loading=5;else{e=E({rel:"stylesheet",href:e,"data-precedence":r},d),(d=pn.get(M))&&kc(e,d);var ee=W=v.createElement("link");ht(ee),xt(ee,"link",e),ee._p=new Promise(function(se,ye){ee.onload=se,ee.onerror=ye}),ee.addEventListener("load",function(){X.loading|=1}),ee.addEventListener("error",function(){X.loading|=2}),X.loading|=4,Go(W,r,v)}W={type:"stylesheet",instance:W,count:1,state:X},R.set(M,W)}}}function sp(e,r){tr.X(e,r);var d=us;if(d&&e){var v=Dn(d).hoistableScripts,R=fs(e),M=v.get(R);M||(M=d.querySelector(ga(R)),M||(e=E({src:e,async:!0},r),(r=pn.get(R))&&Ic(e,r),M=d.createElement("script"),ht(M),xt(M,"link",e),d.head.appendChild(M)),M={type:"script",instance:M,count:1,state:null},v.set(R,M))}}function ap(e,r){tr.M(e,r);var d=us;if(d&&e){var v=Dn(d).hoistableScripts,R=fs(e),M=v.get(R);M||(M=d.querySelector(ga(R)),M||(e=E({src:e,async:!0,type:"module"},r),(r=pn.get(R))&&Ic(e,r),M=d.createElement("script"),ht(M),xt(M,"link",e),d.head.appendChild(M)),M={type:"script",instance:M,count:1,state:null},v.set(R,M))}}function Rf(e,r,d,v){var R=(R=oe.current)?Fo(R):null;if(!R)throw Error(U(446));switch(e){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(r=ds(d.href),d=Dn(R).hoistableStyles,v=d.get(r),v||(v={type:"style",instance:null,count:0,state:null},d.set(r,v)),v):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){e=ds(d.href);var M=Dn(R).hoistableStyles,W=M.get(e);if(W||(R=R.ownerDocument||R,W={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},M.set(e,W),(M=R.querySelector(pa(e)))&&!M._p&&(W.instance=M,W.state.loading=5),pn.has(e)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},pn.set(e,d),M||op(R,e,d,W.state))),r&&v===null)throw Error(U(528,""));return W}if(r&&v!==null)throw Error(U(529,""));return null;case"script":return r=d.async,d=d.src,typeof d=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=fs(d),d=Dn(R).hoistableScripts,v=d.get(r),v||(v={type:"script",instance:null,count:0,state:null},d.set(r,v)),v):{type:"void",instance:null,count:0,state:null};default:throw Error(U(444,e))}}function ds(e){return'href="'+Bt(e)+'"'}function pa(e){return'link[rel="stylesheet"]['+e+"]"}function Af(e){return E({},e,{"data-precedence":e.precedence,precedence:null})}function op(e,r,d,v){e.querySelector('link[rel="preload"][as="style"]['+r+"]")?v.loading=1:(r=e.createElement("link"),v.preload=r,r.addEventListener("load",function(){return v.loading|=1}),r.addEventListener("error",function(){return v.loading|=2}),xt(r,"link",d),ht(r),e.head.appendChild(r))}function fs(e){return'[src="'+Bt(e)+'"]'}function ga(e){return"script[async]"+e}function Of(e,r,d){if(r.count++,r.instance===null)switch(r.type){case"style":var v=e.querySelector('style[data-href~="'+Bt(d.href)+'"]');if(v)return r.instance=v,ht(v),v;var R=E({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return v=(e.ownerDocument||e).createElement("style"),ht(v),xt(v,"style",R),Go(v,d.precedence,e),r.instance=v;case"stylesheet":R=ds(d.href);var M=e.querySelector(pa(R));if(M)return r.state.loading|=4,r.instance=M,ht(M),M;v=Af(d),(R=pn.get(R))&&kc(v,R),M=(e.ownerDocument||e).createElement("link"),ht(M);var W=M;return W._p=new Promise(function(X,ee){W.onload=X,W.onerror=ee}),xt(M,"link",v),r.state.loading|=4,Go(M,d.precedence,e),r.instance=M;case"script":return M=fs(d.src),(R=e.querySelector(ga(M)))?(r.instance=R,ht(R),R):(v=d,(R=pn.get(M))&&(v=E({},d),Ic(v,R)),e=e.ownerDocument||e,R=e.createElement("script"),ht(R),xt(R,"link",v),e.head.appendChild(R),r.instance=R);case"void":return null;default:throw Error(U(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(v=r.instance,r.state.loading|=4,Go(v,d.precedence,e));return r.instance}function Go(e,r,d){for(var v=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),R=v.length?v[v.length-1]:null,M=R,W=0;W<v.length;W++){var X=v[W];if(X.dataset.precedence===r)M=X;else if(M!==R)break}M?M.parentNode.insertBefore(e,M.nextSibling):(r=d.nodeType===9?d.head:d,r.insertBefore(e,r.firstChild))}function kc(e,r){e.crossOrigin==null&&(e.crossOrigin=r.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=r.referrerPolicy),e.title==null&&(e.title=r.title)}function Ic(e,r){e.crossOrigin==null&&(e.crossOrigin=r.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=r.referrerPolicy),e.integrity==null&&(e.integrity=r.integrity)}var Ho=null;function kf(e,r,d){if(Ho===null){var v=new Map,R=Ho=new Map;R.set(d,v)}else R=Ho,v=R.get(d),v||(v=new Map,R.set(d,v));if(v.has(e))return v;for(v.set(e,null),d=d.getElementsByTagName(e),R=0;R<d.length;R++){var M=d[R];if(!(M[sr]||M[wt]||e==="link"&&M.getAttribute("rel")==="stylesheet")&&M.namespaceURI!=="http://www.w3.org/2000/svg"){var W=M.getAttribute(r)||"";W=e+W;var X=v.get(W);X?X.push(M):v.set(W,[M])}}return v}function If(e,r,d){e=e.ownerDocument||e,e.head.insertBefore(d,r==="title"?e.querySelector("head > title"):null)}function lp(e,r,d){if(d===1||r.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;switch(r.rel){case"stylesheet":return e=r.disabled,typeof r.precedence=="string"&&e==null;default:return!0}case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function Lf(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var ma=null;function cp(){}function up(e,r,d){if(ma===null)throw Error(U(475));var v=ma;if(r.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(r.state.loading&4)===0){if(r.instance===null){var R=ds(d.href),M=e.querySelector(pa(R));if(M){e=M._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(v.count++,v=Bo.bind(v),e.then(v,v)),r.state.loading|=4,r.instance=M,ht(M);return}M=e.ownerDocument||e,d=Af(d),(R=pn.get(R))&&kc(d,R),M=M.createElement("link"),ht(M);var W=M;W._p=new Promise(function(X,ee){W.onload=X,W.onerror=ee}),xt(M,"link",d),r.instance=M}v.stylesheets===null&&(v.stylesheets=new Map),v.stylesheets.set(r,e),(e=r.state.preload)&&(r.state.loading&3)===0&&(v.count++,r=Bo.bind(v),e.addEventListener("load",r),e.addEventListener("error",r))}}function dp(){if(ma===null)throw Error(U(475));var e=ma;return e.stylesheets&&e.count===0&&Lc(e,e.stylesheets),0<e.count?function(r){var d=setTimeout(function(){if(e.stylesheets&&Lc(e,e.stylesheets),e.unsuspend){var v=e.unsuspend;e.unsuspend=null,v()}},6e4);return e.unsuspend=r,function(){e.unsuspend=null,clearTimeout(d)}}:null}function Bo(){if(this.count--,this.count===0){if(this.stylesheets)Lc(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var $o=null;function Lc(e,r){e.stylesheets=null,e.unsuspend!==null&&(e.count++,$o=new Map,r.forEach(fp,e),$o=null,Bo.call(e))}function fp(e,r){if(!(r.state.loading&4)){var d=$o.get(e);if(d)var v=d.get(null);else{d=new Map,$o.set(e,d);for(var R=e.querySelectorAll("link[data-precedence],style[data-precedence]"),M=0;M<R.length;M++){var W=R[M];(W.nodeName==="LINK"||W.getAttribute("media")!=="not all")&&(d.set(W.dataset.precedence,W),v=W)}v&&d.set(null,v)}R=r.instance,W=R.getAttribute("data-precedence"),M=d.get(W)||v,M===v&&d.set(null,R),d.set(W,R),this.count++,v=Bo.bind(this),R.addEventListener("load",v),R.addEventListener("error",v),M?M.parentNode.insertBefore(R,M.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(R,e.firstChild)),r.state.loading|=4}}var va={$$typeof:t,Provider:null,Consumer:null,_currentValue:Z,_currentValue2:Z,_threadCount:0};function hp(e,r,d,v,R,M,W,X){this.tag=1,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Si(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Si(0),this.hiddenUpdates=Si(null),this.identifierPrefix=v,this.onUncaughtError=R,this.onCaughtError=M,this.onRecoverableError=W,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=X,this.incompleteTransitions=new Map}function Pf(e,r,d,v,R,M,W,X,ee,se,ye,Te){return e=new hp(e,r,d,W,X,ee,se,Te),r=1,M===!0&&(r|=24),M=fn(3,null,null,r),e.current=M,M.stateNode=e,r=cl(),r.refCount++,e.pooledCache=r,r.refCount++,M.memoizedState={element:v,isDehydrated:d,cache:r},$l(M),e}function Df(e){return e?(e=qi,e):qi}function Mf(e,r,d,v,R,M){R=Df(R),v.context===null?v.context=R:v.pendingContext=R,v=kr(r),v.payload={element:d},M=M===void 0?null:M,M!==null&&(v.callback=M),d=Ir(e,v,r),d!==null&&(qt(d,e,r),ea(d,e,r))}function Nf(e,r){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var d=e.retryLane;e.retryLane=d!==0&&d<r?d:r}}function Pc(e,r){Nf(e,r),(e=e.alternate)&&Nf(e,r)}function Uf(e){if(e.tag===13){var r=br(e,67108864);r!==null&&qt(r,e,67108864),Pc(e,67108864)}}var qo=!0;function pp(e,r,d,v){var R=C.T;C.T=null;var M=Y.p;try{Y.p=2,Dc(e,r,d,v)}finally{Y.p=M,C.T=R}}function gp(e,r,d,v){var R=C.T;C.T=null;var M=Y.p;try{Y.p=8,Dc(e,r,d,v)}finally{Y.p=M,C.T=R}}function Dc(e,r,d,v){if(qo){var R=Mc(v);if(R===null)Cc(e,r,v,Vo,d),jf(e,v);else if(vp(R,e,r,d,v))v.stopPropagation();else if(jf(e,v),r&4&&-1<mp.indexOf(e)){for(;R!==null;){var M=en(R);if(M!==null)switch(M.tag){case 3:if(M=M.stateNode,M.current.memoizedState.isDehydrated){var W=ft(M.pendingLanes);if(W!==0){var X=M;for(X.pendingLanes|=2,X.entangledLanes|=2;W;){var ee=1<<31-Pe(W);X.entanglements[1]|=ee,W&=~ee}Pn(M),(gt&6)===0&&(Oo=St()+500,da(0))}}break;case 13:X=br(M,2),X!==null&&qt(X,M,2),Lo(),Pc(M,2)}if(M=Mc(v),M===null&&Cc(e,r,v,Vo,d),M===R)break;R=M}R!==null&&v.stopPropagation()}else Cc(e,r,v,null,d)}}function Mc(e){return e=Ai(e),Nc(e)}var Vo=null;function Nc(e){if(Vo=null,e=En(e),e!==null){var r=F(e);if(r===null)e=null;else{var d=r.tag;if(d===13){if(e=H(r),e!==null)return e;e=null}else if(d===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;e=null}else r!==e&&(e=null)}}return Vo=e,null}function xf(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(_i()){case bn:return 2;case Tn:return 8;case gn:case $r:return 32;case nr:return 268435456;default:return 32}default:return 32}}var Uc=!1,xr=null,jr=null,Fr=null,ya=new Map,_a=new Map,Gr=[],mp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function jf(e,r){switch(e){case"focusin":case"focusout":xr=null;break;case"dragenter":case"dragleave":jr=null;break;case"mouseover":case"mouseout":Fr=null;break;case"pointerover":case"pointerout":ya.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":_a.delete(r.pointerId)}}function Sa(e,r,d,v,R,M){return e===null||e.nativeEvent!==M?(e={blockedOn:r,domEventName:d,eventSystemFlags:v,nativeEvent:M,targetContainers:[R]},r!==null&&(r=en(r),r!==null&&Uf(r)),e):(e.eventSystemFlags|=v,r=e.targetContainers,R!==null&&r.indexOf(R)===-1&&r.push(R),e)}function vp(e,r,d,v,R){switch(r){case"focusin":return xr=Sa(xr,e,r,d,v,R),!0;case"dragenter":return jr=Sa(jr,e,r,d,v,R),!0;case"mouseover":return Fr=Sa(Fr,e,r,d,v,R),!0;case"pointerover":var M=R.pointerId;return ya.set(M,Sa(ya.get(M)||null,e,r,d,v,R)),!0;case"gotpointercapture":return M=R.pointerId,_a.set(M,Sa(_a.get(M)||null,e,r,d,v,R)),!0}return!1}function Ff(e){var r=En(e.target);if(r!==null){var d=F(r);if(d!==null){if(r=d.tag,r===13){if(r=H(d),r!==null){e.blockedOn=r,Ra(e.priority,function(){if(d.tag===13){var v=Xt(),R=br(d,v);R!==null&&qt(R,d,v),Pc(d,v)}});return}}else if(r===3&&d.stateNode.current.memoizedState.isDehydrated){e.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}e.blockedOn=null}function zo(e){if(e.blockedOn!==null)return!1;for(var r=e.targetContainers;0<r.length;){var d=Mc(e.nativeEvent);if(d===null){d=e.nativeEvent;var v=new d.constructor(d.type,d);Ri=v,d.target.dispatchEvent(v),Ri=null}else return r=en(d),r!==null&&Uf(r),e.blockedOn=d,!1;r.shift()}return!0}function Gf(e,r,d){zo(e)&&d.delete(r)}function yp(){Uc=!1,xr!==null&&zo(xr)&&(xr=null),jr!==null&&zo(jr)&&(jr=null),Fr!==null&&zo(Fr)&&(Fr=null),ya.forEach(Gf),_a.forEach(Gf)}function Wo(e,r){e.blockedOn===r&&(e.blockedOn=null,Uc||(Uc=!0,Le.unstable_scheduleCallback(Le.unstable_NormalPriority,yp)))}var Yo=null;function Hf(e){Yo!==e&&(Yo=e,Le.unstable_scheduleCallback(Le.unstable_NormalPriority,function(){Yo===e&&(Yo=null);for(var r=0;r<e.length;r+=3){var d=e[r],v=e[r+1],R=e[r+2];if(typeof v!="function"){if(Nc(v||d)===null)continue;break}var M=en(d);M!==null&&(e.splice(r,3),r-=3,wl(M,{pending:!0,data:R,method:d.method,action:v},v,R))}}))}function Ca(e){function r(ee){return Wo(ee,e)}xr!==null&&Wo(xr,e),jr!==null&&Wo(jr,e),Fr!==null&&Wo(Fr,e),ya.forEach(r),_a.forEach(r);for(var d=0;d<Gr.length;d++){var v=Gr[d];v.blockedOn===e&&(v.blockedOn=null)}for(;0<Gr.length&&(d=Gr[0],d.blockedOn===null);)Ff(d),d.blockedOn===null&&Gr.shift();if(d=(e.ownerDocument||e).$$reactFormReplay,d!=null)for(v=0;v<d.length;v+=3){var R=d[v],M=d[v+1],W=R[Mt]||null;if(typeof M=="function")W||Hf(d);else if(W){var X=null;if(M&&M.hasAttribute("formAction")){if(R=M,W=M[Mt]||null)X=W.formAction;else if(Nc(R)!==null)continue}else X=W.action;typeof X=="function"?d[v+1]=X:(d.splice(v,3),v-=3),Hf(d)}}}function xc(e){this._internalRoot=e}Qo.prototype.render=xc.prototype.render=function(e){var r=this._internalRoot;if(r===null)throw Error(U(409));var d=r.current,v=Xt();Mf(d,v,e,r,null,null)},Qo.prototype.unmount=xc.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var r=e.containerInfo;e.tag===0&&os(),Mf(e.current,2,null,e,null,null),Lo(),r[Zt]=null}};function Qo(e){this._internalRoot=e}Qo.prototype.unstable_scheduleHydration=function(e){if(e){var r=vs();e={blockedOn:null,target:e,priority:r};for(var d=0;d<Gr.length&&r!==0&&r<Gr[d].priority;d++);Gr.splice(d,0,e),d===0&&Ff(e)}};var Bf=ut.version;if(Bf!=="19.0.0")throw Error(U(527,Bf,"19.0.0"));Y.findDOMNode=function(e){var r=e._reactInternals;if(r===void 0)throw typeof e.render=="function"?Error(U(188)):(e=Object.keys(e).join(","),Error(U(268,e)));return e=$(r),e=e!==null?j(e):null,e=e===null?null:e.stateNode,e};var _p={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:C,findFiberByHostInstance:En,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ko=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ko.isDisabled&&Ko.supportsFiber)try{ge=Ko.inject(_p),Ae=Ko}catch{}}return Ta.createRoot=function(e,r){if(!K(e))throw Error(U(299));var d=!1,v="",R=id,M=sd,W=ad,X=null;return r!=null&&(r.unstable_strictMode===!0&&(d=!0),r.identifierPrefix!==void 0&&(v=r.identifierPrefix),r.onUncaughtError!==void 0&&(R=r.onUncaughtError),r.onCaughtError!==void 0&&(M=r.onCaughtError),r.onRecoverableError!==void 0&&(W=r.onRecoverableError),r.unstable_transitionCallbacks!==void 0&&(X=r.unstable_transitionCallbacks)),r=Pf(e,1,!1,null,null,d,v,R,M,W,X,null),e[Zt]=r.current,Sc(e.nodeType===8?e.parentNode:e),new xc(r)},Ta.hydrateRoot=function(e,r,d){if(!K(e))throw Error(U(299));var v=!1,R="",M=id,W=sd,X=ad,ee=null,se=null;return d!=null&&(d.unstable_strictMode===!0&&(v=!0),d.identifierPrefix!==void 0&&(R=d.identifierPrefix),d.onUncaughtError!==void 0&&(M=d.onUncaughtError),d.onCaughtError!==void 0&&(W=d.onCaughtError),d.onRecoverableError!==void 0&&(X=d.onRecoverableError),d.unstable_transitionCallbacks!==void 0&&(ee=d.unstable_transitionCallbacks),d.formState!==void 0&&(se=d.formState)),r=Pf(e,1,!0,r,d??null,v,R,M,W,X,ee,se),r.context=Df(null),d=r.current,v=Xt(),R=kr(v),R.callback=null,Ir(d,R,v),r.current.lanes=v,rr(r,v),Pn(r),e[Zt]=r.current,Sc(e),new Qo(r)},Ta.version="19.0.0",Ta}var Jf;function Ip(){if(Jf)return Gc.exports;Jf=1;function Le(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Le)}catch(ut){console.error(ut)}}return Le(),Gc.exports=kp(),Gc.exports}var Lp=Ip(),qc={exports:{}};/*! For license information please see plivobrowsersdk.js.LICENSE.txt */var Zf;function Pp(){return Zf||(Zf=1,function(Le,ut){(function(Se,U){Le.exports=U()})(window,function(){return function(Se){var U={};function K(G){if(U[G])return U[G].exports;var q=U[G]={i:G,l:!1,exports:{}};return Se[G].call(q.exports,q,q.exports,K),q.l=!0,q.exports}return K.m=Se,K.c=U,K.d=function(G,q,x){K.o(G,q)||Object.defineProperty(G,q,{enumerable:!0,get:x})},K.r=function(G){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(G,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(G,"__esModule",{value:!0})},K.t=function(G,q){if(1&q&&(G=K(G)),8&q||4&q&&typeof G=="object"&&G&&G.__esModule)return G;var x=Object.create(null);if(K.r(x),Object.defineProperty(x,"default",{enumerable:!0,value:G}),2&q&&typeof G!="string")for(var N in G)K.d(x,N,(function(S){return G[S]}).bind(null,N));return x},K.n=function(G){var q=G&&G.__esModule?function(){return G.default}:function(){return G};return K.d(q,"a",q),q},K.o=function(G,q){return Object.prototype.hasOwnProperty.call(G,q)},K.p="",K(K.s=0)}({"./lib/client.ts":function(Se,U,K){var G=this&&this.__createBinding||(Object.create?function(k,P,F,H){H===void 0&&(H=F),Object.defineProperty(k,H,{enumerable:!0,get:function(){return P[F]}})}:function(k,P,F,H){H===void 0&&(H=F),k[H]=P[F]}),q=this&&this.__setModuleDefault||(Object.create?function(k,P){Object.defineProperty(k,"default",{enumerable:!0,value:P})}:function(k,P){k.default=P}),x=this&&this.__importStar||function(k){if(k&&k.__esModule)return k;var P={};if(k!=null)for(var F in k)F!=="default"&&Object.prototype.hasOwnProperty.call(k,F)&&G(P,k,F);return q(P,k),P},N=this&&this.__importDefault||function(k){return k&&k.__esModule?k:{default:k}};Object.defineProperty(U,"__esModule",{value:!0}),U.Client=void 0;const S=K("./node_modules/events/events.js"),p=x(K("./lib/constants.ts")),b=K("./lib/logger.ts"),_=x(K("./lib/media/audioDevice.ts")),t=x(K("./lib/media/document.ts")),m=N(K("./lib/utils/options.ts")),f=x(K("./lib/stats/nonRTPStats.ts")),o=x(K("./lib/utils/device.ts")),s=N(K("./lib/managers/account.ts")),n=x(K("./lib/managers/incomingCall.ts")),i=x(K("./lib/managers/outgoingCall.ts")),a=K("./lib/stats/ws.ts"),c=K("./lib/utils/feedback.ts"),u=K("./lib/stats/httpRequest.ts"),g=N(K("./lib/utils/browserDetection.ts")),h=N(K("./lib/utils/frameworkDetection.ts")),C=N(K("./lib/utils/token.js")),E=K("./lib/managers/util.ts"),y=K("./lib/utils/networkManager.ts"),w=K("./lib/constants.ts"),O=K("./lib/utils/loggerUtil.ts"),L={log:b.Logger,sendEvents:f.sendEvents,AppError:f.AppError};class I extends S.EventEmitter{constructor(P){super(),this.login=(D,$)=>this._login(D,$),this.loginWithAccessToken=D=>this._loginWithAccessToken(D),this.loginWithAccessTokenGenerator=D=>this._loginWithAccessTokenGenerator(D),this.getErrorStringByErrorCodes=D=>this._getErrorStringByErrorCodes(D),this.logout=()=>this._logout(),this.call=(D,$)=>this._call(D,$),this.answer=(D,$)=>this._answer(D,$),this.hangup=()=>this._hangup(),this.reject=D=>this._reject(D),this.ignore=D=>this._ignore(D),this.sendDtmf=D=>this._sendDtmf(D),this.mute=()=>this._mute(),this.unmute=()=>this._unmute(),this.setRingTone=D=>this._setRingTone(D),this.setRingToneBack=D=>this._setRingToneBack(D),this.setConnectTone=D=>this._setConnectTone(D),this.startNoiseReduction=()=>this._startNoiseReduction(),this.stopNoiseReduction=()=>this._stopNoiseReduction(),this.setDtmfTone=(D,$)=>this._setDtmfTone(D,$),this.getCallUUID=()=>this._getCallUUID(),this.isRegistered=()=>this._isRegistered(),this.isConnecting=()=>this._isConnecting(),this.isConnected=()=>this._isConnected(),this.getLastCallUUID=()=>this._getLastCallUUID(),this.getIncomingCalls=()=>this._getIncomingCalls(),this.setDebug=D=>this._setDebug(D),this.getPeerConnection=()=>this._getPeerConnection(),this.webRTC=()=>!!window.RTCPeerConnection,this.supportedBrowsers=()=>"Chrome, Firefox, Safari, Edge",this.submitCallQualityFeedback=(D,$,j,V,Y)=>this._submitCallQualityFeedback(D,$,j,V,Y),this.getUsernameFromToken=D=>D.sub?`${D.sub}_${D.iss}`:`puser${new Date().valueOf().toString()}jt_${D.iss}`,this.validateToken=D=>{if(D==null)return!1;const{app:$,iss:j,sub:V,nbf:Y,exp:Z,per:J}=D;return!!(j&&Y&&Z)&&!($&&typeof $!="string"||j&&typeof j!="string"||V&&typeof V!="string"||Y&&typeof Y!="number"||Z&&typeof Z!="number"||J&&J.voice&&J.voice.incoming_allow&&typeof J.voice.incoming_allow!="boolean"||J&&J.voice&&J.voice.outgoing_allow&&typeof J.voice.outgoing_allow!="boolean")},this.parseJwtToken=D=>{try{const $=D.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),j=decodeURIComponent(atob($).split("").map(V=>"%"+("00"+V.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(j)}catch($){return L.log.error(`${p.LOGCAT.LOGIN}| parsing of jwt failed ${$.message}`),null}},this.tokenLogin=(D,$)=>{var j;if(this.phone&&this.phone.isRegistered()&&this.phone.isConnected()&&this.userName===D&&!this.isAccessToken)return L.log.warn(`${p.LOGCAT.LOGIN} | Already registered with the endpoint provided - ${this.userName}`),!0;this.isLoginCalled=!0;const V=new s.default(this,D," ",$,(j=this.options.registrationRefreshTimer)!==null&&j!==void 0?j:p.REGISTER_EXPIRES_SECONDS),Y=()=>{V.setupUserAccount()},Z=V.validate(()=>{Y()});if(typeof Z=="boolean"){if(!Z)return!1;Y()}return!0},this.setExpiryTimeInEpoch=D=>{this.accessTokenExpiryInEpoch=D},this.getTokenExpiryTimeInEpoch=()=>this.accessTokenExpiryInEpoch,this._loginWithAccessTokenGenerator=D=>D==null?(L.log.error(`${p.LOGCAT.LOGIN} | Login failed. Access token object can not be null`),this.emit("onLoginFailed","INVALID_ACCESS_TOKEN"),!1):(this.isAccessTokenGenerator=!0,this.accessTokenObject=D,L.log.info(`${p.LOGCAT.LOGIN} | Login initiated with Access Token Generator`),D.getAccessToken().then($=>{if($==null)return this.emit("onLoginFailed","INVALID_ACCESS_TOKEN"),L.log.error(`${p.LOGCAT.LOGIN} | Login failed. Access Token found null. Try to re-login with valid accessToken`),!1;const j=this.parseJwtToken($);if(j!=null){const V=Math.floor(new Date().getTime()),Y=Math.floor(new Date().getTime()+864e5),Z=(j.exp!=null?1e3*j.exp:Y)-V-6e4;this.accessTokenGeneratorTimer=setTimeout(()=>{this.loginWithAccessTokenGenerator(D)},Number(Z))}return this.isAccessToken?(this.phone!=null&&this._initJWTParams($)&&(L.log.debug("New token added : ",$),this.phone.registrator().setExtraHeaders([`X-Plivo-Jwt: ${$}`])),!0):this.loginWithAccessToken($)}).catch($=>(L.log.error(`${p.LOGCAT.LOGIN} | Failed to fetch the accessToken. Try to re-login with valid accessToken`,$),this.emit("onLoginFailed","INVALID_ACCESS_TOKEN"),!1)),!0),this._initJWTParams=D=>{try{const $=this.parseJwtToken(D);return $&&$.per&&$.per.voice&&(this.isOutgoingGrant=$.per.voice.outgoing_allow,this.isIncomingGrant=$.per.voice.incoming_allow),this.validateToken($)?(L.log.info(`${p.LOGCAT.LOGIN} | Parsed JWT with params:- `,JSON.stringify($)),this.userName=this.getUsernameFromToken($),this.accessToken=D,this.isAccessToken=!0,!0):(this.emit("onLoginFailed","INVALID_ACCESS_TOKEN"),L.log.error(`${p.LOGCAT.LOGIN} | Login failed. Access Token found null. Try to re-login with valid accessToken`),!1)}catch{return!1}},this._loginWithAccessToken=D=>{try{return this.phone&&(this.isConnecting()||this.phone.isRegistering())?(L.log.warn(`${p.LOGCAT.LOGIN} | Already ${this.isConnecting()?"connecting":"registering"}`),!0):this._initJWTParams(D)&&this.userName?(L.log.info(p.LOGCAT.LOGIN," | Login initiated with AccessToken : ",D),this.loggerUtil.setUserName(this.userName),this.tokenLogin(this.userName,D)):(L.log.info(p.LOGCAT.LOGIN,"Login failed : Invalid AccessToken"),!1)}catch{return!1}},this._getErrorStringByErrorCodes=D=>{switch(D){case 10001:return"INVALID_ACCESS_TOKEN";case 10002:return"INVALID_ACCESS_TOKEN_HEADER";case 10003:return"INVALID_ACCESS_TOKEN_ISSUER";case 10004:return"INVALID_ACCESS_TOKEN_SUBJECT";case 10005:return"ACCESS_TOKEN_NOT_VALID_YET";case 10006:return"ACCESS_TOKEN_EXPIRED";case 10007:return"INVALID_ACCESS_TOKEN_SIGNATURE";case 10008:return"INVALID_ACCESS_TOKEN_GRANTS";case 10009:return"EXPIRATION_EXCEEDS_MAX_ALLOWED_TIME";case 10010:return"MAX_ALLOWED_LOGIN_REACHED";default:return"Unauthorised"}},this._login=(D,$)=>{var j;if(this.loggerUtil.setUserName(D),L.log.info(`${p.LOGCAT.LOGIN} | Login initiated with Endpoint - ${D}`),this.phone&&(this.isConnecting()||this.phone.isRegistering()))return L.log.warn(`${p.LOGCAT.LOGIN} | Already ${this.isConnecting()?"connecting":"registering"}`),!0;if(this.phone&&this.phone.isRegistered()&&this.phone.isConnected()&&this.userName===D&&!this.isAccessToken)return L.log.warn(`${p.LOGCAT.LOGIN} | Already registered with the endpoint provided - ${this.userName}`),!0;this.isLoginCalled=!0;const V=new s.default(this,D,$,null,(j=this.options.registrationRefreshTimer)!==null&&j!==void 0?j:p.REGISTER_EXPIRES_SECONDS),Y=()=>{V.setupUserAccount(),this.browserDetails.browser==="safari"&&t.playAudio(p.SILENT_TONE_ELEMENT_ID)},Z=V.validate(()=>{Y()});if(typeof Z=="boolean"){if(!Z)return!1;Y()}return!0},this._logout=()=>this.isLoggedIn?(L.log.debug(p.LOGCAT.LOGOUT," | Logout initiated!",this.userName),this.clearOnLogout(),!0):(L.log.debug(p.LOGCAT.LOGOUT," | Cannot execute logout: no active login session.",this.userName),!1),this._call=(D,$)=>(this.timeTakenForStats.pdd={init:new Date().getTime()},!this.isLoggedIn&&(this.phone===null||this.phone&&!this.phone.isConnected()&&!this.phone.isRegistered())?(L.log.warn(`${p.LOGCAT.LOGIN} | Must be logged in before to make a call`),!1):this.isAccessToken&&(this.accessToken==null||this.accessToken===void 0||(this===null||this===void 0?void 0:this.isOutgoingGrant)===!1)?(this.emit("onPermissionDenied","INVALID_ACCESS_TOKEN_GRANTS"),L.log.warn(`${p.LOGCAT.LOGIN} | Outgoing call permission not granted`),!1):(this.isAccessToken&&($["X-Plivo-Jwt"]=`${this.accessToken}`),this.owaLastDetect.isOneWay=!1,i.makeCall(this,$,D),!0)),this._answer=(D,$)=>{const j=n.getCurrentIncomingCall(D,this),V=n.checkIncomingCallAction($);return j&&V?(L.log.debug(`answer - ${j.callUUID}`),j.addConnectionStage(`answer()@${new Date().getTime()}`),n.answerIncomingCall(j,$),!0):(L.log.error(`${p.LOGCAT.LOGIN} | Incoming call answer() failed : no incoming call`),!1)},this._hangup=()=>{var D;if(!this._currentSession)return L.log.warn(`${w.LOGCAT.CALL} | No call session exists to hangup`),!1;this.loggerUtil.setSipCallID((D=this._currentSession.sipCallID)!==null&&D!==void 0?D:""),L.log.debug(`hangup - ${this._currentSession.callUUID}`),this._currentSession.session&&this._currentSession.session.direction!=="outgoing"&&!this._currentSession.session.isEstablished()&&L.log.warn("use of hangup() on unanswered call is deprecated. use reject() instead");try{L.log.debug(`${w.LOGCAT.CALL} | hangup initialized`),_.updateAudioDeviceFlags(),L.AppError&&L.AppError.call(this,{name:"hangup",message:"hangup initialized",method:"hangup()"}),this._currentSession.session&&!this._currentSession.session.isEnded()&&this._currentSession.session.terminate(),this.ringBackToneView&&!this.ringBackToneView.paused&&t.stopAudio(p.RINGBACK_ELEMENT_ID)}catch($){L.log.error(`${w.LOGCAT.CALL} | Could not hangup, Reason: `,$),L.AppError&&L.sendEvents&&(L.AppError.call(this,{name:$.name,message:$.message,method:"hangup()"}),L.sendEvents.call(this,{msg:"ERROR_EVENT",name:$.name,info:$.message,method:"hangup()"},this._currentSession))}return!0},this._reject=D=>{var $;const j=n.getCurrentIncomingCall(D,this);if(!j)return L.log.warn(`${w.LOGCAT.CALL} | No call session exists to reject()`),!1;if(this.loggerUtil.setSipCallID(($=j.sipCallID)!==null&&$!==void 0?$:""),L.log.debug(`${w.LOGCAT.CALL} | reject - ${j.callUUID}`),j.session&&j.session.isEstablished())return L.log.warn(`${w.LOGCAT.CALL} |call already answerd, please use hangup() method`),!1;if(j){const V={status_code:486,reason_phrase:"Busy Here"};L.log.info("rejecting call"),L.AppError&&L.AppError.call(this,{name:"reject",message:"reject initialized",method:"reject()"});try{j.session.terminate(V),this.incomingInvites.delete(j.callUUID)}catch(Y){L.log.error("error in rejecting call : ",Y),L.AppError&&L.sendEvents&&(L.AppError.call(this,{name:Y.name,message:Y.message,method:"reject()"}),L.sendEvents.call(this,{msg:"ERROR_EVENT",name:Y.name,info:Y.message,method:"reject()"},j))}this.incomingInvites.size||this.ringToneView&&!this.ringToneView.paused&&t.stopAudio(p.RINGTONE_ELEMENT_ID)}return!0},this._ignore=D=>{var $;const j=n.getCurrentIncomingCall(D,this);return j?(this.loggerUtil.setSipCallID(($=j.sipCallID)!==null&&$!==void 0?$:""),L.log.debug(`ignore - ${j.callUUID}`),j.session.removeAllListeners(),this.incomingInvites.delete(j.callUUID),this.incomingInvites.size||this.ringToneView&&!this.ringToneView.paused&&t.stopAudio(p.RINGTONE_ELEMENT_ID),n.handleIgnoreState(j),L.log.debug(`${p.LOGCAT.CALL} | On incoming call ignored`,j.getCallInfo("local","none","Ignored",w.LOCAL_ERROR_CODES.Ignored)),this.emit("onIncomingCallIgnored",j.getCallInfo("local","none","Ignored",w.LOCAL_ERROR_CODES.Ignored)),!0):(L.log.warn("No incoming calls to ignore"),this.shouldMuteCall=!1,!1)},this._sendDtmf=D=>{var $;if(!navigator.onLine)return L.log.warn(`${p.LOGCAT.CALL} | Unable to send DTMF: No internet connection`);const j=p.DTMF_TONE_FLAG;if(typeof D>"u"||D==null)return L.log.warn(`${p.LOGCAT.CALL} | DTMF digit can not be null`);if(typeof j[D]>"u")return L.log.warn(`${D} is not a valid DTMF digit`);if(!this._currentSession)return L.log.warn("No call session exists to send DTMF");L.log.debug(`sendDtmf - ${this._currentSession.callUUID}`);try{return L.log.debug(`${p.LOGCAT.CALL} | DTMF send ${D}`),t.getDTMFOption(this.options.dtmfOptions)!=="INBAND"&&(this._currentSession.session.sendDTMF(D),L.log.info("sent outband dtmf")),D==="*"?t.playAudio("dtmfstar",this):D==="#"?t.playAudio("dtmfpound",this):t.playAudio(`dtmf${D}`,this)}catch(V){return L.log.error(`${p.LOGCAT.CALL} | Call has not been confirmed cannot send DTMF`),L.AppError&&L.AppError.call(this,{name:V.name,message:V.message,method:"sendDtmf()"}),($=L.sendEvents)===null||$===void 0?void 0:$.call(this,{msg:"ERROR_EVENT",name:V.name,info:V.message,method:"sendDtmf()"},this._currentSession)}},this._mute=()=>{var D,$;if(!this._currentSession)return L.log.warn(`${p.LOGCAT.CALL} | No call session exists to mute`),this.shouldMuteCall=!0,!1;L.log.debug(`${p.LOGCAT.CALL} | mute method is called`);try{this.isMuteCalled=!0,_.mute.call(this),this.isCallMuted=!0,this.callStats&&this.callStats.sendFabricEvent(this._currentSession.session.connection,this.callStats.fabricEvent.audioMute,this._currentSession.callUUID),f.onToggleMute.call(this,this._currentSession,"mute")}catch(j){L.log.error(`${p.LOGCAT.CALL} | error in mute :`,j.message),(D=L.AppError)===null||D===void 0||D.call(this,{name:j.name,message:j.message,method:"mute()"}),($=L.sendEvents)===null||$===void 0||$.call(this,{msg:"ERROR_EVENT",name:j.name,info:j.message,method:"mute()"},this._currentSession)}return!0},this._unmute=()=>{var D,$;if(!this._currentSession)return L.log.warn(`${p.LOGCAT.CALL} | No call session exists to unmute`),!1;L.log.debug(`${p.LOGCAT.CALL} | unmute method is called`),this.shouldMuteCall=!1;try{this.isMuteCalled=!1,_.unmute.call(this),this.isCallMuted=!1,this.callStats&&this.callStats.sendFabricEvent(this._currentSession.session.connection,this.callStats.fabricEvent.audioUnmute,this._currentSession.callUUID),f.onToggleMute.call(this,this._currentSession,"unmute")}catch(j){L.log.error(`${p.LOGCAT.CALL} | error in unmute : `,j.message),(D=L.AppError)===null||D===void 0||D.call(this,{name:j.name,message:j.message,method:"unmute()"}),($=L.sendEvents)===null||$===void 0||$.call(this,{msg:"ERROR_EVENT",name:j.name,info:j.message,method:"unmute()"},this._currentSession)}return!0},this._setRingTone=D=>(L.log.debug(`${p.LOGCAT.INIT}| setting ringtone`),D===!1||D===null?this.ringToneFlag=!1:typeof D=="string"?(this.ringToneFlag=!0,L.log.debug(`setRingTone() url : ${D}`),this.ringToneView&&(this.ringToneView.src=D)):this.ringToneFlag=!0,!0),this._setRingToneBack=D=>(L.log.debug(`${p.LOGCAT.INIT}| setting ringtoneback`),D===!1||D===null?this.ringToneBackFlag=!1:typeof D=="string"?(this.ringToneBackFlag=!0,L.log.debug(`setRingToneBack() url : ${D}`),this.ringBackToneView&&(this.ringBackToneView.src=D)):this.ringToneBackFlag=!0,!0),this._setConnectTone=D=>(L.log.debug(`${p.LOGCAT.INIT}| setting connect tone`),this.connectToneFlag=!!D,!0),this._setDtmfTone=(D,$)=>{L.log.debug(`${p.LOGCAT.CALL}| setting dtmf tone`);const j=p.DTMF_TONE_FLAG;if($===!1||$===null)j[D]=!1;else if(typeof $=="string"){L.log.debug("set dtmf tone"),j[D]="user";const V=`dtmf${D}`;document.getElementById(V).src=$}else j[D]=!0;return!0},this._getCallUUID=()=>this._currentSession?this._currentSession.callUUID:null,this._isRegistered=()=>this.isLoggedIn&&this.phone&&this.phone.isRegistered(),this._isConnecting=()=>this.phone&&this.phone._transport.isConnecting(),this._isConnected=()=>this.phone&&this.phone.isConnected(),this._startNoiseReduction=()=>new Promise(D=>{this.enableNoiseReduction?this.noiseSuppresion?this.browserDetails.browser==="safari"?(L.log.warn(`${p.LOGCAT.CALL_QUALITY} | Noise reduction feature is not supported in safari browser`),D(!1)):this.noiseSuppresion.startNoiseSuppresionManual().then(()=>{L.log.info(`${p.LOGCAT.CALL_QUALITY} | Noise Reduction started`),D(!0)}).catch($=>{L.log.info(`${p.LOGCAT.CALL_QUALITY} | Noise Reduction start failed with error:- ${$.message}`),D(!1)}):(L.log.warn(`${p.LOGCAT.CALL_QUALITY} | Noise reduction cannot be started since noise reduction is not instantiated`),D(!1)):(L.log.warn(`${p.LOGCAT.CALL_QUALITY} | Noise reduction cannot be started since "enableNoiseReduction" is set to false`),D(!1))}),this._stopNoiseReduction=()=>new Promise(D=>{this.enableNoiseReduction?this.noiseSuppresion?this.browserDetails.browser==="safari"?(L.log.warn(`${p.LOGCAT.CALL_QUALITY} | Noise reduction feature is not supported in safari browser`),D(!1)):this.noiseSuppresion.stopNoiseSuppressionManual().then(()=>{L.log.info(`${p.LOGCAT.CALL_QUALITY} | Noise Reduction stopped`),D(!0)}).catch($=>{L.log.info(`${p.LOGCAT.CALL_QUALITY} | Noise Reduction stop failed with error:- ${$.message}`),D(!1)}):(L.log.warn(`${p.LOGCAT.CALL_QUALITY} | Noise reduction cannot be stopped since noise reduction is not instantiated`),D(!1)):(L.log.warn(`${p.LOGCAT.CALL_QUALITY} | Noise reduction cannot be stopped since "enableNoiseReduction" is set to false`),D(!1))}),this._getLastCallUUID=()=>this._lastCallSession?this._lastCallSession.callUUID:null,this._getIncomingCalls=()=>{const D=[];return this.incomingInvites.forEach($=>{D.push($.getCallInfo())}),D},this._setDebug=D=>{D&&["INFO","DEBUG","WARN","ERROR","ALL","OFF"].indexOf(D)!==-1&&L.log.setLevel(D)},this._getPeerConnection=()=>this._currentSession&&this._currentSession.session&&this._currentSession.session.connection?{status:"success",pc:this._currentSession.session.connection}:{status:"called in wrong state",pc:null},this._submitCallQualityFeedback=(D,$,j,V,Y)=>new Promise((Z,J)=>{c.validateFeedback(D,$,V,j,this.userName,this.isLoggedIn).then(re=>{let ce;if(this.callStats&&this.callStats.sendUserFeedback(D,re,Re=>{L.log.debug(`Feedback stats sent status: ${Re}`)}),this._currentSession&&this._currentSession.callUUID===D?ce=this._currentSession:this._lastCallSession&&this._lastCallSession.callUUID===D&&(ce=this._lastCallSession),ce&&(L.log.send(this),this.statsSocket||(this.statsSocket=new a.StatsSocket,this.statsSocket.connect()),f.sendFeedbackEvent.call(this,ce,re)),Y===!0){let Re;Re=this.isAccessToken?{username:this.userName,accessToken:this.accessToken,calluuid:D}:{username:this.userName,password:this.password,domain:p.DOMAIN,calluuid:D},u.getPreSignedS3URL(Re,this.isAccessToken).then(pe=>{u.uploadConsoleLogsToBucket(pe,re).then(()=>{Z("Feedback is sent with console logs")}).catch(Oe=>{J(Oe)})}).catch(pe=>{L.log.error("Feedback was not able to send console logs"),J(pe)})}else Z("Feedback is sent")}).catch(re=>{L.log.error(`${p.LOGCAT.CALL_QUALITY} | SubmitCallQualityFeedback failed:- ${re}`),J(re)})}),E.setErrorCollector(),o.checkMediaDevices(),this.version="2.2.18-rc.2";const F=m.default(P);L.log.enableSipLogs(F.debug);const H={codecs:F.codecs,enableTracking:F.enableTracking,enableQualityTracking:F.enableQualityTracking,debug:F.debug,enableIPV6:F.enableIPV6,dscp:F.dscp,appId:F.appId,appSecret:F.appSecret,registrationDomainSocket:F.registrationDomainSocket,clientRegion:F.clientRegion,disableRtpTimeOut:F.disableRtpTimeOut,allowMultipleIncomingCalls:F.allowMultipleIncomingCalls,closeProtection:F.closeProtection,maxAverageBitrate:F.maxAverageBitrate,useDefaultAudioDevice:F.useDefaultAudioDevice,enableNoiseReduction:F.enableNoiseReduction,usePlivoStunServer:F.usePlivoStunServer,dtmfOptions:F.dtmfOptions};L.log.info(`${p.LOGCAT.INIT} | Plivo SDK initialized successfully with options:- `,JSON.stringify(H),`in ${L.log.level()} mode`),S.EventEmitter.call(this),this.accessTokenInterface=C.default,this.deferFeedback=null,this.isUnregisterPending=null,this.browserDetails=g.default(),this.connectionInfo={state:"",reason:""},this.permOnClick=!1,this.ringToneFlag=!0,this.ringToneBackFlag=!0,this.connectToneFlag=!0,this.isLoggedIn=!1,this.reconnectInterval=null,this.noiseReductionFilePath=P.noiseReductionFilePath,this.reconnectTryCount=0,this.phone=null,this._currentSession=null,this.callSession=null,this.callUUID=null,this.callDirection=null,this.lastCallUUID=null,this._lastCallSession=null,this.incomingInvites=new Map,this.incomingCallsInitiationTime=new Map,this.lastIncomingCall=null,this.callStats=null,this.userName=null,this.password=null,this.options=F,this.callstatskey=null,this.rtp_enabled=!1,this.statsioused=!1,this.isCallMuted=!1,this.isLoginCalled=!1,this.isLogoutCalled=!1,this.networkChangeInterval=null,this.connectionRetryInterval=null,this.shouldMuteCall=!1,this.isOutgoingGrant=!1,this.isIncomingGrant=!1,this.useDefaultAudioDevice=!1,g.default().browser!=="firefox"&&(this.speechRecognition=new webkitSpeechRecognition),this.loggerUtil=new O.LoggerUtil(this),L.log.setLoggerUtil(this.loggerUtil),this.options.usePlivoStunServer===!0&&p.STUN_SERVERS.indexOf(p.FALLBACK_STUN_SERVER)===-1&&p.STUN_SERVERS.push(p.FALLBACK_STUN_SERVER),this.options.usePlivoStunServer===!1&&p.STUN_SERVERS.indexOf(p.GOOG_STUN_SERVER)===-1&&p.STUN_SERVERS.push(p.GOOG_STUN_SERVER),this.audio={availableDevices:_.availableDevices,ringtoneDevices:_.ringtoneDevices,microphoneDevices:_.inputDevices,speakerDevices:_.outputDevices,revealAudioDevices:_.revealAudioDevices},this.audioConstraints=this.options.audioConstraints,this.owaLastDetect={time:0,isOneWay:!0},this.owaDetectTime=36e5,this.statsSocket=null,this.timeTakenForStats={},this.networkDisconnectedTimestamp=null,this.networkReconnectionTimestamp=null,this.deviceToggledInCurrentSession=!1,this.networkChangeInCurrentSession=!1,this.didFetchInitialNetworkInfo=!1,this.enableNoiseReduction=this.options.enableNoiseReduction,_.setAudioContraints(this),t.setup(this,this.options),_.detectDeviceChange.call(this),this.audioDevDic=null,_.audioDevDicSetter(D=>{this.audioDevDic=D}),_.audioDevDictionary(!0),window._PlivoInstance=this,L.log.info(`${p.LOGCAT.INIT} | PlivoWebSdk initialized in ${L.log.level()} mode, version: 2.2.18-rc.2 , browser: ${this.browserDetails.browser}-${this.browserDetails.version}`),this.jsFramework=h.default()}clearOnLogout(){this.isAccessToken&&(this.isAccessToken=!1,this.isOutgoingGrant=!1,this.isIncomingGrant=!1,this.accessToken=null),this.isAccessTokenGenerator&&this.accessTokenGeneratorTimer!=null&&(clearTimeout(this.accessTokenGeneratorTimer),this.accessTokenGeneratorTimer=null),this._currentSession&&!this._currentSession.session.isEnded()&&(this._currentSession.addConnectionStage(`logout()@${new Date().getTime()}`),L.log.debug(`${p.LOGCAT.LOGOUT} | Terminating an active call, before logging out`),this._currentSession.session.terminate()),this.isLogoutCalled=!0,this.noiseSuppresion.clearNoiseSupression(),this.connectionInfo={state:y.ConnectionState.DISCONNECTED,reason:"Logout"},this.phone&&this.phone.isRegistered()&&(this.phone.stop(),this.phone=null),this.statsSocket&&(this.statsSocket.disconnect(),this.statsSocket=null),L.log.send(this)}}U.Client=I},"./lib/constants.ts":function(Se,U,K){Object.defineProperty(U,"__esModule",{value:!0}),U.AUDIO_DEVICE_SECURITY_ERROR=U.AUDIO_DEVICE_ABORT_ERROR_CODE=U.SILENT_TONE_ELEMENT_ID=U.CONNECT_TONE_ELEMENT_ID=U.RINGTONE_ELEMENT_ID=U.RINGBACK_ELEMENT_ID=U.REMOTE_VIEW_ID=U.SELF_VIEW_ID=U.SILENT_TONE_URL=U.CONNECT_TONE_URL=U.RINGBACK_URL=U.RINGTONE_URL=U.LOGCAT=U.DEFAULT_COMMENTS=U.DEBUG_MODES=U.REGION=U.MAX_REGISTRATION_REFRESH_TIMER=U.MIN_REGISTRATION_REFRESH_TIMER=U.MIN_AVERAGE_BITRATE=U.MAX_AVERAGE_BITRATE=U.CONSOLE_LOGS_BUFFER_SIZE=U.DTMF_OPTIONS=U.DEFAULT_CODECS=U.LOCAL_ERROR_CODES=U.SIP_ERROR_CODE=U.DTMF_TONE_PLAY_RETRY_ATTEMPTS=U.SOCKET_SEND_STATS_RETRY_ATTEMPTS=U.SOCKET_SEND_STATS_RETRY_SECONDS_COUNT=U.GOOG_STUN_SERVER=U.FALLBACK_STUN_SERVER=U.STUN_SERVERS=U.NETWORK_CHANGE_INTERVAL=U.ICE_RECONNECT_COUNT=U.ICE_RECONNECT_INTERVAL=U.ICE_GATHERING_TIMEOUT=U.DEFAULT_MDNS_CANDIDATE=U.WS_RECOVERY_MIN_INTERVAL=U.WS_RECOVERY_MAX_INTERVAL=U.SESSION_TIMERS_EXPIRES=U.REGISTER_EXPIRES_SECONDS=U.NUMBER_OF_SIMULTANEOUS_INCOMING_CALLS_ALLOWED=U.DEFAULT_DTMFOPTIONS=U.AUDIO_CONSTRAINTS=U.REMOTEONLY=U.LOCALONLY=U.ENABLE_QUALITY_TRACKING_ALLOWED_VALUES=U.DEFAULT_ENABLE_QUALITY_TRACKING=U.DEFAULT_LOG_LEVEL=U.WS_SERVERS=U.DOMAIN=void 0,U.WS_RECONNECT_RETRY_INTERVAL=U.WS_RECONNECT_RETRY_COUNT=U.IP_ADDRESS_FETCH_RETRY_COUNT=U.MESSAGE_CHECK_TIMEOUT_ON_CALL_STATE=U.MESSAGE_CHECK_TIMEOUT_IDLE_STATE=U.NETWORK_CHANGE_INTERVAL_ON_CALL_STATE=U.NETWORK_CHANGE_INTERVAL_IDLE_STATE=U.STATS_ANALYSIS_WAIT_TIME=U.STATSSOCKET_RECONNECT_SEC=U.GETSTATS_HEARTBEATINTERVAL=U.AUDIO_INTERVAL=U.GETSTATS_INTERVAL=U.STATS_VERSION=U.STATS_SOURCE=U.LOG_COLLECTION_JWT=U.LOG_COLLECTION=U.S3BUCKET_API_URL_JWT=U.STATS_API_URL_ACCESS_TOKEN=U.SDKVERSION_API_URL=U.STATS_API_URL=U.STATSSOCKET_URL=U.S3BUCKET_API_URL=U.DTMF_TONE_FLAG=void 0,U.DOMAIN="phone.plivo.com",U.WS_SERVERS=["wss://client.plivo.com/signalling","wss://client-fb.plivo.com/signalling"],U.DEFAULT_LOG_LEVEL="INFO",U.DEFAULT_ENABLE_QUALITY_TRACKING="ALL",U.ENABLE_QUALITY_TRACKING_ALLOWED_VALUES=["ALL","NONE","REMOTEONLY","LOCALONLY"],U.LOCALONLY="LOCALONLY",U.REMOTEONLY="REMOTEONLY",U.AUDIO_CONSTRAINTS={optional:[{googAutoGainControl:!0}]},U.DEFAULT_DTMFOPTIONS={sendDtmfType:["INBAND","OUTBAND"]},U.NUMBER_OF_SIMULTANEOUS_INCOMING_CALLS_ALLOWED=50,U.REGISTER_EXPIRES_SECONDS=120,U.SESSION_TIMERS_EXPIRES=300,U.WS_RECOVERY_MAX_INTERVAL=20,U.WS_RECOVERY_MIN_INTERVAL=2,U.DEFAULT_MDNS_CANDIDATE="192.168.0.1",U.ICE_GATHERING_TIMEOUT=2e3,U.ICE_RECONNECT_INTERVAL=2e3,U.ICE_RECONNECT_COUNT=5,U.NETWORK_CHANGE_INTERVAL=1e4,U.STUN_SERVERS=["stun:stun.plivo.com:3478"],U.FALLBACK_STUN_SERVER="stun:stun-fb.plivo.com:3478",U.GOOG_STUN_SERVER="stun:stun.l.google.com:19302",U.SOCKET_SEND_STATS_RETRY_SECONDS_COUNT=1,U.SOCKET_SEND_STATS_RETRY_ATTEMPTS=5,U.DTMF_TONE_PLAY_RETRY_ATTEMPTS=4,U.SIP_ERROR_CODE={486:"User was busy",408:"No response from user",480:"No response from user",603:"Call rejected by user",484:"Invalid destination format",503:"Network issue while connecting the call",501:"Incompatible client configuration",487:"Call cancelled by caller",400:"Bad request - Parameters not valid",401:"Call authorization failed",403:"Call authorization failed",404:"Call authorization failed",405:"Call authorization failed",483:"Too many hops detected for call connection",500:"Internal Server Error",502:"There is an issue with the Carrier Gateway"},U.LOCAL_ERROR_CODES={"No Answer":3e3,Canceled:1e3,Rejected:3020,Terminated:11001,Ignored:11002,"call answer fail":11003,"Network switch while ringing":11004},U.DEFAULT_CODECS=["OPUS","PCMU"],U.DTMF_OPTIONS=["INBAND","OUTBAND"],U.CONSOLE_LOGS_BUFFER_SIZE=900,U.MAX_AVERAGE_BITRATE=48e3,U.MIN_AVERAGE_BITRATE=8e3,U.MIN_REGISTRATION_REFRESH_TIMER=60,U.MAX_REGISTRATION_REFRESH_TIMER=86400,U.REGION=["usa_west","usa_east","australia","europe","asia","south_america","south_asia"],U.DEBUG_MODES=["INFO","DEBUG","WARN","ERROR","ALL","ALL-PLAIN","OFF"],U.DEFAULT_COMMENTS={AUDIO_LAG:"audio_lag",BROKEN_AUDIO:"broken_audio",CALL_DROPPED:"call_dropped",CALLERID_ISSUES:"callerid_issue",DIGITS_NOT_CAPTURED:"digits_not_captured",ECHO:"echo",HIGH_CONNECT_TIME:"high_connect_time",LOW_AUDIO_LEVEL:"low_audio_level",ONE_WAY_AUDIO:"one_way_audio",OTHERS:"others",ROBOTIC_AUDIO:"robotic_audio"},U.LOGCAT={INIT:"INIT",LOGIN:"LOGIN",CALL:"CALLING",LOGOUT:"LOGOUT",CRASH:"CRASH",CALL_QUALITY:"CALL_QUALITY_FEEDBACK",NETWORK_CHANGE:"NETWORK_CHANGE",NIMBUS:"NIMBUS",WS:"WS"},U.RINGTONE_URL="https://cdn.plivo.com/sdk/browser/audio/us-ring.mp3",U.RINGBACK_URL="https://cdn.plivo.com/sdk/browser/audio/us-ring.mp3?v=ringback",U.CONNECT_TONE_URL="https://cdn.plivo.com/sdk/browser/audio/connect-tone.mp3",U.SILENT_TONE_URL="https://cdn.plivo.com/sdk/browser/audio/silent-audio.mp3",U.SELF_VIEW_ID="plivo_webrtc_selfview",U.REMOTE_VIEW_ID="plivo_webrtc_remoteview",U.RINGBACK_ELEMENT_ID="plivo_ringbacktone",U.RINGTONE_ELEMENT_ID="plivo_ringtone",U.CONNECT_TONE_ELEMENT_ID="plivo_connect_tone",U.SILENT_TONE_ELEMENT_ID="plivo_silent_tone",U.AUDIO_DEVICE_ABORT_ERROR_CODE=20,U.AUDIO_DEVICE_SECURITY_ERROR="SecurityError",U.DTMF_TONE_FLAG={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,"#":!0,"*":!0},U.S3BUCKET_API_URL="https://stats.plivo.com/v1/browser/bucketurl/",U.STATSSOCKET_URL="wss://insights.plivo.com/ws",U.STATS_API_URL="https://stats.plivo.com/v1/browser/validate/",U.SDKVERSION_API_URL="https://stats.plivo.com/v1/browser/websdkversion/",U.STATS_API_URL_ACCESS_TOKEN="https://stats.plivo.com/v1/browser/validate/jwt/",U.S3BUCKET_API_URL_JWT="https://stats.plivo.com/v1/browser/bucketurl/jwt/",U.LOG_COLLECTION="https://nimbus.plivo.com/collect/logs/",U.LOG_COLLECTION_JWT="https://nimbus.plivo.com/collect/logs/jwt/",U.STATS_SOURCE="BrowserSDK",U.STATS_VERSION="v1",U.GETSTATS_INTERVAL=5e3,U.AUDIO_INTERVAL=1e3,U.GETSTATS_HEARTBEATINTERVAL=1e5,U.STATSSOCKET_RECONNECT_SEC=1e4,U.STATS_ANALYSIS_WAIT_TIME=5e3,U.NETWORK_CHANGE_INTERVAL_IDLE_STATE=5e3,U.NETWORK_CHANGE_INTERVAL_ON_CALL_STATE=4e3,U.MESSAGE_CHECK_TIMEOUT_IDLE_STATE=2e3,U.MESSAGE_CHECK_TIMEOUT_ON_CALL_STATE=2e3,U.IP_ADDRESS_FETCH_RETRY_COUNT=10,U.WS_RECONNECT_RETRY_COUNT=2,U.WS_RECONNECT_RETRY_INTERVAL=15e3},"./lib/index.ts":function(Se,U,K){Object.defineProperty(U,"__esModule",{value:!0});const G=K("./lib/client.ts"),q=K("./lib/logger.ts");class x{constructor(S){typeof window._PlivoInstance=="object"?(q.Logger.info("window.Plivo object and its instance already exist"),this.client=window._PlivoInstance):this.client=new G.Client(S)}}Object.defineProperty(x,"client",{enumerable:!0}),U.default=x,Se.exports=x},"./lib/logger.ts":function(Se,U,K){var G=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(U,"__esModule",{value:!0}),U.Logger=void 0;const q=K("./lib/constants.ts"),x=G(K("./lib/storage.ts")),N=K("./lib/utils/device.ts"),S=[],p=typeof chrome<"u"&&chrome.storage?chrome.storage.local:window.localStorage,b=["INFO","DEBUG","WARN","ERROR","ALL","OFF"],_=["ERROR","WARN","INFO","DEBUG","ALL"];U.Logger=new class{constructor(t={}){this.info=(...m)=>this.logging("INFO",m),this.debug=(...m)=>this.logging("DEBUG",m),this.warn=(...m)=>this.logging("WARN",m),this.error=(...m)=>this.logging("ERROR",m),this.setLevel=m=>this._setLevel(m),this.level=()=>this.logMethod,this.consolelogs=()=>S,this.enableSipLogs=m=>this._enableSipLogs(m),this._setLevel=m=>{const f=m.toUpperCase();return b.indexOf(f)!==-1?(this.logMethod=f,["DEBUG","ALL"].indexOf(f)===-1&&(p.debug=""),`logLevel is now : ${this.logMethod}`):`only : ${b.toString()} are allowed in run time!`},this._enableSipLogs=m=>{["ALL","ALL-PLAIN"].indexOf(m)!==-1?(p.debug="JsSIP:*",window._PlivoUseColorLog=!0,m==="ALL-PLAIN"&&(window._PlivoUseColorLog=!1)):p.debug=""},this._appendToQueue=(m,f,o)=>{let s=!1;f.includes(q.LOGCAT.INIT)&&(s=!0),f.includes(q.LOGCAT.CALL)&&(s=!0),f.includes(q.LOGCAT.LOGIN)&&(s=!0),f.includes(q.LOGCAT.LOGOUT)&&(s=!0),f.includes(q.LOGCAT.CRASH)&&(s=!0),f.includes(q.LOGCAT.CALL_QUALITY)&&(s=!0),f.includes(q.LOGCAT.NETWORK_CHANGE)&&(s=!0),f.includes(q.LOGCAT.NIMBUS)&&(s=!0),f.includes(q.LOGCAT.WS)&&(s=!0),s&&x.default.getInstance().setData(m,f,o)},this.logging=(m,f)=>{var o,s;const n=m.toUpperCase(),i=f[0]||" ",a=f[1]||" ";if(b.indexOf(this.logMethod)!==-1||this.logMethod===n){const c=this.options.enableDate||!1,u=this.options.loggingName||"",g=new Date;let h="";c&&(h=`[${g.toISOString().substring(0,10)} ${g.toISOString().split("T")[1].split(".")[0]}.${g.getUTCMilliseconds()}]`);let C="";if(C=this.loggerUtil?`${h} ${u} : ${(o=this.loggerUtil)===null||o===void 0?void 0:o.getUserName()} ${(s=this.loggerUtil)===null||s===void 0?void 0:s.getSipCallID()} [${n}] `:`${h} ${u} :[${n}] `,S.length>=q.CONSOLE_LOGS_BUFFER_SIZE&&S.shift(),S.push(`${C+i+a} 
`),this._appendToQueue(C,i,a),_.indexOf(n)>_.indexOf(this.logMethod))return;switch(n){case"OFF":break;case"INFO":console.info(C,i,a);break;case"DEBUG":console.debug(C,i,a);break;case"WARN":console.warn(C,i,a);break;case"ERROR":console.error(C,i,a);break;default:console.log(C,i,a)}}},this._getLogsBatchData=(m,f)=>{let o=0;const s=[];let n=[];return m.forEach(i=>{o+=i.length,o>f&&(n.push("...continue"),s.push(n),n=[],o=0),n.push(i)}),n.length!==0&&(s.length>0&&n.push("...continue"),s.push(n)),s},this._sendBatchedLogsToServer=(m,f,o,s,n="",i="")=>new Promise((a,c)=>{const u=N.getSDKVersion(),g=N.getOS(),h={username:m.userName,logs:o[s],sdk_v:u.version,sdk_name:"BrowserSDK",user_agent:g,call_uuid:""};n&&n!==""&&(h.call_uuid=n),i&&i!==""&&(h.username=i),m.isAccessToken&&(h.jwt=m.accessToken);const C={method:"POST",headers:f,body:JSON.stringify(h),redirect:"follow"},E=m.isAccessToken?q.LOG_COLLECTION_JWT:q.LOG_COLLECTION;navigator.onLine?fetch(E.trimEnd(),C).then(y=>{y.ok?(s+=1,o.length>s?this._sendBatchedLogsToServer(m,f,o,s,h.call_uuid,h.username):x.default.getInstance().clear(),a("success")):(this.info(`${q.LOGCAT.NIMBUS} | Error while uploading logs to nimbus`),c(new Error("failure"))),y.text()}).then(y=>console.log(y)).catch(y=>{console.log("error",y),c(y)}):(this.info(`${q.LOGCAT.NIMBUS} | No internet while pushing logs to nimbus`),a("no internet while sending nimbus logs"))}),this.send=m=>{const f=new Headers;f.append("Content-Type","application/json");const o=x.default.getInstance().getData();if(!o)return void console.log("No data to send");if(!m.userName)return;const s=JSON.parse(o).split(`
`),n=this._getLogsBatchData(s,2e4);this._sendBatchedLogsToServer(m,f,n,0)},this.options=t,this.logMethod=this.options.logMethod||"INFO"}setLoggerUtil(t){this.loggerUtil=t}}({enableDate:!0,loggingName:"PlivoSDK",logMethod:"DEBUG"})},"./lib/managers/account.ts":function(Se,U,K){var G=this&&this.__createBinding||(Object.create?function(g,h,C,E){E===void 0&&(E=C),Object.defineProperty(g,E,{enumerable:!0,get:function(){return h[C]}})}:function(g,h,C,E){E===void 0&&(E=C),g[E]=h[C]}),q=this&&this.__setModuleDefault||(Object.create?function(g,h){Object.defineProperty(g,"default",{enumerable:!0,value:h})}:function(g,h){g.default=h}),x=this&&this.__importStar||function(g){if(g&&g.__esModule)return g;var h={};if(g!=null)for(var C in g)C!=="default"&&Object.prototype.hasOwnProperty.call(g,C)&&G(h,g,C);return q(h,g),h};Object.defineProperty(U,"__esModule",{value:!0});const N=x(K("./node_modules/plivo-jssip/dist/plivo-jssip.min.js")),S=x(K("./lib/constants.ts")),p=K("./lib/logger.ts"),b=x(K("./package.json")),_=K("./lib/stats/httpRequest.ts"),t=K("./lib/stats/setup.ts"),m=K("./lib/managers/incomingCall.ts"),f=K("./lib/managers/outgoingCall.ts"),o=K("./lib/managers/util.ts"),s=K("./lib/media/document.ts"),n=K("./lib/utils/networkManager.ts"),i=K("./lib/stats/ws.ts"),a=K("./lib/rnnoise/NoiseSuppression.ts"),c={log:p.Logger};let u=0;U.default=class{constructor(g,h,C,E,y){this.validate=w=>this._validate(w),this.setupUserAccount=()=>this._setupUserAccount(),this.create=()=>this._create(),this.createListeners=()=>this._createListeners(),this._validate=w=>typeof this.credentials.userName>"u"||typeof this.credentials.password>"u"||this.credentials.userName===null||this.credentials.password===null&&(this.credentials.userName.length<=0||this.credentials.password.length<=0)?(c.log.error(`${S.LOGCAT.LOGIN} | username and password cannot be null.`),this.cs.emit("onLoginFailed","Username and password must be filled out"),!1):this.cs._currentSession?(c.log.warn(`${S.LOGCAT.LOGIN} | Cannot login when there is an ongoing call ${this.cs._currentSession.callUUID}`),this.cs.emit("onLoginFailed","Cannot login when there is an ongoing call"),!1):navigator.onLine?!this.cs.phone||(this.cs.loginCallback=w,c.log.debug(`${S.LOGCAT.LOGIN} | deleting the existing phone instance`),this.cs.phone.stop(),this.cs.connectionInfo={state:n.ConnectionState.DISCONNECTED,reason:"Relogin"},this.cs.loginCallback):(c.log.warn(`${S.LOGCAT.LOGIN} | Cannot login when there is no internet`),this.cs.emit("onLoginFailed","Cannot login when there is no internet"),!1),this.sendReInvite=()=>{c.log.debug(`${S.LOGCAT.LOGIN} | reInvite initiated`),this.cs._currentSession&&this.cs.phone&&(this.cs._currentSession.session.replaceUA(this.cs.phone),setTimeout(()=>{this.reinviteCounter+=1,this.cs._currentSession.session._sendReinvite({eventHandlers:{succeeded:()=>{},failed:()=>{}},rtcOfferConstraints:{iceRestart:!0}})},0))},this.setupUAConfig=()=>{this.cs.plivoSocket=null;let w=S.WS_SERVERS;return this.cs.options.registrationDomainSocket&&(w=this.cs.options.registrationDomainSocket,w=typeof this.cs.options.registrationDomainSocket=="string"?this.cs.options.registrationDomainSocket.split(","):this.cs.options.registrationDomainSocket),u>=w.length&&(u=0),c.log.debug(`${S.LOGCAT.LOGIN} | Connecting WS with domain ${w[u]}`),this.cs.plivoSocket=new N.WebSocketInterface(w[u]),{sockets:[this.cs.plivoSocket],register_expires:this.registerRefreshTimer,uri:`${this.credentials.userName}@${S.DOMAIN}`,password:this.credentials.password,token:this.accessTokenCredentials.accessToken,googIPv6:!1,connection_recovery_max_interval:S.WS_RECOVERY_MAX_INTERVAL,connection_recovery_min_interval:S.WS_RECOVERY_MIN_INTERVAL,session_timers:!1,user_agent:`${b.name} ${b.version}`}},this._setupUserAccount=()=>{this._create()&&(c.log.info("Ready to login"),c.log.debug(`${S.LOGCAT.CALL} | Establishing user accounts and configuring the callback listener`),this._createListeners(),this.cs.phone&&(this.accessTokenCredentials.accessToken!=null&&this.cs.phone.registrator().setExtraHeaders([`X-Plivo-Jwt: ${this.accessTokenCredentials.accessToken}`]),n.socketReconnectionRetry(this.cs),this.cs.phone.start()))},this._create=()=>{const w=this.setupUAConfig();try{return this.cs.phone=new N.UA(w),!0}catch(O){return c.log.debug(`${S.LOGCAT.LOGIN} | Failed to create user agent ${O.message}`),this.cs.emit("onLoginFailed","Failed to create user agent"),!1}},this.tiggerNetworkChangeEvent=()=>{this.fetchIpCount+=1,_.fetchIPAddress(this.cs).then(w=>{typeof w=="string"?n.sendNetworkChangeEvent(this.cs,w):this.fetchIpCount!==S.IP_ADDRESS_FETCH_RETRY_COUNT?setTimeout(()=>{this.tiggerNetworkChangeEvent()},200*this.fetchIpCount):(c.log.warn(`${S.LOGCAT.NETWORK_CHANGE} | Could not retreive ipaddress`),this.fetchIpCount=0)})},this._createListeners=()=>{this.cs.phone&&(this.cs.phone.on("connected",this._onConnected),this.cs.phone.on("disconnected",this._onDisconnected),this.cs.phone.on("registered",this._onRegistered),this.cs.phone.on("unregistered",this._onUnRegistered),this.cs.phone.on("registrationFailed",this._onRegistrationFailed),this.cs.phone.on("newTransaction",this._onNewTransaction),this.cs.phone.on("newRTCSession",this._onNewRTCSession))},this._onConnected=w=>{c.log.debug("websocket connection established",w),c.log.info(`${S.LOGCAT.WS} | websocket connection established`),this.cs.connectionRetryInterval&&(c.log.info(`${S.LOGCAT.LOGIN} | websocket connected. Clearing the connection check interval`),clearInterval(this.cs.connectionRetryInterval),this.cs.connectionRetryInterval=null),this.isPlivoSocketConnected||(this.isPlivoSocketConnected=!0,this.cs.didFetchInitialNetworkInfo||(_.fetchIPAddress(this.cs).then(O=>{this.cs.currentNetworkInfo={networkType:navigator.connection?navigator.connection.effectiveType:"unknown",ip:typeof O=="string"?O:""}}).catch(()=>{this.cs.currentNetworkInfo={networkType:navigator.connection?navigator.connection.effectiveType:"unknown",ip:""}}),this.cs.didFetchInitialNetworkInfo=!0))},this._onDisconnected=w=>{var O,L;if(c.log.info(`${S.LOGCAT.LOGOUT} | WebSocket Connection Closed - Code: ${(O=w.code)!==null&&O!==void 0?O:"Unknown code"}, Reason: ${(L=w.reason)!==null&&L!==void 0?L:"No reason provided"}, Socket URL: ${w.socket.url}`),w.code&&(this.cs.connectionInfo={state:n.ConnectionState.DISCONNECTED,reason:w.code.toString()}),this.isPlivoSocketConnected&&(this.isPlivoSocketConnected=!1),this.cs.loginCallback&&(c.log.debug(`${S.LOGCAT.LOGOUT} |  Previous connection disconnected successfully, starting a new one.`),this.cs.loginCallback(),this.cs.loginCallback=null),!w.ignoreReconnection){c.log.debug(`${S.LOGCAT.LOGIN} | starting new transport`),u+=1,n.socketReconnectionRetry(this.cs);const I=this.setupUAConfig();this.cs.phone.createNewUATransport(I),this.cs.phone.start(),this.sendReInvite()}},this._onRegistered=w=>{if(this.cs._currentSession&&this.cs.isCallMuted&&(c.log.info(`${S.LOGCAT.CALL} | Speech Recognition restarted after network disruption`),this.cs._currentSession.startSpeechRecognition(this.cs)),this.cs.loginCallback&&(this.cs.loginCallback=null),this.cs.connectionInfo={state:n.ConnectionState.CONNECTED,reason:"registered"},c.log.debug(`${S.LOGCAT.WS} |  websocket connected: ${this.cs.connectionInfo.reason}`),this.cs.emit("onConnectionChange",Object.assign({},this.cs.connectionInfo)),this.cs.isAccessToken&&w.response.headers["X-Plivo-Jwt"]){const O=w.response.headers["X-Plivo-Jwt"][0].raw.split(";")[0].split("=")[1];this.cs.setExpiryTimeInEpoch(1e3*O)}if(!this.cs.isLoggedIn&&!this.cs.isLoginCalled){if(c.log.info(`${S.LOGCAT.NETWORK_CHANGE} | Network changed happened. re-starting the OPTIONS interval`),clearInterval(this.cs.networkChangeInterval),this.cs.networkChangeInterval=null,n.startPingPong({client:this.cs,networkChangeInterval:this.cs._currentSession?S.NETWORK_CHANGE_INTERVAL_ON_CALL_STATE:S.NETWORK_CHANGE_INTERVAL_IDLE_STATE,messageCheckTimeout:S.MESSAGE_CHECK_TIMEOUT_ON_CALL_STATE}),!this.cs._currentSession)return _.fetchIPAddress(this.cs).then(O=>{const L=n.getNetworkData(this.cs,O);c.log.info(`${S.LOGCAT.NETWORK_CHANGE} | Network changed from ${JSON.stringify(L.previousNetworkInfo).slice(1,-1)}
          to ${JSON.stringify(L.newNetworkInfo).slice(1,-1)} in idle state`),this.cs.currentNetworkInfo={networkType:L.newNetworkInfo.networkType,ip:typeof O=="string"?O:""}}),void(this.cs.isLoggedIn=!0);this.cs.statsSocket&&(this.cs.statsSocket.disconnect(),this.cs.statsSocket=null),this.cs.statsSocket=new i.StatsSocket,this.cs.statsSocket.connect(),this.cs.networkReconnectionTimestamp=new Date().getTime(),this.tiggerNetworkChangeEvent()}if(this.cs.isLoginCalled||(this.cs.isLoggedIn=!0),this.cs.userName=this.credentials.userName,this.cs.password=this.credentials.password,this.cs.isLoggedIn===!1&&this.cs.isLoginCalled===!0){let O;this.cs.isLoggedIn=!0,this.cs.isLoginCalled=!1,this.cs.noiseSuppresion=new a.NoiseSuppression(this.cs),this.cs.emit("onLogin"),c.log.info(`${S.LOGCAT.LOGIN} | User logged in successfully`),n.startPingPong({client:this.cs,networkChangeInterval:S.NETWORK_CHANGE_INTERVAL_IDLE_STATE,messageCheckTimeout:S.MESSAGE_CHECK_TIMEOUT_ON_CALL_STATE}),this.cs.isAccessToken?O=this.cs.accessToken:(this.cs.isAccessToken=!1,O=this.cs.password),_.validateCallStats(this.cs.userName,O,this.cs.isAccessToken).then(L=>{this.cs.callstatskey=L.data,this.cs.rtp_enabled=L.is_rtp_enabled}).catch(()=>{this.cs.callstatskey=null}),t.initCallStatsIO.call(this.cs),c.log.send(this.cs)}},this._onUnRegistered=()=>{this.cs.isLoggedIn=!1,this.cs.connectionInfo.state!==""&&this.cs.connectionInfo.state!==n.ConnectionState.CONNECTED||(this.cs.connectionInfo={state:n.ConnectionState.DISCONNECTED,reason:"unregistered"}),c.log.debug(`${S.LOGCAT.WS} |  websocket disconnected with reason : ${this.cs.connectionInfo.reason}`),this.cs.emit("onConnectionChange",Object.assign({},this.cs.connectionInfo)),this.cs.isLogoutCalled&&(c.log.debug(`${S.LOGCAT.LOGOUT} |  Plivo client unregistered`),this.cs.ringToneView&&!this.cs.ringToneView.paused&&s.stopAudio(S.RINGTONE_ELEMENT_ID),this.cs.ringBackToneView&&!this.cs.ringBackToneView.paused&&s.stopAudio(S.RINGBACK_ELEMENT_ID),this.cs.networkDisconnectedTimestamp=new Date().getTime(),this.cs.userName=null,this.cs.password=null,this.cs.emit("onLogout"),c.log.info(S.LOGCAT.LOGOUT," | Logout successful!"),this.cs.networkChangeInterval&&(clearInterval(this.cs.networkChangeInterval),this.cs.networkChangeInterval=null),this.cs.clearOnLogout(),this.message=null,this.cs.isLogoutCalled=!1,c.log.send(this.cs))},this._onRegistrationFailed=w=>{var O,L,I;if(this.cs.connectionInfo.state===n.ConnectionState.DISCONNECTED&&this.cs.isLoggedIn)return void c.log.debug(`${S.LOGCAT.LOGIN} | Registration failed when state: ${this.cs.connectionInfo.state} and login: ${this.cs.isLoggedIn} with error: `,w.cause,w.response);this.cs.isLoggedIn=!1,this.cs.userName=null,this.cs.password=null;const k=!((O=w==null?void 0:w.response)===null||O===void 0)&&O.headers["X-Plivo-Jwt-Error-Code"]?parseInt((I=(L=w==null?void 0:w.response)===null||L===void 0?void 0:L.headers["X-Plivo-Jwt-Error-Code"][0])===null||I===void 0?void 0:I.raw,10):401;if(w.cause&&k===401)c.log.info(`${S.LOGCAT.LOGIN} | Login failed with error: `,w.cause,w.response),this.cs.emit("onLoginFailed",w.cause);else{clearInterval(this.cs.networkChangeInterval),this.cs.networkChangeInterval=null;const P=this.cs.isAccessTokenGenerator?"RELOGIN_FAILED_INVALID_TOKEN":this.cs.getErrorStringByErrorCodes(k);c.log.info(`${S.LOGCAT.LOGIN} | Login failed with error: ${P}`),this.cs.emit("onLoginFailed",P)}},this._onNewTransaction=w=>{var O;if(w.transaction.type==="ist"){const L=(O=w.transaction.request.getHeader("Call-ID"))!==null&&O!==void 0?O:"";c.log.info(`${S.LOGCAT.LOGIN} | new Transaction created, incoming call received callUUID: ${L}`),this.cs.loggerUtil.setSipCallID(L),c.log.info("<----- INCOMING ----->");const I=w.transaction.request.getHeader("X-Calluuid")||null;this.cs.incomingCallsInitiationTime.set(I,o.getCurrentTime()),c.log.debug("call initiation time, invite received from server")}},this._onNewRTCSession=w=>{if(w.originator==="local"){const O=w.request.call_id;this.cs.loggerUtil.setSipCallID(O)}c.log.debug(`${S.LOGCAT.CALL} | new rtc session created, originator:${w.originator}`),t.createStatsSocket.call(this.cs),this._validateRTCSession(w)&&(w.originator==="remote"?(o.addMidAttribute.call(this.cs,w),m.createIncomingSession(this.cs,w)):f.createOutgoingSession(w),this.cs.timeTakenForStats.mediaSetup={},this.cs.timeTakenForStats.mediaSetup.init=new Date().getTime())},this._validateRTCSession=w=>{var O,L;if(this.cs._currentSession&&this.cs._currentSession.session.connection&&this.cs._currentSession.session.connection.signalingState==="closed"&&(c.log.warn(`${S.LOGCAT.CALL} | Previous call did not end properly`),this.cs._currentSession=null,this.cs.callSession=null,this.cs.callUUID=null,this.cs.callDirection=null),this.cs.incomingInvites.size&&(c.log.debug(`${S.LOGCAT.CALL} | Remove the incoming call from map if it is failed but not removed properly, invite-size: ${(L=(O=this.cs.incomingInvites)===null||O===void 0?void 0:O.size)!==null&&L!==void 0?L:"none"}`),this.cs.incomingInvites.forEach(I=>{I.session.isEnded()&&this.cs.incomingInvites.delete(I.callUUID)})),(this.cs._currentSession||this.cs.incomingInvites.size)&&!this.cs.options.allowMultipleIncomingCalls||this.cs.incomingInvites.size>=S.NUMBER_OF_SIMULTANEOUS_INCOMING_CALLS_ALLOWED){c.log.debug(`${S.LOGCAT.CALL} | Already on call, Sending busy call due to existing call, invite-size: ${this.cs.incomingInvites.size} }`),this.cs.loggerUtil.setSipCallID("");const I={status_code:486,reason_phrase:"Busy Here"};return w.session.terminate(I),!1}return!0},this.cs=g,this.credentials={userName:h,password:C},this.accessTokenCredentials={accessToken:E},this.message=null,this.registerRefreshTimer=y,this.reinviteCounter=0,this.isPlivoSocketConnected=!1,this.fetchIpCount=0}}},"./lib/managers/callSession.ts":function(Se,U,K){var G=this&&this.__createBinding||(Object.create?function(n,i,a,c){c===void 0&&(c=a),Object.defineProperty(n,c,{enumerable:!0,get:function(){return i[a]}})}:function(n,i,a,c){c===void 0&&(c=a),n[c]=i[a]}),q=this&&this.__setModuleDefault||(Object.create?function(n,i){Object.defineProperty(n,"default",{enumerable:!0,value:i})}:function(n,i){n.default=i}),x=this&&this.__importStar||function(n){if(n&&n.__esModule)return n;var i={};if(n!=null)for(var a in n)a!=="default"&&Object.prototype.hasOwnProperty.call(n,a)&&G(i,n,a);return q(i,n),i};Object.defineProperty(U,"__esModule",{value:!0}),U.CallSession=void 0;const N=K("./lib/stats/nonRTPStats.ts"),S=K("./lib/stats/mediaMetrics.ts"),p=K("./lib/media/audioDevice.ts"),b=K("./lib/utils/oneWayAudio.ts"),_=x(K("./lib/constants.ts")),t=K("./lib/managers/util.ts"),m=K("./lib/logger.ts"),f=K("./lib/media/document.ts"),o=K("./lib/constants.ts"),s={log:m.Logger,emitMetrics:S.emitMetrics};U.CallSession=class{constructor(n){this.candidateList=new Map,this.candidatePairsList=new Map,this.setCallUUID=i=>{this.callUUID=i},this.setState=i=>{this.state=i},this.setSpeechState=i=>{this.speech_state=i},this.addConnectionStage=i=>{this.connectionStages.push(i)},this.getConnectionStages=()=>this.connectionStages,this.setCallStats=i=>{this.stats=i},this.clearCallStats=()=>this._clearCallStats(),this.updateSignallingInfo=i=>{this.signallingInfo=Object.assign(Object.assign({},this.signallingInfo),i)},this.updateMediaConnectionInfo=i=>{this.mediaConnectionInfo=Object.assign(Object.assign({},this.mediaConnectionInfo),i)},this.getSignallingInfo=()=>Object.assign(Object.assign({},this.signallingInfo),{post_dial_delay:this.postDialDelayEndTime?this.postDialDelayEndTime:0-this.signallingInfo.call_initiation_time}),this.stopSpeechRecognition=i=>{var a,c,u;i.speechRecognition&&((a=i._currentSession)===null||a===void 0?void 0:a.speech_state)===((c=i._currentSession)===null||c===void 0?void 0:c.SPEECH_STATE.RUNNING)&&((u=i._currentSession)===null||u===void 0||u.setSpeechState(i._currentSession.SPEECH_STATE.STOPPING),i.speechRecognition.stop())},this.startSpeechRecognition=i=>{var a,c,u,g;if("webkitSpeechRecognition"in window){if(((a=i._currentSession)===null||a===void 0?void 0:a.state)===((c=i._currentSession)===null||c===void 0?void 0:c.STATE.ANSWERED)&&((u=i._currentSession)===null||u===void 0?void 0:u.speech_state)===((g=i._currentSession)===null||g===void 0?void 0:g.SPEECH_STATE.STOPPED))try{s.log.info(`${o.LOGCAT.CALL} | Recognizing speech Starting`),p.speechListeners.call(i)}catch(h){s.log.error(`${o.LOGCAT.CALL} | Error in starting recognizing speech, will be restarted :: ${h.message}`)}}else s.log.error(`${o.LOGCAT.CALL} | Speech Recognition not available in browser`)},this.getMediaConnectionInfo=()=>Object.assign({},this.mediaConnectionInfo),this.setPostDialDelayEndTime=i=>{this.postDialDelayEndTime||(this.postDialDelayEndTime=i)},this.getCallInfo=(i,a="none",c="none",u=-1)=>({callUUID:this.callUUID,direction:this.direction,src:this.src,dest:this.dest,state:this.state,extraHeaders:this.extraHeaders,stirShakenState:this.stirShakenState,originator:i,protocol:a,reason:c,code:u}),this.onAccepted=i=>this._onAccepted(i),this.onRinging=i=>this._onRinging(i),this.onConfirmed=i=>this._onConfirmed(i),this.onIceCandidate=(i,a)=>this._onIceCandidate(i,a),this.onIceTimeout=(i,a)=>this._onIceTimeout(i,a),this.onFailed=(i,a)=>this._onFailed(i,a),this.onEnded=(i,a)=>this._onEnded(i,a),this.onGetUserMediaFailed=(i,a)=>this._onGetUserMediaFailed(i,a),this.handlePeerConnectionFailures=(i,a,c,u)=>this._handlePeerConnectionFailures(i,a,c,u),this._clearCallStats=()=>{this.stats&&(s.log.debug(`${_.LOGCAT.CALL} | clearing out stats`),clearInterval(this.stats.statsTimer),clearInterval(this.stats.audioTimer),this.stats.stop(),this.stats=null)},this._onAccepted=i=>{t.addCloseProtectionListeners.call(i),p.getAudioDevicesInfo.call(i).then(a=>{N.sendCallAnsweredEvent.call(i,a,!0)}).catch(()=>{N.sendCallAnsweredEvent.call(i,null,!0)}),this.updateSignallingInfo({answer_time:t.getCurrentTime()}),t.callStart.call(i),p.startVolumeDataStreaming(i)},this._onRinging=i=>{const a=this.getSignallingInfo(),c=this.getMediaConnectionInfo();p.getAudioDevicesInfo.call(i).then(u=>{N.sendCallRingingEvent.call(i,u,a,c,this)}).catch(()=>{N.sendCallRingingEvent.call(i,null,a,c,this)})},this._onConfirmed=i=>{this.addConnectionStage(`confirmed@${t.getCurrentTime()}`),this.setState(this.STATE.ANSWERED),this.updateSignallingInfo({call_confirmed_time:t.getCurrentTime()}),t.setEncodingParameters.call(i),i.options.disableRtpTimeOut&&(this.session.connection.disableRtpTimeOut=!0),t.statsCollector.call(i,this),i.ringToneView&&!i.ringToneView.paused&&f.stopAudio(_.RINGTONE_ELEMENT_ID),i.ringBackToneView&&!i.ringBackToneView.paused&&f.stopAudio(_.RINGBACK_ELEMENT_ID),i.emit("onCallAnswered",this.getCallInfo("local")),s.log.debug("Post-Answer detecting OWA"),setTimeout(()=>{b.owaNotification.bind(i)},3e3,this.session.connection,i),i.isCallMuted&&this.startSpeechRecognition(i)},this._onIceCandidate=(i,a)=>{const{candidate:c}=a;c&&c.candidate.search("srflx")!==-1?a.ready():this.gotInitalIce||(this.gotInitalIce=!0,setTimeout(()=>{if(!this.session)return;const{connection:u}=this.session;u&&u.iceGatheringState!=="complete"&&(a.ready(),s.log.debug(`${_.LOGCAT.CALL} | ice gathering taking more than ${_.ICE_GATHERING_TIMEOUT/1e3} sec ${u.iceGatheringState}`),s.emitMetrics.call(i,"network","warning","ice_timeout",_.ICE_GATHERING_TIMEOUT,!0,"Possible NAT/Firewall issue","None"))},_.ICE_GATHERING_TIMEOUT))},this._onIceTimeout=(i,a)=>{s.log.debug(`${_.LOGCAT.CALL} | ice gathering timed out`),s.emitMetrics.call(i,"network","warning","ice_timeout",a,!0,"Possible NAT/Firewall issue","None"),N.onIceFailure.call(i,this,new Error("ice_timeout"))},this._onFailed=(i,a)=>{t.logCandidatePairs(i._currentSession),this.addConnectionStage(`failed@${t.getCurrentTime()}`),this.updateSignallingInfo({hangup_time:t.getCurrentTime(),hangup_party:a.originator,hangup_reason:a.cause}),t.handleMediaError(a,this),t.hangupClearance.call(i,this),p.stopVolumeDataStreaming(),s.log.send(i),i.loggerUtil.setSipCallID("")},this._onEnded=(i,a)=>{if(t.logCandidatePairs(i._currentSession),this.addConnectionStage(`ended@${t.getCurrentTime()}`),this.setState(this.STATE.ENDED),this.updateSignallingInfo({hangup_time:t.getCurrentTime(),hangup_party:a.originator,hangup_reason:a.cause}),i.callStats&&i.callStats.sendFabricEvent(this.session.connection,i.callStats.fabricEvent.fabricTerminated,this.callUUID),i._currentSession){const c=t.extractReason(a);s.log.info(`${_.LOGCAT.CALL} | onCallTerminated - ${a.cause}`),i.emit("onCallTerminated",{originator:a.originator,reason:a.cause},i._currentSession.getCallInfo(a.originator,c.protocol,c.text,c.cause)),t.hangupClearance.call(i,i._currentSession),p.stopVolumeDataStreaming(),this.stopSpeechRecognition(i)}s.log.send(i),i.loggerUtil.setSipCallID("")},this._onGetUserMediaFailed=(i,a)=>{s.log.error(`${_.LOGCAT.CALL} | UserMedia:failed ${a.message}`),i.userName&&i.callStats&&(a.message="getusermediafailed",i.callStats.reportError(null,i.userName,i.callStats.webRTCFunctions.getUserMedia,a)),i.emit("onMediaPermission",{status:"failure",error:a.message}),N.onMediaFailure.call(i,this,a)},this._handlePeerConnectionFailures=(i,a,c,u)=>{i.userName&&i.callStats&&c&&(u.message=`peerconnection:${a}`,i.callStats.reportError(null,i.userName,c,u)),N.onSDPfailure.call(i,this,u)},this.STATE={INITIALIZED:"initialized",RINGING:"ringing",ANSWERED:"answered",REJECTED:"rejected",IGNORED:"ignored",CANCELED:"canceled",FAILED:"failed",ENDED:"ended"},this.SPEECH_STATE={STOPPED:"stopped",STARTING:"starting",RUNNING:"running",STOPPING:"stopping",STOPPED_AFTER_DETECTION:"stopped_after_detecting",STOPPED_DUE_TO_NETWORK_ERROR:"stopped_due_to_network_error"},this.callUUID=n.callUUID?n.callUUID:null,this.sipCallID=n.sipCallID,this.stirShakenState=n.stirShakenState,this.direction=n.direction,this.src=n.src,this.dest=n.dest,this.serverFeatureFlags=[],this.state=this.STATE.INITIALIZED,this.speech_state=this.SPEECH_STATE.STOPPED,this.extraHeaders=n.extraHeaders,this.session=n.session,this.connectionStages=[],this.gotInitalIce=!1,this.isCallTerminatedDuringRinging=!1,this.stats=null,this.signallingInfo={},this.mediaConnectionInfo={},n.call_initiation_time&&(this.signallingInfo.call_initiation_time=n.call_initiation_time),this.postDialDelayEndTime=null}}},"./lib/managers/incomingCall.ts":function(Se,U,K){var G=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(U,"__esModule",{value:!0}),U.handleIgnoreState=U.answerIncomingCall=U.checkIncomingCallAction=U.getCurrentIncomingCall=U.createIncomingSession=U.createIncomingCallListeners=void 0;const q=K("./node_modules/plivo-jssip/dist/plivo-jssip.min.js"),x=K("./lib/constants.ts"),N=K("./lib/managers/callSession.ts"),S=K("./lib/utils/headers.ts"),p=K("./lib/media/document.ts"),b=G(K("./lib/utils/codecPreference.ts")),_=K("./lib/logger.ts"),t=K("./lib/managers/util.ts"),m=K("./lib/utils/networkManager.ts"),f={log:_.Logger};let o,s=!1,n=!1;document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"?(n=!1,s&&t.mobileBrowserCheck()&&(f.log.debug(`${x.LOGCAT.CALL} | Move to foreground. playing audio`),p.playAudio(x.RINGTONE_ELEMENT_ID))):(n=!0,s&&t.mobileBrowserCheck()&&(f.log.debug(`${x.LOGCAT.CALL} | Move to background. stopping audio`),p.stopAudio(x.RINGTONE_ELEMENT_ID)))});const i=h=>{f.log.debug(`${x.LOGCAT.CALL} | incoming ${h.originator} sdp prepared`),s=!1;try{h.sdp=b.default(o.options.codecs,h.sdp)}catch(C){f.log.debug("checkCodecPreference err - ",C)}h.sdp=h.sdp.replace("useinbandfec=1",`useinbandfec=1;maxaveragebitrate=${o.options.maxAverageBitrate}`),h.sdp=h.sdp.replace("0\r\r","0"),h.sdp=t.replaceMdnsIceCandidates(h.sdp),f.log.debug("Incoming call SDP processing done")},a=h=>C=>{s=!1,f.log.debug(`${x.LOGCAT.CALL} | Incoming call failed: ${C.cause}`),((E,y)=>{f.log.info(`${x.LOGCAT.CALL} | Incoming call - ${E.cause}`);let w={protocol:"none",cause:-1,text:"none"};E.originator==="local"&&y.isCallTerminatedDuringRinging?(w={protocol:"none",cause:x.LOCAL_ERROR_CODES["Network switch while ringing"],text:"Network switch while ringing"},y.isCallTerminatedDuringRinging=!1):w=t.extractReason(E),E.cause===q.C.causes.CANCELED?(y.setState(y.STATE.CANCELED),f.log.info(`${x.LOGCAT.CALL} | Incoming call Canceled - ${w.text===""||w.text==="none"?E.cause:w.text}}`),o.emit("onIncomingCallCanceled",y.getCallInfo(E.originator,w.protocol,w.text,w.cause))):(f.log.info(`${x.LOGCAT.CALL} | Incoming call failed - ${w.text===""||w.text==="none"?E.cause:w.text}`),E.cause==="Rejected"?y.setState(y.STATE.REJECTED):y.setState(y.STATE.FAILED),o.emit("onCallFailed",E.cause,y.getCallInfo(E.originator,w.protocol,w.text,w.cause)))})(C,h),h.onFailed(o,C),o.incomingInvites.size<2&&o.ringToneView&&!o.ringToneView.paused&&p.stopAudio(x.RINGTONE_ELEMENT_ID)},c=h=>C=>{s=!1,f.log.info(`${x.LOGCAT.CALL} | Incoming call - ${C.cause} - ${C.originator}`),f.log.debug(`Incoming call ended - ${h.callUUID}`),f.log.info(`${x.LOGCAT.CALL} | Incoming call Hangup`),h.onEnded(o,C),m.resetPingPong({client:o,messageCheckTimeout:x.MESSAGE_CHECK_TIMEOUT_IDLE_STATE,networkChangeInterval:x.NETWORK_CHANGE_INTERVAL_IDLE_STATE})},u=h=>{if(o._currentSession&&h.originator==="remote"){f.log.info(`${x.LOGCAT.CALL} | emitting onDtmfReceived with digit: `,h.dtmf.tone);const C={tone:h.dtmf.tone,duration:h.dtmf.duration};o.emit("onDtmfReceived",C)}},g=h=>{f.log.info(`${x.LOGCAT.CALL} | Incoming Call | ${h.originator} INFO packet with body : ${h.info.body}`),o._currentSession&&h.info.body==="remote-party-ringing"&&o.emit("onCallConnected",o._currentSession.getCallInfo(h.originator)),h.info.body==="no-remote-audio"&&o.emit("remoteAudioStatus",!1),h.info.body==="remote-audio"&&o.emit("remoteAudioStatus",!0)};U.createIncomingCallListeners=h=>{h.session.on("progress",(C=>()=>{C.onRinging(o),f.log.debug(`${x.LOGCAT.CALL} | Incoming call ringing`),C.addConnectionStage(`progress-180@${t.getCurrentTime()}`),C.updateSignallingInfo({call_progress_time:t.getCurrentTime()}),C.setState(C.STATE.RINGING),C.setPostDialDelayEndTime(t.getCurrentTime()),f.log.debug(`${x.LOGCAT.CALL} | call ringing with 180 code, incoming call in progress`);const E=C.session.remote_identity.uri.toString(),y=C.session.remote_identity.display_name;f.log.debug(`${x.LOGCAT.CALL} | ringtone enabled : ${o.ringToneFlag}`),f.log.debug(`${x.LOGCAT.CALL} | no session is active currently: ${!o._currentSession}`),o.ringToneFlag===!1||o._currentSession||(t.mobileBrowserCheck()?n||(f.log.debug(`${x.LOGCAT.CALL} | Not in background. Playing ring tone`),p.playAudio(x.RINGTONE_ELEMENT_ID)):(f.log.debug(`${x.LOGCAT.CALL} | Not a mobile browser. Playing ring tone`),p.playAudio(x.RINGTONE_ELEMENT_ID)),f.log.debug(`${x.LOGCAT.CALL} | incoming call ringtone started`),s=!0);const w=`${E.substring(4,E.indexOf("@"))}@${x.DOMAIN}`,O=()=>{f.log.debug(`${x.LOGCAT.CALL} | Emitting onIncomingCall`),o.emit("onIncomingCall",w,C.extraHeaders,C.getCallInfo("local"),y)};o.noiseSuppresion.setLocalMediaStream().then(()=>{O()}).catch(()=>{O()}),t.addCloseProtectionListeners.call(o),f.log.debug(`${x.LOGCAT.CALL} | Incoming Call Extra Headers : ${JSON.stringify(C.extraHeaders)}`)})(h)),h.session.on("sdp",i),h.session.on("accepted",(C=>()=>{s=!1,f.log.info(`${x.LOGCAT.CALL} | Incoming call Answered`),m.resetPingPong({client:o,messageCheckTimeout:x.MESSAGE_CHECK_TIMEOUT_ON_CALL_STATE,networkChangeInterval:x.NETWORK_CHANGE_INTERVAL_ON_CALL_STATE}),C.onAccepted(o);const E=C.session.connection||null;E&&(E.oniceconnectionstatechange=()=>t.onIceConnectionChange.call(o,E,C),E.onconnectionstatechange=()=>{f.log.debug(`${x.LOGCAT.CALL} | onconnectionstatechange is ${E.connectionState}`),E.connectionState==="connected"&&(o.timeTakenForStats.mediaSetup.end=new Date().getTime())})})(h)),h.session.on("confirmed",(C=>()=>{f.log.debug(`Incoming call confirmed - ${C.callUUID}`),s=!1,C.onConfirmed(o);const E=C.session.connection?C.session.connection.getRemoteStreams()[0]:null;E||f.log.error(`${x.LOGCAT.CALL} | Incoming call: remote stream does not exist`),o.remoteView.srcObject=E,t.addCallstatsIOFabric.call(o,C,C.src,C.callUUID)})(h)),h.session.on("icetimeout",C=>h.onIceTimeout(o,C)),h.session.on("failed",a(h)),h.session.on("ended",c(h)),h.session.on("noCall",c(h)),h.session.on("newDTMF",u),h.session.on("newInfo",g),h.session.on("icecandidate",C=>h.onIceCandidate(o,C)),h.session.on("getusermediafailed",C=>h.onGetUserMediaFailed(o,C)),h.session.on("peerconnection:createofferfailed",C=>h.handlePeerConnectionFailures(o,"createofferfailed",o.callStats?o.callStats.webRTCFunctions.createOffer:null,C)),h.session.on("peerconnection:createanswerfailed",C=>h.handlePeerConnectionFailures(o,"createanswerfailed",o.callStats?o.callStats.webRTCFunctions.createAnswer:null,C)),h.session.on("peerconnection:setlocaldescriptionfailed",C=>h.handlePeerConnectionFailures(o,"setlocaldescriptionfailed",o.callStats?o.callStats.webRTCFunctions.setLocalDescription:null,C)),h.session.on("peerconnection:setremotedescriptionfailed",C=>h.handlePeerConnectionFailures(o,"setremotedescriptionfailed",o.callStats?o.callStats.webRTCFunctions.setRemoteDescription:null,C))},U.createIncomingSession=(h,C)=>{o=h;const E=C.request.getHeader("X-Calluuid"),y=C.request.getHeader("X-Plivo-Stir-Verification"),w=C.request.getHeader("Call-ID"),O=C.request.getHeader("From").match(/:(.*)@/i),L=O!==null?O[1]:"";o.loggerUtil.setSipCallID(w);const I=S.receiveExtraHeader(C.request,C.request.headers),k={call_uuid:E,sip_call_id:w};f.log.info(`${x.LOGCAT.CALL} | Incoming call initiated for ${o.userName} from ${L} with header:- `,JSON.stringify(k));const P=o.incomingCallsInitiationTime.get(E);P&&o.incomingCallsInitiationTime.delete(E);const F=new N.CallSession({callUUID:E,sipCallID:w,direction:"incoming",src:L,dest:o.userName,session:C.session,extraHeaders:I,call_initiation_time:P,client:o,stirShakenState:y});var H;C.request.getHeader("X-FeatureFlags")?(F.serverFeatureFlags=C.request.getHeader("X-FeatureFlags").split(","),F.serverFeatureFlags.forEach(D=>D.trim()),o.phone&&(F.serverFeatureFlags.indexOf("ft_info")!==-1?o.phone.sendReInviteOnTransportConnect=!1:o.phone.sendReInviteOnTransportConnect=!0)):o.phone&&(o.phone.sendReInviteOnTransportConnect=!0),(H=F).callUUID&&(o.incomingInvites.set(H.callUUID,H),o.lastIncomingCall=H,o.options.allowMultipleIncomingCalls||(o.callSession=H.session,o.callUUID=H.callUUID,o.direction=H.direction),H.addConnectionStage(`I-invite@${t.getCurrentTime()}`),H.updateSignallingInfo({invite_time:t.getCurrentTime()}),f.log.debug(`callSession - ${H.callUUID}`)),U.createIncomingCallListeners(F)},U.getCurrentIncomingCall=(h,C)=>{let E=null;if(h&&C.incomingInvites.has(h))E=C.incomingInvites.get(h);else if(C.lastIncomingCall&&(E=C.lastIncomingCall,h&&C.options.allowMultipleIncomingCalls))return f.log.error(`${x.LOGCAT.CALL} | No incomingCall with callUUID - ${h}`),null;return E},U.checkIncomingCallAction=h=>!(o.options.allowMultipleIncomingCalls&&h&&typeof h!="string"||typeof h=="string"&&o.options.allowMultipleIncomingCalls&&["reject","ignore","letring"].indexOf(h.toLowerCase())===-1)||(f.log.error(`${x.LOGCAT.CALL} | Invalid actionOnOtherIncomingCalls value`),!1),U.answerIncomingCall=function(h,C){return new Promise(()=>{var E;((y,w)=>{o._currentSession&&(f.log.debug(`${x.LOGCAT.CALL} | hanging up current session before answer`),o.hangup()),o.incomingInvites.forEach(O=>{O!==y&&(typeof w=="string"&&w.toLowerCase()==="ignore"?(s=!1,o.ignore(O.callUUID)):typeof w=="string"&&w.toLowerCase()==="reject"?(s=!1,o.reject(O.callUUID)):typeof w=="string"&&w.toLowerCase()==="letring"?f.log.info("Other incoming calls will keep ringing"):w||o.reject(O.callUUID))})})(h,C),o.owaLastDetect.isOneWay=!1;try{o._currentSession=h,o.incomingInvites.delete(h.callUUID),h===o.lastIncomingCall&&(o.lastIncomingCall=null,o.incomingInvites.size&&(o.lastIncomingCall=o.incomingInvites.values().next().value)),o.loggerUtil.setSipCallID((E=o._currentSession.sipCallID)!==null&&E!==void 0?E:""),o.callSession=o._currentSession.session,o.callUUID=o._currentSession.callUUID,f.log.debug(`${x.LOGCAT.CALL} | CallUUID is ${o.callUUID}`),o.callDirection=o._currentSession.direction,new Promise(y=>{var w;const O={};if(O.pcConfig={iceServers:[{urls:x.STUN_SERVERS}]},o.permOnClick){const L=o.options.audioConstraints||!0;O.mediaConstraints={audio:L,video:!1}}o.noiseSuppresion.startNoiseSuppression((w=window.localStream)!==null&&w!==void 0?w:null).then(L=>{O.mediaStream=L??window.localStream,O.sessionTimersExpires=x.SESSION_TIMERS_EXPIRES,y(O)})}).then(y=>{h.session.answer(y)})}catch(y){f.log.error(`${x.LOGCAT.CALL} | error in answering incoming call : `,y.message),h.setState(h.STATE.CANCELED),f.log.info(`${x.LOGCAT.CALL} | Incoming call Canceled - ${y.message}`),o.emit("onIncomingCallCanceled",h.getCallInfo("local","none","call answer fail",x.LOCAL_ERROR_CODES["call answer fail"]))}o.ringToneView&&!o.ringToneView.paused&&p.stopAudio(x.RINGTONE_ELEMENT_ID)})},U.handleIgnoreState=h=>{h.setState(h.STATE.IGNORED),h.updateSignallingInfo({hangup_time:t.getCurrentTime(),hangup_party:"local",hangup_reason:"Ignored",signalling_errors:{timestamp:t.getCurrentTime(),error_code:"Ignored",error_description:"Ignored"}}),t.hangupClearance.call(o,h)}},"./lib/managers/outgoingCall.ts":function(Se,U,K){var G=this&&this.__importDefault||function(k){return k&&k.__esModule?k:{default:k}};Object.defineProperty(U,"__esModule",{value:!0}),U.createOutgoingSession=U.makeCall=void 0;const q=K("./lib/constants.ts"),x=K("./lib/managers/callSession.ts"),N=K("./lib/utils/headers.ts"),S=K("./lib/media/document.ts"),p=G(K("./lib/utils/codecPreference.ts")),b=K("./lib/stats/nonRTPStats.ts"),_=K("./lib/stats/mediaMetrics.ts"),t=K("./lib/logger.ts"),m=K("./lib/managers/util.ts"),f=K("./lib/utils/networkManager.ts"),o={log:t.Logger,emitMetrics:_.emitMetrics,sendEvents:b.sendEvents,AppError:b.AppError};let s,n,i,a;const c=k=>{o.log.debug("Outgoing remote Audio stream received"),s._currentSession&&(s._currentSession.addConnectionStage(`addStream-success@${m.getCurrentTime()}`),s._currentSession.updateMediaConnectionInfo({stream_success:m.getCurrentTime()}),k.streams[0]?(setTimeout(()=>{s.remoteView.srcObject=k.streams[0]},100),s.ringToneBackFlag&&!m.isSessionConfirmed(s._currentSession.session)?setTimeout(()=>{s._currentSession&&!m.isSessionConfirmed(s._currentSession.session)&&(o.log.debug("playAudio - session confirmed"),s.remoteView.pause())},100):s.ringToneBackFlag||m.isSessionConfirmed(s._currentSession.session)||o.log.debug("playAudio - MediaServer")):(o.log.error(`${q.LOGCAT.CALL} | Outgoing call add stream failure`),s._currentSession.addConnectionStage(`addStream-failure@${m.getCurrentTime()}`),s._currentSession.updateMediaConnectionInfo({stream_failure:m.getCurrentTime()})))},u=()=>{o.log.debug(`${q.LOGCAT.CALL} | Outgoing call sending`),s._currentSession&&(s._currentSession.addConnectionStage(`O-invite@${m.getCurrentTime()}`),s._currentSession.updateSignallingInfo({call_initiation_time:m.getCurrentTime()})),o.log.debug("call initiation time, sending invite");const k=s._currentSession&&s._currentSession.session.connection||null;s.connectToneFlag!==!1&&S.playAudio(q.CONNECT_TONE_ELEMENT_ID),k&&(k.ontrack=c,k.oniceconnectionstatechange=()=>{s._currentSession&&m.onIceConnectionChange.call(s,k,s._currentSession)},k.onconnectionstatechange=()=>{o.log.debug(`${q.LOGCAT.CALL} | onconnectionstatechange is ${k.connectionState}`),k.connectionState==="connected"&&(s.timeTakenForStats.mediaSetup.end=new Date().getTime())})},g=k=>{o.log.debug(`${q.LOGCAT.CALL} | ${k.originator} SDP found`);try{k.sdp=p.default(s.options.codecs,k.sdp),k.sdp=k.sdp.replace("useinbandfec=1",`useinbandfec=1;maxaveragebitrate=${s.options.maxAverageBitrate}`),k.sdp=m.replaceMdnsIceCandidates(k.sdp)}catch(P){o.log.debug(`${q.LOGCAT.CALL} checkCodecPreference err - `,P)}},h=k=>{if(s.timeTakenForStats.pdd.end=new Date().getTime(),s._currentSession&&k.response){s._currentSession.onRinging(s);const P=k.response.getHeader("X-Calluuid");s._currentSession.setCallUUID(P),s._currentSession.setState(s._currentSession.STATE.RINGING),s.callUUID=P,o.log.info(`${q.LOGCAT.CALL} | Outgoing call Ringing, CallUUID: ${s.callUUID}`),s.emit("onCallRemoteRinging",s._currentSession.getCallInfo("local")),m.addCloseProtectionListeners.call(s),m.addMidAttribute.call(s,k),m.addCallstatsIOFabric.call(s,s._currentSession,k.response.headers.To[0].parsed.uri.user,s._currentSession.callUUID),s._currentSession.addConnectionStage(`progress-${k.response.status_code}@${m.getCurrentTime()}`),o.log.debug(`progress-${k.response.status_code}@${m.getCurrentTime()}`),s._currentSession.updateSignallingInfo({ring_start_time:m.getCurrentTime()}),s._currentSession.setPostDialDelayEndTime(m.getCurrentTime()),o.log.debug("Outgoing call progress",k.response.status_code),(F=>{o.log.debug(`${q.LOGCAT.CALL} | ringback tone enabled : ${s.ringToneBackFlag} audioPaused: ${s.connectToneView.paused}`),s.connectToneView.paused||S.stopAudio(q.CONNECT_TONE_ELEMENT_ID),s.ringToneBackFlag&&S.playAudio(q.RINGBACK_ELEMENT_ID),F.response&&F.response.status_code===183&&F.response.body&&s._currentSession&&(o.log.debug(`callSession - ${s._currentSession.callUUID}`),s._currentSession.setPostDialDelayEndTime(m.getCurrentTime()),s.ringToneBackFlag||s.ringBackToneView&&!s.ringBackToneView.paused&&S.stopAudio(q.RINGBACK_ELEMENT_ID))})(k),s.shouldMuteCall&&s.mute()}else o.log.debug(`${q.LOGCAT.CALL} | inavlid response received, while call in progress`)},C=k=>{if(k.response&&s._currentSession){const P=k.response.getHeader("X-Calluuid");s._currentSession.setCallUUID(P),o.log.info(`${q.LOGCAT.CALL} | Outgoing call Answered`),k.response.getHeader("X-FeatureFlags")?(s._currentSession.serverFeatureFlags=k.response.getHeader("X-FeatureFlags").split(","),s._currentSession.serverFeatureFlags.forEach(F=>F.trim()),s.phone&&(s._currentSession.serverFeatureFlags.indexOf("ft_info")!==-1?s.phone.sendReInviteOnTransportConnect=!1:s.phone.sendReInviteOnTransportConnect=!0)):s.phone&&(s.phone.sendReInviteOnTransportConnect=!0),s._currentSession.onAccepted(s),s._currentSession.setPostDialDelayEndTime(m.getCurrentTime()),m.addCallstatsIOFabric.call(s,s._currentSession,k.response.headers.To[0].parsed.uri.user,s._currentSession.callUUID),f.resetPingPong({client:s,messageCheckTimeout:q.MESSAGE_CHECK_TIMEOUT_ON_CALL_STATE,networkChangeInterval:q.NETWORK_CHANGE_INTERVAL_ON_CALL_STATE})}},E=()=>{s._currentSession&&(o.log.debug(`Outgoing call confirmed - ${s._currentSession.callUUID}`),s._currentSession.onConfirmed(s),s.remoteView.paused&&s.remoteView.play().catch(()=>{}),s.connectToneView.paused||S.stopAudio(q.CONNECT_TONE_ELEMENT_ID))},y=k=>{if(o.log.error(`${q.LOGCAT.CALL} | Outgoing call failed: ${k.cause}`),!s._currentSession)return;k.message&&s._currentSession.setCallUUID(k.message.getHeader("X-CallUUID")||null),(F=>{o.log.info(`${q.LOGCAT.CALL} | Outgoing call - ${F.cause}`),s._currentSession&&(F.cause==="Rejected"?s._currentSession.setState(s._currentSession.STATE.REJECTED):F.cause==="Canceled"?s._currentSession.setState(s._currentSession.STATE.CANCELED):s._currentSession.setState(s._currentSession.STATE.FAILED))})(k);let P={protocol:"none",cause:-1,text:"none"};k.originator==="local"&&s._currentSession.isCallTerminatedDuringRinging?(P={protocol:"none",cause:q.LOCAL_ERROR_CODES["Network switch while ringing"],text:"Network switch while ringing"},s._currentSession.isCallTerminatedDuringRinging=!1):P=m.extractReason(k),o.log.info(`${q.LOGCAT.CALL} | Outgoing call failed - ${P.text===""||P.text==="none"?k.cause:P.text}`),s.emit("onCallFailed",k.cause,s._currentSession.getCallInfo(k.originator,P.protocol,P.text,P.cause)),s._currentSession.onFailed(s,k),s.ringBackToneView&&!s.ringBackToneView.paused&&S.stopAudio(q.RINGBACK_ELEMENT_ID),s.connectToneView.paused||S.stopAudio(q.CONNECT_TONE_ELEMENT_ID),s.shouldMuteCall=!1},w=k=>{s._currentSession&&(o.log.info(`${q.LOGCAT.CALL} | Outgoing call - ${k.cause} - ${k.originator}`),o.log.debug(`Outgoing call ended - ${s._currentSession.callUUID}`),o.log.info("Outgoing call ended"),s._currentSession.onEnded(s,k),f.resetPingPong({client:s,messageCheckTimeout:q.MESSAGE_CHECK_TIMEOUT_IDLE_STATE,networkChangeInterval:q.NETWORK_CHANGE_INTERVAL_IDLE_STATE}),o.AppError.call(s,{name:"onCallTerminated",originator:k.originator,reason:k.cause}),s.shouldMuteCall=!1)},O=k=>{if(s._currentSession&&k.originator==="remote"){o.log.info(`${q.LOGCAT.CALL} | Outgoing Call | emitting onDtmfReceived with digit: `,k.dtmf.tone);const P={tone:k.dtmf.tone,duration:k.dtmf.duration};s.emit("onDtmfReceived",P)}},L=k=>{o.log.info(`${q.LOGCAT.CALL} | Outgoing Call | ${k.originator} INFO packet with body : ${k.info.body}`),s._currentSession&&k.info.body==="remote-party-ringing"&&s.emit("onCallConnected",s._currentSession.getCallInfo(k.originator)),k.info.body==="no-remote-audio"&&s.emit("remoteAudioStatus",!1),k.info.body==="remote-audio"&&s.emit("remoteAudioStatus",!0)},I=function(k,P){const F={};return F.sessionTimersExpires=q.SESSION_TIMERS_EXPIRES,F.pcConfig={iceServers:[{urls:q.STUN_SERVERS}]},F.mediaConstraints={audio:s.options.audioConstraints||!0,video:!1},F.extraHeaders=((H={})=>{const D=[];return i={},Object.keys(H).forEach($=>{const j=H[$],V=$.toUpperCase()==="X-PLIVO-JWT"?N.checkExtraHeaderJWTVal:N.checkExtraHeaderVal;N.checkExtraHeaderKey($)&&V(j)?(D.push(`${$}: ${j}`),i[$]=j,o.log.debug(`valid hdr = ${$} -> ${j}`)):o.log.debug(`invalid hdr = ${$} -> ${j}`)}),s.options.clientRegion&&D.push(`X-ClientRegion: ${s.options.clientRegion}`),D})(k),F.mediaStream=P??window.localStream,F.eventHandlers={sending:u,sdp:g,progress:h,accepted:C,confirmed:E,noCall:w,newDTMF:O,newInfo:L,icecandidate:H=>s._currentSession&&s._currentSession.onIceCandidate(s,H),icetimeout:H=>s._currentSession&&s._currentSession.onIceTimeout(s,H),failed:y,ended:w,getusermediafailed:H=>s._currentSession&&s._currentSession.onGetUserMediaFailed(s,H),"peerconnection:createofferfailed":H=>s._currentSession&&s._currentSession.handlePeerConnectionFailures(s,"createofferfailed",s.callStats?s.callStats.webRTCFunctions.createOffer:null,H),"peerconnection:createanswerfailed":H=>s._currentSession&&s._currentSession.handlePeerConnectionFailures(s,"createanswerfailed",s.callStats?s.callStats.webRTCFunctions.createAnswer:null,H),"peerconnection:setlocaldescriptionfailed":H=>s._currentSession&&s._currentSession.handlePeerConnectionFailures(s,"setlocaldescriptionfailed",s.callStats?s.callStats.webRTCFunctions.setLocalDescription:null,H),"peerconnection:setremotedescriptionfailed":H=>s._currentSession&&s._currentSession.handlePeerConnectionFailures(s,"setremotedescriptionfailed",s.callStats?s.callStats.webRTCFunctions.setRemoteDescription:null,H)},F};U.makeCall=(k,P,F)=>{o.log.debug(`${q.LOGCAT.CALL} | Outgoing call initiating to ${F} with headers ${JSON.stringify(P)}`),s=k,a=[],a.push(`call()@${m.getCurrentTime()}`);let H="";return F&&(H=m.removeSpaces(String(F))),s.noiseSuppresion.startNoiseSuppression().then(D=>{const $=I(P,D);if(!(j=>typeof j>"u"||j===null||j.length<=0?(o.log.warn(`${q.LOGCAT.CALL} | Destination address cannot be null and the length must be > 0`),!1):s._currentSession?(o.log.warn(`${q.LOGCAT.CALL} | Cannot make another call while in call`),!1):s.incomingInvites.size?(o.log.warn(`${q.LOGCAT.CALL} | Cannot make a call while there is an incoming call`),!1):(n=j,!0))(H))return!1;((j,V)=>{try{s.phone?s.phone.call(V,j):o.log.debug(`${q.LOGCAT.CALL} | phone instance is null`),o.log.debug("Outgoing call options : ",JSON.stringify(j.mediaConstraints))}catch(Y){o.log.error("Failed to execute plivo.onCalling event handler",Y),o.AppError.call(s,{name:Y.name,message:Y.message,method:"call()"}),o.sendEvents.call(s,{msg:"ERROR_EVENT",name:Y.name,info:Y.message,method:"call()"},s._currentSession)}})($,(j=>j.substring(0,4)!=="sip:"?`sip:${j}`:j)(H))}),!0},U.createOutgoingSession=k=>{const P=k.request.getHeader("Call-ID")||null,F={sip_call_id:P,extra_headers:i};s.loggerUtil.setSipCallID(P??""),o.log.info(`${q.LOGCAT.CALL} | Outgoing call initiated to ${n} with header:- `,JSON.stringify(F)),s._currentSession=new x.CallSession({sipCallID:P,direction:"outgoing",src:s.userName,dest:n,session:k.session,extraHeaders:i,client:s,stirShakenState:"Not_applicable"}),s.callSession=s._currentSession.session,s.callUUID=s._currentSession.callUUID,s.callDirection=s._currentSession.direction,a.forEach(H=>{s._currentSession.addConnectionStage(H)}),a=[],o.log.debug(`${q.LOGCAT.CALL} | outgoing session created`),s.emit("onCalling")}},"./lib/managers/util.ts":function(Se,U,K){var G=this&&this.__awaiter||function(g,h,C,E){return new(C||(C=Promise))(function(y,w){function O(k){try{I(E.next(k))}catch(P){w(P)}}function L(k){try{I(E.throw(k))}catch(P){w(P)}}function I(k){var P;k.done?y(k.value):(P=k.value,P instanceof C?P:new C(function(F){F(P)})).then(O,L)}I((E=E.apply(g,h||[])).next())})},q=this&&this.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(U,"__esModule",{value:!0}),U.removeSpaces=U.logCandidatePairs=U.mobileBrowserCheck=U.isSessionConfirmed=U.handleMediaError=U.addCallstatsIOFabric=U.addMidAttribute=U.hangupClearance=U.statsCollector=U.extractReason=U.extractReasonInfo=U.onIceConnectionChange=U.getUTCTImeString=U.setEncodingParameters=U.iceConnectionCheck=U.callStart=U.getCurrentTime=U.replaceMdnsIceCandidates=U.addCloseProtectionListeners=U.setErrorCollector=void 0;const x=K("./package.json"),N=K("./lib/utils/device.ts"),S=K("./lib/stats/nonRTPStats.ts"),p=K("./lib/stats/mediaMetrics.ts"),b=K("./lib/stats/rtpStats.ts"),_=K("./lib/media/audioDevice.ts"),t=K("./lib/logger.ts"),m=K("./lib/constants.ts"),f=q(K("./lib/utils/browserDetection.ts")),o={log:t.Logger,sendEvents:S.sendEvents,AppError:S.AppError,emitMetrics:p.emitMetrics};U.setErrorCollector=()=>{window.onerror=g=>{o.log.error(`${m.LOGCAT.CRASH} | ${g} |`,new Error().stack)}},U.addCloseProtectionListeners=function(){const g=this;(function(h){var C;return G(this,void 0,void 0,function*(){const E=N.getClientVersion(),y=N.getSDKVersion(),w=N.getOS(),O={msg:"CALL_SUMMARY",userAgent:navigator.userAgent,clientVersionMajor:E.major||E[0]||"0",clientVersionMinor:E.minor||E[1]||"0",clientVersionPatch:E.patch||E[2]||"0",sdkName:x.name,sdkVersionMajor:y.major,sdkVersionMinor:y.minor,sdkVersionPatch:y.patch,clientName:f.default().browser,devicePlatform:navigator.platform,deviceOs:w,setupOptions:h.options,noiseReduction:{enabled:(C=h.enableNoiseReduction)!==null&&C!==void 0&&C,noiseSuprressionStarted:h.noiseSuppresion.started},isAudioDeviceToggled:h.deviceToggledInCurrentSession,isNetworkChanged:h.networkChangeInCurrentSession,jsFramework:h.jsFramework};h._currentSession&&(O.signalling=h._currentSession.signallingInfo);const L=yield _.getAudioDevicesInfo.call(h);return L&&(O.audioDeviceInfo=L),O})})(g).then(h=>{g.options.closeProtection?window.onbeforeunload=C=>{o.sendEvents.call(g,h,g._currentSession),C.preventDefault(),C.returnValue=""}:window.onbeforeunload=()=>{o.sendEvents.call(g,h,g._currentSession),g._currentSession&&g._currentSession.session.terminate()},window.onunload=()=>{g._currentSession&&g._currentSession.session.terminate(),o.sendEvents.call(g,h,g._currentSession),o.log.send(g)}})};const s=g=>{const h=g.split(" ");return h[4]=m.DEFAULT_MDNS_CANDIDATE,h.join(" ")};U.replaceMdnsIceCandidates=g=>{const h=g;let C=0,E=0;const y=[],w=g.split(`
`);for(let O=0;O<w.length;O+=1)w[O].indexOf("a=candidate")!==-1&&(E+=1,w[O].indexOf(".local")!==-1&&(C+=1,w[O]=s(w[O]))),y.push(w[O]);return C!==E?h:y.join(`
`)},U.getCurrentTime=()=>Date.now();const n=function(){const{storage:g}=this;return g&&(g.local_audio=[],g.remote_audio=[],g.mosLocalMeasures=[],g.mosRemoteMeasures=[],g.jitterLocalMeasures=[],g.jitterRemoteMeasures=[],g.packetLossRemoteMeasures=[],g.packetLossLocalMeasures=[],g.rtt=[],g.audioCodec=null,g.warning={audioLocalMeasures:!1,audioRemoteMeasures:!1,mosLocalMeasures:!1,mosRemoteMeasures:!1,jitterLocalMeasures:!1,jitterRemoteMeasures:!1,packetLossRemoteMeasures:!1,packetLossLocalMeasures:!1,rtt:!1,ice_connection:!1},g.startAnalysis=!1,setTimeout(()=>{g.startAnalysis=!0,o.log.debug("Stats analysis started")},m.STATS_ANALYSIS_WAIT_TIME)),!0};U.callStart=function(){return this.storage={},n.call(this)},U.iceConnectionCheck=function(g){const h=this;["disconnected","failed"].indexOf(g)!==-1&&(o.log.info(`${m.LOGCAT.NETWORK_CHANGE} | Network drop while performing ice connection check`),o.emitMetrics.call(h,"network","warning","ice_connection",g,!0,"network drop","None"),h.storage&&(h.storage.warning.ice_connection=!0)),g==="connected"&&h.storage&&h.storage.warning.ice_connection===!0&&(o.emitMetrics.call(h,"network","warning","ice_connection",g,!1,"network drop","None"),h.storage.warning.ice_connection=!1)},U.setEncodingParameters=function(){const g=this;if(g._currentSession&&g._currentSession.session&&g._currentSession.session.connection){const h=g._currentSession.session.connection.getSenders()[0];if(!g.options.dscp||!h||typeof h.getParameters!="function"||typeof h.setParameters!="function")return;const C=h.getParameters();if(!C.priority&&(!C.encodings||!C.encodings.length))return;C.priority="high",C.encodings&&C.encodings.length&&C.encodings.forEach(E=>{E.priority="high",E.networkPriority="high"}),h.setParameters(C)}},U.getUTCTImeString=function(){const g=new Date;return`${g.toISOString().substring(0,10)} ${g.toISOString().split("T")[1].split(".")[0]}.${g.getUTCMilliseconds()}`},U.onIceConnectionChange=function(g,h){return G(this,void 0,void 0,function*(){const C=this,E=g.iceConnectionState;o.log.debug(`${m.LOGCAT.CALL} | oniceconnectionstatechange is ${E}`),function(y,w){G(this,void 0,void 0,function*(){(yield y.getStats()).forEach(O=>{switch(O.type){case"candidate-pair":w.candidatePairsList.set(O.id,{iceConnectionState:y.iceConnectionState,localCandidateId:O.localCandidateId,remoteCandidateId:O.remoteCandidateId,state:O.state,timeStamp:U.getUTCTImeString()});break;case"local-candidate":case"remote-candidate":w.candidateList.set(O.id,{ip:O.ip,port:O.port,candidateType:O.candidateType,isLocal:O.type==="local-candidate"})}})})}(g,h),h.addConnectionStage(`iceConnectionState-${E}@${U.getCurrentTime()}`),h.updateMediaConnectionInfo({[`ice_connection_state_${E}`]:U.getCurrentTime()}),U.iceConnectionCheck.call(C,E),h.callUUID&&g&&(E!=="failed"&&E!=="disconnected"||C.callStats&&C.callStats.reportError(g,h.callUUID,C.callStats.webRTCFunctions.iceConnectionFailure),E==="connected"&&C.emit("onMediaConnected",h.getCallInfo("local")))})},U.extractReasonInfo=g=>{if(g==null||typeof g!="object")return o.log.debug(`${m.LOGCAT.CALL} | evt.message could be null or not an object: ${g?typeof g:"null"}`),{protocol:"none",cause:-1,text:"none"};const h=g.getHeader("Reason");if(h==null)return o.log.debug(`${m.LOGCAT.CALL} | No reason header present}`),{protocol:"none",cause:-1,text:"none"};const C=h.match(/cause=(\d+)/),E=h.match(/^([^;]+)/),y=h.match(/text="([^"]+)"/);return{protocol:E?E[1]:"none",cause:C?parseInt(C[1],10):-1,text:y?y[1]:"none"}},U.extractReason=g=>g.originator==="local"?{protocol:"none",cause:m.LOCAL_ERROR_CODES[g.cause],text:g.cause}:U.extractReasonInfo(g.message),U.statsCollector=function(g){const h=this;if(h.statsSocket&&h.callstatskey&&(h.browserDetails.browser==="chrome"&&h.browserDetails.version>63||h.browserDetails.browser==="firefox"&&h.browserDetails.version>59||h.browserDetails.browser==="safari"&&h.browserDetails.version>10||h.browserDetails.browser==="edge"&&h.browserDetails.version>79)||h.browserDetails.browser==="chrome"&&h.browserDetails.version>63){const C=new b.GetRTPStats(h);g.setCallStats(C)}else h.statsSocket&&h.callstatskey&&o.log.warn("This browser version is not supported for collecting data for Call Insights API but the call will proceed despite this. Supported versions are Chrome version - 64 and above, Firefox version - 63 and above, Safari version - 10 and above")};const i=function(g){const h=this;g===h._currentSession?(h.remoteView&&h.remoteView.pause(),h._lastCallSession=g,h.lastCallUUID=g.callUUID,h._currentSession=null,h.callSession=null,h.callUUID=null,h.callDirection=null):h&&h.incomingInvites&&g.callUUID&&h.incomingInvites.has(g.callUUID)&&h.incomingInvites.delete(g.callUUID),h.lastIncomingCall&&h.lastIncomingCall.callUUID===g.callUUID&&(h.lastIncomingCall=null,h.options.allowMultipleIncomingCalls||(h.callSession=null,h.callUUID=null,h.callDirection=null),h.incomingInvites.size&&(h.lastIncomingCall=h.incomingInvites.values().next().value,!h.options.allowMultipleIncomingCalls&&h.lastIncomingCall&&(h.callSession=h.lastIncomingCall.session,h.callUUID=h.lastIncomingCall.callUUID,h.callDirection=h.lastIncomingCall.direction)))},a=function(){!this._currentSession&&this.incomingInvites&&this.incomingInvites.size===0&&(window.onbeforeunload=()=>{},window.onunload=()=>{})},c=function(){if(window.localStream){if(f.default().browser==="firefox"||f.default().browser==="chrome"||this.permOnClick||_.isElectronApp())try{window.localStream.getTracks().forEach(g=>{g.stop(),window.localStream.removeTrack(g)}),window.localStream=null}catch(g){o.log.debug(`${m.LOGCAT.CALL} | error in stopping tracks in localStream : ${g.message}`)}if(f.default().browser==="safari")try{window.localStream.getTracks().forEach(g=>{g.enabled||(g.enabled=!0)})}catch(g){o.log.debug(`${m.LOGCAT.CALL} | error in enabling tracks in localStream : ${g.message}`)}}};U.hangupClearance=function(g){try{const h=this;o.AppError.call(h,function(y){const w=[];let O="";for(let I=0;y.length>I;I+=1){const k=y[I].split("@");if(I===0)O=k[1],w.push(`${k[0]} = ${k[1]}#`);else{let P=new Date(k[1]).valueOf()-new Date(O).valueOf();P>1e3?(P/=1e3,P=`${String(P)}s#`):P=`${String(P)}ms#`,w.push(`${k[0]} = ${k[1]} +${P}`)}}let L=JSON.stringify(w);return L=L.replace(/[[",\]]/g,""),L=L.replace(/#/g,`
`),L}(g.connectionStages),"log"),g.clearCallStats(),i.call(h,g);const C=g.getSignallingInfo(),E=g.getMediaConnectionInfo();if(h.callstatskey&&_.getAudioDevicesInfo.call(h).then(y=>{S.sendCallSummaryEvent.call(h,y,C,E,g)}).catch(()=>{S.sendCallSummaryEvent.call(h,null,C,E,g)}),a.call(h),h.isCallMuted=!1,h._currentSession)return;h.storage&&(h.storage=null),c.call(h),_.updateAudioDeviceFlags(),_.resetMuteOnHangup(),h.noiseSuppresion.stopNoiseSuppresion()}catch(h){o.log.info(`${m.LOGCAT.CALL} | error while hangup clearance : ${h.message}`)}},U.addMidAttribute=function(g){this.browserDetails.browser==="firefox"&&this.browserDetails.version>62&&g.response&&g.response.body&&g.response.body.indexOf("a=mid:0")===-1&&(g.response.body=g.response.body.replace("a=ice-pwd",`a=mid:0
a=ice-pwd`))};const u=g=>{o.log.debug(`Stats new fabric message: ${g}`)};U.addCallstatsIOFabric=function(g,h,C){this.callStats&&g.session.connection&&this.callStats.addNewFabric(g.session.connection,h,this.callStats.fabricUsage.audio,C,u)},U.handleMediaError=function(g,h){const C=this;if(C.callStats&&h.callUUID&&!g.cause.match("edia")&&(o.log.debug(`${m.LOGCAT.CALL} | Sending error to stats when media error occurs`),h.session.connection?C.callStats.reportError(h.session.connection,h.callUUID,C.callStats.webRTCFunctions.signalingError):C.callStats.reportError(null,h.callUUID,C.callStats.webRTCFunctions.signalingError)),C.statsSocket&&h.callUUID&&C.callstatskey&&!g.cause.match("edia")){const E=g.cause;let y;y=g.message&&g.message.status_code?String(g.message.status_code):g.cause,h.updateSignallingInfo({signalling_errors:{timestamp:U.getCurrentTime(),error_code:y,error_description:E}})}},U.isSessionConfirmed=function(g){return g?g.isEstablished():(o.log.debug("session not available"),!1)},U.mobileBrowserCheck=function(){let g=!1;var h;return h=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(h)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(h.substr(0,4)))&&(g=!0),g},U.logCandidatePairs=function(g){if(g){const{candidateList:h}=g;g.candidatePairsList.forEach((C,E)=>{o.log.debug(`${m.LOGCAT.CALL}| iceConnectionState-${C.iceConnectionState}, CandidatePair(${E}): state-${C.state} at [${C.timeStamp}] has local-candidate(${C.localCandidateId}):[${JSON.stringify(h.get(C.localCandidateId)).slice(1,-1)}] and remote-candidate(${C.remoteCandidateId}):[${JSON.stringify(h.get(C.remoteCandidateId)).slice(1,-1)}]`)})}else o.log.debug(`${m.LOGCAT.CALL} |can't logCandidatePairs, callSession is null`)},U.removeSpaces=function(g){return g.replace(/\s/g,"")}},"./lib/media/audioDevice.ts":function(Se,U,K){(function(G){var q=this&&this.__importDefault||function(H){return H&&H.__esModule?H:{default:H}};Object.defineProperty(U,"__esModule",{value:!0}),U.detectDeviceChange=U.audioDevDicSetter=U.updateAudioDeviceFlags=U.unmute=U.ringtoneDevices=U.outputDevices=U.inputDevices=U.checkAudioDevChange=U.setAudioDeviceForForWindows=U.updateWindowDeviceList=U.getAudioDevicesInfo=U.isElectronApp=U.audioDevDictionary=U.replaceStream=U.stopVolumeDataStreaming=U.startVolumeDataStreaming=U.resetMuteOnHangup=U.mute=U.speechListeners=U.revealAudioDevices=U.availableDevices=U.setAudioContraints=void 0;const x=K("./lib/constants.ts"),N=q(K("./lib/media/audioVisualize.ts")),S=K("./lib/logger.ts"),p=K("./lib/stats/nonRTPStats.ts"),b=q(K("./lib/utils/browserDetection.ts")),_=K("./lib/media/document.ts"),t=K("./lib/stats/mediaMetrics.ts"),m=K("./lib/media/audioLevel.ts"),f={log:S.Logger,audioConstraints:{}};let o,s,n,i=null,a=null,c=!1,u,g=!1;const h=N.default();let C=[];const E={},y={};let w=null;const O={},L={},I=navigator.userAgent.search("Safari")>=0&&navigator.userAgent.search("Chrome")<0,k=navigator.platform==="Win32"||navigator.platform==="Win16"||navigator.platform.toString().toLocaleLowerCase().includes("win");U.setAudioContraints=function(H){i=H,f.audioConstraints=i.audioConstraints};const P=function(H){H.forEach(D=>{D.kind==="audioinput"&&(E[D.deviceId]=D.groupId,y[D.groupId]=D.deviceId)})};U.availableDevices=function(H){return new Promise((D,$)=>{navigator.mediaDevices.enumerateDevices().then(j=>{const V=[];j.forEach(Y=>{H==="input"?Y.kind==="audioinput"&&Y.deviceId!=="communications"&&V.push(Y):H==="output"?Y.kind==="audiooutput"&&Y.deviceId!=="communications"&&V.push(Y):/video/i.test(Y.kind)||Y.deviceId!=="communications"&&V.push(Y)}),D(V)}).catch(j=>{$(j)})})},U.revealAudioDevices=function(H){return new Promise((D,$)=>{navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(j=>{H==="returnStream"?D(j):(j.getTracks().forEach(V=>{V.stop()}),D("success"))}).catch(j=>{f.log.error(`${x.LOGCAT.CALL} | Failed to get user media during init ${j.message}`),$(j.name)}):$("no getUserMedia support")})},U.speechListeners=function(){var H;if(this._currentSession.state!==this._currentSession.STATE.ANSWERED)return;const D=this;D.speechRecognition.stop(),D.speechRecognition.continuous=!0,D.speechRecognition.interimResults=!0,D.speechRecognition.onerror=$=>{var j;f.log.error(`${x.LOGCAT.CALL} | Error in Recognizing speech :`,$.error),$.error==="network"&&((j=D._currentSession)===null||j===void 0||j.setSpeechState(D._currentSession.SPEECH_STATE.STOPPED_DUE_TO_NETWORK_ERROR),f.log.info(`${x.LOGCAT.CALL} | Speech Recognition stopped due to network disruption`))},D.speechRecognition.onend=()=>{var $,j,V,Y,Z,J,re;f.log.info(`${x.LOGCAT.CALL} | Recognizing speech Stopped`),D.isMuteCalled&&(($=D._currentSession)===null||$===void 0?void 0:$.speech_state)!==((j=D._currentSession)===null||j===void 0?void 0:j.SPEECH_STATE.STOPPED_AFTER_DETECTION)&&((V=D._currentSession)===null||V===void 0?void 0:V.speech_state)!==((Y=D._currentSession)===null||Y===void 0?void 0:Y.SPEECH_STATE.STOPPED_DUE_TO_NETWORK_ERROR)?((Z=D._currentSession)===null||Z===void 0||Z.setSpeechState(D._currentSession.SPEECH_STATE.STOPPED),(J=D._currentSession)===null||J===void 0||J.startSpeechRecognition(D)):(re=D._currentSession)===null||re===void 0||re.setSpeechState(D._currentSession.SPEECH_STATE.STOPPED)},D.speechRecognition.onstart=()=>{var $,j,V,Y,Z,J;f.log.info(`${x.LOGCAT.CALL} | Recognizing speech Running`),D.isMuteCalled||(($=D._currentSession)===null||$===void 0?void 0:$.speech_state)===((j=D._currentSession)===null||j===void 0?void 0:j.SPEECH_STATE.STOPPED)&&((V=D._currentSession)===null||V===void 0?void 0:V.speech_state)===((Y=D._currentSession)===null||Y===void 0?void 0:Y.SPEECH_STATE.STOPPING)?(J=D._currentSession)===null||J===void 0||J.setSpeechState(D._currentSession.SPEECH_STATE.RUNNING):(Z=D._currentSession)===null||Z===void 0||Z.stopSpeechRecognition(D)},D.speechRecognition.onresult=()=>{var $;t.emitMetrics.call(this,"audio","warning","speaking_on_mute",0,!0,"User is trying to speak on mute",""),($=D._currentSession)===null||$===void 0||$.setSpeechState(D._currentSession.SPEECH_STATE.STOPPED_AFTER_DETECTION),D.speechRecognition.stop(),f.log.info(`${x.LOGCAT.CALL} | User speaking on mute`)},(H=D._currentSession)===null||H===void 0||H.setSpeechState(D._currentSession.SPEECH_STATE.STARTING),D.speechRecognition.start()},U.mute=function(){var H;f.log.debug(`${x.LOGCAT.CALL} | call is now muted`);const D=this;(H=this._currentSession)===null||H===void 0||H.startSpeechRecognition(D),a?a.getAudioTracks()[0].enabled=!1:this._currentSession.session.mute(),D.noiseSuppresion&&D.noiseSuppresion.muteStream(),o=!1},U.resetMuteOnHangup=function(){o=!0},U.startVolumeDataStreaming=function(H){if(H._currentSession){const D=H._currentSession.session.connection;let $=null;const j=D.getRemoteStreams()[0];if(a?($=a,setTimeout(()=>{H._currentSession&&h.start(H,$,j)},3e3)):($=D.getLocalStreams()[0],h.start(H,$,j)),I&&$&&$.active===!1){const V=Object.keys(O)[0],Y=O[V];i&&i.audio.microphoneDevices.set(Y)}}},U.stopVolumeDataStreaming=function(){setTimeout(()=>{f.log.debug(`${x.LOGCAT.CALL} | stopping the emission of audio level`),window._localContext&&window._localContext.suspend(),h&&h.stop()},3e3)},U.replaceStream=function(H,D){return new Promise(($,j)=>{const V=H._currentSession?H._currentSession.session.connection:null;V?navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(D).then(Y=>{f.log.debug(`${x.LOGCAT.CALL_QUALITY} | Got new stream while replacing stream`);let Z=null;Z=V.getSenders()[0],a&&(f.log.debug(`${x.LOGCAT.CALL_QUALITY} | Stopping current local stream in replacing stream`),a.getTracks().forEach(J=>J.stop()),a=null),Z&&(f.log.debug("replaced sender : ",Z),H.noiseSuppresion.updateProcessingStream(Y).then(J=>{J!=null&&(Y=J),a=Y,o===!1&&(f.log.debug(`${x.LOGCAT.CALL_QUALITY} | call was muted before replacing stream. Muting new stream`),function(re){U.mute.call(re)}(H)),H._currentSession&&H._currentSession.stats&&(H._currentSession.stats.senderMediaStream=Y,H._currentSession.stats.localAudioLevelHelper=new m.AudioLevel(H._currentSession.stats.senderMediaStream)),f.log.debug(`${x.LOGCAT.CALL_QUALITY} | replacing track`),Z.replaceTrack(Y.getAudioTracks()[0]).catch(()=>{f.log.debug(`${x.LOGCAT.CALL_QUALITY} | error in replacing track`);const re=i==null?void 0:i.getPeerConnection().pc;re&&(Z=re.getSenders()[0],Z&&Z.replaceTrack(Y.getAudioTracks()[0]).catch(()=>{}))})}))}).catch(Y=>{f.log.debug(`${x.LOGCAT.CALL_QUALITY} | error in replacing stream ${Y}`),j(Y)}).then(()=>{U.stopVolumeDataStreaming()}).then(()=>{U.startVolumeDataStreaming(H),$()}).catch(Y=>{f.log.debug(`${x.LOGCAT.CALL_QUALITY} | main error in replacing stream ${Y}`),j(Y)}):(f.log.debug(`${x.LOGCAT.CALL_QUALITY} | No getUserMedia support in replaceStream`),j(new Error("No getUserMedia support"))):(f.log.debug(`${x.LOGCAT.CALL_QUALITY} | session is not active while replacing stream`),$())})};const F=function(H,D,$,j){let V;f.log.debug(`${x.LOGCAT.CALL_QUALITY} |inside replacetrack with device id  : ${H}`),D._currentSession?(typeof f.audioConstraints=="object"&&"optional"in f.audioConstraints?(f.audioConstraints.optional.forEach(Y=>{Object.entries(Y).forEach(([Z,J])=>{f.audioConstraints&&(Z=Z.replace(/goog(.)/i,(re,ce)=>ce.toLowerCase()),f.audioConstraints[Z]=J)})}),f.audioConstraints.deviceId=H,delete f.audioConstraints.optional,P(C)):typeof f.audioConstraints=="boolean"?f.audioConstraints={deviceId:H}:f.audioConstraints.deviceId=H,V={audio:f.audioConstraints,video:!1},U.replaceStream(D,V)):a?a.getTracks().forEach(Y=>Y.stop()):D.permOnClick||window.localStream&&(window.localStream.getTracks().forEach(Y=>{Y.stop(),window.localStream.removeTrack(Y)}),window.localStream=null)};U.audioDevDictionary=function(H){return new Promise((D,$)=>{U.availableDevices().then(j=>{let V=[],Y=!1;j.forEach(Z=>{if(Z.label){const J=JSON.stringify(Z);V.push(J),Y=!0}else V=[]}),H?(Y&&(C=j),w&&w(V),D(!0)):D({devices:j,audioRef:V})}).catch(j=>{f.log.error("Error availableDevices() ",j),$(j)})})},U.isElectronApp=function(){return typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||!(typeof G>"u"||typeof G.versions!="object"||!G.versions.electron)||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0},U.getAudioDevicesInfo=function(){return navigator.mediaDevices.enumerateDevices().then(H=>{const D=new Map,$=new Map,j={noOfAudioInput:0,noOfAudioOutput:0,audioInputLables:"",audioOutputLables:"",audioInputGroupIds:"",audioOutputGroupIds:"",audioInputIdSet:this.audio.microphoneDevices.get()||"",audioOutputIdSet:this.audio.speakerDevices.get()||"",activeInputAudioDevice:"",activeOutputAudioDevice:""};let V=null;return H.forEach(Y=>{Y.deviceId==="default"&&Y.kind==="audioinput"?Y.defaultInputDeviceGroupId=Y.groupId:Y.deviceId==="default"&&Y.kind==="audiooutput"&&(Y.defaultOutputDeviceGroupId=Y.groupId),Y.kind==="audioinput"?(D.set(Y.deviceId,Y.label),j.noOfAudioInput+=1,j.noOfAudioInput===1&&(V=Y.label),j.audioInputLables+=`${Y.label} ,`,j.audioInputGroupIds+=`${Y.groupId} ,`):Y.kind==="audiooutput"&&($.set(Y.deviceId,Y.label),j.noOfAudioOutput+=1,j.audioOutputLables+=`${Y.label} ,`,j.audioOutputGroupIds+=`${Y.groupId} ,`)}),j.audioInputIdSet===""?(j.activeInputAudioDevice=D.get("default"),b.default().browser==="safari"&&(j.activeInputAudioDevice=V)):j.activeInputAudioDevice=D.get(j.audioInputIdSet),j.audioOutputIdSet===""?j.activeOutputAudioDevice=$.get("default"):j.activeOutputAudioDevice=$.get(j.audioOutputIdSet),j})},U.updateWindowDeviceList=function(H){const D={};H.forEach($=>{$.kind==="audioinput"&&$.deviceId==="default"&&(s=$.groupId),$.kind==="audiooutput"&&($.deviceId==="default"&&(n=$.groupId),D[$.groupId]=$.deviceId)}),s!==n&&(g=!0,D[s]&&(i==null||i.audio.speakerDevices.set(D[s]),c=!0,f.log.debug(`Updated the windows audio device with id ${D[s]}`)))},U.setAudioDeviceForForWindows=function(H,D,$){D!==""&&D!=="default"||$!==null&&$!=="default"&&!c||(C=H,U.updateWindowDeviceList(H))},U.checkAudioDevChange=function(){const H=this,D=typeof window.InstallTrigger<"u",$=i?i.audio.speakerDevices.get():"",j=i?i.audio.microphoneDevices.get():"";U.audioDevDictionary().then(V=>{const{devices:Y,audioRef:Z}=V;return C&&Y&&(Y.forEach(J=>{O[J.label]=J.deviceId,L[J.deviceId]=J.label,C.filter(re=>re.deviceId===J.deviceId).length||/default/i.test(J.deviceId)||(H.emit("audioDeviceChange",{change:"added",device:J}),u=J.label,J.kind==="audioinput"?(f.log.info(`${x.LOGCAT.CALL_QUALITY} Audio input device added:- `,JSON.stringify(J)),setTimeout(()=>{H&&(D||I)?(f.log.debug(`${x.LOGCAT.CALL_QUALITY} Setting mic to ${J.deviceId} in firefox/safari`),H.audio.microphoneDevices.set(J.deviceId)):H&&(f.log.debug(`${x.LOGCAT.CALL_QUALITY} Setting mic to ${k&&!H.options.useDefaultAudioDevice?J.deviceId:"default"} `),H.audio.microphoneDevices.set(k&&!H.options.useDefaultAudioDevice?J.deviceId:"default"))},200)):H&&J.kind==="audiooutput"&&(f.log.info(`${x.LOGCAT.CALL_QUALITY} Audio output device added:- `,JSON.stringify(J)),setTimeout(()=>{H&&D?(H.audio.speakerDevices.set(J.deviceId),f.log.debug(`${x.LOGCAT.CALL_QUALITY} Setting speaker to ${J.deviceId} in firefox`)):!H||I||D||(f.log.debug(`${x.LOGCAT.CALL_QUALITY} Setting speaker to ${k&&!H.options.useDefaultAudioDevice?J.deviceId:"default"} `),H.audio.speakerDevices.set(k&&!H.options.useDefaultAudioDevice?J.deviceId:"default"))},200)))}),C.forEach(J=>{if(!Y.filter(re=>re.deviceId===J.deviceId).length&&!/default/i.test(J.deviceId)&&(H.emit("audioDeviceChange",{change:"removed",device:J}),O[J.label]!==void 0&&(delete O[J.label],delete L[J.deviceId]),J.kind==="audioinput"&&(f.log.info(`${x.LOGCAT.CALL_QUALITY} Audio input device removed:- `,JSON.stringify(J)),f.log.debug(`${x.LOGCAT.CALL_QUALITY} Setting microphone to default`),setTimeout(()=>{H&&(D||I)?(f.log.debug(`${x.LOGCAT.CALL_QUALITY} Setting microphone to ${C[0].deviceId} in firefox/safari`),H.audio.microphoneDevices.set(C[0].deviceId)):H&&(f.log.debug(`${x.LOGCAT.CALL_QUALITY} Setting microphone to default`),H.audio.microphoneDevices.set("default"))},200)),J.kind==="audiooutput")){if($!==""&&$!=="default"&&i){const re=i.remoteView.srcObject,ce=document.getElementById(x.REMOTE_VIEW_ID);ce==null||ce.remove(),_.setupRemoteView(),f.log.debug(`${x.LOGCAT.CALL_QUALITY} | Remote view id replaced`),i.remoteView=document.getElementById(x.REMOTE_VIEW_ID),i._currentSession&&re&&(f.log.debug(`${x.LOGCAT.CALL_QUALITY} | Remote view src object added`),i.remoteView.srcObject=re)}f.log.info(`${x.LOGCAT.CALL_QUALITY} Audio output device removed:- `,JSON.stringify(J)),setTimeout(()=>{H&&D?C.every(re=>re.kind!=="audiooutput"||(f.log.debug(`${x.LOGCAT.CALL_QUALITY} Setting output to default ${re.deviceId} in firefox`),H&&H.audio.speakerDevices.set(re.deviceId),!1)):!H||I||D||(f.log.debug(`${x.LOGCAT.CALL_QUALITY} Setting output to default`),H.audio.speakerDevices.set("default"))},200)}})),C||H.emit("audioDeviceChange",{change:"",device:""}),Y&&(C=Y,w&&w(Z)),[Y,u,$,j]}).then(()=>{g=!1}).catch(V=>{f.log.error("Error checkAudioDevChange() ",V)})},U.inputDevices={set(H){if(typeof H!="string")return f.log.error("Device id should be string"),!1;const D=C.filter($=>$.deviceId===H&&$.kind==="audioinput");if(!D.length)return f.log.error("Invalid input device id"),!1;if(P(C),i){if(H==="default"){const $=E[H];H=y[$],f.log.debug(H),F(H,i)}else F(H,i);U.getAudioDevicesInfo.call(i).then($=>{const j=i;if(j!==null){f.log.info(`${x.LOGCAT.CALL} | Audio device toggled to`,JSON.stringify(D));const V={msg:"AUDIO_DEVICES_TOGGLE",deviceInfo:$};p.sendEvents.call(i,V,j._currentSession),j.deviceToggledInCurrentSession=!0}})}return!0},get(){if(f.audioConstraints.optional){const H=f.audioConstraints.optional.filter(D=>D.sourceId);return H.length>0?H[0].sourceId:""}return f.audioConstraints&&f.audioConstraints.deviceId?f.audioConstraints.deviceId:""},reset:()=>(f.audioConstraints.optional?f.audioConstraints.optional=f.audioConstraints.optional.filter(H=>!H.sourceId):f.audioConstraints&&f.audioConstraints.deviceId&&delete f.audioConstraints.deviceId,!0)},U.outputDevices={set(H){const D=C.filter($=>$.deviceId===H&&$.kind==="audiooutput");return D.length?(document.querySelectorAll('[data-devicetype="speakerDevice"]').forEach($=>(typeof $.sinkId<"u"?$.setSinkId(H).then(()=>{}).catch(j=>{if(j.code===x.AUDIO_DEVICE_ABORT_ERROR_CODE)$.src="",$.setSinkId(H).then(()=>{}).catch(V=>{f.log.error(V.message)});else{let V=j.message;j.name===x.AUDIO_DEVICE_SECURITY_ERROR&&(V=`You need to use HTTPS for selecting audio output device: ${j}`),f.log.error(V)}return!1}):f.log.warn("Browser does not support output device selection."),!1)),g||(c=!1),i!==null&&i._currentSession&&U.getAudioDevicesInfo.call(i).then($=>{const j=i;if(j!==null){f.log.info(`${x.LOGCAT.CALL} Audio device toggled to`,JSON.stringify(D));const V={msg:"AUDIO_DEVICES_TOGGLE",deviceInfo:$};p.sendEvents.call(i,V,j._currentSession),j.deviceToggledInCurrentSession=!0}}),!0):(f.log.error("Invalid output device id"),!1)},get(){const H=document.querySelector('[data-devicetype="speakerDevice"]');return H.sinkId?H.sinkId:null},reset:()=>(document.querySelectorAll('[data-devicetype="speakerDevice"]').forEach(H=>{H.setSinkId&&H.setSinkId("")}),!0),media(H){const D={dtmf:"dtmfstar",ringback:x.RINGBACK_ELEMENT_ID};return H&&H in D?document.getElementById(D[H]):document.getElementById(x.RINGBACK_ELEMENT_ID)}},U.ringtoneDevices={set(H){if(!C.filter($=>$.deviceId===H&&$.kind==="audiooutput").length)return f.log.error("Invalid output device id"),!1;const D=document.getElementById(x.RINGTONE_ELEMENT_ID);return D.setSinkId&&D.setSinkId(H),!0},get(){const H=document.getElementById(x.RINGTONE_ELEMENT_ID);return H.sinkId?H.sinkId:null},reset(){const H=document.getElementById(x.RINGTONE_ELEMENT_ID);return H.setSinkId&&H.setSinkId(""),!0},media:()=>document.getElementById(x.RINGTONE_ELEMENT_ID)},U.unmute=function(){var H;f.log.debug(`${x.LOGCAT.CALL} | call is now unmuted`);const D=this;a?a.getAudioTracks()[0].enabled=!0:this._currentSession.session.unmute(),(H=D._currentSession)===null||H===void 0||H.stopSpeechRecognition(D),D.noiseSuppresion&&D.noiseSuppresion.unmuteStream(),o=!0},U.updateAudioDeviceFlags=function(){a&&a.getTracks().forEach(H=>H.stop()),a=null},U.audioDevDicSetter=function(H){w=H},U.detectDeviceChange=function(){this.browserDetails.browser==="chrome"&&this.browserDetails.version<57?setInterval(()=>{U.checkAudioDevChange.call(this)},5e3):navigator.mediaDevices.ondevicechange=H=>{H.isTrusted?f.log.debug(`${x.LOGCAT.CALL} | Device change event is trusted`):f.log.debug(`${x.LOGCAT.CALL} | Device change event is not trusted`),U.checkAudioDevChange.call(this)}}}).call(this,K("./node_modules/process/browser.js"))},"./lib/media/audioLevel.ts":function(Se,U,K){Object.defineProperty(U,"__esModule",{value:!0}),U.AudioLevel=void 0;const G=K("./lib/logger.ts"),q=new class{constructor(){this.getAudioContext=()=>{if(!this.audioContext){const x=window.AudioContext||window.webkitAudioContext;this.audioContext=new x}return this.audioContextCount+=1,this.audioContext},this.stop=()=>{this.audioContext&&(this.audioContextCount-=1,this.audioContextCount===0&&(this.audioContext.close(),this.audioContext=null,G.Logger.debug("AudioContext no longer needed so closed")))},this.audioContext=null,this.audioContextCount=0}};U.AudioLevel=class{constructor(x){this.getAudioLevel=()=>{let S=-100;const{fftBins:p}=this;if(p&&this.analyser&&this.analyser.getFloatFrequencyData(p),p)for(let b=4,_=p.length;b<_;b+=1)p[b]>S&&p[b]<0&&(S=p[b]);return S},this.stop=()=>{this.stopped||(this.stopped=!0,this.analyser&&this.analyser.disconnect(),this.sourceNode.disconnect(),q.stop())},this.volumeLevel=-100,this.fftBins=null,this.analyser=null,this.stopped=!1;const N=q.getAudioContext();this.analyser=N.createAnalyser(),this.analyser.fftSize=1024,this.analyser.minDecibels=-100,this.analyser.maxDecibels=0,this.analyser.smoothingTimeConstant=.1,this.fftBins=new Float32Array(this.analyser.frequencyBinCount),this.sourceNode=N.createMediaStreamSource(x),this.sourceNode.connect(this.analyser)}}},"./lib/media/audioVisualize.ts":function(Se,U,K){Object.defineProperty(U,"__esModule",{value:!0});const G=K("./lib/logger.ts");let q,x,N,S,p,b,_;const t=function(){S=window.requestAnimationFrame(t);const f=new Uint8Array(b.frequencyBinCount),o=new Uint8Array(_.frequencyBinCount);b.getByteFrequencyData(f),_.getByteFrequencyData(o);let s=0,n=0;for(let a=0;a<f.length;a+=1)s+=f[a],n+=o[a];const i={inputVolume:(s/f.length/255).toFixed(3),outputVolume:(n/o.length/255).toFixed(3)};q.emit("volume",i)},m=function(f,o,s){if(q=f,!o||!s)return;x?x.resume():x=new p,N?N.resume():N=new p;const n=x.createGain(),i=N.createGain();x.createMediaStreamSource(o).connect(n),N.createMediaStreamSource(s).connect(i),b=x.createAnalyser(),_=N.createAnalyser(),b.fftSize=128,_.fftSize=128,n.connect(b),i.connect(_),t()};U.default=()=>(p=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,{start:m,stop(){G.Logger.info("stopping the requesting frame"),x&&x.suspend(),N&&N.suspend(),S&&window.cancelAnimationFrame(S)}})},"./lib/media/document.ts":function(Se,U,K){Object.defineProperty(U,"__esModule",{value:!0}),U.stopAudio=U.playAudio=U.getDTMFOption=U.setup=U.setupRemoteView=void 0;const G=K("./lib/constants.ts"),q=K("./lib/logger.ts"),x=K("./lib/media/audioDevice.ts"),N={log:q.Logger},S=function(p,b){window.RTCPeerConnection||(N.log.error("No WebRTC support"),document.onreadystatechange=()=>{document.readyState==="complete"&&p.emit("onWebrtcNotSupported")}),p.emit("onMediaPermission",b),b.status==="failure"&&p.userName&&p.callStats&&p.callStats.reportError(null,p.userName,p.callStats.webRTCFunctions.getUserMedia),b.status==="success"&&b.stream&&x.audioDevDictionary.call(p,!0).then(()=>{x.availableDevices().then(_=>{if(navigator.platform===" Win32"||navigator.platform==="Win16"||navigator.platform.toString().toLocaleLowerCase().includes("win")){let t=null,m=null;_.forEach(f=>{f.deviceId==="default"&&f.kind==="audioinput"&&(t=f),f.deviceId==="default"&&f.kind==="audiooutput"&&(m=f)}),N.log.debug(`${G.LOGCAT.CALL} Setting Input device set to default i.e ${JSON.stringify(t)}`),p.audio.microphoneDevices.set("default"),N.log.debug(`${G.LOGCAT.CALL} Setting Output device set to default i.e ${JSON.stringify(m)}`),p.audio.speakerDevices.set("default")}}),N.log.debug(`${G.LOGCAT.LOGIN} UserMedia:audioDevDictionary is updated, onMediaPermission:${b.status}`)}),p.remoteView=document.getElementById(G.REMOTE_VIEW_ID),p.ringToneView=document.getElementById(G.RINGTONE_ELEMENT_ID),p.ringBackToneView=document.getElementById(G.RINGBACK_ELEMENT_ID),p.connectToneView=document.getElementById(G.CONNECT_TONE_ELEMENT_ID)};U.setupRemoteView=()=>{const p=document.createElement("audio");p.id=G.REMOTE_VIEW_ID,p.hidden=!0,p.autoplay=!0,p.width=0,p.height=0,p.setAttribute("data-devicetype","speakerDevice"),document.body.appendChild(p)},U.setup=function(p,b){U.setupRemoteView();const _=document.createElement("audio");_.id=G.CONNECT_TONE_ELEMENT_ID,_.loop="loop",_.src=G.CONNECT_TONE_URL,_.setAttribute("data-devicetype","speakerDevice"),document.body.appendChild(_);const t=document.createElement("audio");t.id=G.RINGBACK_ELEMENT_ID,t.loop="loop",t.src=G.RINGBACK_URL,t.setAttribute("data-devicetype","speakerDevice"),document.body.appendChild(t);const m=document.createElement("audio");m.id=G.RINGTONE_ELEMENT_ID,m.loop="loop",m.src=G.RINGTONE_URL,m.setAttribute("data-devicetype","ringtoneDevice"),document.body.appendChild(m);const f=document.createElement("audio");f.id=G.SILENT_TONE_ELEMENT_ID,f.src=G.SILENT_TONE_URL,f.setAttribute("data-devicetype","silentDevice"),document.body.appendChild(f);const o=function(s){const n=`dtmf${s}`,i="https://cdn.plivo.com/sdk/browser/audio/dtmf-"+s+".mp3",a=document.createElement("audio");a.id=n,a.src=i,a.setAttribute("data-devicetype","speakerDevice"),document.body.appendChild(a)};for(let s=0;s<=9;s+=1)o(s);o("star"),o("pound"),b.permOnClick?(window.localStream=null,S(p,{status:"success",stream:!1})):function(s,n,i){navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:s,video:!1}).then(a=>{window.localStream=a,N.log.debug(`${G.LOGCAT.LOGIN} UserMedia:Access granted for audio`),i(n,{status:"success",stream:!0})}).catch(a=>{N.log.error(`${G.LOGCAT.LOGIN}UserMedia:Access to audio failed - ${a.name}`),i(n,{status:"failure",error:a.name})}):(N.log.error(`${G.LOGCAT.LOGIN} UserMedia:Not available`),i(n,{status:"failure",error:"getUserMedia not supported"}))}(b.audioConstraints,p,(s,n)=>{S(s,n)})},U.getDTMFOption=function(p){let b;return p&&"sendDtmfType"in p?(b=p.sendDtmfType,b=b.map(_=>_.toUpperCase()),b.indexOf("INBAND")!==-1&&b.indexOf("OUTBAND")===-1?"INBAND":b.indexOf("INBAND")===-1&&b.indexOf("OUTBAND")!==-1?"OUTBAND":"DEFAULT"):"DEFAULT"},U.playAudio=function(p,b){try{let _=!1;const t=G.DTMF_TONE_PLAY_RETRY_ATTEMPTS,m=document.getElementById(p);N.log.debug(`${G.LOGCAT.CALL} | Unmuting audio for element: ${p}`),m.muted=!1;let f="";p.includes("dtmf")&&(f=U.getDTMFOption(b==null?void 0:b.options.dtmfOptions),q.Logger.debug(`DTMF Options :  ${f}`)),p.includes("dtmf")&&b&&f.toUpperCase()==="OUTBAND"&&x.mute.call(b),m.currentTime=0;const o=function(n){if(n<=0&&!_)return b&&x.unmute.call(b),void(_=!0);setTimeout(()=>{n>0&&!_&&o(n-1)},100)},s=m.play().then(()=>{N.log.debug(`${G.LOGCAT.CALL} | Audio played for element: ${p}`),p.includes("dtmf")&&f.toUpperCase()==="OUTBAND"?m.onended=()=>{_=!0,b&&x.unmute.call(b)}:p.includes("dtmf")&&N.log.info("sent inband dtmf")});s!==void 0&&s.catch(n=>{N.log.error(`${G.LOGCAT.CALL} | error while playing audio for element: ${p}, err: ${n.name}`)}),p.includes("dtmf")&&f.toUpperCase()==="OUTBAND"&&o(t),N.log.debug(`${G.LOGCAT.CALL} | playAudio - ${p}`)}catch(_){N.log.error(`${G.LOGCAT.CALL} | failed to play audio for elementId ${p} Cause: ${_}`)}},U.stopAudio=function(p){try{N.log.debug(`${G.LOGCAT.CALL} | stopping audio for element - ${p}`);const b=document.getElementById(p);b.pause(),b.muted=!0,N.log.debug(`${G.LOGCAT.CALL} | stopAudio - ${p}`)}catch(b){N.log.error(`${G.LOGCAT.CALL} | failed to stop audio for elementId ${p} Cause: ${b}`)}}},"./lib/rnnoise/NoiseSuppression.ts":function(Se,U,K){var G=this&&this.__createBinding||(Object.create?function(f,o,s,n){n===void 0&&(n=s),Object.defineProperty(f,n,{enumerable:!0,get:function(){return o[s]}})}:function(f,o,s,n){n===void 0&&(n=s),f[n]=o[s]}),q=this&&this.__setModuleDefault||(Object.create?function(f,o){Object.defineProperty(f,"default",{enumerable:!0,value:o})}:function(f,o){f.default=o}),x=this&&this.__importStar||function(f){if(f&&f.__esModule)return f;var o={};if(f!=null)for(var s in f)s!=="default"&&Object.prototype.hasOwnProperty.call(f,s)&&G(o,f,s);return q(o,f),o},N=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(U,"__esModule",{value:!0}),U.NoiseSuppression=void 0;const S=K("./lib/logger.ts"),p=x(K("./lib/constants.ts")),b=K("./lib/rnnoise/NoiseSuppressionEffect.ts"),_=K("./lib/media/audioDevice.ts"),t=N(K("./lib/utils/browserDetection.ts")),m={log:S.Logger};U.NoiseSuppression=class{constructor(f){this.noiseSupressionRunning=!1,this.started=!1,this.initNoiseSuppresionEffect=function(){return new Promise(o=>{this.noiseSuppresionEffect=new b.NoiseSuppressionEffect,this.noiseSuppresionEffect.prepareAudioWorklet(this.client.noiseReductionFilePath).then(()=>{this.client.emit("onNoiseReductionReady"),o()})})},this.startNoiseSuppression=function(o){return new Promise(s=>{this.noiseSupressionRunning?(m.log.info(`${p.LOGCAT.CALL_QUALITY} | Noise Suppression is already running. Cannot start again`),s(window.localStream)):o?this.noiseSuppresionEffect&&this.noiseSuppresionEffect.noiseSuppressorNode&&this.started?(m.log.debug(`${p.LOGCAT.CALL_QUALITY} | Noise Suppression started. Starting effect on current stream`),this.noiseSupressionRunning=!0,this.noiseSuppresionEffect.startEffect(o).then(n=>{window.localStream=n,s(n)})):(m.log.debug(`${p.LOGCAT.CALL_QUALITY} | Noise Suppression is not running, returning mediastream`),window.localStream=o,s(o)):this.setLocalMediaStream().then(n=>{m.log.info(`${p.LOGCAT.CALL_QUALITY} | Fetching new stream to process`),n?this.noiseSuppresionEffect&&this.noiseSuppresionEffect.noiseSuppressorNode&&this.started?(m.log.info(`${p.LOGCAT.CALL_QUALITY} | Noise Suppression started. Starting effect on new stream`),this.noiseSupressionRunning=!0,this.noiseSuppresionEffect.startEffect(n).then(i=>{window.localStream=i,s(i)})):(m.log.info(`${p.LOGCAT.CALL_QUALITY} | Noise Suppression is not running, returning new stream without processing`),s(n)):(m.log.error(`${p.LOGCAT.CALL_QUALITY} | Could not fetch new stream. Returning current localStream`),s(window.localStream))}).catch(n=>{m.log.error(`${p.LOGCAT.CALL_QUALITY} | Error while fetching the new stream ${n}`),s(window.localStream)})})},this.stopNoiseSuppresion=()=>{if(this.noiseSuppresionEffect&&this.noiseSuppresionEffect.noiseSuppressorNode){if(!this.noiseSupressionRunning)return void m.log.debug(`${p.LOGCAT.CALL_QUALITY} | Noise Suppression is already stopped. Cannot stop again`);m.log.debug(`${p.LOGCAT.CALL_QUALITY} | Stopping noise suppression`),this.noiseSupressionRunning=!1,this.noiseSuppresionEffect.stopEffect()}},this.setLocalMediaStream=function(){return new Promise((o,s)=>{window.localStream?(m.log.debug(`${p.LOGCAT.CALL_QUALITY} | Returning current localstream`),o(window.localStream)):navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:this.client.options.audioConstraints,video:!1}).then(n=>{m.log.debug(`${p.LOGCAT.CALL_QUALITY} | Got the new stream from getUserMedia`),window.localStream=n,o(n)}).catch(n=>{m.log.debug(`${p.LOGCAT.CALL_QUALITY} | Error in navigator.getUserMedia ${n}`),s(n)}):(m.log.error(`${p.LOGCAT.CALL_QUALITY} | Usermedia:Not available, Noise suppression will not work`),s(new Error("getUserMedia not available")))})},this.updateProcessingStream=function(o){return new Promise(s=>{this.noiseSuppresionEffect&&(this.noiseSupressionRunning||this.started)?(this.stopNoiseSuppresion(),this.startNoiseSuppression(o).then(n=>{m.log.debug(`${p.LOGCAT.CALL_QUALITY} | Updated stream with a new stream`),window.localStream=n,s(n)})):(m.log.debug(`${p.LOGCAT.CALL_QUALITY} | Noise suppresion not started. Returning current stream`),s(o))})},this.clearNoiseSupression=()=>{this.noiseSuppresionEffect&&(m.log.debug(`${p.LOGCAT.CALL_QUALITY} | Noise suppression cleared`),this.noiseSupressionRunning=!1,this.started=!1,this.noiseSuppresionEffect.clearEffect())},this.muteStream=()=>{this.noiseSuppresionEffect&&this.noiseSupressionRunning&&(m.log.debug(`${p.LOGCAT.CALL_QUALITY} | processed stream muted`),this.noiseSuppresionEffect.muteEffect())},this.unmuteStream=()=>{this.noiseSuppresionEffect&&this.noiseSupressionRunning&&(m.log.debug(`${p.LOGCAT.CALL_QUALITY} | processed stream unmuted`),this.noiseSuppresionEffect.unmuteEffect())},this.startNoiseSuppresionManual=function(){return new Promise((o,s)=>{this.noiseSuppresionEffect&&this.noiseSuppresionEffect.noiseSuppressorNode&&this.client?(m.log.debug(`${p.LOGCAT.CALL_QUALITY} | starting noise suppresion`),this.started?(m.log.info(`${p.LOGCAT.CALL_QUALITY} | noise suppresion already started. Cannot start again`),s(new Error("Noise suprresion is already started"))):(this.started=!0,_.replaceStream(this.client,{audio:this.client.options.audioConstraints,video:!1}).then(()=>{o()}).catch(n=>{s(n)}))):s(new Error('Noise reduction is not instantiated. Please check if "enableNoiseReduction" is passed as true while initializing the SDK'))})},this.stopNoiseSuppressionManual=function(){return new Promise((o,s)=>{this.noiseSuppresionEffect&&this.noiseSuppresionEffect.noiseSuppressorNode&&this.client?(m.log.debug(`${p.LOGCAT.CALL_QUALITY} | stopping noise suppresion`),this.started?(this.started=!1,_.replaceStream(this.client,{audio:this.client.options.audioConstraints,video:!1}).then(()=>{o()}).catch(n=>{s(n)})):(m.log.debug(`${p.LOGCAT.CALL_QUALITY} | noise suppresion already stopped. Cannot stop again`),s(new Error("Noise suprresion is already stopped")))):s(new Error('Noise reduction is not instantiated. Please check if "enableNoiseReduction" is passed as true while initializing the SDK'))})},this.client=f,f.enableNoiseReduction&&!this.noiseSuppresionEffect&&t.default().browser!=="safari"&&(m.log.info(`${p.LOGCAT.CALL_QUALITY} | Noise Suppression instance created`),this.initNoiseSuppresionEffect())}}},"./lib/rnnoise/NoiseSuppressionEffect.ts":function(Se,U,K){var G=this&&this.__createBinding||(Object.create?function(_,t,m,f){f===void 0&&(f=m),Object.defineProperty(_,f,{enumerable:!0,get:function(){return t[m]}})}:function(_,t,m,f){f===void 0&&(f=m),_[f]=t[m]}),q=this&&this.__setModuleDefault||(Object.create?function(_,t){Object.defineProperty(_,"default",{enumerable:!0,value:t})}:function(_,t){_.default=t}),x=this&&this.__importStar||function(_){if(_&&_.__esModule)return _;var t={};if(_!=null)for(var m in _)m!=="default"&&Object.prototype.hasOwnProperty.call(_,m)&&G(t,_,m);return q(t,_),t};Object.defineProperty(U,"__esModule",{value:!0}),U.getBaseUrl=U.NoiseSuppressionEffect=void 0;const N=K("./lib/logger.ts"),S=x(K("./lib/constants.ts")),p={log:N.Logger};function b(_,t,m){return new Promise(f=>{try{p.log.debug(`${S.LOGCAT.LOGIN} | Noise suppresion file path is: ${t}`),_.audioWorklet.addModule(t||"https://cdn.plivo.com/sdk/browser/processor.js").then(()=>{p.log.debug(`${S.LOGCAT.CALL_QUALITY} | audioWorklet setup is completed`),f(new AudioWorkletNode(_,"NoiseSuppressorWorklet-ts"))}).catch(o=>{p.log.debug(`${S.LOGCAT.LOGIN} | Error while loading audio worklet: ${o} `),t&&m===0&&(p.log.debug(`${S.LOGCAT.LOGIN} | Could not add file from path: ${t}. Fetching the file from plivo cdn`),f(b(_,"https://cdn.plivo.com/sdk/browser/processor.js",1)))})}catch(o){p.log.error(`${S.LOGCAT.CALL_QUALITY} | Error while initializing noise suppression effect ${o}`),f(void 0)}})}U.NoiseSuppressionEffect=class{constructor(){this.prepareAudioWorklet=function(_){return new Promise(t=>{const m=()=>{b(this.audioContext,_,0).then(f=>{f?(this.noiseSuppressorNode=f,t(this.noiseSuppressorNode)):t(void 0)})};this.audioContext?(p.log.debug(`${S.LOGCAT.CALL_QUALITY} | AudioContext instance already created. Resuming it.`),this.audioContext.resume().then(()=>{m()})):(p.log.debug(`${S.LOGCAT.CALL_QUALITY} | Creating new instance of AudioContext`),this.audioContext=new AudioContext,m())})}}startEffect(_){return new Promise(t=>{try{this.audioContext.resume().then(()=>{this.originalMediaTrack=_.getAudioTracks()[0],this.audioSource=this.audioContext.createMediaStreamSource(_),this.audioDestination=this.audioContext.createMediaStreamDestination(),this.outputMediaTrack=this.audioDestination.stream.getAudioTracks()[0],this.noiseSuppressorNode&&this.audioSource&&this.audioDestination&&(this.audioSource.connect(this.noiseSuppressorNode),this.noiseSuppressorNode.connect(this.audioDestination)),this.outputMediaTrack.enabled=this.originalMediaTrack.enabled,this.originalMediaTrack.enabled=!0,t(this.audioDestination.stream)})}catch(m){p.log.error(`${S.LOGCAT.CALL_QUALITY} | Error while starting noise suppression effect ${m}`),t(_)}})}stopEffect(){var _,t;try{this.originalMediaTrack&&this.outputMediaTrack&&(this.originalMediaTrack.enabled=this.outputMediaTrack.enabled),(_=this.audioDestination)===null||_===void 0||_.disconnect(),(t=this.audioSource)===null||t===void 0||t.disconnect()}catch(m){p.log.error(`${S.LOGCAT.CALL_QUALITY} | Error while stopping noise suppression effect ${m}`)}}muteEffect(){try{this.noiseSuppressorNode&&this.audioSource&&this.audioDestination&&(this.audioSource.disconnect(this.noiseSuppressorNode),this.noiseSuppressorNode.disconnect(this.audioDestination))}catch(_){p.log.error(`${S.LOGCAT.CALL_QUALITY} | Error while mute in noise suppression effect ${_}`)}}unmuteEffect(){try{this.noiseSuppressorNode&&this.audioSource&&this.audioDestination&&(this.audioSource.connect(this.noiseSuppressorNode),this.noiseSuppressorNode.connect(this.audioDestination))}catch(_){p.log.error(`${S.LOGCAT.CALL_QUALITY} | Error while unmute in noise suppression effect ${_}`)}}clearEffect(){var _,t,m,f,o;try{this.originalMediaTrack&&this.outputMediaTrack&&(this.originalMediaTrack.enabled=this.outputMediaTrack.enabled),(t=(_=this.noiseSuppressorNode)===null||_===void 0?void 0:_.port)===null||t===void 0||t.close(),(m=this.audioDestination)===null||m===void 0||m.disconnect(),(f=this.noiseSuppressorNode)===null||f===void 0||f.disconnect(),(o=this.audioSource)===null||o===void 0||o.disconnect(),this.audioContext.suspend()}catch(s){p.log.error(`${S.LOGCAT.CALL_QUALITY} | Error while clearing noise suppression effect ${s}`)}}},U.getBaseUrl=function(_=window){const t=_.document.querySelector("base");if(t!=null&&t.href)return t.href;const{protocol:m,host:f}=_.location;return`${m}//${f}`}},"./lib/stats/callstatsio.js":function(Se,U,K){(function(G){var q,x,N;(function S(p,b,_){function t(o,s){if(!b[o]){if(!p[o]){if(m)return m(o,!0);var n=new Error("Cannot find module '"+o+"'");throw n.code="MODULE_NOT_FOUND",n}var i=b[o]={exports:{}};p[o][0].call(i.exports,function(a){return t(p[o][1][a]||a)},i,i.exports,S,p,b,_)}return b[o].exports}for(var m=!1,f=0;f<_.length;f++)t(_[f]);return t})({1:[function(S,p,b){(function(_,t,m){(function(f){typeof b=="object"&&p!==void 0?p.exports=f():(x=[],(N=typeof(q=f)=="function"?q.apply(U,x):q)===void 0||(Se.exports=N))})(function(){return function f(o,s,n){function i(u,g){if(!s[u]){if(!o[u]){var h=typeof _dereq_=="function"&&_dereq_;if(!g&&h)return h(u,!0);if(a)return a(u,!0);var C=new Error("Cannot find module '"+u+"'");throw C.code="MODULE_NOT_FOUND",C}var E=s[u]={exports:{}};o[u][0].call(E.exports,function(y){return i(o[u][1][y]||y)},E,E.exports,f,o,s,n)}return s[u].exports}for(var a=typeof _dereq_=="function"&&_dereq_,c=0;c<n.length;c++)i(n[c]);return i}({1:[function(f,o,s){o.exports=function(n){function i(c){var u=new a(c),g=u.promise();return u.setHowMany(1),u.setUnwrap(),u.init(),g}var a=n._SomePromiseArray;n.any=function(c){return i(c)},n.prototype.any=function(){return i(this)}}},{}],2:[function(f,o,s){function n(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new h(16),this._normalQueue=new h(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var E=this;this.drainQueues=function(){E._drainQueues()},this._schedule=g}function i(E,y,w){this._lateQueue.push(E,y,w),this._queueTick()}function a(E,y,w){this._normalQueue.push(E,y,w),this._queueTick()}function c(E){this._normalQueue._pushOne(E),this._queueTick()}var u;try{throw new Error}catch(E){u=E}var g=f("./schedule"),h=f("./queue"),C=f("./util");n.prototype.setScheduler=function(E){var y=this._schedule;return this._schedule=E,this._customScheduler=!0,y},n.prototype.hasCustomScheduler=function(){return this._customScheduler},n.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},n.prototype.disableTrampolineIfNecessary=function(){C.hasDevTools&&(this._trampolineEnabled=!1)},n.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},n.prototype.fatalError=function(E,y){y?(_.stderr.write("Fatal "+(E instanceof Error?E.stack:E)+`
`),_.exit(2)):this.throwLater(E)},n.prototype.throwLater=function(E,y){if(arguments.length===1&&(y=E,E=function(){throw y}),typeof setTimeout<"u")setTimeout(function(){E(y)},0);else try{this._schedule(function(){E(y)})}catch{throw new Error(`No async scheduler available

    See http://goo.gl/MqrFmX
`)}},C.hasDevTools?(n.prototype.invokeLater=function(E,y,w){this._trampolineEnabled?i.call(this,E,y,w):this._schedule(function(){setTimeout(function(){E.call(y,w)},100)})},n.prototype.invoke=function(E,y,w){this._trampolineEnabled?a.call(this,E,y,w):this._schedule(function(){E.call(y,w)})},n.prototype.settlePromises=function(E){this._trampolineEnabled?c.call(this,E):this._schedule(function(){E._settlePromises()})}):(n.prototype.invokeLater=i,n.prototype.invoke=a,n.prototype.settlePromises=c),n.prototype._drainQueue=function(E){for(;E.length()>0;){var y=E.shift();if(typeof y=="function"){var w=E.shift(),O=E.shift();y.call(w,O)}else y._settlePromises()}},n.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},n.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},n.prototype._reset=function(){this._isTickUsed=!1},o.exports=n,o.exports.firstLineError=u},{"./queue":26,"./schedule":29,"./util":36}],3:[function(f,o,s){o.exports=function(n,i,a,c){var u=!1,g=function(y,w){this._reject(w)},h=function(y,w){w.promiseRejectionQueued=!0,w.bindingPromise._then(g,g,null,this,y)},C=function(y,w){(50397184&this._bitField)==0&&this._resolveCallback(w.target)},E=function(y,w){w.promiseRejectionQueued||this._reject(y)};n.prototype.bind=function(y){u||(u=!0,n.prototype._propagateFrom=c.propagateFromFunction(),n.prototype._boundValue=c.boundValueFunction());var w=a(y),O=new n(i);O._propagateFrom(this,1);var L=this._target();if(O._setBoundTo(w),w instanceof n){var I={promiseRejectionQueued:!1,promise:O,target:L,bindingPromise:w};L._then(i,h,void 0,O,I),w._then(C,E,void 0,O,I),O._setOnCancel(w)}else O._resolveCallback(L);return O},n.prototype._setBoundTo=function(y){y!==void 0?(this._bitField=2097152|this._bitField,this._boundTo=y):this._bitField=-2097153&this._bitField},n.prototype._isBound=function(){return(2097152&this._bitField)==2097152},n.bind=function(y,w){return n.resolve(w).bind(y)}}},{}],4:[function(f,o,s){var n;typeof Promise<"u"&&(n=Promise);var i=f("./promise")();i.noConflict=function(){try{Promise===i&&(Promise=n)}catch{}return i},o.exports=i},{"./promise":22}],5:[function(f,o,s){var n=Object.create;if(n){var i=n(null),a=n(null);i[" size"]=a[" size"]=0}o.exports=function(c){function u(y){return function(w,O){var L;if(w!=null&&(L=w[O]),typeof L!="function"){var I="Object "+C.classString(w)+" has no method '"+C.toString(O)+"'";throw new c.TypeError(I)}return L}(y,this.pop()).apply(y,this)}function g(y){return y[this]}function h(y){var w=+this;return w<0&&(w=Math.max(0,w+y.length)),y[w]}var C=f("./util"),E=C.canEvaluate;C.isIdentifier,c.prototype.call=function(y){var w=[].slice.call(arguments,1);return w.push(y),this._then(u,void 0,void 0,w,void 0)},c.prototype.get=function(y){var w;if(typeof y=="number")w=h;else if(E){var O=(void 0)(y);w=O!==null?O:g}else w=g;return this._then(w,void 0,void 0,y,void 0)}}},{"./util":36}],6:[function(f,o,s){o.exports=function(n,i,a,c){var u=f("./util"),g=u.tryCatch,h=u.errorObj,C=n._async;n.prototype.break=n.prototype.cancel=function(){if(!c.cancellation())return this._warn("cancellation is disabled");for(var E=this,y=E;E._isCancellable();){if(!E._cancelBy(y)){y._isFollowing()?y._followee().cancel():y._cancelBranched();break}var w=E._cancellationParent;if(w==null||!w._isCancellable()){E._isFollowing()?E._followee().cancel():E._cancelBranched();break}E._isFollowing()&&E._followee().cancel(),E._setWillBeCancelled(),y=E,E=w}},n.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},n.prototype._enoughBranchesHaveCancelled=function(){return this._branchesRemainingToCancel===void 0||this._branchesRemainingToCancel<=0},n.prototype._cancelBy=function(E){return E===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},n.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},n.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),C.invoke(this._cancelPromises,this,void 0))},n.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},n.prototype._unsetOnCancel=function(){this._onCancelField=void 0},n.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},n.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},n.prototype._doInvokeOnCancel=function(E,y){if(u.isArray(E))for(var w=0;w<E.length;++w)this._doInvokeOnCancel(E[w],y);else if(E!==void 0)if(typeof E=="function"){if(!y){var O=g(E).call(this._boundValue());O===h&&(this._attachExtraTrace(O.e),C.throwLater(O.e))}}else E._resultCancelled(this)},n.prototype._invokeOnCancel=function(){var E=this._onCancel();this._unsetOnCancel(),C.invoke(this._doInvokeOnCancel,this,E)},n.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},n.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(f,o,s){o.exports=function(n){var i=f("./util"),a=f("./es5").keys,c=i.tryCatch,u=i.errorObj;return function(g,h,C){return function(E){var y=C._boundValue();e:for(var w=0;w<g.length;++w){var O=g[w];if(O===Error||O!=null&&O.prototype instanceof Error){if(E instanceof O)return c(h).call(y,E)}else if(typeof O=="function"){var L=c(O).call(y,E);if(L===u)return L;if(L)return c(h).call(y,E)}else if(i.isObject(E)){for(var I=a(O),k=0;k<I.length;++k){var P=I[k];if(O[P]!=E[P])continue e}return c(h).call(y,E)}}return n}}}},{"./es5":13,"./util":36}],8:[function(f,o,s){o.exports=function(n){function i(){this._trace=new i.CapturedTrace(a())}function a(){var g=u.length-1;if(g>=0)return u[g]}var c=!1,u=[];return n.prototype._promiseCreated=function(){},n.prototype._pushContext=function(){},n.prototype._popContext=function(){return null},n._peekContext=n.prototype._peekContext=function(){},i.prototype._pushContext=function(){this._trace!==void 0&&(this._trace._promiseCreated=null,u.push(this._trace))},i.prototype._popContext=function(){if(this._trace!==void 0){var g=u.pop(),h=g._promiseCreated;return g._promiseCreated=null,h}return null},i.CapturedTrace=null,i.create=function(){if(c)return new i},i.deactivateLongStackTraces=function(){},i.activateLongStackTraces=function(){var g=n.prototype._pushContext,h=n.prototype._popContext,C=n._peekContext,E=n.prototype._peekContext,y=n.prototype._promiseCreated;i.deactivateLongStackTraces=function(){n.prototype._pushContext=g,n.prototype._popContext=h,n._peekContext=C,n.prototype._peekContext=E,n.prototype._promiseCreated=y,c=!1},c=!0,n.prototype._pushContext=i.prototype._pushContext,n.prototype._popContext=i.prototype._popContext,n._peekContext=n.prototype._peekContext=a,n.prototype._promiseCreated=function(){var w=this._peekContext();w&&w._promiseCreated==null&&(w._promiseCreated=this)}},i}},{}],9:[function(f,o,s){o.exports=function(n,i){function a(fe,ge){return{promise:ge}}function c(){return!1}function u(fe,ge,Ae){var Ie=this;try{fe(ge,Ae,function(Ne){if(typeof Ne!="function")throw new TypeError("onCancel must be a function, got: "+pe.toString(Ne));Ie._attachCancellationCallback(Ne)})}catch(Ne){return Ne}}function g(fe){if(!this._isCancellable())return this;var ge=this._onCancel();ge!==void 0?pe.isArray(ge)?ge.push(fe):this._setOnCancel([ge,fe]):this._setOnCancel(fe)}function h(){return this._onCancelField}function C(fe){this._onCancelField=fe}function E(){this._cancellationParent=void 0,this._onCancelField=void 0}function y(fe,ge){if((1&ge)!=0){this._cancellationParent=fe;var Ae=fe._branchesRemainingToCancel;Ae===void 0&&(Ae=0),fe._branchesRemainingToCancel=Ae+1}(2&ge)!=0&&fe._isBound()&&this._setBoundTo(fe._boundTo)}function w(){var fe=this._boundTo;return fe!==void 0&&fe instanceof n?fe.isFulfilled()?fe.value():void 0:fe}function O(){this._trace=new V(this._peekContext())}function L(fe,ge){if(Oe(fe)){var Ae=this._trace;if(Ae!==void 0&&ge&&(Ae=Ae._parent),Ae!==void 0)Ae.attachExtraTrace(fe);else if(!fe.__stackCleaned__){var Ie=P(fe);pe.notEnumerableProp(fe,"stack",Ie.message+`
`+Ie.stack.join(`
`)),pe.notEnumerableProp(fe,"__stackCleaned__",!0)}}}function I(fe,ge,Ae){if(at.warnings){var Ie,Ne=new Re(fe);if(ge)Ae._attachExtraTrace(Ne);else if(at.longStackTraces&&(Ie=n._peekContext()))Ie.attachExtraTrace(Ne);else{var Pe=P(Ne);Ne.stack=Pe.message+`
`+Pe.stack.join(`
`)}bn("warning",Ne)||F(Ne,"",!0)}}function k(fe){for(var ge=[],Ae=0;Ae<fe.length;++Ae){var Ie=fe[Ae],Ne=Ie==="    (No stack trace)"||we.test(Ie),Pe=Ne&&gn(Ie);Ne&&!Pe&&(De&&Ie.charAt(0)!==" "&&(Ie="    "+Ie),ge.push(Ie))}return ge}function P(fe){var ge=fe.stack,Ae=fe.toString();return ge=typeof ge=="string"&&ge.length>0?function(Ie){for(var Ne=Ie.stack.replace(/\s+$/g,"").split(`
`),Pe=0;Pe<Ne.length;++Pe){var me=Ne[Pe];if(me==="    (No stack trace)"||we.test(me))break}return Pe>0&&Ie.name!="SyntaxError"&&(Ne=Ne.slice(Pe)),Ne}(fe):["    (No stack trace)"],{message:Ae,stack:fe.name=="SyntaxError"?ge:k(ge)}}function F(fe,ge,Ae){if(typeof console<"u"){var Ie;if(pe.isObject(fe)){var Ne=fe.stack;Ie=ge+Ee(Ne,fe)}else Ie=ge+String(fe);typeof J=="function"?J(Ie,Ae):typeof console.log!="function"&&typeof console.log!="object"||console.log(Ie)}}function H(fe,ge,Ae,Ie){var Ne=!1;try{typeof ge=="function"&&(Ne=!0,fe==="rejectionHandled"?ge(Ie):ge(Ae,Ie))}catch(Pe){ce.throwLater(Pe)}fe==="unhandledRejection"?bn(fe,Ae,Ie)||Ne||F(Ae,"Unhandled rejection "):bn(fe,Ie)}function D(fe){var ge;if(typeof fe=="function")ge="[function "+(fe.name||"anonymous")+"]";else{if(ge=fe&&typeof fe.toString=="function"?fe.toString():pe.toString(fe),/\[object [a-zA-Z0-9$_]+\]/.test(ge))try{ge=JSON.stringify(fe)}catch{}ge.length===0&&(ge="(empty array)")}return"(<"+function(Ae){return Ae.length<41?Ae:Ae.substr(0,38)+"..."}(ge)+">, no stack trace)"}function $(){return typeof nr=="function"}function j(fe){var ge=fe.match($r);if(ge)return{fileName:ge[1],line:parseInt(ge[2],10)}}function V(fe){this._parent=fe,this._promisesCreated=0;var ge=this._length=1+(fe===void 0?0:fe._length);nr(this,V),ge>32&&this.uncycle()}var Y,Z,J,re=n._getDomain,ce=n._async,Re=f("./errors").Warning,pe=f("./util"),Oe=pe.canAttachTrace,te=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,oe=/\((?:timers\.js):\d+:\d+\)/,_e=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,we=null,Ee=null,De=!1,Fe=pe.env("BLUEBIRD_DEBUG")!=0,xe=!(pe.env("BLUEBIRD_WARNINGS")==0||!Fe&&!pe.env("BLUEBIRD_WARNINGS")),et=!(pe.env("BLUEBIRD_LONG_STACK_TRACES")==0||!Fe&&!pe.env("BLUEBIRD_LONG_STACK_TRACES")),tt=pe.env("BLUEBIRD_W_FORGOTTEN_RETURN")!=0&&(xe||!!pe.env("BLUEBIRD_W_FORGOTTEN_RETURN"));n.prototype.suppressUnhandledRejections=function(){var fe=this._target();fe._bitField=-1048577&fe._bitField|524288},n.prototype._ensurePossibleRejectionHandled=function(){if((524288&this._bitField)==0){this._setRejectionIsUnhandled();var fe=this;setTimeout(function(){fe._notifyUnhandledRejection()},1)}},n.prototype._notifyUnhandledRejectionIsHandled=function(){H("rejectionHandled",Y,void 0,this)},n.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},n.prototype._returnedNonUndefined=function(){return(268435456&this._bitField)!=0},n.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var fe=this._settledValue();this._setUnhandledRejectionIsNotified(),H("unhandledRejection",Z,fe,this)}},n.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},n.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},n.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},n.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},n.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},n.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},n.prototype._warn=function(fe,ge,Ae){return I(fe,ge,Ae||this)},n.onPossiblyUnhandledRejection=function(fe){var ge=re();Z=typeof fe=="function"?ge===null?fe:pe.domainBind(ge,fe):void 0},n.onUnhandledRejectionHandled=function(fe){var ge=re();Y=typeof fe=="function"?ge===null?fe:pe.domainBind(ge,fe):void 0};var nt=function(){};n.longStackTraces=function(){if(ce.haveItemsQueued()&&!at.longStackTraces)throw new Error(`cannot enable long stack traces after promises have been created

    See http://goo.gl/MqrFmX
`);if(!at.longStackTraces&&$()){var fe=n.prototype._captureStackTrace,ge=n.prototype._attachExtraTrace;at.longStackTraces=!0,nt=function(){if(ce.haveItemsQueued()&&!at.longStackTraces)throw new Error(`cannot enable long stack traces after promises have been created

    See http://goo.gl/MqrFmX
`);n.prototype._captureStackTrace=fe,n.prototype._attachExtraTrace=ge,i.deactivateLongStackTraces(),ce.enableTrampoline(),at.longStackTraces=!1},n.prototype._captureStackTrace=O,n.prototype._attachExtraTrace=L,i.activateLongStackTraces(),ce.disableTrampolineIfNecessary()}},n.hasLongStackTraces=function(){return at.longStackTraces&&$()};var Dt=function(){try{if(typeof CustomEvent=="function"){var fe=new CustomEvent("CustomEvent");return pe.global.dispatchEvent(fe),function(ge,Ae){var Ie=new CustomEvent(ge.toLowerCase(),{detail:Ae,cancelable:!0});return!pe.global.dispatchEvent(Ie)}}return typeof Event=="function"?(fe=new Event("CustomEvent"),pe.global.dispatchEvent(fe),function(ge,Ae){var Ie=new Event(ge.toLowerCase(),{cancelable:!0});return Ie.detail=Ae,!pe.global.dispatchEvent(Ie)}):((fe=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),pe.global.dispatchEvent(fe),function(ge,Ae){var Ie=document.createEvent("CustomEvent");return Ie.initCustomEvent(ge.toLowerCase(),!1,!0,Ae),!pe.global.dispatchEvent(Ie)})}catch{}return function(){return!1}}(),St=pe.isNode?function(){return _.emit.apply(_,arguments)}:pe.global?function(fe){var ge="on"+fe.toLowerCase(),Ae=pe.global[ge];return!!Ae&&(Ae.apply(pe.global,[].slice.call(arguments,1)),!0)}:function(){return!1},_i={promiseCreated:a,promiseFulfilled:a,promiseRejected:a,promiseResolved:a,promiseCancelled:a,promiseChained:function(fe,ge,Ae){return{promise:ge,child:Ae}},warning:function(fe,ge){return{warning:ge}},unhandledRejection:function(fe,ge,Ae){return{reason:ge,promise:Ae}},rejectionHandled:a},bn=function(fe){var ge=!1;try{ge=St.apply(null,arguments)}catch(Ie){ce.throwLater(Ie),ge=!0}var Ae=!1;try{Ae=Dt(fe,_i[fe].apply(null,arguments))}catch(Ie){ce.throwLater(Ie),Ae=!0}return Ae||ge};n.config=function(fe){if("longStackTraces"in(fe=Object(fe))&&(fe.longStackTraces?n.longStackTraces():!fe.longStackTraces&&n.hasLongStackTraces()&&nt()),"warnings"in fe){var ge=fe.warnings;at.warnings=!!ge,tt=at.warnings,pe.isObject(ge)&&"wForgottenReturn"in ge&&(tt=!!ge.wForgottenReturn)}if("cancellation"in fe&&fe.cancellation&&!at.cancellation){if(ce.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");n.prototype._clearCancellationData=E,n.prototype._propagateFrom=y,n.prototype._onCancel=h,n.prototype._setOnCancel=C,n.prototype._attachCancellationCallback=g,n.prototype._execute=u,Tn=y,at.cancellation=!0}return"monitoring"in fe&&(fe.monitoring&&!at.monitoring?(at.monitoring=!0,n.prototype._fireEvent=bn):!fe.monitoring&&at.monitoring&&(at.monitoring=!1,n.prototype._fireEvent=c)),n},n.prototype._fireEvent=c,n.prototype._execute=function(fe,ge,Ae){try{fe(ge,Ae)}catch(Ie){return Ie}},n.prototype._onCancel=function(){},n.prototype._setOnCancel=function(fe){},n.prototype._attachCancellationCallback=function(fe){},n.prototype._captureStackTrace=function(){},n.prototype._attachExtraTrace=function(){},n.prototype._clearCancellationData=function(){},n.prototype._propagateFrom=function(fe,ge){};var Tn=function(fe,ge){(2&ge)!=0&&fe._isBound()&&this._setBoundTo(fe._boundTo)},gn=function(){return!1},$r=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;pe.inherits(V,Error),i.CapturedTrace=V,V.prototype.uncycle=function(){var fe=this._length;if(!(fe<2)){for(var ge=[],Ae={},Ie=0,Ne=this;Ne!==void 0;++Ie)ge.push(Ne),Ne=Ne._parent;for(Ie=(fe=this._length=Ie)-1;Ie>=0;--Ie){var Pe=ge[Ie].stack;Ae[Pe]===void 0&&(Ae[Pe]=Ie)}for(Ie=0;Ie<fe;++Ie){var me=Ae[ge[Ie].stack];if(me!==void 0&&me!==Ie){me>0&&(ge[me-1]._parent=void 0,ge[me-1]._length=1),ge[Ie]._parent=void 0,ge[Ie]._length=1;var $e=Ie>0?ge[Ie-1]:this;me<fe-1?($e._parent=ge[me+1],$e._parent.uncycle(),$e._length=$e._parent._length+1):($e._parent=void 0,$e._length=1);for(var rt=$e._length+1,Qe=Ie-2;Qe>=0;--Qe)ge[Qe]._length=rt,rt++;return}}}},V.prototype.attachExtraTrace=function(fe){if(!fe.__stackCleaned__){this.uncycle();for(var ge=P(fe),Ae=ge.message,Ie=[ge.stack],Ne=this;Ne!==void 0;)Ie.push(k(Ne.stack.split(`
`))),Ne=Ne._parent;(function(Pe){for(var me=Pe[0],$e=1;$e<Pe.length;++$e){for(var rt=Pe[$e],Qe=me.length-1,Gt=me[Qe],ft=-1,Et=rt.length-1;Et>=0;--Et)if(rt[Et]===Gt){ft=Et;break}for(Et=ft;Et>=0;--Et){var Jt=rt[Et];if(me[Qe]!==Jt)break;me.pop(),Qe--}me=rt}})(Ie),function(Pe){for(var me=0;me<Pe.length;++me)(Pe[me].length===0||me+1<Pe.length&&Pe[me][0]===Pe[me+1][0])&&(Pe.splice(me,1),me--)}(Ie),pe.notEnumerableProp(fe,"stack",function(Pe,me){for(var $e=0;$e<me.length-1;++$e)me[$e].push("From previous event:"),me[$e]=me[$e].join(`
`);return $e<me.length&&(me[$e]=me[$e].join(`
`)),Pe+`
`+me.join(`
`)}(Ae,Ie)),pe.notEnumerableProp(fe,"__stackCleaned__",!0)}};var nr=function(){var fe=/^\s*at\s*/,ge=function(Pe,me){return typeof Pe=="string"?Pe:me.name!==void 0&&me.message!==void 0?me.toString():D(me)};if(typeof Error.stackTraceLimit=="number"&&typeof Error.captureStackTrace=="function"){Error.stackTraceLimit+=6,we=fe,Ee=ge;var Ae=Error.captureStackTrace;return gn=function(Pe){return te.test(Pe)},function(Pe,me){Error.stackTraceLimit+=6,Ae(Pe,me),Error.stackTraceLimit-=6}}var Ie,Ne=new Error;if(typeof Ne.stack=="string"&&Ne.stack.split(`
`)[0].indexOf("stackDetection@")>=0)return we=/@/,Ee=ge,De=!0,function(Pe){Pe.stack=new Error().stack};try{throw new Error}catch(Pe){Ie="stack"in Pe}return"stack"in Ne||!Ie||typeof Error.stackTraceLimit!="number"?(Ee=function(Pe,me){return typeof Pe=="string"?Pe:typeof me!="object"&&typeof me!="function"||me.name===void 0||me.message===void 0?D(me):me.toString()},null):(we=fe,Ee=ge,function(Pe){Error.stackTraceLimit+=6;try{throw new Error}catch(me){Pe.stack=me.stack}Error.stackTraceLimit-=6})}();typeof console<"u"&&console.warn!==void 0&&(J=function(fe){console.warn(fe)},pe.isNode&&_.stderr.isTTY?J=function(fe,ge){var Ae=ge?"\x1B[33m":"\x1B[31m";console.warn(Ae+fe+`\x1B[0m
`)}:pe.isNode||typeof new Error().stack!="string"||(J=function(fe,ge){console.warn("%c"+fe,ge?"color: darkorange":"color: red")}));var at={warnings:xe,longStackTraces:!1,cancellation:!1,monitoring:!1};return et&&n.longStackTraces(),{longStackTraces:function(){return at.longStackTraces},warnings:function(){return at.warnings},cancellation:function(){return at.cancellation},monitoring:function(){return at.monitoring},propagateFromFunction:function(){return Tn},boundValueFunction:function(){return w},checkForgottenReturns:function(fe,ge,Ae,Ie,Ne){if(fe===void 0&&ge!==null&&tt){if(Ne!==void 0&&Ne._returnedNonUndefined()||(65535&Ie._bitField)==0)return;Ae&&(Ae+=" ");var Pe="",me="";if(ge._trace){for(var $e=ge._trace.stack.split(`
`),rt=k($e),Qe=rt.length-1;Qe>=0;--Qe){var Gt=rt[Qe];if(!oe.test(Gt)){var ft=Gt.match(_e);ft&&(Pe="at "+ft[1]+":"+ft[2]+":"+ft[3]+" ");break}}if(rt.length>0){var Et=rt[0];for(Qe=0;Qe<$e.length;++Qe)if($e[Qe]===Et){Qe>0&&(me=`
`+$e[Qe-1]);break}}}var Jt="a promise was created in a "+Ae+"handler "+Pe+"but was not returned from it, see http://goo.gl/rRqMUw"+me;Ie._warn(Jt,!0,ge)}},setBounds:function(fe,ge){if($()){for(var Ae,Ie,Ne=fe.stack.split(`
`),Pe=ge.stack.split(`
`),me=-1,$e=-1,rt=0;rt<Ne.length;++rt)if(Qe=j(Ne[rt])){Ae=Qe.fileName,me=Qe.line;break}for(rt=0;rt<Pe.length;++rt){var Qe;if(Qe=j(Pe[rt])){Ie=Qe.fileName,$e=Qe.line;break}}me<0||$e<0||!Ae||!Ie||Ae!==Ie||me>=$e||(gn=function(Gt){if(te.test(Gt))return!0;var ft=j(Gt);return!!(ft&&ft.fileName===Ae&&me<=ft.line&&ft.line<=$e)})}},warn:I,deprecated:function(fe,ge){var Ae=fe+" is deprecated and will be removed in a future version.";return ge&&(Ae+=" Use "+ge+" instead."),I(Ae)},CapturedTrace:V,fireDomEvent:Dt,fireGlobalEvent:St}}},{"./errors":12,"./util":36}],10:[function(f,o,s){o.exports=function(n){function i(){return this.value}function a(){throw this.reason}n.prototype.return=n.prototype.thenReturn=function(c){return c instanceof n&&c.suppressUnhandledRejections(),this._then(i,void 0,void 0,{value:c},void 0)},n.prototype.throw=n.prototype.thenThrow=function(c){return this._then(a,void 0,void 0,{reason:c},void 0)},n.prototype.catchThrow=function(c){if(arguments.length<=1)return this._then(void 0,a,void 0,{reason:c},void 0);var u=arguments[1],g=function(){throw u};return this.caught(c,g)},n.prototype.catchReturn=function(c){if(arguments.length<=1)return c instanceof n&&c.suppressUnhandledRejections(),this._then(void 0,i,void 0,{value:c},void 0);var u=arguments[1];u instanceof n&&u.suppressUnhandledRejections();var g=function(){return u};return this.caught(c,g)}}},{}],11:[function(f,o,s){o.exports=function(n,i){function a(){return u(this)}var c=n.reduce,u=n.all;n.prototype.each=function(g){return c(this,g,i,0)._then(a,void 0,void 0,this,void 0)},n.prototype.mapSeries=function(g){return c(this,g,i,i)},n.each=function(g,h){return c(g,h,i,0)._then(a,void 0,void 0,g,void 0)},n.mapSeries=function(g,h){return c(g,h,i,i)}}},{}],12:[function(f,o,s){function n(H,D){function $(j){if(!(this instanceof $))return new $(j);E(this,"message",typeof j=="string"?j:D),E(this,"name",H),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return C($,Error),$}function i(H){if(!(this instanceof i))return new i(H);E(this,"name","OperationalError"),E(this,"message",H),this.cause=H,this.isOperational=!0,H instanceof Error?(E(this,"message",H.message),E(this,"stack",H.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var a,c,u=f("./es5"),g=u.freeze,h=f("./util"),C=h.inherits,E=h.notEnumerableProp,y=n("Warning","warning"),w=n("CancellationError","cancellation error"),O=n("TimeoutError","timeout error"),L=n("AggregateError","aggregate error");try{a=TypeError,c=RangeError}catch{a=n("TypeError","type error"),c=n("RangeError","range error")}for(var I="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),k=0;k<I.length;++k)typeof Array.prototype[I[k]]=="function"&&(L.prototype[I[k]]=Array.prototype[I[k]]);u.defineProperty(L.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),L.prototype.isOperational=!0;var P=0;L.prototype.toString=function(){var H=Array(4*P+1).join(" "),D=`
`+H+`AggregateError of:
`;P++,H=Array(4*P+1).join(" ");for(var $=0;$<this.length;++$){for(var j=this[$]===this?"[Circular AggregateError]":this[$]+"",V=j.split(`
`),Y=0;Y<V.length;++Y)V[Y]=H+V[Y];D+=(j=V.join(`
`))+`
`}return P--,D},C(i,Error);var F=Error.__BluebirdErrorTypes__;F||(F=g({CancellationError:w,TimeoutError:O,OperationalError:i,RejectionError:i,AggregateError:L}),u.defineProperty(Error,"__BluebirdErrorTypes__",{value:F,writable:!1,enumerable:!1,configurable:!1})),o.exports={Error,TypeError:a,RangeError:c,CancellationError:F.CancellationError,OperationalError:F.OperationalError,TimeoutError:F.TimeoutError,AggregateError:F.AggregateError,Warning:y}},{"./es5":13,"./util":36}],13:[function(f,o,s){var n=function(){return this===void 0}();if(n)o.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:n,propertyIsWritable:function(g,h){var C=Object.getOwnPropertyDescriptor(g,h);return!(C&&!C.writable&&!C.set)}};else{var i={}.hasOwnProperty,a={}.toString,c={}.constructor.prototype,u=function(g){var h=[];for(var C in g)i.call(g,C)&&h.push(C);return h};o.exports={isArray:function(g){try{return a.call(g)==="[object Array]"}catch{return!1}},keys:u,names:u,defineProperty:function(g,h,C){return g[h]=C.value,g},getDescriptor:function(g,h){return{value:g[h]}},freeze:function(g){return g},getPrototypeOf:function(g){try{return Object(g).constructor.prototype}catch{return c}},isES5:n,propertyIsWritable:function(){return!0}}}},{}],14:[function(f,o,s){o.exports=function(n,i){var a=n.map;n.prototype.filter=function(c,u){return a(this,c,u,i)},n.filter=function(c,u,g){return a(c,u,g,i)}}},{}],15:[function(f,o,s){o.exports=function(n,i,a){function c(I,k,P){this.promise=I,this.type=k,this.handler=P,this.called=!1,this.cancelPromise=null}function u(I){this.finallyHandler=I}function g(I,k){return I.cancelPromise!=null&&(arguments.length>1?I.cancelPromise._reject(k):I.cancelPromise._cancel(),I.cancelPromise=null,!0)}function h(){return E.call(this,this.promise._target()._settledValue())}function C(I){if(!g(this,I))return O.e=I,O}function E(I){var k=this.promise,P=this.handler;if(!this.called){this.called=!0;var F=this.isFinallyHandler()?P.call(k._boundValue()):P.call(k._boundValue(),I);if(F===a)return F;if(F!==void 0){k._setReturnedNonUndefined();var H=i(F,k);if(H instanceof n){if(this.cancelPromise!=null){if(H._isCancelled()){var D=new w("late cancellation observer");return k._attachExtraTrace(D),O.e=D,O}H.isPending()&&H._attachCancellationCallback(new u(this))}return H._then(h,C,void 0,this,void 0)}}}return k.isRejected()?(g(this),O.e=I,O):(g(this),I)}var y=f("./util"),w=n.CancellationError,O=y.errorObj,L=f("./catch_filter")(a);return c.prototype.isFinallyHandler=function(){return this.type===0},u.prototype._resultCancelled=function(){g(this.finallyHandler)},n.prototype._passThrough=function(I,k,P,F){return typeof I!="function"?this.then():this._then(P,F,void 0,new c(this,k,I),void 0)},n.prototype.lastly=n.prototype.finally=function(I){return this._passThrough(I,0,E,E)},n.prototype.tap=function(I){return this._passThrough(I,1,E)},n.prototype.tapCatch=function(I){var k=arguments.length;if(k===1)return this._passThrough(I,1,void 0,E);var P,F=new Array(k-1),H=0;for(P=0;P<k-1;++P){var D=arguments[P];if(!y.isObject(D))return n.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+y.classString(D)));F[H++]=D}F.length=H;var $=arguments[P];return this._passThrough(L(F,$,this),1,void 0,E)},c}},{"./catch_filter":7,"./util":36}],16:[function(f,o,s){o.exports=function(n,i,a,c,u,g){function h(L,I,k,P){if(g.cancellation()){var F=new n(a),H=this._finallyPromise=new n(a);this._promise=F.lastly(function(){return H}),F._captureStackTrace(),F._setOnCancel(this)}else(this._promise=new n(a))._captureStackTrace();this._stack=P,this._generatorFunction=L,this._receiver=I,this._generator=void 0,this._yieldHandlers=typeof k=="function"?[k].concat(O):O,this._yieldedPromise=null,this._cancellationPhase=!1}var C=f("./errors").TypeError,E=f("./util"),y=E.errorObj,w=E.tryCatch,O=[];E.inherits(h,u),h.prototype._isResolved=function(){return this._promise===null},h.prototype._cleanup=function(){this._promise=this._generator=null,g.cancellation()&&this._finallyPromise!==null&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},h.prototype._promiseCancelled=function(){if(!this._isResolved()){var L;if(this._generator.return!==void 0)this._promise._pushContext(),L=w(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var I=new n.CancellationError("generator .return() sentinel");n.coroutine.returnSentinel=I,this._promise._attachExtraTrace(I),this._promise._pushContext(),L=w(this._generator.throw).call(this._generator,I),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(L)}},h.prototype._promiseFulfilled=function(L){this._yieldedPromise=null,this._promise._pushContext();var I=w(this._generator.next).call(this._generator,L);this._promise._popContext(),this._continue(I)},h.prototype._promiseRejected=function(L){this._yieldedPromise=null,this._promise._attachExtraTrace(L),this._promise._pushContext();var I=w(this._generator.throw).call(this._generator,L);this._promise._popContext(),this._continue(I)},h.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof n){var L=this._yieldedPromise;this._yieldedPromise=null,L.cancel()}},h.prototype.promise=function(){return this._promise},h.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},h.prototype._continue=function(L){var I=this._promise;if(L===y)return this._cleanup(),this._cancellationPhase?I.cancel():I._rejectCallback(L.e,!1);var k=L.value;if(L.done===!0)return this._cleanup(),this._cancellationPhase?I.cancel():I._resolveCallback(k);var P=c(k,this._promise);if(P instanceof n||(P=function(H,D,$){for(var j=0;j<D.length;++j){$._pushContext();var V=w(D[j])(H);if($._popContext(),V===y){$._pushContext();var Y=n.reject(y.e);return $._popContext(),Y}var Z=c(V,$);if(Z instanceof n)return Z}return null}(P,this._yieldHandlers,this._promise))!==null){var F=(P=P._target())._bitField;(50397184&F)==0?(this._yieldedPromise=P,P._proxy(this,null)):(33554432&F)!=0?n._async.invoke(this._promiseFulfilled,this,P._value()):(16777216&F)!=0?n._async.invoke(this._promiseRejected,this,P._reason()):this._promiseCancelled()}else this._promiseRejected(new C(`A value %s was yielded that could not be treated as a promise

    See http://goo.gl/MqrFmX

`.replace("%s",String(k))+`From coroutine:
`+this._stack.split(`
`).slice(1,-7).join(`
`)))},n.coroutine=function(L,I){if(typeof L!="function")throw new C(`generatorFunction must be a function

    See http://goo.gl/MqrFmX
`);var k=Object(I).yieldHandler,P=h,F=new Error().stack;return function(){var H=L.apply(this,arguments),D=new P(void 0,void 0,k,F),$=D.promise();return D._generator=H,D._promiseFulfilled(void 0),$}},n.coroutine.addYieldHandler=function(L){if(typeof L!="function")throw new C("expecting a function but got "+E.classString(L));O.push(L)},n.spawn=function(L){if(g.deprecated("Promise.spawn()","Promise.coroutine()"),typeof L!="function")return i(`generatorFunction must be a function

    See http://goo.gl/MqrFmX
`);var I=new h(L,this),k=I.promise();return I._run(n.spawn),k}}},{"./errors":12,"./util":36}],17:[function(f,o,s){o.exports=function(n,i,a,c,u,g){var h=f("./util");h.canEvaluate,h.tryCatch,h.errorObj,n.join=function(){var C,E=arguments.length-1;E>0&&typeof arguments[E]=="function"&&(C=arguments[E]);var y=[].slice.call(arguments);C&&y.pop();var w=new i(y).promise();return C!==void 0?w.spread(C):w}}},{"./util":36}],18:[function(f,o,s){o.exports=function(n,i,a,c,u,g){function h(I,k,P,F){this.constructor$(I),this._promise._captureStackTrace();var H=E();this._callback=H===null?k:y.domainBind(H,k),this._preservedValues=F===u?new Array(this.length()):null,this._limit=P,this._inFlight=0,this._queue=[],L.invoke(this._asyncInit,this,void 0)}function C(I,k,P,F){if(typeof k!="function")return a("expecting a function but got "+y.classString(k));var H=0;if(P!==void 0){if(typeof P!="object"||P===null)return n.reject(new TypeError("options argument must be an object but it is "+y.classString(P)));if(typeof P.concurrency!="number")return n.reject(new TypeError("'concurrency' must be a number but it is "+y.classString(P.concurrency)));H=P.concurrency}return new h(I,k,H=typeof H=="number"&&isFinite(H)&&H>=1?H:0,F).promise()}var E=n._getDomain,y=f("./util"),w=y.tryCatch,O=y.errorObj,L=n._async;y.inherits(h,i),h.prototype._asyncInit=function(){this._init$(void 0,-2)},h.prototype._init=function(){},h.prototype._promiseFulfilled=function(I,k){var P=this._values,F=this.length(),H=this._preservedValues,D=this._limit;if(k<0){if(P[k=-1*k-1]=I,D>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(D>=1&&this._inFlight>=D)return P[k]=I,this._queue.push(k),!1;H!==null&&(H[k]=I);var $=this._promise,j=this._callback,V=$._boundValue();$._pushContext();var Y=w(j).call(V,I,k,F),Z=$._popContext();if(g.checkForgottenReturns(Y,Z,H!==null?"Promise.filter":"Promise.map",$),Y===O)return this._reject(Y.e),!0;var J=c(Y,this._promise);if(J instanceof n){var re=(J=J._target())._bitField;if((50397184&re)==0)return D>=1&&this._inFlight++,P[k]=J,J._proxy(this,-1*(k+1)),!1;if((33554432&re)==0)return(16777216&re)!=0?(this._reject(J._reason()),!0):(this._cancel(),!0);Y=J._value()}P[k]=Y}return++this._totalResolved>=F&&(H!==null?this._filter(P,H):this._resolve(P),!0)},h.prototype._drainQueue=function(){for(var I=this._queue,k=this._limit,P=this._values;I.length>0&&this._inFlight<k;){if(this._isResolved())return;var F=I.pop();this._promiseFulfilled(P[F],F)}},h.prototype._filter=function(I,k){for(var P=k.length,F=new Array(P),H=0,D=0;D<P;++D)I[D]&&(F[H++]=k[D]);F.length=H,this._resolve(F)},h.prototype.preservedValues=function(){return this._preservedValues},n.prototype.map=function(I,k){return C(this,I,k,null)},n.map=function(I,k,P,F){return C(I,k,P,F)}}},{"./util":36}],19:[function(f,o,s){o.exports=function(n,i,a,c,u){var g=f("./util"),h=g.tryCatch;n.method=function(C){if(typeof C!="function")throw new n.TypeError("expecting a function but got "+g.classString(C));return function(){var E=new n(i);E._captureStackTrace(),E._pushContext();var y=h(C).apply(this,arguments),w=E._popContext();return u.checkForgottenReturns(y,w,"Promise.method",E),E._resolveFromSyncValue(y),E}},n.attempt=n.try=function(C){if(typeof C!="function")return c("expecting a function but got "+g.classString(C));var E,y=new n(i);if(y._captureStackTrace(),y._pushContext(),arguments.length>1){u.deprecated("calling Promise.try with more than 1 argument");var w=arguments[1],O=arguments[2];E=g.isArray(w)?h(C).apply(O,w):h(C).call(O,w)}else E=h(C)();var L=y._popContext();return u.checkForgottenReturns(E,L,"Promise.try",y),y._resolveFromSyncValue(E),y},n.prototype._resolveFromSyncValue=function(C){C===g.errorObj?this._rejectCallback(C.e,!1):this._resolveCallback(C,!0)}}},{"./util":36}],20:[function(f,o,s){function n(h){var C;if(function(O){return O instanceof Error&&u.getPrototypeOf(O)===Error.prototype}(h)){(C=new c(h)).name=h.name,C.message=h.message,C.stack=h.stack;for(var E=u.keys(h),y=0;y<E.length;++y){var w=E[y];g.test(w)||(C[w]=h[w])}return C}return i.markAsOriginatingFromRejection(h),h}var i=f("./util"),a=i.maybeWrapAsError,c=f("./errors").OperationalError,u=f("./es5"),g=/^(?:name|message|stack|cause)$/;o.exports=function(h,C){return function(E,y){if(h!==null){if(E){var w=n(a(E));h._attachExtraTrace(w),h._reject(w)}else if(C){var O=[].slice.call(arguments,1);h._fulfill(O)}else h._fulfill(y);h=null}}}},{"./errors":12,"./es5":13,"./util":36}],21:[function(f,o,s){o.exports=function(n){function i(E,y){if(!u.isArray(E))return a.call(this,E,y);var w=h(y).apply(this._boundValue(),[null].concat(E));w===C&&g.throwLater(w.e)}function a(E,y){var w=this._boundValue(),O=E===void 0?h(y).call(w,null):h(y).call(w,null,E);O===C&&g.throwLater(O.e)}function c(E,y){if(!E){var w=new Error(E+"");w.cause=E,E=w}var O=h(y).call(this._boundValue(),E);O===C&&g.throwLater(O.e)}var u=f("./util"),g=n._async,h=u.tryCatch,C=u.errorObj;n.prototype.asCallback=n.prototype.nodeify=function(E,y){if(typeof E=="function"){var w=a;y!==void 0&&Object(y).spread&&(w=i),this._then(w,c,void 0,this,E)}return this}}},{"./util":36}],22:[function(f,o,s){o.exports=function(){function n(){}function i(te){te!==H&&function(oe,_e){if(oe==null||oe.constructor!==i)throw new P(`the promise constructor cannot be invoked directly

    See http://goo.gl/MqrFmX
`);if(typeof _e!="function")throw new P("expecting a function but got "+w.classString(_e))}(this,te),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(te),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function a(te){this.promise._resolveCallback(te)}function c(te){this.promise._rejectCallback(te,!1)}function u(te){var oe=new i(H);oe._fulfillmentHandler0=te,oe._rejectionHandler0=te,oe._promise0=te,oe._receiver0=te}var g,h=function(){return new P(`circular promise resolution chain

    See http://goo.gl/MqrFmX
`)},C=function(){return new i.PromiseInspection(this._target())},E=function(te){return i.reject(new P(te))},y={},w=f("./util");g=w.isNode?function(){var te=_.domain;return te===void 0&&(te=null),te}:function(){return null},w.notEnumerableProp(i,"_getDomain",g);var O=f("./es5"),L=f("./async"),I=new L;O.defineProperty(i,"_async",{value:I});var k=f("./errors"),P=i.TypeError=k.TypeError;i.RangeError=k.RangeError;var F=i.CancellationError=k.CancellationError;i.TimeoutError=k.TimeoutError,i.OperationalError=k.OperationalError,i.RejectionError=k.OperationalError,i.AggregateError=k.AggregateError;var H=function(){},D={},$={},j=f("./thenables")(i,H),V=f("./promise_array")(i,H,j,E,n),Y=f("./context")(i),Z=Y.create,J=f("./debuggability")(i,Y),re=(J.CapturedTrace,f("./finally")(i,j,$)),ce=f("./catch_filter")($),Re=f("./nodeback"),pe=w.errorObj,Oe=w.tryCatch;return i.prototype.toString=function(){return"[object Promise]"},i.prototype.caught=i.prototype.catch=function(te){var oe=arguments.length;if(oe>1){var _e,we=new Array(oe-1),Ee=0;for(_e=0;_e<oe-1;++_e){var De=arguments[_e];if(!w.isObject(De))return E("Catch statement predicate: expecting an object but got "+w.classString(De));we[Ee++]=De}return we.length=Ee,te=arguments[_e],this.then(void 0,ce(we,te,this))}return this.then(void 0,te)},i.prototype.reflect=function(){return this._then(C,C,void 0,this,void 0)},i.prototype.then=function(te,oe){if(J.warnings()&&arguments.length>0&&typeof te!="function"&&typeof oe!="function"){var _e=".then() only accepts functions but was passed: "+w.classString(te);arguments.length>1&&(_e+=", "+w.classString(oe)),this._warn(_e)}return this._then(te,oe,void 0,void 0,void 0)},i.prototype.done=function(te,oe){this._then(te,oe,void 0,void 0,void 0)._setIsFinal()},i.prototype.spread=function(te){return typeof te!="function"?E("expecting a function but got "+w.classString(te)):this.all()._then(te,void 0,void 0,D,void 0)},i.prototype.toJSON=function(){var te={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(te.fulfillmentValue=this.value(),te.isFulfilled=!0):this.isRejected()&&(te.rejectionReason=this.reason(),te.isRejected=!0),te},i.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new V(this).promise()},i.prototype.error=function(te){return this.caught(w.originatesFromRejection,te)},i.getNewLibraryCopy=o.exports,i.is=function(te){return te instanceof i},i.fromNode=i.fromCallback=function(te){var oe=new i(H);oe._captureStackTrace();var _e=arguments.length>1&&!!Object(arguments[1]).multiArgs,we=Oe(te)(Re(oe,_e));return we===pe&&oe._rejectCallback(we.e,!0),oe._isFateSealed()||oe._setAsyncGuaranteed(),oe},i.all=function(te){return new V(te).promise()},i.cast=function(te){var oe=j(te);return oe instanceof i||((oe=new i(H))._captureStackTrace(),oe._setFulfilled(),oe._rejectionHandler0=te),oe},i.resolve=i.fulfilled=i.cast,i.reject=i.rejected=function(te){var oe=new i(H);return oe._captureStackTrace(),oe._rejectCallback(te,!0),oe},i.setScheduler=function(te){if(typeof te!="function")throw new P("expecting a function but got "+w.classString(te));return I.setScheduler(te)},i.prototype._then=function(te,oe,_e,we,Ee){var De=Ee!==void 0,Fe=De?Ee:new i(H),xe=this._target(),et=xe._bitField;De||(Fe._propagateFrom(this,3),Fe._captureStackTrace(),we===void 0&&(2097152&this._bitField)!=0&&(we=(50397184&et)!=0?this._boundValue():xe===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,Fe));var tt=g();if((50397184&et)!=0){var nt,Dt,St=xe._settlePromiseCtx;(33554432&et)!=0?(Dt=xe._rejectionHandler0,nt=te):(16777216&et)!=0?(Dt=xe._fulfillmentHandler0,nt=oe,xe._unsetRejectionIsUnhandled()):(St=xe._settlePromiseLateCancellationObserver,Dt=new F("late cancellation observer"),xe._attachExtraTrace(Dt),nt=oe),I.invoke(St,xe,{handler:tt===null?nt:typeof nt=="function"&&w.domainBind(tt,nt),promise:Fe,receiver:we,value:Dt})}else xe._addCallbacks(te,oe,Fe,we,tt);return Fe},i.prototype._length=function(){return 65535&this._bitField},i.prototype._isFateSealed=function(){return(117506048&this._bitField)!=0},i.prototype._isFollowing=function(){return(67108864&this._bitField)==67108864},i.prototype._setLength=function(te){this._bitField=-65536&this._bitField|65535&te},i.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},i.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},i.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},i.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},i.prototype._isFinal=function(){return(4194304&this._bitField)>0},i.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},i.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},i.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},i.prototype._setAsyncGuaranteed=function(){I.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},i.prototype._receiverAt=function(te){var oe=te===0?this._receiver0:this[4*te-4+3];if(oe!==y)return oe===void 0&&this._isBound()?this._boundValue():oe},i.prototype._promiseAt=function(te){return this[4*te-4+2]},i.prototype._fulfillmentHandlerAt=function(te){return this[4*te-4+0]},i.prototype._rejectionHandlerAt=function(te){return this[4*te-4+1]},i.prototype._boundValue=function(){},i.prototype._migrateCallback0=function(te){var oe=(te._bitField,te._fulfillmentHandler0),_e=te._rejectionHandler0,we=te._promise0,Ee=te._receiverAt(0);Ee===void 0&&(Ee=y),this._addCallbacks(oe,_e,we,Ee,null)},i.prototype._migrateCallbackAt=function(te,oe){var _e=te._fulfillmentHandlerAt(oe),we=te._rejectionHandlerAt(oe),Ee=te._promiseAt(oe),De=te._receiverAt(oe);De===void 0&&(De=y),this._addCallbacks(_e,we,Ee,De,null)},i.prototype._addCallbacks=function(te,oe,_e,we,Ee){var De=this._length();if(De>=65531&&(De=0,this._setLength(0)),De===0)this._promise0=_e,this._receiver0=we,typeof te=="function"&&(this._fulfillmentHandler0=Ee===null?te:w.domainBind(Ee,te)),typeof oe=="function"&&(this._rejectionHandler0=Ee===null?oe:w.domainBind(Ee,oe));else{var Fe=4*De-4;this[Fe+2]=_e,this[Fe+3]=we,typeof te=="function"&&(this[Fe+0]=Ee===null?te:w.domainBind(Ee,te)),typeof oe=="function"&&(this[Fe+1]=Ee===null?oe:w.domainBind(Ee,oe))}return this._setLength(De+1),De},i.prototype._proxy=function(te,oe){this._addCallbacks(void 0,void 0,oe,te,null)},i.prototype._resolveCallback=function(te,oe){if((117506048&this._bitField)==0){if(te===this)return this._rejectCallback(h(),!1);var _e=j(te,this);if(!(_e instanceof i))return this._fulfill(te);oe&&this._propagateFrom(_e,2);var we=_e._target();if(we===this)return void this._reject(h());var Ee=we._bitField;if((50397184&Ee)==0){var De=this._length();De>0&&we._migrateCallback0(this);for(var Fe=1;Fe<De;++Fe)we._migrateCallbackAt(this,Fe);this._setFollowing(),this._setLength(0),this._setFollowee(we)}else if((33554432&Ee)!=0)this._fulfill(we._value());else if((16777216&Ee)!=0)this._reject(we._reason());else{var xe=new F("late cancellation observer");we._attachExtraTrace(xe),this._reject(xe)}}},i.prototype._rejectCallback=function(te,oe,_e){var we=w.ensureErrorObject(te),Ee=we===te;if(!Ee&&!_e&&J.warnings()){var De="a promise was rejected with a non-error: "+w.classString(te);this._warn(De,!0)}this._attachExtraTrace(we,!!oe&&Ee),this._reject(te)},i.prototype._resolveFromExecutor=function(te){if(te!==H){var oe=this;this._captureStackTrace(),this._pushContext();var _e=!0,we=this._execute(te,function(Ee){oe._resolveCallback(Ee)},function(Ee){oe._rejectCallback(Ee,_e)});_e=!1,this._popContext(),we!==void 0&&oe._rejectCallback(we,!0)}},i.prototype._settlePromiseFromHandler=function(te,oe,_e,we){var Ee=we._bitField;if((65536&Ee)==0){var De;we._pushContext(),oe===D?_e&&typeof _e.length=="number"?De=Oe(te).apply(this._boundValue(),_e):(De=pe).e=new P("cannot .spread() a non-array: "+w.classString(_e)):De=Oe(te).call(oe,_e);var Fe=we._popContext();(65536&(Ee=we._bitField))==0&&(De===$?we._reject(_e):De===pe?we._rejectCallback(De.e,!1):(J.checkForgottenReturns(De,Fe,"",we,this),we._resolveCallback(De)))}},i.prototype._target=function(){for(var te=this;te._isFollowing();)te=te._followee();return te},i.prototype._followee=function(){return this._rejectionHandler0},i.prototype._setFollowee=function(te){this._rejectionHandler0=te},i.prototype._settlePromise=function(te,oe,_e,we){var Ee=te instanceof i,De=this._bitField,Fe=(134217728&De)!=0;(65536&De)!=0?(Ee&&te._invokeInternalOnCancel(),_e instanceof re&&_e.isFinallyHandler()?(_e.cancelPromise=te,Oe(oe).call(_e,we)===pe&&te._reject(pe.e)):oe===C?te._fulfill(C.call(_e)):_e instanceof n?_e._promiseCancelled(te):Ee||te instanceof V?te._cancel():_e.cancel()):typeof oe=="function"?Ee?(Fe&&te._setAsyncGuaranteed(),this._settlePromiseFromHandler(oe,_e,we,te)):oe.call(_e,we,te):_e instanceof n?_e._isResolved()||((33554432&De)!=0?_e._promiseFulfilled(we,te):_e._promiseRejected(we,te)):Ee&&(Fe&&te._setAsyncGuaranteed(),(33554432&De)!=0?te._fulfill(we):te._reject(we))},i.prototype._settlePromiseLateCancellationObserver=function(te){var oe=te.handler,_e=te.promise,we=te.receiver,Ee=te.value;typeof oe=="function"?_e instanceof i?this._settlePromiseFromHandler(oe,we,Ee,_e):oe.call(we,Ee,_e):_e instanceof i&&_e._reject(Ee)},i.prototype._settlePromiseCtx=function(te){this._settlePromise(te.promise,te.handler,te.receiver,te.value)},i.prototype._settlePromise0=function(te,oe,_e){var we=this._promise0,Ee=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(we,te,Ee,oe)},i.prototype._clearCallbackDataAtIndex=function(te){var oe=4*te-4;this[oe+2]=this[oe+3]=this[oe+0]=this[oe+1]=void 0},i.prototype._fulfill=function(te){var oe=this._bitField;if(!((117506048&oe)>>>16)){if(te===this){var _e=h();return this._attachExtraTrace(_e),this._reject(_e)}this._setFulfilled(),this._rejectionHandler0=te,(65535&oe)>0&&((134217728&oe)!=0?this._settlePromises():I.settlePromises(this))}},i.prototype._reject=function(te){var oe=this._bitField;if(!((117506048&oe)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=te,this._isFinal())return I.fatalError(te,w.isNode);(65535&oe)>0?I.settlePromises(this):this._ensurePossibleRejectionHandled()}},i.prototype._fulfillPromises=function(te,oe){for(var _e=1;_e<te;_e++){var we=this._fulfillmentHandlerAt(_e),Ee=this._promiseAt(_e),De=this._receiverAt(_e);this._clearCallbackDataAtIndex(_e),this._settlePromise(Ee,we,De,oe)}},i.prototype._rejectPromises=function(te,oe){for(var _e=1;_e<te;_e++){var we=this._rejectionHandlerAt(_e),Ee=this._promiseAt(_e),De=this._receiverAt(_e);this._clearCallbackDataAtIndex(_e),this._settlePromise(Ee,we,De,oe)}},i.prototype._settlePromises=function(){var te=this._bitField,oe=65535&te;if(oe>0){if((16842752&te)!=0){var _e=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,_e,te),this._rejectPromises(oe,_e)}else{var we=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,we,te),this._fulfillPromises(oe,we)}this._setLength(0)}this._clearCancellationData()},i.prototype._settledValue=function(){var te=this._bitField;return(33554432&te)!=0?this._rejectionHandler0:(16777216&te)!=0?this._fulfillmentHandler0:void 0},i.defer=i.pending=function(){return J.deprecated("Promise.defer","new Promise"),{promise:new i(H),resolve:a,reject:c}},w.notEnumerableProp(i,"_makeSelfResolutionError",h),f("./method")(i,H,j,E,J),f("./bind")(i,H,j,J),f("./cancel")(i,V,E,J),f("./direct_resolve")(i),f("./synchronous_inspection")(i),f("./join")(i,V,j,H,I,g),i.Promise=i,i.version="3.5.1",f("./map.js")(i,V,E,j,H,J),f("./call_get.js")(i),f("./using.js")(i,E,j,Z,H,J),f("./timers.js")(i,H,J),f("./generators.js")(i,E,H,j,n,J),f("./nodeify.js")(i),f("./promisify.js")(i,H),f("./props.js")(i,V,j,E),f("./race.js")(i,H,j,E),f("./reduce.js")(i,V,E,j,H,J),f("./settle.js")(i,V,J),f("./some.js")(i,V,E),f("./filter.js")(i,H),f("./each.js")(i,H),f("./any.js")(i),w.toFastProperties(i),w.toFastProperties(i.prototype),u({a:1}),u({b:2}),u({c:3}),u(1),u(function(){}),u(void 0),u(!1),u(new i(H)),J.setBounds(L.firstLineError,w.lastLineError),i}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(f,o,s){o.exports=function(n,i,a,c,u){function g(C){var E=this._promise=new n(i);C instanceof n&&E._propagateFrom(C,3),E._setOnCancel(this),this._values=C,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var h=f("./util");return h.isArray,h.inherits(g,u),g.prototype.length=function(){return this._length},g.prototype.promise=function(){return this._promise},g.prototype._init=function C(E,y){var w=a(this._values,this._promise);if(w instanceof n){var O=(w=w._target())._bitField;if(this._values=w,(50397184&O)==0)return this._promise._setAsyncGuaranteed(),w._then(C,this._reject,void 0,this,y);if((33554432&O)==0)return(16777216&O)!=0?this._reject(w._reason()):this._cancel();w=w._value()}if((w=h.asArray(w))!==null)w.length!==0?this._iterate(w):y===-5?this._resolveEmptyArray():this._resolve(function(I){switch(I){case-2:return[];case-3:return{};case-6:return new Map}}(y));else{var L=c("expecting an array or an iterable object but got "+h.classString(w)).reason();this._promise._rejectCallback(L,!1)}},g.prototype._iterate=function(C){var E=this.getActualLength(C.length);this._length=E,this._values=this.shouldCopyValues()?new Array(E):this._values;for(var y=this._promise,w=!1,O=null,L=0;L<E;++L){var I=a(C[L],y);I instanceof n?O=(I=I._target())._bitField:O=null,w?O!==null&&I.suppressUnhandledRejections():O!==null?(50397184&O)==0?(I._proxy(this,L),this._values[L]=I):w=(33554432&O)!=0?this._promiseFulfilled(I._value(),L):(16777216&O)!=0?this._promiseRejected(I._reason(),L):this._promiseCancelled(L):w=this._promiseFulfilled(I,L)}w||y._setAsyncGuaranteed()},g.prototype._isResolved=function(){return this._values===null},g.prototype._resolve=function(C){this._values=null,this._promise._fulfill(C)},g.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},g.prototype._reject=function(C){this._values=null,this._promise._rejectCallback(C,!1)},g.prototype._promiseFulfilled=function(C,E){return this._values[E]=C,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},g.prototype._promiseCancelled=function(){return this._cancel(),!0},g.prototype._promiseRejected=function(C){return this._totalResolved++,this._reject(C),!0},g.prototype._resultCancelled=function(){if(!this._isResolved()){var C=this._values;if(this._cancel(),C instanceof n)C.cancel();else for(var E=0;E<C.length;++E)C[E]instanceof n&&C[E].cancel()}},g.prototype.shouldCopyValues=function(){return!0},g.prototype.getActualLength=function(C){return C},g}},{"./util":36}],24:[function(f,o,s){o.exports=function(n,i){function a($){return!P.test($)}function c($){try{return $.__isPromisified__===!0}catch{return!1}}function u($,j,V){var Y=E.getDataPropertyOrDefault($,j+V,k);return!!Y&&c(Y)}function g($,j,V,Y){for(var Z=E.inheritedDataKeys($),J=[],re=0;re<Z.length;++re){var ce=Z[re],Re=$[ce],pe=Y===F||F(ce);typeof Re!="function"||c(Re)||u($,ce,j)||!Y(ce,Re,$,pe)||J.push(ce,Re)}return function(Oe,te,oe){for(var _e=0;_e<Oe.length;_e+=2){var we=Oe[_e];if(oe.test(we)){for(var Ee=we.replace(oe,""),De=0;De<Oe.length;De+=2)if(Oe[De]===Ee)throw new I(`Cannot promisify an API that has normal methods with '%s'-suffix

    See http://goo.gl/MqrFmX
`.replace("%s",te))}}}(J,j,V),J}function h($,j,V,Y,Z){for(var J=new RegExp(H(j)+"$"),re=g($,j,J,V),ce=0,Re=re.length;ce<Re;ce+=2){var pe=re[ce],Oe=re[ce+1],te=pe+j;if(Y===D)$[te]=D(pe,C,pe,Oe,j,Z);else{var oe=Y(Oe,function(){return D(pe,C,pe,Oe,j,Z)});E.notEnumerableProp(oe,"__isPromisified__",!0),$[te]=oe}}return E.toFastProperties($),$}var C={},E=f("./util"),y=f("./nodeback"),w=E.withAppended,O=E.maybeWrapAsError,L=E.canEvaluate,I=f("./errors").TypeError,k={__isPromisified__:!0},P=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),F=function($){return E.isIdentifier($)&&$.charAt(0)!=="_"&&$!=="constructor"},H=function($){return $.replace(/([$])/,"\\$")},D=L?void 0:function($,j,V,Y,Z,J){function re(){var pe=j;j===C&&(pe=this);var Oe=new n(i);Oe._captureStackTrace();var te=typeof Re=="string"&&this!==ce?this[Re]:$,oe=y(Oe,J);try{te.apply(pe,w(arguments,oe))}catch(_e){Oe._rejectCallback(O(_e),!0,!0)}return Oe._isFateSealed()||Oe._setAsyncGuaranteed(),Oe}var ce=function(){return this}(),Re=$;return typeof Re=="string"&&($=Y),E.notEnumerableProp(re,"__isPromisified__",!0),re};n.promisify=function($,j){if(typeof $!="function")throw new I("expecting a function but got "+E.classString($));if(c($))return $;var V=function(Y,Z,J){return D(Y,Z,void 0,Y,null,J)}($,(j=Object(j)).context===void 0?C:j.context,!!j.multiArgs);return E.copyDescriptors($,V,a),V},n.promisifyAll=function($,j){if(typeof $!="function"&&typeof $!="object")throw new I(`the target of promisifyAll must be an object or a function

    See http://goo.gl/MqrFmX
`);var V=!!(j=Object(j)).multiArgs,Y=j.suffix;typeof Y!="string"&&(Y="Async");var Z=j.filter;typeof Z!="function"&&(Z=F);var J=j.promisifier;if(typeof J!="function"&&(J=D),!E.isIdentifier(Y))throw new RangeError(`suffix must be a valid identifier

    See http://goo.gl/MqrFmX
`);for(var re=E.inheritedDataKeys($),ce=0;ce<re.length;++ce){var Re=$[re[ce]];re[ce]!=="constructor"&&E.isClass(Re)&&(h(Re.prototype,Y,Z,J,V),h(Re,Y,Z,J,V))}return h($,Y,Z,J,V)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(f,o,s){o.exports=function(n,i,a,c){function u(O){var L,I=!1;if(h!==void 0&&O instanceof h)L=w(O),I=!0;else{var k=y.keys(O),P=k.length;L=new Array(2*P);for(var F=0;F<P;++F){var H=k[F];L[F]=O[H],L[F+P]=H}}this.constructor$(L),this._isMap=I,this._init$(void 0,I?-6:-3)}function g(O){var L,I=a(O);return E(I)?(L=I instanceof n?I._then(n.props,void 0,void 0,void 0,void 0):new u(I).promise(),I instanceof n&&L._propagateFrom(I,2),L):c(`cannot await properties of a non-object

    See http://goo.gl/MqrFmX
`)}var h,C=f("./util"),E=C.isObject,y=f("./es5");typeof Map=="function"&&(h=Map);var w=function(){function O(k,P){this[L]=k,this[L+I]=P,L++}var L=0,I=0;return function(k){I=k.size,L=0;var P=new Array(2*k.size);return k.forEach(O,P),P}}();C.inherits(u,i),u.prototype._init=function(){},u.prototype._promiseFulfilled=function(O,L){if(this._values[L]=O,++this._totalResolved>=this._length){var I;if(this._isMap)I=function(H){for(var D=new h,$=H.length/2|0,j=0;j<$;++j){var V=H[$+j],Y=H[j];D.set(V,Y)}return D}(this._values);else{I={};for(var k=this.length(),P=0,F=this.length();P<F;++P)I[this._values[P+k]]=this._values[P]}return this._resolve(I),!0}return!1},u.prototype.shouldCopyValues=function(){return!1},u.prototype.getActualLength=function(O){return O>>1},n.prototype.props=function(){return g(this)},n.props=function(O){return g(O)}}},{"./es5":13,"./util":36}],26:[function(f,o,s){function n(i){this._capacity=i,this._length=0,this._front=0}n.prototype._willBeOverCapacity=function(i){return this._capacity<i},n.prototype._pushOne=function(i){var a=this.length();this._checkCapacity(a+1),this[this._front+a&this._capacity-1]=i,this._length=a+1},n.prototype.push=function(i,a,c){var u=this.length()+3;if(this._willBeOverCapacity(u))return this._pushOne(i),this._pushOne(a),void this._pushOne(c);var g=this._front+u-3;this._checkCapacity(u);var h=this._capacity-1;this[g+0&h]=i,this[g+1&h]=a,this[g+2&h]=c,this._length=u},n.prototype.shift=function(){var i=this._front,a=this[i];return this[i]=void 0,this._front=i+1&this._capacity-1,this._length--,a},n.prototype.length=function(){return this._length},n.prototype._checkCapacity=function(i){this._capacity<i&&this._resizeTo(this._capacity<<1)},n.prototype._resizeTo=function(i){var a=this._capacity;this._capacity=i,function(c,u,g,h,C){for(var E=0;E<C;++E)g[E+h]=c[E+u],c[E+u]=void 0}(this,0,this,a,this._front+this._length&a-1)},o.exports=n},{}],27:[function(f,o,s){o.exports=function(n,i,a,c){function u(C,E){var y=a(C);if(y instanceof n)return h(y);if((C=g.asArray(C))===null)return c("expecting an array or an iterable object but got "+g.classString(C));var w=new n(i);E!==void 0&&w._propagateFrom(E,3);for(var O=w._fulfill,L=w._reject,I=0,k=C.length;I<k;++I){var P=C[I];(P!==void 0||I in C)&&n.cast(P)._then(O,L,void 0,w,null)}return w}var g=f("./util"),h=function(C){return C.then(function(E){return u(E,C)})};n.race=function(C){return u(C,void 0)},n.prototype.race=function(){return u(this,void 0)}}},{"./util":36}],28:[function(f,o,s){o.exports=function(n,i,a,c,u,g){function h(k,P,F,H){this.constructor$(k);var D=O();this._fn=D===null?P:L.domainBind(D,P),F!==void 0&&(F=n.resolve(F))._attachCancellationCallback(this),this._initialValue=F,this._currentCancellable=null,this._eachValues=H===u?Array(this._length):H===0?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function C(k,P){this.isFulfilled()?P._resolve(k):P._reject(k)}function E(k,P,F,H){return typeof P!="function"?a("expecting a function but got "+L.classString(P)):new h(k,P,F,H).promise()}function y(k){this.accum=k,this.array._gotAccum(k);var P=c(this.value,this.array._promise);return P instanceof n?(this.array._currentCancellable=P,P._then(w,void 0,void 0,this,void 0)):w.call(this,P)}function w(k){var P,F=this.array,H=F._promise,D=I(F._fn);H._pushContext(),(P=F._eachValues!==void 0?D.call(H._boundValue(),k,this.index,this.length):D.call(H._boundValue(),this.accum,k,this.index,this.length))instanceof n&&(F._currentCancellable=P);var $=H._popContext();return g.checkForgottenReturns(P,$,F._eachValues!==void 0?"Promise.each":"Promise.reduce",H),P}var O=n._getDomain,L=f("./util"),I=L.tryCatch;L.inherits(h,i),h.prototype._gotAccum=function(k){this._eachValues!==void 0&&this._eachValues!==null&&k!==u&&this._eachValues.push(k)},h.prototype._eachComplete=function(k){return this._eachValues!==null&&this._eachValues.push(k),this._eachValues},h.prototype._init=function(){},h.prototype._resolveEmptyArray=function(){this._resolve(this._eachValues!==void 0?this._eachValues:this._initialValue)},h.prototype.shouldCopyValues=function(){return!1},h.prototype._resolve=function(k){this._promise._resolveCallback(k),this._values=null},h.prototype._resultCancelled=function(k){if(k===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof n&&this._currentCancellable.cancel(),this._initialValue instanceof n&&this._initialValue.cancel())},h.prototype._iterate=function(k){this._values=k;var P,F,H=k.length;if(this._initialValue!==void 0?(P=this._initialValue,F=0):(P=n.resolve(k[0]),F=1),this._currentCancellable=P,!P.isRejected())for(;F<H;++F){var D={accum:null,value:k[F],index:F,length:H,array:this};P=P._then(y,void 0,void 0,D,void 0)}this._eachValues!==void 0&&(P=P._then(this._eachComplete,void 0,void 0,this,void 0)),P._then(C,C,void 0,P,this)},n.prototype.reduce=function(k,P){return E(this,k,P,null)},n.reduce=function(k,P,F,H){return E(k,P,F,H)}}},{"./util":36}],29:[function(f,o,s){var n,i=f("./util"),a=i.getNativePromise();if(i.isNode&&typeof MutationObserver>"u"){var c=t.setImmediate,u=_.nextTick;n=i.isRecentNode?function(h){c.call(t,h)}:function(h){u.call(_,h)}}else if(typeof a=="function"&&typeof a.resolve=="function"){var g=a.resolve();n=function(h){g.then(h)}}else n=typeof MutationObserver>"u"||typeof window<"u"&&window.navigator&&(window.navigator.standalone||window.cordova)?m!==void 0?function(h){m(h)}:typeof setTimeout<"u"?function(h){setTimeout(h,0)}:function(){throw new Error(`No async scheduler available

    See http://goo.gl/MqrFmX
`)}:function(){var h=document.createElement("div"),C={attributes:!0},E=!1,y=document.createElement("div");new MutationObserver(function(){h.classList.toggle("foo"),E=!1}).observe(y,C);var w=function(){E||(E=!0,y.classList.toggle("foo"))};return function(O){var L=new MutationObserver(function(){L.disconnect(),O()});L.observe(h,C),w()}}();o.exports=n},{"./util":36}],30:[function(f,o,s){o.exports=function(n,i,a){function c(g){this.constructor$(g)}var u=n.PromiseInspection;f("./util").inherits(c,i),c.prototype._promiseResolved=function(g,h){return this._values[g]=h,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},c.prototype._promiseFulfilled=function(g,h){var C=new u;return C._bitField=33554432,C._settledValueField=g,this._promiseResolved(h,C)},c.prototype._promiseRejected=function(g,h){var C=new u;return C._bitField=16777216,C._settledValueField=g,this._promiseResolved(h,C)},n.settle=function(g){return a.deprecated(".settle()",".reflect()"),new c(g).promise()},n.prototype.settle=function(){return n.settle(this)}}},{"./util":36}],31:[function(f,o,s){o.exports=function(n,i,a){function c(w){this.constructor$(w),this._howMany=0,this._unwrap=!1,this._initialized=!1}function u(w,O){if((0|O)!==O||O<0)return a(`expecting a positive integer

    See http://goo.gl/MqrFmX
`);var L=new c(w),I=L.promise();return L.setHowMany(O),L.init(),I}var g=f("./util"),h=f("./errors").RangeError,C=f("./errors").AggregateError,E=g.isArray,y={};g.inherits(c,i),c.prototype._init=function(){if(this._initialized){if(this._howMany===0)return void this._resolve([]);this._init$(void 0,-5);var w=E(this._values);!this._isResolved()&&w&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},c.prototype.init=function(){this._initialized=!0,this._init()},c.prototype.setUnwrap=function(){this._unwrap=!0},c.prototype.howMany=function(){return this._howMany},c.prototype.setHowMany=function(w){this._howMany=w},c.prototype._promiseFulfilled=function(w){return this._addFulfilled(w),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),this.howMany()===1&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},c.prototype._promiseRejected=function(w){return this._addRejected(w),this._checkOutcome()},c.prototype._promiseCancelled=function(){return this._values instanceof n||this._values==null?this._cancel():(this._addRejected(y),this._checkOutcome())},c.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var w=new C,O=this.length();O<this._values.length;++O)this._values[O]!==y&&w.push(this._values[O]);return w.length>0?this._reject(w):this._cancel(),!0}return!1},c.prototype._fulfilled=function(){return this._totalResolved},c.prototype._rejected=function(){return this._values.length-this.length()},c.prototype._addRejected=function(w){this._values.push(w)},c.prototype._addFulfilled=function(w){this._values[this._totalResolved++]=w},c.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},c.prototype._getRangeError=function(w){var O="Input array must contain at least "+this._howMany+" items but contains only "+w+" items";return new h(O)},c.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},n.some=function(w,O){return u(w,O)},n.prototype.some=function(w){return u(this,w)},n._SomePromiseArray=c}},{"./errors":12,"./util":36}],32:[function(f,o,s){o.exports=function(n){function i(E){E!==void 0?(E=E._target(),this._bitField=E._bitField,this._settledValueField=E._isFateSealed()?E._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}i.prototype._settledValue=function(){return this._settledValueField};var a=i.prototype.value=function(){if(!this.isFulfilled())throw new TypeError(`cannot get fulfillment value of a non-fulfilled promise

    See http://goo.gl/MqrFmX
`);return this._settledValue()},c=i.prototype.error=i.prototype.reason=function(){if(!this.isRejected())throw new TypeError(`cannot get rejection reason of a non-rejected promise

    See http://goo.gl/MqrFmX
`);return this._settledValue()},u=i.prototype.isFulfilled=function(){return(33554432&this._bitField)!=0},g=i.prototype.isRejected=function(){return(16777216&this._bitField)!=0},h=i.prototype.isPending=function(){return(50397184&this._bitField)==0},C=i.prototype.isResolved=function(){return(50331648&this._bitField)!=0};i.prototype.isCancelled=function(){return(8454144&this._bitField)!=0},n.prototype.__isCancelled=function(){return(65536&this._bitField)==65536},n.prototype._isCancelled=function(){return this._target().__isCancelled()},n.prototype.isCancelled=function(){return(8454144&this._target()._bitField)!=0},n.prototype.isPending=function(){return h.call(this._target())},n.prototype.isRejected=function(){return g.call(this._target())},n.prototype.isFulfilled=function(){return u.call(this._target())},n.prototype.isResolved=function(){return C.call(this._target())},n.prototype.value=function(){return a.call(this._target())},n.prototype.reason=function(){var E=this._target();return E._unsetRejectionIsUnhandled(),c.call(E)},n.prototype._value=function(){return this._settledValue()},n.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},n.PromiseInspection=i}},{}],33:[function(f,o,s){o.exports=function(n,i){function a(E){try{return function(y){return y.then}(E)}catch(y){return g.e=y,g}}function c(E,y,w){var O=new n(i),L=O;w&&w._pushContext(),O._captureStackTrace(),w&&w._popContext();var I=!0,k=u.tryCatch(y).call(E,function(P){O&&(O._resolveCallback(P),O=null)},function(P){O&&(O._rejectCallback(P,I,!0),O=null)});return I=!1,O&&k===g&&(O._rejectCallback(k.e,!0,!0),O=null),L}var u=f("./util"),g=u.errorObj,h=u.isObject,C={}.hasOwnProperty;return function(E,y){if(h(E)){if(E instanceof n)return E;var w=a(E);if(w===g){y&&y._pushContext();var O=n.reject(w.e);return y&&y._popContext(),O}if(typeof w=="function")return function(L){try{return C.call(L,"_promise0")}catch{return!1}}(E)?(O=new n(i),E._then(O._fulfill,O._reject,void 0,O,null),O):c(E,w,y)}return E}}},{"./util":36}],34:[function(f,o,s){o.exports=function(n,i,a){function c(O){this.handle=O}function u(O){return clearTimeout(this.handle),O}function g(O){throw clearTimeout(this.handle),O}var h=f("./util"),C=n.TimeoutError;c.prototype._resultCancelled=function(){clearTimeout(this.handle)};var E=function(O){return y(+this).thenReturn(O)},y=n.delay=function(O,L){var I,k;return L!==void 0?(I=n.resolve(L)._then(E,null,null,O,void 0),a.cancellation()&&L instanceof n&&I._setOnCancel(L)):(I=new n(i),k=setTimeout(function(){I._fulfill()},+O),a.cancellation()&&I._setOnCancel(new c(k)),I._captureStackTrace()),I._setAsyncGuaranteed(),I};n.prototype.delay=function(O){return y(O,this)};var w=function(O,L,I){var k;k=typeof L!="string"?L instanceof Error?L:new C("operation timed out"):new C(L),h.markAsOriginatingFromRejection(k),O._attachExtraTrace(k),O._reject(k),I!=null&&I.cancel()};n.prototype.timeout=function(O,L){O=+O;var I,k,P=new c(setTimeout(function(){I.isPending()&&w(I,L,k)},O));return a.cancellation()?(k=this.then(),(I=k._then(u,g,void 0,P,void 0))._setOnCancel(P)):I=this._then(u,g,void 0,P,void 0),I}}},{"./util":36}],35:[function(f,o,s){o.exports=function(n,i,a,c,u,g){function h(D){setTimeout(function(){throw D},0)}function C(D,$){var j=0,V=D.length,Y=new n(u);return function Z(){if(j>=V)return Y._fulfill();var J=function(re){var ce=a(re);return ce!==re&&typeof re._isDisposable=="function"&&typeof re._getDisposer=="function"&&re._isDisposable()&&ce._setDisposable(re._getDisposer()),ce}(D[j++]);if(J instanceof n&&J._isDisposable()){try{J=a(J._getDisposer().tryDispose($),D.promise)}catch(re){return h(re)}if(J instanceof n)return J._then(Z,h,null,null,null)}Z()}(),Y}function E(D,$,j){this._data=D,this._promise=$,this._context=j}function y(D,$,j){this.constructor$(D,$,j)}function w(D){return E.isDisposer(D)?(this.resources[this.index]._setDisposable(D),D.promise()):D}function O(D){this.length=D,this.promise=null,this[D-1]=null}var L=f("./util"),I=f("./errors").TypeError,k=f("./util").inherits,P=L.errorObj,F=L.tryCatch,H={};E.prototype.data=function(){return this._data},E.prototype.promise=function(){return this._promise},E.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():H},E.prototype.tryDispose=function(D){var $=this.resource(),j=this._context;j!==void 0&&j._pushContext();var V=$!==H?this.doDispose($,D):null;return j!==void 0&&j._popContext(),this._promise._unsetDisposable(),this._data=null,V},E.isDisposer=function(D){return D!=null&&typeof D.resource=="function"&&typeof D.tryDispose=="function"},k(y,E),y.prototype.doDispose=function(D,$){return this.data().call(D,D,$)},O.prototype._resultCancelled=function(){for(var D=this.length,$=0;$<D;++$){var j=this[$];j instanceof n&&j.cancel()}},n.using=function(){var D=arguments.length;if(D<2)return i("you must pass at least 2 arguments to Promise.using");var $=arguments[D-1];if(typeof $!="function")return i("expecting a function but got "+L.classString($));var j,V=!0;D===2&&Array.isArray(arguments[0])?(D=(j=arguments[0]).length,V=!1):(j=arguments,D--);for(var Y=new O(D),Z=0;Z<D;++Z){var J=j[Z];if(E.isDisposer(J)){var re=J;(J=J.promise())._setDisposable(re)}else{var ce=a(J);ce instanceof n&&(J=ce._then(w,null,null,{resources:Y,index:Z},void 0))}Y[Z]=J}var Re=new Array(Y.length);for(Z=0;Z<Re.length;++Z)Re[Z]=n.resolve(Y[Z]).reflect();var pe=n.all(Re).then(function(te){for(var oe=0;oe<te.length;++oe){var _e=te[oe];if(_e.isRejected())return P.e=_e.error(),P;if(!_e.isFulfilled())return void pe.cancel();te[oe]=_e.value()}Oe._pushContext(),$=F($);var we=V?$.apply(void 0,te):$(te),Ee=Oe._popContext();return g.checkForgottenReturns(we,Ee,"Promise.using",Oe),we}),Oe=pe.lastly(function(){var te=new n.PromiseInspection(pe);return C(Y,te)});return Y.promise=Oe,Oe._setOnCancel(Y),Oe},n.prototype._setDisposable=function(D){this._bitField=131072|this._bitField,this._disposer=D},n.prototype._isDisposable=function(){return(131072&this._bitField)>0},n.prototype._getDisposer=function(){return this._disposer},n.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},n.prototype.disposer=function(D){if(typeof D=="function")return new y(D,this,c());throw new I}}},{"./errors":12,"./util":36}],36:[function(f,o,s){function n(){try{var V=C;return C=null,V.apply(this,arguments)}catch(Y){return w.e=Y,w}}function i(V){return V==null||V===!0||V===!1||typeof V=="string"||typeof V=="number"}function a(V,Y,Z){if(i(V))return V;var J={value:Z,configurable:!0,enumerable:!1,writable:!0};return E.defineProperty(V,Y,J),V}function c(V){try{return V+""}catch{return"[no string representation]"}}function u(V){return V instanceof Error||V!==null&&typeof V=="object"&&typeof V.message=="string"&&typeof V.name=="string"}function g(V){return u(V)&&E.propertyIsWritable(V,"stack")}function h(V){return{}.toString.call(V)}var C,E=f("./es5"),y=typeof navigator>"u",w={e:{}},O=typeof self<"u"?self:typeof window<"u"?window:t!==void 0?t:this!==void 0?this:null,L=function(){var V=[Array.prototype,Object.prototype,Function.prototype],Y=function(re){for(var ce=0;ce<V.length;++ce)if(V[ce]===re)return!0;return!1};if(E.isES5){var Z=Object.getOwnPropertyNames;return function(re){for(var ce=[],Re=Object.create(null);re!=null&&!Y(re);){var pe;try{pe=Z(re)}catch{return ce}for(var Oe=0;Oe<pe.length;++Oe){var te=pe[Oe];if(!Re[te]){Re[te]=!0;var oe=Object.getOwnPropertyDescriptor(re,te);oe!=null&&oe.get==null&&oe.set==null&&ce.push(te)}}re=E.getPrototypeOf(re)}return ce}}var J={}.hasOwnProperty;return function(re){if(Y(re))return[];var ce=[];e:for(var Re in re)if(J.call(re,Re))ce.push(Re);else{for(var pe=0;pe<V.length;++pe)if(J.call(V[pe],Re))continue e;ce.push(Re)}return ce}}(),I=/this\s*\.\s*\S+\s*=/,k=/^[a-z$_][a-z$_0-9]*$/i,P="stack"in new Error?function(V){return g(V)?V:new Error(c(V))}:function(V){if(g(V))return V;try{throw new Error(c(V))}catch(Y){return Y}},F=function(V){return E.isArray(V)?V:null};if(typeof Symbol<"u"&&Symbol.iterator){var H=typeof Array.from=="function"?function(V){return Array.from(V)}:function(V){for(var Y,Z=[],J=V[Symbol.iterator]();!(Y=J.next()).done;)Z.push(Y.value);return Z};F=function(V){return E.isArray(V)?V:V!=null&&typeof V[Symbol.iterator]=="function"?H(V):null}}var D=_!==void 0&&h(_).toLowerCase()==="[object process]",$=_!==void 0&&_.env!==void 0,j={isClass:function(V){try{if(typeof V=="function"){var Y=E.names(V.prototype),Z=E.isES5&&Y.length>1,J=Y.length>0&&!(Y.length===1&&Y[0]==="constructor"),re=I.test(V+"")&&E.names(V).length>0;if(Z||J||re)return!0}return!1}catch{return!1}},isIdentifier:function(V){return k.test(V)},inheritedDataKeys:L,getDataPropertyOrDefault:function(V,Y,Z){if(!E.isES5)return{}.hasOwnProperty.call(V,Y)?V[Y]:void 0;var J=Object.getOwnPropertyDescriptor(V,Y);return J!=null?J.get==null&&J.set==null?J.value:Z:void 0},thrower:function(V){throw V},isArray:E.isArray,asArray:F,notEnumerableProp:a,isPrimitive:i,isObject:function(V){return typeof V=="function"||typeof V=="object"&&V!==null},isError:u,canEvaluate:y,errorObj:w,tryCatch:function(V){return C=V,n},inherits:function(V,Y){function Z(){for(var re in this.constructor=V,this.constructor$=Y,Y.prototype)J.call(Y.prototype,re)&&re.charAt(re.length-1)!=="$"&&(this[re+"$"]=Y.prototype[re])}var J={}.hasOwnProperty;return Z.prototype=Y.prototype,V.prototype=new Z,V.prototype},withAppended:function(V,Y){var Z,J=V.length,re=new Array(J+1);for(Z=0;Z<J;++Z)re[Z]=V[Z];return re[Z]=Y,re},maybeWrapAsError:function(V){return i(V)?new Error(c(V)):V},toFastProperties:function(V){return V},filledRange:function(V,Y,Z){for(var J=new Array(V),re=0;re<V;++re)J[re]=Y+re+Z;return J},toString:c,canAttachTrace:g,ensureErrorObject:P,originatesFromRejection:function(V){return V!=null&&(V instanceof Error.__BluebirdErrorTypes__.OperationalError||V.isOperational===!0)},markAsOriginatingFromRejection:function(V){try{a(V,"isOperational",!0)}catch{}},classString:h,copyDescriptors:function(V,Y,Z){for(var J=E.names(V),re=0;re<J.length;++re){var ce=J[re];if(Z(ce))try{E.defineProperty(Y,ce,E.getDescriptor(V,ce))}catch{}}},hasDevTools:typeof chrome<"u"&&chrome&&typeof chrome.loadTimes=="function",isNode:D,hasEnvVariables:$,env:function(V){return $?_.env[V]:void 0},global:O,getNativePromise:function(){if(typeof Promise=="function")try{var V=new Promise(function(){});if({}.toString.call(V)==="[object Promise]")return Promise}catch{}},domainBind:function(V,Y){return V.bind(Y)}};j.isRecentNode=j.isNode&&function(){var V=_.versions.node.split(".").map(Number);return V[0]===0&&V[1]>10||V[0]>0}(),j.isNode&&j.toFastProperties(_);try{throw new Error}catch(V){j.lastLineError=V}o.exports=j},{"./es5":13}]},{},[4])(4)}),typeof window<"u"&&window!==null?window.P=window.Promise:typeof self<"u"&&self!==null&&(self.P=self.Promise)}).call(this,S("_process"),typeof G<"u"?G:typeof self<"u"?self:typeof window<"u"?window:{},S("timers").setImmediate)},{_process:15,timers:16}],2:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.PreCallTest=void 0;var _=function(){function g(h,C){for(var E=0;E<C.length;E++){var y=C[E];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(h,y.key,y)}}return function(h,C,E){return C&&g(h.prototype,C),E&&g(h,E),h}}(),t=S("./turnConnection"),m=S("./tests/rttTest"),f=S("./tests/throughputTest"),o=S("./utility/resultsHandler"),s=S("./utility/onlineCheck"),n=S("./utility/stats/detectbrowser"),i=S("bluebird"),a="rtt",c="throughput",u=function(){function g(){(function(h,C){if(!(h instanceof C))throw new TypeError("Cannot call a class as a function")})(this,g),this.browserInfo=(0,n.detect)(),this.onlineCheck=new s.OnlineCheck,this.callsInProgress=0,this.turnTests=[a,c],this.active=!1,this.rtt=null,this.resultsHandler=null}return _(g,[{key:"start",value:function(h,C,E){if(this.browserInfo.browserName!==n.Constants.browserName.msie)if(this.iceServers=h,this.callback=E,this.active)this.callback&&this.callback(null,"Not started: already in progress");else if(0<this.callsInProgress)this.callback&&this.callback(null,"Not started: call in progress");else if(h){this.turnTestCounter=0,this.resultsHandler=new o.ResultsHandler,this.resultsHandler.setProvider(C);var y={type:"browser",os:this.browserInfo.os,osVersion:this.browserInfo.osVersion,buildName:this.browserInfo.browserName,buildVersion:this.browserInfo.browserVersion};this.resultsHandler.add("endpointInfo",y),this.onlineCheck.start(),this.active=!0,this._start()}else this.callback&&this.callback(null,"Not started: no ICE servers given");else this.callback&&this.callback(null,"Not started: disabled for IE")}},{key:"_start",value:function(){var h=this;this.active&&(this.turnConnection=new t.TurnConnection(this.browserInfo),this.turnConnection.connect(this.iceServers).then(function(){h.active?h.startTurnTests().then(function(){h.stop()},function(C){h.stop()}):h.stop()},function(C){var E=C.continueFlag;if(h.resultsHandler.failure(C),!E){h.turnConnection.disconnect(),h.active=!1;var y="";try{y=C.stack}catch{y=C.toString()}return y&&y!==""||(y=C.toString()),void h.callback(null,y)}h.resultsHandler.getFailureNumber()>=10?h.stop():(h.turnConnection.disconnect(),setTimeout(function(){h._start()},0))}))}},{key:"stop",value:function(){var h=this;if(this.browserInfo.browserName!==n.Constants.browserName.msie&&this.active){this.active=!1,this.activeTurnTest&&this.activeTurnTest.forceStop();var C=this.onlineCheck.stop();this.resultsHandler&&this.resultsHandler.add("onlineStatus",C),this.turnConnection.getIceResults().then(function(E){h.resultsHandler&&h.resultsHandler.add("ice",E),h.turnConnection.disconnect(),h.sendResults()},function(E){h.resultsHandler&&h.resultsHandler.failure(E),h.turnConnection.disconnect(),h.sendResults()})}}},{key:"sendResults",value:function(){if(this.resultsHandler){var h=this.resultsHandler.getResults();this.resultsHandler=null,this.callback&&this.callback(h,null)}else this.callback&&this.callback(null,"No results present")}},{key:"callStarts",value:function(){this.callsInProgress+=1,this.stop()}},{key:"callFinished",value:function(){this.callsInProgress-=1}},{key:"getId",value:function(){return this.resultsHandler?this.resultsHandler.getId():null}},{key:"crashDisconnect",value:function(){try{this.turnConnection.disconnect()}catch{}}},{key:"startTurnTests",value:function(){var h=this;if(this.turnTestCounter>=this.turnTests.length)return new i(function(y,w){y()});var C=this.turnTests[this.turnTestCounter],E=null;switch(C){case a:E=new m.RttTest(this.turnConnection);break;case c:E=new f.ThroughputTest(this.turnConnection,this.rtt);break;default:return new i(function(y,w){w(new Error("Unknown test: "+C))})}return this.activeTurnTest=E,this.active?E.start().then(function(){return h.handleTestResults(C,E.getResults()),h.turnTestCounter+=1,h.activeTurnTest=null,h.startTurnTests()},function(y){return h.handleTestResults(C,E.getResults(),y),h.turnTestCounter+=1,h.activeTurnTest=null,h.startTurnTests()}):new i(function(y,w){w(new Error("Test trying to start while testing is not active"))})}},{key:"handleTestResults",value:function(h,C){(2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)==null&&h==a&&(this.rtt=C.median),this.resultsHandler&&this.resultsHandler.add(h,C)}}]),g}();b.PreCallTest=u},{"./tests/rttTest":3,"./tests/throughputTest":4,"./turnConnection":6,"./utility/onlineCheck":8,"./utility/resultsHandler":10,"./utility/stats/detectbrowser":11,bluebird:1}],3:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.RttTest=void 0;var _=function(){function s(n,i){for(var a=0;a<i.length;a++){var c=i[a];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(n,c.key,c)}}return function(n,i,a){return i&&s(n.prototype,i),a&&s(n,a),n}}(),t=function s(n,i,a){n===null&&(n=Function.prototype);var c=Object.getOwnPropertyDescriptor(n,i);if(c===void 0){var u=Object.getPrototypeOf(n);return u===null?void 0:s(u,i,a)}if("value"in c)return c.value;var g=c.get;return g!==void 0?g.call(a):void 0},m=function(s){if(s&&s.__esModule)return s;var n={};if(s!=null)for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(n[i]=s[i]);return n.default=s,n}(S("../utility/timestamps")),f=S("./turnTest"),o=function(s){function n(i){(function(c,u){if(!(c instanceof u))throw new TypeError("Cannot call a class as a function")})(this,n);var a=function(c,u){if(!c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!u||typeof u!="object"&&typeof u!="function"?c:u}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,i));return a.sendTimer=null,a.countSent=0,a.rtts=[],a}return function(i,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof a);i.prototype=Object.create(a&&a.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(i,a):i.__proto__=a)}(n,f.TurnTest),_(n,[{key:"initiate",value:function(){this.results.startTimestamp=m.getCurrent(),this.sendPing()}},{key:"handleMessage",value:function(i){if(this.isActive()){var a=parseInt(i,10),c=this.calculateRtt(a);this.rtts.push(c),this.countSent<10?this.sendPing():this.calculateMetrics()}}},{key:"handleError",value:function(i){this.fillResults(),this.failed(i)}},{key:"sendPing",value:function(){if(this.isActive()){var i=m.getCurrent();this.send(i.toString()),this.countSent+=1,this.sendTimer&&(clearTimeout(this.sendTimer),this.sendTimer=null),this.countSent<10?this.sendTimer=setTimeout(this.sendPing.bind(this),100):this.sendTimer=setTimeout(this.calculateMetrics.bind(this),500)}}},{key:"calculateRtt",value:function(i){return m.getCurrent()-i}},{key:"calculateMetrics",value:function(){this.sendTimer&&(clearTimeout(this.sendTimer),this.sendTimer=null),this.fillResults(),this.finished()}},{key:"fillResults",value:function(){this.results.sentMessages=this.countSent,this.results.unAckedMessages=this.countSent-this.rtts.length,this.results.maxMessages=10,this.results.forceStopped=this.forceStopped,this.results.median=this.median(),this.results.average=this.average(),this.results.variance=this.variance(),this.results.endTimestamp=m.getCurrent()}},{key:"median",value:function(){if(this.rtts.length==0)return null;this.rtts.sort();var i=Math.floor(this.rtts.length/2);return this.rtts[i]}},{key:"average",value:function(){if(this.rtts.length==0)return null;for(var i=0,a=0;a<this.rtts.length;a++)i+=this.rtts[a];return i/this.rtts.length}},{key:"variance",value:function(){if(this.rtts.length==0)return null;for(var i=0,a=this.average(),c=0;c<this.rtts.length;c++){var u=this.rtts[c];i+=Math.pow(u-a,2)}return i/this.rtts.length}},{key:"stop",value:function(){this.isActive()&&(t(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"stop",this).call(this),this.fillResults())}}]),n}();b.RttTest=o},{"../utility/timestamps":14,"./turnTest":5}],4:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.ThroughputTest=void 0;var _=function(){function n(i,a){for(var c=0;c<a.length;c++){var u=a[c];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(i,u.key,u)}}return function(i,a,c){return a&&n(i.prototype,a),c&&n(i,c),i}}(),t=function n(i,a,c){i===null&&(i=Function.prototype);var u=Object.getOwnPropertyDescriptor(i,a);if(u===void 0){var g=Object.getPrototypeOf(i);return g===null?void 0:n(g,a,c)}if("value"in u)return u.value;var h=u.get;return h!==void 0?h.call(c):void 0},m=function(n){if(n&&n.__esModule)return n;var i={};if(n!=null)for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a]);return i.default=n,i}(S("../utility/timestamps")),f=S("../utility/messageMaker"),o=S("./turnTest"),s=function(n){function i(a,c){(function(h,C){if(!(h instanceof C))throw new TypeError("Cannot call a class as a function")})(this,i);var u=function(h,C){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!C||typeof C!="object"&&typeof C!="function"?h:C}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,a));if(u.sentBytes=0,u.receivedBytes=0,u.secondHalfBytes=0,u.secondHalfStart=null,u.bufferEmpty=0,u.chunkSize=1200,u.messageMaker=new f.MessageMaker(u.chunkSize),u.duration=5e3,c!=null){var g=50*c;u.duration=Math.max(Math.min(g,1e4),1e3)}return u.sendTimer=null,u.lastMessage=null,u.intervals=[],u.intervalStart=0,u.intervalLength=100,u.intervalBytes=0,u}return function(a,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}(i,o.TurnTest),_(i,[{key:"initiate",value:function(){window&&window.csioReactNative?this.handleError(new Error("Not running throughput test for react-native")):this.startSend()}},{key:"handleMessage",value:function(a){var c=this;if(this.isActive()){this.lastMessage=a,this.receivedBytes+=a.length;var u=m.getCurrent();if(this.sendTimer||(this.results.startTimestamp=u,this.sendTimer=setTimeout(function(){c.stop(),c.finished()},this.duration)),this.intervalStart==0&&(this.intervalStart=u),this.intervalBytes+=a.length,u-this.intervalStart>=this.intervalLength){var g=u-this.intervalStart,h=this.averageThroughput(this.intervalBytes,g),C=null;try{C=u-JSON.parse(this.lastMessage).timestamp}catch{}this.intervals.push({startTimestamp:this.intervalStart,endTimestamp:u,bytesReceived:this.intervalBytes,average:h,rtt:C}),this.intervalStart=u,this.intervalBytes=0}this.results.startTimestamp&&u-this.results.startTimestamp>this.duration/2&&(this.secondHalfStart||(this.secondHalfStart=u),this.secondHalfBytes+=a.length)}}},{key:"handleError",value:function(a){this.stop(),this.failed(a)}},{key:"averageThroughput",value:function(a,c){return a/(c/1e3)*8/1024}},{key:"bufferListener",value:function(){this.sendChannel.removeEventListener("bufferedamountlow",this.bufferListener.bind(this)),this.fillBuffer()}},{key:"fillBuffer",value:function(){for(this.sendChannel.bufferedAmount==0&&(this.bufferEmpty+=1);this.isActive();){if(this.sendChannel.bufferedAmount>this.bufferFullThreshold)return void(this.usePolling?setTimeout(this.fillBuffer.bind(this),250):this.sendChannel.addEventListener("bufferedamountlow",this.bufferListener.bind(this)));var a=this.messageMaker.make(this.sentBytes);this.sentBytes+=a.length,this.send(a)}this.sendChannel.removeEventListener("bufferedamountlow",this.bufferListener.bind(this))}},{key:"startSend",value:function(){this.isActive()&&(this.bufferFullThreshold=1e3*this.chunkSize,this.sendChannel=this.connection.sendChannel,this.usePolling=!0,typeof this.sendChannel.bufferedAmountLowThreshold=="number"&&(this.usePolling=!1,this.sendChannel.bufferedAmountLowThreshold=this.bufferFullThreshold/10),setTimeout(this.fillBuffer.bind(this),0))}},{key:"fillResults",value:function(){this.results.endTimestamp=m.getCurrent(),this.results.maxDuration=this.duration,this.results.forceStopped=this.forceStopped,this.results.bufferEmpty=this.bufferEmpty,this.results.intervals=this.intervals,this.results.bytesPrepared=this.sentBytes,this.results.bytesReceived=this.receivedBytes;var a=0,c=0;this.secondHalfStart&&(a=this.results.endTimestamp-this.secondHalfStart,c=this.averageThroughput(this.secondHalfBytes,a));var u=this.results.endTimestamp-this.results.startTimestamp,g=this.averageThroughput(this.receivedBytes,u);c<g&&(c=g),this.results.average=c;var h=null;try{h=JSON.parse(this.lastMessage)}catch{return}if(h){var C=h.sentBytes+this.lastMessage.length;this.results.bytesSent=C,this.results.fractionLostBytes=1-this.receivedBytes/C}else this.results.bytesSent=-1,this.results.fractionLostBytes=-1}},{key:"stop",value:function(){this.isActive()&&(clearTimeout(this.sendTimer),this.sendTimer=null,t(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"stop",this).call(this),this.fillResults())}}]),i}();b.ThroughputTest=s},{"../utility/messageMaker":7,"../utility/timestamps":14,"./turnTest":5}],5:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0});var _=function(){function f(o,s){for(var n=0;n<s.length;n++){var i=s[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(o,i.key,i)}}return function(o,s,n){return s&&f(o.prototype,s),n&&f(o,n),o}}(),t=S("bluebird"),m=function(){function f(o){(function(s,n){if(!(s instanceof n))throw new TypeError("Cannot call a class as a function")})(this,f),this.connection=o,this.active=!1,this.results={}}return _(f,[{key:"getResults",value:function(){return this.results}},{key:"start",value:function(){var o=this,s=new t(function(n,i){o.resolveCb=n,o.rejectCb=i});return this.connection.setMessageCallback(this.handleMessage.bind(this)),this.connection.setErrorCallback(this.handleError.bind(this)),this.active=!0,this.forceStopped=!1,this.initiate(),s}},{key:"stop",value:function(){this.active=!1}},{key:"forceStop",value:function(){this.forceStopped=!0,this.stop(),this.finished()}},{key:"isActive",value:function(){return this.active}},{key:"initiate",value:function(){}},{key:"handleMessage",value:function(o){}},{key:"handleError",value:function(o){}},{key:"send",value:function(o){this.connection.send(o)}},{key:"finished",value:function(){this.active=!1,this.resolveCb&&(this.resolveCb(),this.resolveCb=null)}},{key:"failed",value:function(o){this.active=!1,this.rejectCb&&(this.rejectCb(o),this.rejectCb=null)}}]),f}();b.TurnTest=m},{bluebird:1}],6:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.TurnConnection=void 0;var _=function(){function n(i,a){for(var c=0;c<a.length;c++){var u=a[c];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(i,u.key,u)}}return function(i,a,c){return a&&n(i.prototype,a),c&&n(i,c),i}}(),t=S("./utility/parsedIceCandidate"),m=S("./utility/stats/getstatshandler"),f=S("./utility/stats/detectbrowser"),o=S("bluebird"),s=function(){function n(i){(function(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function")})(this,n),this.reset(),this.statshandler=new m.GetStatsHandler(i)}return _(n,[{key:"reset",value:function(){this.disconnect(),this.iceServers=null,this.pctpc1=null,this.pctpc2=null,this.sendChannel=null,this.messageCallback=null,this.errorCallback=null,this.parsedIceResults={},this.resolveCb=null,this.rejectCb=null}},{key:"setMessageCallback",value:function(i){this.messageCallback=i}},{key:"setErrorCallback",value:function(i){this.errorCallback=i}},{key:"send",value:function(i){if(this.sendChannel)try{this.sendChannel.send(i)}catch(a){this.raiseSendError(a)}else this.raiseSendError(new Error("No send channel"))}},{key:"raiseSendError",value:function(i){this.errorCallback&&this.errorCallback(i)}},{key:"assignEvent",value:function(i,a,c){i.addEventListener?i.addEventListener(a,c.bind(this),!1):i.attachEvent&&(a="on"+a,i.attachEvent(a,c.bind(this)))}},{key:"connect",value:function(i){var a=this;this.reset();var c=new o(function(C,E){a.resolveCb=C,a.rejectCb=E});this.iceServers=i;var u=null;try{if(RTCPeerConnection?u=RTCPeerConnection:webkitRTCPeerConnection?u=webkitRTCPeerConnection:mozRTCPeerConnection?u=mozRTCPeerConnection:window&&window.RTCPeerConnection&&(u=window.RTCPeerConnection),!u){var g=new Error("RTCPeerConnection not found");return g.continueFlag=!1,this.rejectCb(g),c}}catch(C){return C.continueFlag=!1,this.rejectCb(C),c}var h={iceTransportPolicy:"all",iceServers:this.iceServers};try{this.pctpc1=new u(h),this.pctpc2=new u(h)}catch(C){return this.rejectDisconnect(!1,C),c}this.connectionTimer=setTimeout(function(){delete a.connectionTimer,a.rejectDisconnect(!1,new Error("Connection timeout"))},3e4);try{this.sendChannel=this.pctpc1.createDataChannel("precalltest",{ordered:!1,maxRetransmits:0}),this.sendChannel.binaryType="arraybuffer",this.assignEvent(this.sendChannel,"error",function(C){a.raiseSendError(C),a.rejectDisconnect(!0,C)}),this.assignEvent(this.pctpc2,"datachannel",function(C){var E=C.channel;a.assignEvent(E,"open",function(y){a.resolveCb&&(a.resolveCb(),a.resolveCb=null)}),a.assignEvent(E,"close",function(y){a&&a.disconnect&&a.disconnect()}),a.assignEvent(E,"message",function(y){a.messageCallback&&a.messageCallback(y.data)}),a.assignEvent(E,"error",function(y){a.errorCallback&&a.errorCallback(y),a.rejectDisconnect(!0,y)})})}catch(C){return this.rejectDisconnect(!1,C),c}try{this.assignEvent(this.pctpc1,"icecandidate",function(C){a.onIceCandidate(a.pctpc1,C)}),this.assignEvent(this.pctpc1,"iceconnectionstatechange",function(C){a.onIceStateChange(a.pctpc1,C)}),this.assignEvent(this.pctpc2,"icecandidate",function(C){a.onIceCandidate(a.pctpc2,C)}),this.assignEvent(this.pctpc2,"iceconnectionstatechange",function(C){a.onIceStateChange(a.pctpc2,C)}),this.pctpc1.createOffer().then(function(C,E){a.onCreateOfferSuccess(C)},function(C){a.onCreateOfferError(a.pctpc1,C)})}catch(C){return this.rejectDisconnect(!1,C),c}return c}},{key:"rejectDisconnect",value:function(i,a){this.disconnect(),this.rejectCb&&(a.continueFlag=i,this.rejectCb(a)),this.resolveCb=null,this.rejectCb=null}},{key:"disconnect",value:function(){if(clearTimeout(this.connectionTimer),clearTimeout(this.iceTimer),this.pctpc1)try{this.pctpc1.close()}catch{}if(this.pctpc1=null,this.pctpc2)try{this.pctpc2.close()}catch{}this.pctpc2=null}},{key:"getName",value:function(i){return i===this.pctpc1?"pctpc1":"pctpc2"}},{key:"getOtherPc",value:function(i){return i===this.pctpc1?this.pctpc2:this.pctpc1}},{key:"onCreateOfferError",value:function(i,a){this.rejectDisconnect(!1,a)}},{key:"onCreateAnswerError",value:function(i,a){this.rejectDisconnect(!1,a)}},{key:"onCreateOfferSuccess",value:function(i){var a=this;try{this.pctpc1.setLocalDescription(i).then(function(){a.onSetLocalSuccess(a.pctpc1)},function(c){a.onSetSessionDescriptionError(a.pctpc1,c)}),this.pctpc2.setRemoteDescription(i).then(function(){a.onSetRemoteSuccess(a.pctpc2)},function(c){a.onSetRemoteSessionDescriptionError(a.pctpc2,c)}),this.pctpc2.createAnswer().then(function(c){a.onCreateAnswerSuccess(c)},function(c){a.onCreateAnswerError(a.pctpc2,c)})}catch(c){this.rejectDisconnect(!1,c)}}},{key:"onSetLocalSuccess",value:function(i){}},{key:"onSetRemoteSuccess",value:function(i){}},{key:"onSetSessionDescriptionError",value:function(i,a){this.rejectDisconnect(!1,a)}},{key:"onSetRemoteSessionDescriptionError",value:function(i,a){this.rejectDisconnect(!1,a)}},{key:"onCreateAnswerSuccess",value:function(i){var a=this;try{this.pctpc2.setLocalDescription(i).then(function(){a.onSetLocalSuccess(a.pctpc2)},function(c){a.onSetSessionDescriptionError(a.pctpc2,c)}),this.pctpc1.setRemoteDescription(i).then(function(){a.onSetRemoteSuccess(a.pctpc1)},function(c){a.onSetRemoteSessionDescriptionError(a.pctpc1,c)})}catch(c){this.rejectDisconnect(!1,c)}}},{key:"onIceCandidate",value:function(i,a){var c=this;try{if(!a.candidate)return;var u=new t.ParsedIceCandidate(a.candidate);if(i==this.pctpc1&&this.statshandler.codeBase==f.Constants.codeBaseType.chrome&&(u.isRelay()&&(u.isTypeTransportUdp()&&(this.parsedIceResults.relayUdpGathered=!0),u.isTypeTransportTcp()&&(this.parsedIceResults.relayTcpGathered=!0),u.isTypeTransportTls()&&(this.parsedIceResults.relayTlsGathered=!0)),u.isServerReflexive()&&(this.parsedIceResults.srflxGathered=!0)),!u.isRelay())return;this.getOtherPc(i).addIceCandidate(a.candidate).then(function(){c.onAddIceCandidateSuccess(i)},function(g){c.onAddIceCandidateError(i,g,u.isRelay())})}catch(g){this.rejectDisconnect(!1,g)}}},{key:"onAddIceCandidateSuccess",value:function(i){}},{key:"onAddIceCandidateError",value:function(i,a,c){c&&this.rejectDisconnect(!1,a)}},{key:"onIceStateChange",value:function(i,a){var c=this;try{var u="(?)";i&&(u=i.iceConnectionState),u==="failed"&&this.rejectDisconnect(!0,new Error("ICE failure")),u!=="checking"||this.iceTimer||(this.iceTimer=setTimeout(function(){delete c.iceTimer,c.rejectDisconnect(!0,new Error("ICE timeout"))},1e4)),u!=="completed"&&u!=="connected"||(clearTimeout(this.iceTimer),delete this.iceTimer)}catch(g){this.rejectDisconnect(!1,g)}}},{key:"getIceResults",value:function(){var i=this;return new o(function(a,c){for(var u=JSON.parse(JSON.stringify(i.iceServers)),g=0;g<u.length;g++){var h=u[g];u.hasOwnProperty(h)||delete h.credential}var C={turnIpAddress:"",turnIpVersion:"",turnTransport:"",iceServers:u,ipv6Supported:!1,ipv4Supported:!1,relayTlsGathered:!1,relayTcpGathered:!1,relayUdpGathered:!1,srflxGathered:!1,relayTlsSuccess:!1,relayTcpSuccess:!1,relayUdpSuccess:!1,srflxSuccess:!1};for(var E in i.parsedIceResults)i.parsedIceResults.hasOwnProperty(E)&&(C[E]=i.parsedIceResults[E]);i.pctpc1?i.statshandler.getIceCandidates(i.pctpc1).then(function(y){for(var w=0;w<y.iceCandidatePairs.length;w++){var O=y.iceCandidatePairs[w];if(O.googActiveConnection||O.selected)for(var L=0;L<y.localCandidates.length;L++){var I=y.localCandidates[L],k=null;if(k=I.ip?I.ip:I.ipAddress,I.id==O.localCandidateId){var P=(C.turnIpAddress=k).indexOf(":")!==-1;C.turnIpVersion=P?"ipv6":"ipv4",C.turnTransport=I.mozLocalTransport}I.candidateType!=="relay"&&I.candidateType!=="relayed"||(I.mozLocalTransport==="udp"&&(C.relayUdpSuccess=!0),I.mozLocalTransport==="tcp"&&(C.relayTcpSuccess=!0),I.mozLocalTransport==="tls"&&(C.relayTlsSuccess=!0)),k.indexOf(":")!==-1?C.ipv6Supported=!0:C.ipv4Supported=!0}}for(var F=0;F<y.localCandidates.length;F++){var H=y.localCandidates[F];H.candidateType!=="relay"&&H.candidateType!=="relayed"||(H.mozLocalTransport==="udp"&&(C.relayUdpGathered=!0),H.mozLocalTransport==="tcp"&&(C.relayTcpGathered=!0),H.mozLocalTransport==="tls"&&(C.relayTlsGathered=!0)),H.candidateType!=="srflx"&&H.candidateType!=="serverreflexive"||(C.srflxGathered=!0)}for(var D=0;D<y.iceCandidatePairs.length;D++){var $=y.iceCandidatePairs[D];if($.state==="succeeded")for(var j=0;j<y.localCandidates.length;j++){var V=y.localCandidates[j];V.id==$.localCandidateId&&(V.candidateType!=="relay"&&V.candidateType!=="relayed"||(V.mozLocalTransport==="udp"&&(C.relayUdpSuccess=!0),V.mozLocalTransport==="tcp"&&(C.relayTcpSuccess=!0),V.mozLocalTransport==="tls"&&(C.relayTlsSuccess=!0)),V.candidateType!=="srflx"&&V.candidateType!=="serverreflexive"||(C.srflxSuccess=!0))}}a(C)},function(y){c(y)}):c(new Error("PC not available for stats"))},function(a){reject(a)})}}]),n}();b.TurnConnection=s},{"./utility/parsedIceCandidate":9,"./utility/stats/detectbrowser":11,"./utility/stats/getstatshandler":12,bluebird:1}],7:[function(S,p,b){function _(s,n){if(!(s instanceof n))throw new TypeError("Cannot call a class as a function")}function t(s){for(var n="",i=0;i<s;i++)n+=String.fromCharCode(35+58*Math.random());return n}Object.defineProperty(b,"__esModule",{value:!0}),b.randomAsciiString=b.MessageMaker=void 0;var m=function(){function s(n,i){for(var a=0;a<i.length;a++){var c=i[a];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(n,c.key,c)}}return function(n,i,a){return i&&s(n.prototype,i),a&&s(n,a),n}}(),f=function(s){if(s&&s.__esModule)return s;var n={};if(s!=null)for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(n[i]=s[i]);return n.default=s,n}(S("../utility/timestamps")),o=function(){function s(){var n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1200;_(this,s),this.message={timestamp:"",sentBytes:1e4,padding:""};var i=t(n-f.getCurrent().toString().length-JSON.stringify(this.message).length);this.message.padding=i}return m(s,[{key:"make",value:function(n){return this.message.timestamp=f.getCurrent(),this.message.sentBytes=n,JSON.stringify(this.message)}}]),s}();b.MessageMaker=o,b.randomAsciiString=t},{"../utility/timestamps":14}],8:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.OnlineCheck=void 0;var _=function(){function f(o,s){for(var n=0;n<s.length;n++){var i=s[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(o,i.key,i)}}return function(o,s,n){return s&&f(o.prototype,s),n&&f(o,n),o}}(),t=function(f){if(f&&f.__esModule)return f;var o={};if(f!=null)for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(o[s]=f[s]);return o.default=f,o}(S("./timestamps")),m=function(){function f(){(function(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")})(this,f),this.active=!1}return _(f,[{key:"start",value:function(){var o=this;this.active=!0,this.onlineCheck=[],window&&window.addEventListener&&typeof window.addEventListener=="function"&&(window.addEventListener("offline",function(){o.addEntry()}),window.addEventListener("online",function(){o.addEntry()}),this.addEntry())}},{key:"addEntry",value:function(){if(this.active){var o=t.getCurrent();if(navigator&&navigator.onLine){var s=navigator.onLine;this.onlineCheck.push({timestamp:o,online:s})}}}},{key:"stop",value:function(){var o=this;return this.active=!1,window&&window.removeEventListener&&typeof window.removeEventListener=="function"&&(window.removeEventListener("offline",function(){o.addEntry()}),window.removeEventListener("online",function(){o.addEntry()})),this.onlineCheck}}]),f}();b.OnlineCheck=m},{"./timestamps":14}],9:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0});var _=function(){function m(f,o){for(var s=0;s<o.length;s++){var n=o[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(f,n.key,n)}}return function(f,o,s){return o&&m(f.prototype,o),s&&m(f,s),f}}(),t=function(){function m(f){(function(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")})(this,m),this.iceCandidateStr=f.candidate,this.parse()}return _(m,[{key:"parse",value:function(){var f=this.iceCandidateStr.split(" ");f.length<8||(this.protocol=f[1]==="1"?"rtp":"rtcp",this.transport=f[2],this.typeTransport=this.extractTypeTransport(f[3]),this.ipv6=f[4].indexOf(":")!==-1,this.ipAddress=f[4],this.port=f[5],this.type=f[7])}},{key:"extractTypeTransport",value:function(f){var o="None",s=f>>24;if(this.protocol==="rtp"&&0<=s&&s<=2)switch(s){case 0:o="TLS";break;case 1:o="TCP";break;case 2:o="UDP"}return o}},{key:"getString",value:function(){return this.iceCandidateStr}},{key:"getType",value:function(){return this.type}},{key:"isHost",value:function(){return this.type.toLowerCase()==="host"}},{key:"isServerReflexive",value:function(){return this.type.toLowerCase()==="srflx"}},{key:"isPeerReflexive",value:function(){return this.type.toLowerCase()==="prflx"}},{key:"isRelay",value:function(){return this.type.toLowerCase()==="relay"||this.type.toLowerCase()==="relayed"}},{key:"getTypeTransport",value:function(){return this.typeTransport}},{key:"isTypeTransportUdp",value:function(){return this.typeTransport==="UDP"}},{key:"isTypeTransportTcp",value:function(){return this.typeTransport==="TCP"}},{key:"isTypeTransportTls",value:function(){return this.typeTransport==="TLS"}},{key:"getTransport",value:function(){return this.transport}},{key:"isUdp",value:function(){return this.transport.toLowerCase()==="udp"}},{key:"isTcp",value:function(){return this.transport.toLowerCase()==="tcp"}},{key:"getProtocol",value:function(){return this.protocol}},{key:"isRtp",value:function(){return this.protocol==="rtp"}},{key:"isRtcp",value:function(){return this.protocol==="rtcp"}},{key:"isIpv6",value:function(){return this.ipv6}},{key:"getIpAddress",value:function(){return this.ipAddress}},{key:"getPort",value:function(){return this.port}}]),m}();b.ParsedIceCandidate=t},{}],10:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.ResultsHandler=void 0;var _=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},t=function(){function s(n,i){for(var a=0;a<i.length;a++){var c=i[a];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(n,c.key,c)}}return function(n,i,a){return i&&s(n.prototype,i),a&&s(n,a),n}}(),m=function(s){if(s&&s.__esModule)return s;var n={};if(s!=null)for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(n[i]=s[i]);return n.default=s,n}(S("./timestamps")),f=S("./messageMaker"),o=function(){function s(){(function(n,i){if(!(n instanceof i))throw new TypeError("Cannot call a class as a function")})(this,s),this.start=m.getCurrent(),this.id=Math.trunc(this.start)+"-"+(0,f.randomAsciiString)(20),this.version="1.3.1",this.failures=[],this.results={},this.forceStopped=!0,this.provider="callstats"}return t(s,[{key:"setProvider",value:function(n){n&&(this.provider=n)}},{key:"getResults",value:function(){return{id:this.id,version:this.version,forceStopped:this.forceStopped,startTimestamp:this.start,endTimestamp:m.getCurrent(),failures:this.failures,tests:this.results,provider:this.provider}}},{key:"getFailureNumber",value:function(){return this.failures.length}},{key:"getId",value:function(){return this.id}},{key:"add",value:function(n,i){(this.results[n]=i).hasOwnProperty("forceStopped")&&(this.forceStopped=i.forceStopped)}},{key:"failure",value:function(n){(n===void 0?"undefined":_(n))==="object"&&(n=n.toString());var i={timestamp:m.getCurrent(),reason:n};this.failures.push(i)}}]),s}();b.ResultsHandler=o},{"./messageMaker":7,"./timestamps":14}],11:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.detect=function(){var t=_.browserName.chrome,m=null,f=null,o=null,s=null,n=_.codeBaseType.chrome;if(window&&(!window.navigator||!window.navigator.userAgent||window.csioReactNative))return window&&window.csioGetOsName&&(m=window.csioGetOsName()),window&&window.csioGetOsVer&&(f=window.csioGetOsVer()),window&&window.csioReactNative&&(o="react-native"),{browserName:t,codeBase:n,os:m,osVersion:f,userAgent:o};var i=(o=navigator.userAgent).toLowerCase(),a=void 0,c=void 0;(s=navigator.appVersion)&&(a=s.toLowerCase(),c=""+parseFloat(a));var u=void 0,g="Version";(u=i.indexOf("opera"))!==-1?(t=_.browserName.opera,c=i.substring(u+6),(u=i.indexOf(g))!==-1&&(c=i.substring(u+8)),n=_.codeBaseType.chrome):(u=i.indexOf("opr"))!==-1?(t=_.browserName.opera,c=i.substring(u+4),(u=i.indexOf(g))!==-1&&(c=i.substring(u+8)),n=_.codeBaseType.chrome):(u=i.indexOf("msie"))!==-1?(t=_.browserName.msie,c=i.substring(u+5),n=_.codeBaseType.chrome):(u=i.indexOf("edge"))!==-1?(t=_.browserName.edge,c=i.substring(u+5),n=_.codeBaseType.edge):(u=i.indexOf("chrome"))!==-1?(t=_.browserName.chrome,c=i.substring(u+7),n=_.codeBaseType.chrome):(u=i.indexOf("safari"))!==-1?(t=_.browserName.safari,c=i.substring(u+7),(u=i.indexOf(g))!==-1&&(c=i.substring(u+8)),n=_.codeBaseType.chrome):(u=i.indexOf("firefox"))!==-1?(t=_.browserName.firefox,c=i.substring(u+8),n=_.codeBaseType.firefox):(u=i.indexOf("trident"))!==-1&&(t=_.browserName.msie,u=i.indexOf("rv"),c=i.substring(u+3,u+7),n=_.codeBaseType.chrome);var h=[{s:"Windows 3.11",r:/win16/},{s:"Windows 95",r:/(windows 95|win95|windows_95)/},{s:"Windows ME",r:/(win 9x 4.90|windows me)/},{s:"Windows 98",r:/(windows 98|win98)/},{s:"Windows CE",r:/windows ce/},{s:"Windows 2000",r:/(windows nt 5.0|windows 2000)/},{s:"Windows XP",r:/(windows nt 5.1|windows xp)/},{s:"Windows Server 2003",r:/windows nt 5.2/},{s:"Windows Vista",r:/windows nt 6.0/},{s:"Windows 7",r:/(windows 7|windows nt 6.1)/},{s:"Windows 8.1",r:/(windows 8.1|windows nt 6.3)/},{s:"Windows 8",r:/(windows 8|windows nt 6.2)/},{s:"Windows 10",r:/(windows 10|windows nt 10.0)/},{s:"Windows NT 4.0",r:/(windows nt 4.0|winnt4.0|winnt|windows nt)/},{s:"Windows ME",r:/windows me/},{s:"Android",r:/android/},{s:"Open BSD",r:/openbsd/},{s:"Sun OS",r:/sunos/},{s:"Linux",r:/(linux|x11)/},{s:"iOS",r:/(iphone|ipad|ipod)/},{s:"Mac OS X",r:/mac os x/},{s:"Mac OS",r:/(macppc|macintel|mac_powerpc|macintosh)/},{s:"QNX",r:/qnx/},{s:"UNIX",r:/unix/},{s:"BeOS",r:/beos/},{s:"OS/2",r:/os\/2/},{s:"Search Bot",r:/(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\/teoma|ia_archiver)/}],C=void 0,E=void 0;for(C in h)if(h.hasOwnProperty(C)&&(E=h[C]).r.test(i)){m=E.s;break}switch(m&&/Windows/.test(m)&&(f=/Windows (.*)/.exec(m)[1],m=_.osName.windows),m){case _.osName.mac:f=/mac os x (10[\.\_\d]+)/.exec(i)[1];break;case _.osName.android:f=/android ([\.\_\d]+)/.exec(i)[1];break;case _.osName.ios:if(!a||!(f=/os (\d+)_(\d+)_?(\d+)?/.exec(a)))break;f=f[1]+"."+f[2]+"."+(0|f[3])}return{browserName:t,browserVersion:c.toString(),os:m,osVersion:f,codeBase:n,userAgent:o}};var _=b.Constants={codeBaseType:{chrome:"Chrome",firefox:"Firefox",edge:"Edge",plugin:"Plugin"},browserName:{chrome:"Chrome",firefox:"Firefox",edge:"Edge",msie:"Microsoft Internet Explorer",safari:"Safari"},osName:{windows:"Windows",mac:"Mac OS X",android:"Android",ios:"iOS"}}},{}],12:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.GetStatsHandler=void 0;var _=function(){function s(n,i){for(var a=0;a<i.length;a++){var c=i[a];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(n,c.key,c)}}return function(n,i,a){return i&&s(n.prototype,i),a&&s(n,a),n}}(),t=S("./detectbrowser"),m=S("./statsadapter"),f=S("bluebird"),o=function(){function s(n){(function(i,a){if(!(i instanceof a))throw new TypeError("Cannot call a class as a function")})(this,s),this.codeBase=n.codeBase,this.browserName=n.browserName,this.adapter=new m.StatsAdapter(this.codeBase,this.browserName),this.isPromiseBased=!0}return _(s,[{key:"getIceCandidates",value:function(n){var i=this;return new f(function(a,c){i.csioGetStats(i.iceCandidatesHandler.bind(i),n,function(u){a(u)})})}},{key:"iceCandidatesHandler",value:function(n,i){i(this.adapter.getIceCandidates(n))}},{key:"csioGetStats",value:function(n,i,a){var c=t.Constants.codeBaseType.firefox,u=t.Constants.codeBaseType.chrome,g=t.Constants.codeBaseType.edge,h=t.Constants.browserName.safari;i&&(this.codeBase===c?this.getStatsFirefox(n,i,a):this.browserName===h?this.getStatsSafari(n,i,a):this.codeBase===u?this.getStatsChrome(n,i,a):this.codeBase===g&&this.getStatsEdge(n,i,a))}},{key:"getStatsFirefox",value:function(n,i,a){var c=this;if(c.isPromiseBased)try{i.getStats().then(function(u){n(u,a)}).catch(function(u){c.isPromiseBased=!1,i.getStats(null,function(g){n(g,a)},function(){})})}catch{c.isPromiseBased=!1,i.getStats(null,function(g){n(g,a)},function(){})}else i.getStats(null,function(u){n(u,a)},function(){})}},{key:"getStatsChrome",value:function(n,i,a){var c=this;if(window&&window.csioReactNative)i.getStats(null,function(u){n(u,a)},function(u){});else if(c.isPromiseBased)try{i.getStats().then(function(u){n(u,a)}).catch(function(u){c.isPromiseBased=!1,i.getStats(function(g){n(g,a)})})}catch{isPromiseBased=!1,i.getStats(function(g){n(g,a)})}else i.getStats(function(u){n(u,a)})}},{key:"getStatsEdge",value:function(n,i,a){i.getStats().then(function(c){n(c,a)}).catch(function(c){})}},{key:"getStatsSafari",value:function(n,i,a){i.getStats().then(function(c){n(c,a)}).catch(function(c){})}}]),s}();b.GetStatsHandler=o},{"./detectbrowser":11,"./statsadapter":13,bluebird:1}],13:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.StatsAdapter=void 0;var _=function(){function f(o,s){for(var n=0;n<s.length;n++){var i=s[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(o,i.key,i)}}return function(o,s,n){return s&&f(o.prototype,s),n&&f(o,n),o}}(),t=S("./detectbrowser"),m=function(){function f(o,s){(function(n,i){if(!(n instanceof i))throw new TypeError("Cannot call a class as a function")})(this,f),this.codeBase=o,this.browser=s}return _(f,[{key:"getIceCandidates",value:function(o){if(!o)return{localCandidates:[],remoteCandidates:[],iceCandidatePairs:[]};var s=this.extractRawStats(o);return this.processRawStatsForIceInfo(s)}},{key:"extractRawStats",value:function(o){var s=[],n=void 0,i=t.Constants.codeBaseType.firefox,a=t.Constants.codeBaseType.chrome,c=t.Constants.browserName.safari;if(this.codeBase===i&&this.browser!==c)o.forEach(function(u){s.push(u)});else if(this.codeBase===a&&this.browser!==c)o&&o.result?s=o.result():o&&o.forEach&&(s=[],o.forEach(function(u){s.push(u)}));else for(n in o)o.hasOwnProperty(n)&&s.push(o[n]);return s}},{key:"processRawStatsForIceInfo",value:function(o){var s=[],n=[],i=[],a=void 0;if(!o)return{localCandidates:s,remoteCandidates:n,iceCandidatePairs:i};for(var c=0;c<o.length;++c){var u=this.getParsedStats(o[c]),g=this.statsClassifier(u);if(g.candidatePair)i.push(g.candidatePair);else if(g.transportStats){if(g.transportStats.type==="transport"){a=g.transportStats.selectedCandidatePairId;continue}i.push(g.transportStats)}else if(g.localCandidate){var h=g.localCandidate;if(h.candidateType=="relay"||h.candidateType=="relayed"){if(!h.mozLocalTransport){var C=h.priority>>24;h.mozLocalTransport=this.formatRelayType(C)}h.mozLocalTransport=h.mozLocalTransport.toLowerCase()}s.push(h)}else g.remoteCandidate&&n.push(g.remoteCandidate)}if(a)for(var E=0;E<i.length;++E)i[E].id===a&&(i[E].googActiveConnection="true");return{localCandidates:s,remoteCandidates:n,iceCandidatePairs:i}}},{key:"getParsedStats",value:function(o){var s={};if(o.timestamp instanceof Date&&(s.timestamp=o.timestamp.getTime().toString()),o.type&&(s.type=o.type),o.names)for(var n=o.names(),i=0;i<n.length;++i)s[n[i]]=o.stat(n[i]);else Object.assign(s,o);if(s.values){for(var a=0;a<s.values.length;a++){var c=s.values[a];Object.assign(s,c)}delete s.values}return s}},{key:"statsClassifier",value:function(o){var s={},n=function(){for(var c=arguments.length,u=Array(c),g=0;g<c;g++)u[g]=arguments[g];for(var h=0;h<u.length;h++){var C=u[h];if(o.type===C)return!0}return!1},i=n("inbound-rtp","inboundrtp"),a=o.isRemote==="true"||o.isRemote===!0;return i||n("outbound-rtp","outboundrtp")?(s.tracks={},s.tracks.data=o,s.tracks.ssrc=o.ssrc,s.tracks.streamType=i?"inbound":"outbound",s.tracks.reportType="local",o.isRemote!==void 0&&(s.tracks.reportType=a?"remote":"local")):n("candidatepair")&&o.selected?s.transportStats=o:n("localcandidate","local-candidate")?s.localCandidate=o:n("remotecandidate","remote-candidate")?s.remoteCandidate=o:n("transport","googCandidatePair")?s.transportStats=o:n("VideoBwe")?s.bwe=o:n("track")?s.trackStats=o:n("candidate-pair")?s.candidatePair=o:n("codec")?s.codec=o:n("ssrc")&&(s.tracks={},s.tracks.data=o,s.tracks.ssrc=o.ssrc,s.tracks.reportType="local",s.tracks.streamType=o.bytesSent?"outbound":"inbound"),s}},{key:"formatRelayType",value:function(o){var s="none";switch(o){case 0:s="tls";break;case 1:s="tcp";break;case 2:s="udp"}return s}}]),f}();b.StatsAdapter=m},{"./detectbrowser":11}],14:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.getCurrent=function(){return window&&window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now()}},{}],15:[function(S,p,b){function _(){throw new Error("setTimeout has not been defined")}function t(){throw new Error("clearTimeout has not been defined")}function m(E){if(i===setTimeout)return setTimeout(E,0);if((i===_||!i)&&setTimeout)return i=setTimeout,setTimeout(E,0);try{return i(E,0)}catch{try{return i.call(null,E,0)}catch{return i.call(this,E,0)}}}function f(){h&&u&&(h=!1,u.length?g=u.concat(g):C=-1,g.length&&o())}function o(){if(!h){var E=m(f);h=!0;for(var y=g.length;y;){for(u=g,g=[];++C<y;)u&&u[C].run();C=-1,y=g.length}u=null,h=!1,function(w){if(a===clearTimeout)return clearTimeout(w);if((a===t||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(w);try{a(w)}catch{try{return a.call(null,w)}catch{return a.call(this,w)}}}(E)}}function s(E,y){this.fun=E,this.array=y}function n(){}var i,a,c=p.exports={};(function(){try{i=typeof setTimeout=="function"?setTimeout:_}catch{i=_}try{a=typeof clearTimeout=="function"?clearTimeout:t}catch{a=t}})();var u,g=[],h=!1,C=-1;c.nextTick=function(E){var y=new Array(arguments.length-1);if(arguments.length>1)for(var w=1;w<arguments.length;w++)y[w-1]=arguments[w];g.push(new s(E,y)),g.length!==1||h||m(o)},s.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=n,c.addListener=n,c.once=n,c.off=n,c.removeListener=n,c.removeAllListeners=n,c.emit=n,c.prependListener=n,c.prependOnceListener=n,c.listeners=function(E){return[]},c.binding=function(E){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(E){throw new Error("process.chdir is not supported")},c.umask=function(){return 0}},{}],16:[function(S,p,b){(function(_,t){function m(a,c){this._id=a,this._clearFn=c}var f=S("process/browser.js").nextTick,o=Function.prototype.apply,s=Array.prototype.slice,n={},i=0;b.setTimeout=function(){return new m(o.call(setTimeout,window,arguments),clearTimeout)},b.setInterval=function(){return new m(o.call(setInterval,window,arguments),clearInterval)},b.clearTimeout=b.clearInterval=function(a){a.close()},m.prototype.unref=m.prototype.ref=function(){},m.prototype.close=function(){this._clearFn.call(window,this._id)},b.enroll=function(a,c){clearTimeout(a._idleTimeoutId),a._idleTimeout=c},b.unenroll=function(a){clearTimeout(a._idleTimeoutId),a._idleTimeout=-1},b._unrefActive=b.active=function(a){clearTimeout(a._idleTimeoutId);var c=a._idleTimeout;c>=0&&(a._idleTimeoutId=setTimeout(function(){a._onTimeout&&a._onTimeout()},c))},b.setImmediate=typeof _=="function"?_:function(a){var c=i++,u=!(arguments.length<2)&&s.call(arguments,1);return n[c]=!0,f(function(){n[c]&&(u?a.apply(null,u):a.call(null),b.clearImmediate(c))}),c},b.clearImmediate=typeof t=="function"?t:function(a){delete n[a]}}).call(this,S("timers").setImmediate,S("timers").clearImmediate)},{"process/browser.js":15,timers:16}],17:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0});var _=function(){function m(f,o){for(var s=0;s<o.length;s++){var n=o[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(f,n.key,n)}}return function(f,o,s){return o&&m(f.prototype,o),s&&m(f,s),f}}(),t=function(){function m(){var f=this;(function(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")})(this,m),this.batteryManager=null,typeof navigator.getBattery=="function"&&navigator.getBattery().then(function(o){f.batteryManager=o})}return _(m,[{key:"getLevel",value:function(){return this.batteryManager?this.batteryManager.level:-1}},{key:"getCharging",value:function(){return this.batteryManager?this.batteryManager.charging:null}}]),m}();b.Battery=t},{}],18:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.detect=function(){var t=_.browserName.chrome,m=null,f=null,o=null,s=null,n=_.codeBaseType.chrome;if(!window.navigator.userAgent||window.csioReactNative)return window&&window.csioGetOsName&&(m=window.csioGetOsName()),window&&window.csioGetOsVer&&(f=window.csioGetOsVer()),window&&window.csioReactNative&&(o="react-native"),{browserName:t,codeBase:n,os:m,osVersion:f,userAgent:o,browserVersion:null};var i=(o=navigator.userAgent).toLowerCase(),a=void 0,c=void 0;(s=navigator.appVersion)&&(a=s.toLowerCase(),c=""+parseFloat(a));var u=void 0;(u=i.indexOf("opera"))!==-1?(t=_.browserName.opera,c=i.substring(u+6),(u=i.indexOf("Version"))!==-1&&(c=i.substring(u+8)),n=_.codeBaseType.chrome):(u=i.indexOf("opr"))!==-1?(t=_.browserName.opera,c=i.substring(u+4),(u=i.indexOf("Version"))!==-1&&(c=i.substring(u+8)),n=_.codeBaseType.chrome):(u=i.indexOf("msie"))!==-1?(t=_.browserName.msie,c=i.substring(u+5),n=_.codeBaseType.chrome):(u=i.indexOf("edge"))!==-1?(t=_.browserName.edge,c=i.substring(u+5),n=_.codeBaseType.edge):(u=i.indexOf("chrome"))!==-1?(t=_.browserName.chrome,c=i.substring(u+7),n=_.codeBaseType.chrome):(u=i.indexOf("safari"))!==-1?(t=_.browserName.safari,c=i.substring(u+7),(u=i.indexOf("Version"))!==-1&&(c=i.substring(u+8)),n=_.codeBaseType.chrome):(u=i.indexOf("firefox"))!==-1?(t=_.browserName.firefox,c=i.substring(u+8),n=_.codeBaseType.firefox):(u=i.indexOf("trident"))!==-1&&(t=_.browserName.msie,u=i.indexOf("rv"),c=i.substring(u+3,u+7),n=_.codeBaseType.chrome);var g=[{s:"Windows 3.11",r:/win16/},{s:"Windows 95",r:/(windows 95|win95|windows_95)/},{s:"Windows ME",r:/(win 9x 4.90|windows me)/},{s:"Windows 98",r:/(windows 98|win98)/},{s:"Windows CE",r:/windows ce/},{s:"Windows 2000",r:/(windows nt 5.0|windows 2000)/},{s:"Windows XP",r:/(windows nt 5.1|windows xp)/},{s:"Windows Server 2003",r:/windows nt 5.2/},{s:"Windows Vista",r:/windows nt 6.0/},{s:"Windows 7",r:/(windows 7|windows nt 6.1)/},{s:"Windows 8.1",r:/(windows 8.1|windows nt 6.3)/},{s:"Windows 8",r:/(windows 8|windows nt 6.2)/},{s:"Windows 10",r:/(windows 10|windows nt 10.0)/},{s:"Windows NT 4.0",r:/(windows nt 4.0|winnt4.0|winnt|windows nt)/},{s:"Windows ME",r:/windows me/},{s:"Android",r:/android/},{s:"Open BSD",r:/openbsd/},{s:"Sun OS",r:/sunos/},{s:"Linux",r:/(linux|x11)/},{s:"iOS",r:/(iphone|ipad|ipod)/},{s:"Mac OS X",r:/mac os x/},{s:"Mac OS",r:/(macppc|macintel|mac_powerpc|macintosh)/},{s:"QNX",r:/qnx/},{s:"UNIX",r:/unix/},{s:"BeOS",r:/beos/},{s:"OS/2",r:/os\/2/},{s:"Search Bot",r:/(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\/teoma|ia_archiver)/}],h=void 0,C=void 0;for(h in g)if(g.hasOwnProperty(h)&&(C=g[h]).r.test(i)){m=C.s;break}switch(m&&/Windows/.test(m)&&(f=/Windows (.*)/.exec(m)[1],m=_.osName.windows),m){case _.osName.mac:f=/mac os x (10[\.\_\d]+)/.exec(i)[1];break;case _.osName.android:f=/android ([\.\_\d]+)/.exec(i)[1];break;case _.osName.ios:if(!a||!(f=/os (\d+)_(\d+)_?(\d+)?/.exec(a)))break;f=f[1]+"."+f[2]+"."+(0|f[3])}return{browserName:t,browserVersion:c.toString(),os:m,osVersion:f,codeBase:n,userAgent:o}};var _=function(t){if(t&&t.__esModule)return t;var m={};if(t!=null)for(var f in t)Object.prototype.hasOwnProperty.call(t,f)&&(m[f]=t[f]);return m.default=t,m}(S("../config/constants"))},{"../config/constants":33}],19:[function(S,p,b){function _(i){if(i&&i.__esModule)return i;var a={};if(i!=null)for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(a[c]=i[c]);return a.default=i,a}Object.defineProperty(b,"__esModule",{value:!0}),b.Devices=void 0;var t=function(){function i(a,c){for(var u=0;u<c.length;u++){var g=c[u];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(a,g.key,g)}}return function(a,c,u){return c&&i(a.prototype,c),u&&i(a,u),a}}(),m=_(S("../config/constants")),f=S("../utility/registry"),o=_(S("../utility/csiologger")),s=_(S("../utility/utils")),n=function(){function i(a,c){(function(u,g){if(!(u instanceof g))throw new TypeError("Cannot call a class as a function")})(this,i),this.conferenceId=a,this.pc=c,this.devices=null,this.emb=f.Registry.getEventMessageBuilder()}return t(i,[{key:"collectConnected",value:function(){var a=this;if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){var c=this;navigator.mediaDevices.enumerateDevices().then(function(u){var g=s.normalizeMediaDeviceList(u);c.sendConnected(g),setTimeout(a.collectConnected.bind(c),1e4)}).catch(function(u){setTimeout(a.collectConnected.bind(c),1e4)})}}},{key:"sendConnected",value:function(a){this.devices&&this.compare(a)||(this.devices=a,this.send())}},{key:"compare",value:function(a){return self.devices.sort().toString()===a.sort().toString()}},{key:"send",value:function(){var a={mediaDeviceList:this.devices};o.log("sending connectedDevice",m.internalFabricEvent.connectedDeviceList,a),this.emb.make(m.internalFabricEvent.connectedDeviceList,this.conferenceId,this.pc,a)}}]),i}();b.Devices=n},{"../config/constants":33,"../utility/csiologger":88,"../utility/registry":95,"../utility/utils":101}],20:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.store=function(_,t){if(t)try{window&&window.localStorage&&window.localStorage.setItem(_,t)}catch{return}},b.get=function(_){try{if(window&&window.localStorage)return window.localStorage.getItem(_)}catch{return null}return null},b.remove=function(_){try{window&&window.localStorage&&window.localStorage.removeItem(_)}catch{return}}},{}],21:[function(S,p,b){function _(m,f){if(f)try{window&&window.sessionStorage&&window.sessionStorage.setItem(m,f)}catch{return}}function t(m){try{if(window&&window.sessionStorage)return window.sessionStorage.getItem(m)}catch{return null}return null}Object.defineProperty(b,"__esModule",{value:!0}),b.store=_,b.get=t,b.remove=function(m){try{window&&window.sessionStorage&&window.sessionStorage.removeItem(m)}catch{return}},b.storeUcId=function(m,f){if(m){var o=JSON.parse(t("csio_ucid_data"));o||(o={}),o[m]||(o[m]={}),o[m].ucID=f,_("csio_ucid_data",JSON.stringify(o))}},b.getUcId=function(m){if(!m)return null;var f=JSON.parse(t("csio_ucid_data"));return f&&f[m]?f[m].ucID:null}},{}],22:[function(S,p,b){(function(_){function t(O){if(O&&O.__esModule)return O;var L={};if(O!=null)for(var I in O)Object.prototype.hasOwnProperty.call(O,I)&&(L[I]=O[I]);return L.default=O,L}function m(O,L){var I={};return I.status=O,L&&(I.message=L),I}function f(O,L){return O+": "+L+" "+(arguments.length>2&&arguments[2]!==void 0?arguments[2]:"")}function o(O){if(O===null)return!1;var L=g.Registry.getEndpoint().getCodeBase();if(L===i.codeBaseType.firefox)return typeof mozRTCPeerConnection<"u"&&O instanceof mozRTCPeerConnection||typeof RTCPeerConnection<"u"&&O instanceof RTCPeerConnection;if(L===i.codeBaseType.edge||typeof O=="function")return!0;var I=function(){var k=null,P=g.Registry.getEndpoint().getBrowserName();return P==="Firefox"?k=mozRTCPeerConnection:P==="Chrome"||P==="Opera"?k=webkitRTCPeerConnection:P==="Safari"?h.log("Browser type Safari"):P==="Edge"&&(k=window.RTCPeerConnection),k}();return I!==null&&O instanceof I||O.createOffer!==void 0}var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(O){return typeof O}:function(O){return O&&typeof Symbol=="function"&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O},n=function(){function O(L,I){for(var k=0;k<I.length;k++){var P=I[k];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(L,P.key,P)}}return function(L,I,k){return I&&O(L.prototype,I),k&&O(L,k),L}}(),i=t(S("./config/constants")),a=t(S("./config/settings")),c=S("./config/callstatserrors"),u=S("./fsm/mainfsm"),g=S("./utility/registry"),h=t(S("./utility/csiologger")),C=t(S("./utility/onerroreventlistner")),E=t(S("./utility/utils"));C.setErrorEventListener(),E.assignPollyfill(),E.isIntegerPollyfill();var y=null,w=function(){function O(){(function(L,I){if(!(L instanceof I))throw new TypeError("Cannot call a class as a function")})(this,O),y=new u.MainFSM}return n(O,[{key:"initialize",value:function(L,I,k,P,F,H){if(!L||!k||!I){var D=f("initialize",c.csErrorStrings.argumentError);return h.error(D),m(i.callstatsAPIReturnStatus.failure,D)}if(P&&typeof P!="function"){var $=f("initialize",c.csErrorStrings.argumentError);h.warn($),P=null}if(F&&typeof F!="function"){var j=f("initialize",c.csErrorStrings.argumentError);h.warn(j),F=null}if(typeof I!="function"&&!(window.crypto&&(window.crypto.subtle||window.crypto.webkitSubtle)||window.msCrypto&&window.msCrypto.subtle||window.csioReactNative)){var V=f("initialize",c.csErrorStrings.cryptoError);return h.error(V),P&&P(c.csError.tokenGenerationError,c.csErrorStrings.cryptoError),m(i.callstatsAPIReturnStatus.failure,V)}try{y.fire(u.MainEvents.onInitialize,L,k,I,P,F,H),y.run()}catch(Y){g.Registry.getGenericEventHandler().sendEvent(i.logEvents.error,{msg:"initialize: Error",error:Y.message+":"+Y.stack}),h.error("initialize: Error",Y)}return m(i.callstatsAPIReturnStatus.success)}},{key:"addNewFabric",value:function(L,I,k,P,F,H){var D=null,$=i.endpointType.peer,j=i.transmissionDirection.sendrecv;if(I===void 0){var V=f("addNewFabric",c.csErrorStrings.argumentError);return h.error(V),m(i.callstatsAPIReturnStatus.failure,V)}if(P===void 0){var Y=f("addNewFabric",c.csErrorStrings.argumentError);return h.error(Y),m(i.callstatsAPIReturnStatus.failure,Y)}if(P||(P=i.tmpConferenceId),!L||!k){var Z=f("addNewFabric",c.csErrorStrings.argumentError);return h.error(Z),m(i.callstatsAPIReturnStatus.failure,Z)}if(H&&typeof H=="function"&&(D=H),F&&typeof F=="function"&&(D=F),F&&typeof F!="function"){if(F.remoteEndpointType){if(!i.endpointType.hasOwnProperty(F.remoteEndpointType)){var J=f("addNewFabric",c.csErrorStrings.invalidEndPointType,F.remoteEndpointType);return h.error(J),m(i.callstatsAPIReturnStatus.failure,J)}$=F.remoteEndpointType}if(F.fabricTransmissionDirection){if(!i.transmissionDirection.hasOwnProperty(F.fabricTransmissionDirection)){var re=f("addNewFabric",c.csErrorStrings.invalidTransmissionDirection,F.fabricTransmissionDirection);return h.error(re),m(i.callstatsAPIReturnStatus.failure,re)}j=F.fabricTransmissionDirection}}if(!i.fabricUsage.hasOwnProperty(k)||k instanceof Function){var ce=f("addNewFabric",c.csErrorStrings.fabricUsageInvalid,k);return h.error(ce),m(i.callstatsAPIReturnStatus.failure,ce)}if(!o(L)){var Re=f("addNewFabric",c.csErrorStrings.pcInvalid);return h.error(Re),m(i.callstatsAPIReturnStatus.failure,Re)}var pe=g.Registry.getConferenceManager().get(P);if(pe&&pe.getPeerConnectionManager().getPcHandler(L))return m(i.callstatsAPIReturnStatus.success);if(!g.Registry.getCredentials().getAppId()||!g.Registry.getCredentials().getUserId()){var Oe=f("addNewFabric",c.csErrorStrings.notInitialized);return h.error(Oe),m(i.callstatsAPIReturnStatus.failure,Oe)}try{y.fire(u.MainEvents.onAddNewFabric,L,I,k,P,$,j,D),y.run()}catch(te){g.Registry.getGenericEventHandler().sendEvent(i.logEvents.error,{msg:"addNewFabric: Error",error:te.message+":"+te.stack}),h.error("addNewFabric: Error",te)}return m(i.callstatsAPIReturnStatus.success)}},{key:"sendFabricEvent",value:function(L,I,k,P){if(h.log("sendFabricEvent ",I),k||(k=i.tmpConferenceId),!L||!I){var F=f("sendFabricEvent",c.csErrorStrings.argumentError);return h.error(F),m(i.callstatsAPIReturnStatus.failure,F)}if(I===i.fabricEvent.fabricSetupFailed){var H=f("sendFabricEvent",c.csErrorStrings.fabricEventUnsupported,I);return h.error(H),m(i.callstatsAPIReturnStatus.failure,H)}if(!i.fabricEvent.hasOwnProperty(I)&&!i.internalFabricEvent.hasOwnProperty(I)){var D=f("sendFabricEvent",c.csErrorStrings.fabricEventInvalid,I);return h.error(D),m(i.callstatsAPIReturnStatus.failure,D)}if(!(I!==i.fabricEvent.activeDeviceList||P&&P.deviceList)){var $=f("sendFabricEvent ",c.csErrorStrings.argumentError);return h.error($),m(i.callstatsAPIReturnStatus.failure,$)}var j=g.Registry.getConferenceManager().get(k);if(!g.Registry.getCredentials().getAppId()||!g.Registry.getCredentials().getUserId()||!j){var V=f("sendFabricEvent ",c.csErrorStrings.notInitialized);return h.error(V),m(i.callstatsAPIReturnStatus.failure,V)}if(!j.getPeerConnectionManager().getPcHandler(L)){var Y=f("sendFabricEvent ",c.csErrorStrings.pcInvalid);return h.error(Y),m(i.callstatsAPIReturnStatus.failure,Y)}try{y.fire(u.MainEvents.onSendFabricEvent,L,I,k,P),y.run()}catch(Z){g.Registry.getGenericEventHandler().sendEvent(i.logEvents.error,{msg:"sendFabricEvent: Error",error:Z.message+":"+Z.stack}),h.error("sendFabricEvent: Error",Z)}return m(i.callstatsAPIReturnStatus.success)}},{key:"sendUserFeedback",value:function(L,I,k){if(!I||!L){var P=f("sendUserFeedback",c.csErrorStrings.argumentError);return h.error(P),m(i.callstatsAPIReturnStatus.failure,P)}if((I===void 0?"undefined":s(I))!=="object"){var F=f("sendUserFeedback",c.csErrorStrings.argumentError);return h.error(F),m(i.callstatsAPIReturnStatus.failure,F)}if(Object.keys(I).length===0){var H=f("sendUserFeedback",c.csErrorStrings.argumentError);return h.error(H),m(i.callstatsAPIReturnStatus.failure,H)}try{y.fire(u.MainEvents.onSendUserFeedback,L,I,k),y.run()}catch(D){g.Registry.getGenericEventHandler().sendEvent(i.logEvents.error,{msg:"sendUserFeedback: Error",error:D.message+":"+D.stack}),h.error("sendUserFeedback: Error",D)}return m(i.callstatsAPIReturnStatus.success)}},{key:"associateMstWithUserID",value:function(L,I,k,P,F,H){if(k||(k=i.tmpConferenceId),!L||!P||!F){var D=f("associateMstWithUserID",c.csErrorStrings.argumentError);return h.error(D),m(i.callstatsAPIReturnStatus.failure,D)}if(!o(L)){var $=f("associateMstWithUserID",c.csErrorStrings.pcInvalid);return h.error($),m(i.callstatsAPIReturnStatus.failure,$)}var j=g.Registry.getConferenceManager().get(k);if(!j){var V=f("associateMstWithUserID",c.csErrorStrings.confereneDoesNotExist);return h.error(V),m(i.callstatsAPIReturnStatus.failure,V)}if(!j.getPeerConnectionManager().getPcHandler(L)){var Y=f("associateMstWithUserID",c.csErrorStrings.pcInvalid);return h.error(Y),m(i.callstatsAPIReturnStatus.failure,Y)}H&&typeof H!="string"&&(h.error("associateMstWithUserID: Invalid videoTag"),H=null);try{y.fire(u.MainEvents.onAssociateMstWithUserID,L,I,k,P,F,H),y.run()}catch(Z){g.Registry.getGenericEventHandler().sendEvent(i.logEvents.error,{msg:"associateMstWithUserID: Error",error:Z.message+":"+Z.stack}),h.error("associateMstWithUserID: Error",Z)}return m(i.callstatsAPIReturnStatus.success)}},{key:"reportError",value:function(L,I,k,P,F,H){if(I||(I=i.tmpConferenceId),L===void 0||!k){var D=f("reportError",c.csErrorStrings.argumentError);return h.error(D),m(i.callstatsAPIReturnStatus.failure,D)}if(!i.webRTCFunctions.hasOwnProperty(k)){var $=f("reportError",c.csErrorStrings.webRTCFunctionsInvalid,k);return h.error($),m(i.callstatsAPIReturnStatus.failure,$)}if(P===void 0&&h.warn("reportError: Missing DOM error parameter"),!g.Registry.getCredentials().getAppId()||!g.Registry.getCredentials().getUserId()){var j=f("reportError",c.csErrorStrings.notInitialized);return h.error(j),m(i.callstatsAPIReturnStatus.failure,j)}try{y.fire(u.MainEvents.onReportError,L,I,k,P,F,H),y.run()}catch(V){g.Registry.getGenericEventHandler().sendEvent(i.logEvents.error,{msg:"reportError: Error",error:V.message+":"+V.stack}),h.error("reportError: Error",V)}return m(i.callstatsAPIReturnStatus.success)}},{key:"setProxyConfig",value:function(L){if(window&&!window.csioproxy){var I=f("setProxyConfig",c.csErrorStrings.setProxyConfigInvokeError);return h.error(I),m(i.callstatsAPIReturnStatus.failure,I)}if(!L){var k=f("setProxyConfig",c.csErrorStrings.argumentError);return h.error(k),m(i.callstatsAPIReturnStatus.failure,k)}try{y.fire(u.MainEvents.onSetProxyConfig,L),y.run()}catch(P){g.Registry.getGenericEventHandler().sendEvent(i.logEvents.error,{msg:"setProxyConfig: Error",error:P.message+":"+P.stack}),h.error("setProxyConfig: Error",P)}return m(i.callstatsAPIReturnStatus.success)}},{key:"attachWifiStatsHandler",value:function(L){if(!L){var I=f("attachWifiStatsHandler",c.csErrorStrings.argumentError);return h.error(I),m(i.callstatsAPIReturnStatus.failure,I)}if(typeof L!="function"){var k=f("attachWifiStatsHandler",c.csErrorStrings.argumentError);return h.error(k),m(i.callstatsAPIReturnStatus.failure,k)}try{y.fire(u.MainEvents.onAttachWifiStatsHandler,L),y.run()}catch(P){g.Registry.getGenericEventHandler().sendEvent(i.logEvents.error,{msg:"attachWifiStatsHandler: Error",error:P.message+":"+P.stack}),h.error("attachWifiStatsHandler: Error",P)}return m(i.callstatsAPIReturnStatus.success)}},{key:"setIdentifiers",value:function(L,I){if(!L){var k=f("setIdentifiers",c.csErrorStrings.argumentError);return h.error(k),m(i.callstatsAPIReturnStatus.failure,k)}try{y.fire(u.MainEvents.onSetIdentifiers,L,I),y.run()}catch(P){g.Registry.getGenericEventHandler().sendEvent(i.logEvents.error,{msg:"setIdentifiers: Error",error:P.message+":"+P.stack}),h.error("setIdentifiers: Error",P)}return m(i.callstatsAPIReturnStatus.success)}},{key:"makePrecallTest",value:function(L,I){if(!g.Registry.getAuthenticator().getToken()||!g.Registry.getCredentials().getAppId()){var k=f("makePrecallTest",c.csErrorStrings.notInitialized);return h.error(k),m(i.callstatsAPIReturnStatus.failure,k)}if(!g.Registry.getAuthenticator().getIceServers()){var P=f("makePrecallTest",c.csErrorStrings.notInitialized);return h.error(P),m(i.callstatsAPIReturnStatus.failure,P)}if(!g.Registry.getCredentials().getCollectSDP()){var F=f("makePrecallTest",c.csErrorStrings.apiaccesserror);return h.error(F),m(i.callstatsAPIReturnStatus.failure,F)}try{y.fire(u.MainEvents.onMakePrecallTest,L,I),y.run()}catch(H){g.Registry.getGenericEventHandler().sendEvent(i.logEvents.error,{msg:"on: Error",error:H.message+":"+H.stack}),h.error("makePrecallTest: Error",H)}return m(i.callstatsAPIReturnStatus.success)}},{key:"on",value:function(L,I){if(!I||typeof I!="function"){var k=f("on",c.csErrorStrings.argumentError);return h.error(k),m(i.callstatsAPIReturnStatus.failure,k)}if(!L||!i.callbackFunctions.hasOwnProperty(L)){var P=f("on",c.csErrorStrings.argumentError);return h.error(P),m(i.callstatsAPIReturnStatus.failure,P)}try{y.fire(u.MainEvents.onOn,L,I),y.run()}catch(F){g.Registry.getGenericEventHandler().sendEvent(i.logEvents.error,{msg:"on: Error",error:F.message+":"+F.stack}),h.error("on: Error",F)}return m(i.callstatsAPIReturnStatus.success)}},{key:"fabricUsage",get:function(){return this.constructor.fabricUsage}},{key:"fabricEvent",get:function(){return this.constructor.fabricEvent}},{key:"webRTCFunctions",get:function(){return this.constructor.webRTCFunctions}},{key:"csError",get:function(){return this.constructor.csError}},{key:"qualityRating",get:function(){return this.constructor.qualityRating}},{key:"callStatsAPIReturnStatus",get:function(){return this.constructor.callStatsAPIReturnStatus}},{key:"version",get:function(){return this.constructor.version}},{key:"userIDType",get:function(){return this.constructor.userIDType}},{key:"transmissionDirection",get:function(){return this.constructor.transmissionDirection}},{key:"endpointType",get:function(){return this.constructor.endpointType}}]),O}();w.fabricUsage=i.fabricUsage,w.fabricEvent=i.fabricEvent,w.webRTCFunctions=i.webRTCFunctions,w.csError=c.csError,w.qualityRating=i.qualityRating,w.callStatsAPIReturnStatus=i.callstatsAPIReturnStatus,w.version=a.version,w.userIDType=i.userIdType,w.endpointType=i.endpointType,w.transmissionDirection=i.transmissionDirection,function(){function O(){return new w}x=[],(N=typeof(q=O)=="function"?q.apply(U,x):q)!==void 0&&(Se.exports=N),p.exports=O}()}).call(this,typeof G<"u"?G:typeof self<"u"?self:typeof window<"u"?window:{})},{"./config/callstatserrors":32,"./config/constants":33,"./config/settings":34,"./fsm/mainfsm":35,"./utility/csiologger":88,"./utility/onerroreventlistner":94,"./utility/registry":95,"./utility/utils":101}],23:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.BinaryTree=void 0;var _=function(){function o(s,n){for(var i=0;i<n.length;i++){var a=n[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(s,a.key,a)}}return function(s,n,i){return n&&o(s.prototype,n),i&&o(s,i),s}}(),t=S("./binarytreenode.js"),m=function(o){if(o&&o.__esModule)return o;var s={};if(o!=null)for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(s[n]=o[n]);return s.default=o,s}(S("../utility/csiologger")),f=function(){function o(s){(function(n,i){if(!(n instanceof i))throw new TypeError("Cannot call a class as a function")})(this,o),this.root=null,this.top=null,this.bottom=null,this.comparator=s,this.node_counter=0,this.duplicate_counter=0}return _(o,[{key:"getTopNode",value:function(){return this.top}},{key:"getTopValue",value:function(){return this.top===null?null:this.top.peek()}},{key:"getBottomValue",value:function(){return this.bottom===null?null:this.bottom.peek()}},{key:"getBottomNode",value:function(){return this.bottom}},{key:"getDuplicatedCounter",value:function(){return this.duplicate_counter}},{key:"getNodeCounter",value:function(){return this.node_counter}},{key:"getSize",value:function(){return this.duplicate_counter+this.node_counter}},{key:"insertNodeAtTop",value:function(s){s&&this.inserting(s.getValues(),this.top)}},{key:"insertNodeAtBottom",value:function(s){s&&this.inserting(s.getValues(),this.bottom)}},{key:"insert",value:function(s){this.inserting([s],this.root)}},{key:"createNode",value:function(s){var n=new(Function.prototype.bind.apply(t.BinaryTreeNode,[null].concat(function(i){if(Array.isArray(i)){for(var a=0,c=Array(i.length);a<i.length;a++)c[a]=i[a];return c}return Array.from(i)}(s))));return(this.top===null||this.comparator(this.top.peek(),n.peek())<0)&&(this.top=n),(this.bottom===null||this.comparator(n.peek(),this.bottom.peek())<0)&&(this.bottom=n),n}},{key:"inserting",value:function(s,n){if(this.root===null)return this.root=this.createNode(s),this.node_counter=1,void(this.duplicate_counter+=s.length-1);for(var i=null,a=n,c=0;a!==null;){if((c=this.comparator(s[0],a.peek()))===0)return a.concat(s),this.duplicate_counter+=s.length,void a.find(s[0]);i=a,a=c<0?a.getLeft():a.getRight()}++this.node_counter,this.duplicate_counter+=s.length-1,a=this.createNode(s),c<0?i.setLeft(a):i.setRight(a)}},{key:"getRightist",value:function(s){for(var n=null;s.right!==null;)n=s,s=s.right;return[s,n]}},{key:"getLeftist",value:function(s){for(var n=null;s.getLeft()!==null;)n=s,s=s.getLeft();return[s,n]}},{key:"popBottomNode",value:function(){if(this.bottom===null)return null;var s=this.search(this.bottom.peek()),n=s[0],i=s[1];return n===null?null:(this.replaceNode(n,i,n.getRight()),this.disposeNode(n),--this.node_counter,this.duplicate_counter-=n.getLength()-1,n.setRight(null),n)}},{key:"popTopNode",value:function(){if(this.top===null)return null;var s=this.search(this.top.peek()),n=s[0],i=s[1];return n===null?null:(this.replaceNode(n,i,n.getLeft()),this.disposeNode(n),--this.node_counter,this.duplicate_counter-=n.getLength()-1,n.setLeft(null),n)}},{key:"search",value:function(s){for(var n=this.root,i=null,a=void 0;n!==null;){if((a=this.comparator(s,n.peek()))===0)return n.find(s)?[n,i]:[null,null];i=n,n=a<0?n.getLeft():n.getRight()}return[null,null]}},{key:"replaceNode",value:function(s,n,i){n!==null?n.left===s?n.left=i:n.right=i:this.root=i}},{key:"disposeNode",value:function(s){if(s!==null){if(this.root===null)return void(this.bottom=this.top=null);if(this.comparator(this.top.peek(),s.peek())===0){var n=this.getRightist(this.root);this.top=n[0]}if(this.comparator(this.bottom.peek(),s.peek())===0){var i=this.getLeftist(this.root);this.bottom=i[0]}}}},{key:"delete",value:function(s){var n=this.search(s),i=n[0],a=n[1];if(i===null)return!1;if(1<i.getLength())return i.remove(s),--this.duplicate_counter,!0;if(--this.node_counter,i.getLeft()===null&&i.getRight()===null)this.replaceNode(i,a,null);else if(i.getLeft()===null)this.replaceNode(i,a,i.getRight());else if(i.getRight()===null)this.replaceNode(i,a,i.getLeft());else{for(var c=i.getLeft(),u=i;c.getRight()!==null;u=c,c=c.getRight());var g=c.getLeft();u===i?u.setLeft(g):u.setRight(g),i.setValues(c.getValues())}return this.disposeNode(i),!0}},{key:"logging",value:function(){this.root!==null?(m.log("Size of the tree: "+this.getSize()+" Node: "+this.getNodeCounter()+" Duplicates: "+this.getDuplicatedCounter()+" Top: "+this.getTopNode().toString()+" Bottom: "+this.getBottomNode().toString()),function s(n,i,a){if(n!==null){for(var c="-",u=0;u<i;++u)c+="--";m.log(c+"> ("+a+") ["+n.toString()+"]"),n.getLeft()!==null&&s(n.getLeft(),i+1,"Left"),n.getRight()!==null&&s(n.getRight(),i+1,"Right")}}(this.root,0,"Root")):m.log("This tree is empty Duplicate Counter: "+this.duplicate_counter)}}]),o}();b.BinaryTree=f},{"../utility/csiologger":88,"./binarytreenode.js":24}],24:[function(S,p,b){function _(f,o){if(!(f instanceof o))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var t=function(){function f(o,s){for(var n=0;n<s.length;n++){var i=s[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(o,i.key,i)}}return function(o,s,n){return s&&f(o.prototype,s),n&&f(o,n),o}}(),m=function(){function f(){_(this,f);for(var o=arguments.length,s=Array(o),n=0;n<o;n++)s[n]=arguments[n];this.values=s,this.left=null,this.right=null}return t(f,[{key:"getRight",value:function(){return this.right}},{key:"setRight",value:function(o){this.right=o}},{key:"getLeft",value:function(){return this.left}},{key:"setLeft",value:function(o){this.left=o}},{key:"push",value:function(o){this.values.push(o)}},{key:"concat",value:function(o){this.values=this.values.concat(o)}},{key:"pop",value:function(){return this.values.length<1?null:this.values.shift()}},{key:"remove",value:function(o){this.values.splice(this.values.indexOf(o),1)}},{key:"setValues",value:function(o){this.values=o}},{key:"getValues",value:function(){return this.values}},{key:"hasValue",value:function(){return 0<this.values.length}},{key:"getLength",value:function(){return this.values.length}},{key:"peek",value:function(){return this.values.length<1?null:this.values[0]}},{key:"find",value:function(o){return this.values.find(function(s){return s===o})}},{key:"toString",value:function(){return this.values.toString()}}]),f}();b.BinaryTreeNode=m},{}],25:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.Cache=void 0;var _=function(){function f(o,s){for(var n=0;n<s.length;n++){var i=s[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(o,i.key,i)}}return function(o,s,n){return s&&f(o.prototype,s),n&&f(o,n),o}}(),t=function(f){if(f&&f.__esModule)return f;var o={};if(f!=null)for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(o[s]=f[s]);return o.default=f,o}(S("../utility/csiologger")),m=function(){function f(){(function(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")})(this,f),this.queue=[],this.priority=[]}return _(f,[{key:"add",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this.length()>1e6?t.error("Maximum cached items reached, dropping."):s?this.priority.push(o):this.queue.push(o)}},{key:"pop",value:function(){return this.priority.length>0?this.priority.shift():this.queue.shift()}},{key:"peak",value:function(){return this.priority.length>0?this.priority[0]:this.queue.length>0?this.queue[0]:null}},{key:"length",value:function(){return this.queue.length+this.priority.length}},{key:"updateConferenceId",value:function(o){for(var s=0;s<this.queue.length;++s)this.queue[s].updateConferenceId(o);for(var n=0;n<this.priority.length;++n)this.priority[n].updateConferenceId(o)}}]),f}();b.Cache=m},{"../utility/csiologger":88}],26:[function(S,p,b){function _(s,n){if(!(s instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0}),b.Component=void 0;var t=function(){function s(n,i){for(var a=0;a<i.length;a++){var c=i[a];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(n,c.key,c)}}return function(n,i,a){return i&&s(n.prototype,i),a&&s(n,a),n}}(),m=S("./port"),f=function(s){if(s&&s.__esModule)return s;var n={};if(s!=null)for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(n[i]=s[i]);return n.default=s,n}(S("../utility/csiologger")),o=function(){function s(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"Unknown";_(this,s),this.name=n,this.ports=new Map}return t(s,[{key:"bindPort",value:function(n,i){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this;this.ports.has(n)?f.warn("Port ("+n+") for "+this.name+" already exists."):this.ports.set(n,new m.Port(i,a))}},{key:"declarePort",value:function(n){this.ports.has(n)?f.warn("Port ("+n+") for "+this.name+" already exists."):this.ports.set(n,null)}},{key:"getPort",value:function(n){return this.ports.get(n)}},{key:"isConnected",value:function(n){return!!this.ports.has(n)&&this.ports.get(n)!==null}},{key:"connect",value:function(n,i){this.ports.has(n)?this.ports.set(n,i):f.warn("Port ("+n+") for "+this.name+" does not exists.")}},{key:"transmit",value:function(n){var i=this.ports.get(n);if(i!==void 0)if(i!==null){for(var a=arguments.length,c=Array(a>1?a-1:0),u=1;u<a;u++)c[u-1]=arguments[u];i.transmit(c)}else f.warn("Port ("+n+") for "+this.name+" is not connected.");else f.warn("Port ("+n+") for "+this.name+" does not exists.")}},{key:"request",value:function(n){var i=this.ports.get(n);if(i===void 0)return f.warn("Port ("+n+") for "+this.name+" does not exists."),null;if(i===null)return f.warn("Port ("+n+") for "+this.name+" is not connected."),null;for(var a=arguments.length,c=Array(a>1?a-1:0),u=1;u<a;u++)c[u-1]=arguments[u];return i.request(c)}}]),s}();b.Component=o},{"../utility/csiologger":88,"./port":27}],27:[function(S,p,b){function _(f,o){if(!(f instanceof o))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var t=function(){function f(o,s){for(var n=0;n<s.length;n++){var i=s[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(o,i.key,i)}}return function(o,s,n){return s&&f(o.prototype,s),n&&f(o,n),o}}(),m=function(){function f(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;_(this,f),this.target=o,this.object=s}return t(f,[{key:"transmit",value:function(o){this.target.apply(this.object,o)}},{key:"request",value:function(o){return this.target.apply(this.object,o)}}]),f}();b.Port=m},{}],28:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.SlidingWindow=void 0;var _=function(){function o(s,n){for(var i=0;i<n.length;i++){var a=n[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(s,a.key,a)}}return function(s,n,i){return n&&o(s.prototype,n),i&&o(s,i),s}}(),t=S("./switem"),m=function(o){if(o&&o.__esModule)return o;var s={};if(o!=null)for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(s[n]=o[n]);return s.default=o,s}(S("../utility/timestamps")),f=function(){function o(s,n){(function(i,a){if(!(i instanceof a))throw new TypeError("Cannot call a class as a function")})(this,o),this.items=[],this.plugins=[],this.postProcesses=[],this.preProcesses=[],this.timeoutInMs=n,this.maxItemsNum=s,this.minItemsNum=0}return _(o,[{key:"setMaxItemsNum",value:function(s){this.maxItemsNum=s}},{key:"setTimeoutInMs",value:function(s){this.timeoutInMs=s}},{key:"setMinItemsNum",value:function(s){this.minItemsNum=s}},{key:"refresh",value:function(){var s=m.getCurrent();if(!(this.items.length<=this.minItemsNum)){for(;0<this.maxItemsNum&&this.maxItemsNum<=this.items.length;)this.remove();this.timeoutInMs&&this.timeoutInMs<s-this.items[0].getCreated()&&(this.remove(),this.refresh())}}},{key:"getLength",value:function(){return this.items.length}},{key:"add",value:function(s){this.refresh(),this.items.push(new t.SWItem(s));for(var n=0;n<this.preProcesses.length;n++)(0,this.preProcesses[n])(s);for(var i=0;i<this.plugins.length;i++)this.plugins[i].add(s);for(var a=0;a<this.postProcesses.length;a++)(0,this.postProcesses[a])(s)}},{key:"remove",value:function(){for(var s=this.items.shift(),n=0;n<this.plugins.length;n++)this.plugins[n].remove(s.value)}},{key:"peek",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.items.length<=s?null:this.items[this.items.length-s-1].getValue()}},{key:"attach",value:function(s){this.plugins.push(s)}},{key:"addPreProcess",value:function(s){this.preProcesses.push(s)}},{key:"addPostProcess",value:function(s){this.postProcesses.push(s)}},{key:"detach",value:function(s){this.plugins=this.plugins.filter(function(n){return n!==s})}}]),o}();b.SlidingWindow=f},{"../utility/timestamps":99,"./switem":29}],29:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.SWItem=void 0;var _=function(){function f(o,s){for(var n=0;n<s.length;n++){var i=s[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(o,i.key,i)}}return function(o,s,n){return s&&f(o.prototype,s),n&&f(o,n),o}}(),t=function(f){if(f&&f.__esModule)return f;var o={};if(f!=null)for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(o[s]=f[s]);return o.default=f,o}(S("../utility/timestamps")),m=function(){function f(o){(function(s,n){if(!(s instanceof n))throw new TypeError("Cannot call a class as a function")})(this,f),this.value=o,this.created=t.getCurrent()}return _(f,[{key:"getValue",value:function(){return this.value}},{key:"getCreated",value:function(){return this.created}},{key:"toString",value:function(){return""}}]),f}();b.SWItem=m},{"../utility/timestamps":99}],30:[function(S,p,b){function _(i){if(i&&i.__esModule)return i;var a={};if(i!=null)for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(a[c]=i[c]);return a.default=i,a}Object.defineProperty(b,"__esModule",{value:!0}),b.Conference=void 0;var t=function(){function i(a,c){for(var u=0;u<c.length;u++){var g=c[u];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(a,g.key,g)}}return function(a,c,u){return c&&i(a.prototype,c),u&&i(a,u),a}}(),m=S("../peerconnection/peerconnectionmanager"),f=_(S("../config/settings")),o=S("../utility/registry"),s=_(S("../browserapi/sessionstorage")),n=function(){function i(a,c){(function(u,g){if(!(u instanceof g))throw new TypeError("Cannot call a class as a function")})(this,i),this.conferenceId=a,this.startTime,this.peerConnectionManager=new m.PeerConnectionManager,this.credentials=c,this.ucId=null,this.url=null,this.userJoinedSent=!1}return t(i,[{key:"getCredentials",value:function(){return this.credentials}},{key:"getUcId",value:function(){return this.ucId}},{key:"setUcId",value:function(a){this.ucId=a,this.url=f.conferenceBaseUrl+o.Registry.getCredentials().getAppId()+"/conferences/"+encodeURIComponent(this.conferenceId)+"/"+a+"/general",s.storeUcId(this.conferenceId,a)}},{key:"getPeerConnectionManager",value:function(){return this.peerConnectionManager}},{key:"getUrl",value:function(){return this.url}},{key:"updateConferenceId",value:function(a){this.conferenceId=a,this.peerConnectionManager.updateConferenceId(a)}},{key:"close",value:function(a){}}]),i}();b.Conference=n},{"../browserapi/sessionstorage":21,"../config/settings":34,"../peerconnection/peerconnectionmanager":42,"../utility/registry":95}],31:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.ConferenceManager=void 0;var _=function(){function o(s,n){for(var i=0;i<n.length;i++){var a=n[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(s,a.key,a)}}return function(s,n,i){return n&&o(s.prototype,n),i&&o(s,i),s}}(),t=S("./conference"),m=function(o){if(o&&o.__esModule)return o;var s={};if(o!=null)for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(s[n]=o[n]);return s.default=o,s}(S("../config/constants")),f=function(){function o(){(function(s,n){if(!(s instanceof n))throw new TypeError("Cannot call a class as a function")})(this,o),this.conferenceMap=new Map}return _(o,[{key:"add",value:function(s,n){if(!this.get(s)){var i=new t.Conference(s,n);this.conferenceMap.set(s,i)}}},{key:"get",value:function(s){return this.conferenceMap.get(s)}},{key:"getConferenceForPc",value:function(s){var n=null;return s&&this.conferenceMap.forEach(function(i,a){var c=i.getPeerConnectionManager().getPcHandler(s);c&&c.getConferenceId()===a&&(n=i)}),n}},{key:"getConferenceForPcHash",value:function(s){var n=null;return s&&this.conferenceMap.forEach(function(i,a){var c=i.getPeerConnectionManager().getPcHandlerByHash(s);c&&c.getConferenceId()===a&&(n=i)}),n}},{key:"updateConferenceId",value:function(s){var n=m.tmpConferenceId,i=this.get(n);i&&(i.updateConferenceId(s),this.conferenceMap.set(s,i),this.conferenceMap.delete(n))}},{key:"getConferenceIds",value:function(){var s=[];return this.conferenceMap.forEach(function(n,i){s.push(i)}),s}}]),o}();b.ConferenceManager=f},{"../config/constants":33,"./conference":30}],32:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.csError={httpError:"httpError",authError:"authError",wsChannelFailure:"wsChannelFailure",success:"success",csProtoError:"csProtoError",appConnectivityError:"appConnectivityError",tokenGenerationError:"tokenGenerationError",ok:"OK",authOngoing:"authOngoing",invalidWebRTCFunctionName:"Invalid WebRTC function name",invalidEndPointType:"Invalid EndPoint Type",invalidTransmissionDirection:"Invalid fabric transmission direction"},b.csErrorStrings={argumentError:"Argument missing/invalid",cryptoError:"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API",fabricEventUnsupported:"Unsupported fabricEvent",fabricEventInvalid:"Invalid fabricEvents value",fabricUsageInvalid:"Invalid fabricUsage value",notInitialized:"SDK is not initialized or no Fabrics added",pcInvalid:"Invalid PeerConnection object passed",confereneDoesNotExist:"conferenceId does not exist",webRTCFunctionsInvalid:"Invalid webRTC functionName value",setProxyConfigInvokeError:"cannot be called if window.csioproxy is false",invalidWebRTCFunctionName:"Invalid WebRTC function name",invalidEndPointType:"Invalid EndPoint Type",invalidTransmissionDirection:"Invalid fabric transmission direction",apiaccesserror:"API access Error"},b.csErrorReason={csProtoError:"Protocol fields cannot be empty.",csNoAuthState:"Authentication state unavailable in server."},b.internalErrors={authOngoing:"authOngoing"},b.authErrorActions={RETRY:0,GET_NEW_TOKEN:1,REPORT_ERROR:2}},{}],33:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.logEvents={stateMachine:"stateMachine",log:"log",timing:"timing",error:"error",getStatsError:"getStatsError",restResponseError:"restResponseError"},b.fabricEvent={fabricSetupFailed:"fabricSetupFailed",fabricHold:"fabricHold",fabricResume:"fabricResume",audioMute:"audioMute",audioUnmute:"audioUnmute",videoPause:"videoPause",videoResume:"videoResume",fabricUsageEvent:"fabricUsageEvent",fabricTerminated:"fabricTerminated",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker",activeDeviceList:"activeDeviceList",applicationErrorLog:"applicationErrorLog"},b.internalFabricEvent={fabricSetup:"fabricSetup",fabricSetupFailed:"fabricSetupFailed",userJoined:"userJoined",userLeft:"userLeft",userAlive:"userAlive",ssrcMap:"ssrcMap",mediaPlaybackStart:"mediaPlaybackStart",mediaPlaybackSuspended:"mediaPlaybackSuspended",mediaPlaybackStalled:"mediaPlaybackStalled",oneWayMedia:"oneWayMedia",fabricStateChange:"fabricStateChange",iceDisruptionStart:"iceDisruptionStart",iceDisruptionEnd:"iceDisruptionEnd",fabricTransportSwitch:"fabricTransportSwitch",iceConnectionDisruptionStart:"iceConnectionDisruptionStart",iceConnectionDisruptionEnd:"iceConnectionDisruptionEnd",iceAborted:"iceAborted",iceTerminated:"iceTerminated",iceFailed:"iceFailed",iceRestarted:"iceRestarted",fabricDropped:"fabricDropped",connectedDeviceList:"connectedDeviceList",sdpSubmission:"sdpSubmissionEvent",sendingThroughputObservations:"sendingThroughputObservations",limitationObservations:"limitationObservations",userDetails:"userDetails"},b.callstatsChannels={sdpSubmission:"sdpSubmissionEvent",processedStats:"processedStats",callstatsEvent:"callStatsEvent",userFeedback:"userFeedbackEvent",preCallTest:"preCallTest",senderConfiguration:"senderConfiguration"},b.precalltestEvents={results:"preCallTestResults",associate:"preCallTestAssociate"},b.callstatsAPIReturnStatus={success:"success",failure:"failure"},b.fabricUsage={audio:"audio",video:"video",data:"data",screen:"screen",multiplex:"multiplex",unbundled:"unbundled"},b.userIdType={local:"local",remote:"remote"},b.qualityRating={excellent:5,good:4,fair:3,poor:2,bad:1},b.reportType={local:"local",remote:"remote",inbound:"inbound",outbound:"outbound"},b.avQualityRatings={excellent:"excellent",fair:"fair",bad:"bad",unknown:"unknown"},b.fabricState={established:"established",initializing:"initializing",failed:"failed",disrupted:"disrupted",hold:"hold",checkingDisrupted:"checkingDisrupted",terminated:"terminated"},b.webRTCFunctions={createOffer:"createOffer",createAnswer:"createAnswer",setLocalDescription:"setLocalDescription",setRemoteDescription:"setRemoteDescription",addIceCandidate:"addIceCandidate",getUserMedia:"getUserMedia",iceConnectionFailure:"iceConnectionFailure",signalingError:"signalingError",applicationError:"applicationError",applicationLog:"applicationLog"},b.callFailureReasons={mediaConfigError:"MediaConfigError",negotiationFailure:"NegotiationFailure",sdpError:"SDPGenerationError",iceFailure:"IceConnectionFailure",transportFailure:"TransportFailure",signalingError:"SignalingError",applicationError:"ApplicationError",applicationLog:"ApplicationLog",invalidWebRTCFunctionName:"Invalid WebRTC function name"},b.throughputThreshold={video:{green:1024,red:256},audio:{green:30,red:8}},b.currOverPrevFrameRateThreshold={video:{green:.8,red:.3}},b.rttThreshold={video:{green:400,red:1e3}},b.fractionalLossThreshold={video:{green:.1,red:.5},audio:{green:.15,red:.3}},b.eModelThreshold={audio:{green:240,red:400}},b.codeBaseType={chrome:"Chrome",firefox:"Firefox",edge:"Edge",plugin:"Plugin"},b.browserName={chrome:"Chrome",firefox:"Firefox",edge:"Edge",msie:"Microsoft Internet Explorer",safari:"Safari",opera:"Opera"},b.osName={windows:"Windows",mac:"Mac OS X",android:"Android",ios:"iOS"},b.mediaType={audio:"audio",video:"video"},b.streamType={inbound:"inbound",outbound:"outbound"},b.fabricStateChangeType={signalingState:"signalingState",iceConnectionState:"iceConnectionState",iceGatheringState:"iceGatheringState"},b.transportType={rest:"rest",ws:"ws"},b.wsConnectionState={initiated:"initiated",connected:"connected",closed:"closed"},b.csCallBackMessages={authSuccessful:"SDK authentication successful.",authFailed:"SDK authentication failed.",authProtocolInvalid:"Fatal authentication error. Invalid auth protocol message.",authOngoing:"Authentication on going.",wsConnected:"WebSocket establishment successful.",wsClosed:"WebSocket server closed.",wsFailed:"WebSocket establishment failed."},b.oneWayMediaTypes={audio:"audio",video:"video",screen:"screen"},b.limitationType={cpu:"cpu",network:"network"},b.qualityDisruptionTypes={qpchange:"qpchange"},b.callbackFunctions={stats:"stats",defaultConfig:"defaultConfig",recommendedConfig:"recommendedConfig",preCallTestResults:"preCallTestResults",preCallTest:"preCallTest"},b.endpointType={peer:"peer",server:"server"},b.transmissionDirection={sendonly:"sendonly",receiveonly:"receiveonly",sendrecv:"sendrecv",inactive:"inactive"},b.tmpConferenceId="csio-conf-id-tmp"},{}],34:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.setConfigServiceUrl=function(_){b.configServiceUrl=_},b.setAuthServiceUrl=function(_){b.authServiceUrl=_},b.setConferenceBaseUrl=function(_){b.conferenceBaseUrl=_},b.setWsUrl=function(_){b.wsUrl=_},b.setRestEventUrl=function(_){b.restEventUrl=_},b.setRestStatsUrl=function(_){b.restStatsUrl=_},b.setBaseUrl=function(_){b.baseUrl=_},b.setQmodelThresholdsAPIUrl=function(_){b.qmodelThresholdsAPIUrl=_},b.setTransportType=function(_){b.transportType=_},b.version="3.53.1",b.configServiceUrl="https://appsettings.callstats.io/v1/apps/",b.authServiceUrl="https://auth.callstats.io/",b.authRetryTimeout=5e3,b.conferenceBaseUrl="https://dashboard.callstats.io/apps/",b.wsUrl="wss://collector.callstats.io:443/csiows/collectCallStats",b.restEventUrl="https://events.callstats.io/v1/apps/",b.restStatsUrl="https://stats.callstats.io/v1/apps/",b.baseUrl="https://collector.callstats.io:443/",b.qmodelThresholdsAPIUrl="https://dashboard.callstats.io/api-internal/v1/qmodelthresholds",b.csioDebug="false",b.transportType="@@transportType"},{}],35:[function(S,p,b){function _(D){if(D&&D.__esModule)return D;var $={};if(D!=null)for(var j in D)Object.prototype.hasOwnProperty.call(D,j)&&($[j]=D[j]);return $.default=D,$}function t(D){if(Array.isArray(D)){for(var $=0,j=Array(D.length);$<D.length;$++)j[$]=D[$];return j}return Array.from(D)}Object.defineProperty(b,"__esModule",{value:!0}),b.MainFSM=b.MainEvents=void 0;var m=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},f=function(){function D($,j){for(var V=0;V<j.length;V++){var Y=j[V];Y.enumerable=Y.enumerable||!1,Y.configurable=!0,"value"in Y&&(Y.writable=!0),Object.defineProperty($,Y.key,Y)}}return function($,j,V){return j&&D($.prototype,j),V&&D($,V),$}}(),o=S("./statemachine"),s=S("../utility/registry"),n=_(S("../utility/csiologger")),i=_(S("../utility/utils")),a=_(S("../utility/timestamps")),c=_(S("../config/constants")),u=_(S("../config/settings")),g=_(S("./utility")),h=S("../statspipeline/statsadapter"),C=S("../statspipeline/statsparser"),E=S("../statspipeline/statsmonitor"),y=S("../statspipeline/statstransmitter"),w=S("../statspipeline/statsassembler"),O="Created",L="Initializing",I="Idle",k="Run",P=b.MainEvents={onStart:"onStart",onInitialize:"onInitialize",onAddNewFabric:"onAddNewFabric",onSendFabricEvent:"onSendFabricEvent",onReportError:"onReportError",onAssociateMstWithUserID:"onAssociateMstWithUserID",onSetProxyConfig:"onSetProxyConfig",onAttachWifiStatsHandler:"onAttachWifiStatsHandler",onSendUserFeedback:"onSendUserFeedback",onOn:"onOn",onSetIdentifiers:"onSetIdentifiers",onMakePrecallTest:"onMakePrecallTest"},F="onServicesFinished",H=function(D){function $(){(function(V,Y){if(!(V instanceof Y))throw new TypeError("Cannot call a class as a function")})(this,$);var j=function(V,Y){if(!V)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!Y||typeof Y!="object"&&typeof Y!="function"?V:Y}(this,($.__proto__||Object.getPrototypeOf($)).call(this,O));return n.log("FSM:",j.getState()),j.fire(P.onStart),j.run(),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(V){if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof V!="function")throw new TypeError("predicate must be a function");for(var Y=Object(this),Z=Y.length>>>0,J=arguments[1],re=void 0,ce=0;ce<Z;ce++)if(re=Y[ce],V.call(J,re,ce,Y))return re}}),j}return function(j,V){if(typeof V!="function"&&V!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof V);j.prototype=Object.create(V&&V.prototype,{constructor:{value:j,enumerable:!1,writable:!0,configurable:!0}}),V&&(Object.setPrototypeOf?Object.setPrototypeOf(j,V):j.__proto__=V)}($,D),f($,[{key:"proceed",value:function(j,V){switch(this.getState()){case O:switch(j){case P.onStart:this.onStart.apply(this,t(V));break;case P.onInitialize:this.setState(L),n.log("FSM:",this.getState()),this.onInitialize.apply(this,t(V));break;case P.onOn:this.onOn.apply(this,t(V));break;case P.onSetProxyConfig:this.onSetProxyConfig.apply(this,t(V))}break;case L:switch(j){case F:this.onServicesFinished()&&(this.setState(I),n.log("FSM:",this.getState()));break;case P.onAddNewFabric:this.onAddNewFabric.apply(this,t(V));break;case P.onSendFabricEvent:this.onSendFabricEvent.apply(this,t(V));break;case P.onReportError:this.onReportError.apply(this,t(V));break;case P.onAssociateMstWithUserID:this.onAssociateMstWithUserID.apply(this,t(V));break;case P.onSendUserFeedback:this.onSendUserFeedback.apply(this,t(V));break;case P.onAttachWifiStatsHandler:this.onAttachWifiStatsHandler.apply(this,t(V));break;case P.onOn:this.onOn.apply(this,t(V));break;case P.onMakePrecallTest:this.onMakePrecallTest.apply(this,t(V));break;case P.onSetIdentifiers:this.onSetIdentifiers.apply(this,t(V));break;case P.onSetProxyConfig:this.onSetProxyConfig.apply(this,t(V))}break;case I:case k:switch(j){case P.onAddNewFabric:this.onAddNewFabric.apply(this,t(V));break;case P.onSendFabricEvent:this.onSendFabricEvent.apply(this,t(V));break;case P.onReportError:this.onReportError.apply(this,t(V));break;case P.onAssociateMstWithUserID:this.onAssociateMstWithUserID.apply(this,t(V));break;case P.onSendUserFeedback:this.onSendUserFeedback.apply(this,t(V));break;case P.onAttachWifiStatsHandler:this.onAttachWifiStatsHandler.apply(this,t(V));break;case P.onOn:this.onOn.apply(this,t(V));break;case P.onSetProxyConfig:this.onSetProxyConfig.apply(this,t(V));break;case P.onMakePrecallTest:this.onMakePrecallTest.apply(this,t(V));break;case P.onSetIdentifiers:this.onSetIdentifiers.apply(this,t(V))}}}},{key:"onStart",value:function(){s.Registry.getEndpoint().setup(),this.authenticator=s.Registry.getAuthenticator(),this.configservicewrapper=s.Registry.getConfigServiceWrapper(),this.precalltest=s.Registry.getPreCallTest(),this.precalltestIds=[];var j=s.Registry.getStatsAdapter(),V=s.Registry.getStatsParser(),Y=s.Registry.getStatsMonitor(),Z=s.Registry.getStatsTransmitter(),J=s.Registry.getStatsAssembler();j.connect(h.StatsAdapterIO.RawStatsOut,V.getPort(C.StatsParserIO.RawStatsIn)),V.connect(C.StatsParserIO.PcStatsTupleOut,Y.getPort(E.StatsMonitorIO.PcStatsTupleIn)),Y.connect(E.StatsMonitorIO.StatsTupleOut,J.getPort(w.StatsAssemblerIO.StatsTupleIn)),J.connect(w.StatsAssemblerIO.CallstatsOut,Z.getPort(y.StatsTransmitterIO.CallstatsIn)),j.connect(h.StatsAdapterIO.UnprocessedOut,Z.getPort(y.StatsTransmitterIO.UnprocessedIn))}},{key:"setupConnection",value:function(){var j=this;this.connectionManager=s.Registry.getConnectionManager(),this.connectionManager.setupCollectorConnection(s.Registry.getCredentials().getTransportType()),this.connectionManager.setup().then(function(){n.log("Connected to connectionManager"),j.fire(F),j.run()}).catch(function(V){return n.log("Could not connect to connectionManager",V)})}},{key:"setup",value:function(){var j=this;this.clocksync=s.Registry.getClockSync(),this.clocksync.initiate().then(function(){n.log("Clocksync completed"),j.fire(F),j.run()}).catch(function(V){return n.log("Could not finish ClockSync",V)})}},{key:"onInitialize",value:function(j,V,Y,Z,J,re){var ce=this,Re=s.Registry.getCredentials();Re.setAppId(j),Re.setUserId(V),s.Registry.getCallbacks().set(c.callbackFunctions.stats,J),this.doPrecalltest=!0,re&&(re.disableBeforeUnloadHandler===!0&&this.setBeforeUnloadHandler(),re.applicationVersion&&s.Registry.getEndpoint().setAppVersion(re.applicationVersion),re.transportType&&u.setTransportType(re.transportType),re.disablePrecalltest&&(this.doPrecalltest=!1)),this.setup(),this.authenticator.initiate(Y,Z).then(function(pe){n.log("Authentication complete"),ce.setupConnection();var Oe=s.Registry.getCredentials().getStatsSubmissionInterval();s.Registry.getStatsMonitor().setIntervals(Oe,Oe),ce.fire(F),ce.run();var te=ce.authenticator.getIceServers();te&&ce.doPrecalltest&&ce.precalltest.start(te,"callstats",ce.precalltestCallback.bind(ce)),ce.configservicewrapper.initiateInternalConfig().then(function(){n.log("ConfigService internal config:",ce.configservicewrapper.getInternalConfig()),ce.fire(F),ce.run()},function(oe){return n.log(oe)}),ce.configservicewrapper.initiateAppConfig().then(function(){var oe=s.Registry.getCallbacks().get(c.callbackFunctions.defaultConfig),_e=ce.configservicewrapper.getAppDefaultConfig();oe&&_e&&oe(_e);var we=s.Registry.getCallbacks().get(c.callbackFunctions.recommendedConfig),Ee=ce.configservicewrapper.getAppRecommendedConfig();we&&Ee&&we(Ee),ce.fire(F),ce.run()},function(oe){return n.log(oe)})},function(pe){n.log(pe)})}},{key:"precalltestCallback",value:function(j,V){var Y=s.Registry.getCallbacks().get(c.callbackFunctions.preCallTestResults),Z=s.Registry.getCallbacks().get(c.callbackFunctions.preCallTest);if(Z&&Z(j),Y){if(V){var J={msg:"precalltest error: "+V};return n.warn("backendlog",J),s.Registry.getGenericEventHandler().sendEvent(c.logEvents.log,J),void Y(c.callstatsAPIReturnStatus.failure,null)}var re=g.getPublicPrecalltestResults(j);Y(c.callstatsAPIReturnStatus.success,re)}j&&(this.precalltestIds.push(j.id),j.tests&&j.tests.ice&&(j.tests.ice.turnIpAddress===""&&delete j.tests.ice.turnIpAddress,j.tests.ice.turnIpVersion===""&&delete j.tests.ice.turnIpVersion,j.tests.ice.turnTransport===""&&delete j.tests.ice.turnTransport),n.log("sending preCallTest results",j),s.Registry.getEventMessageBuilder().make(c.precalltestEvents.results,null,null,{results:j}))}},{key:"setBeforeUnloadHandler",value:function(){window&&window.addEventListener&&(n.log("setBeforeUnloadHandler"),window.addEventListener("beforeunload",function(j){return s.Registry.getConferenceManager().conferenceMap.forEach(function(V,Y){V&&V.getPeerConnectionManager().pcHandlers.forEach(function(Z,J){s.Registry.getEventMessageBuilder().make(c.internalFabricEvent.userLeft,Z.getConferenceId(),Z.getPeerConnection())})}),"Are you sure you want to close the call?"}))}},{key:"onServicesFinished",value:function(){return!!(this.connectionManager&&this.connectionManager.isReady()&&this.clocksync.isCompleted()&&this.authenticator.isCompleted())&&(s.Registry.getTransmissionManager().trySend(),!0)}},{key:"onAddNewFabric",value:function(j,V,Y,Z,J,re,ce){n.warn("FSM onAddNewFabric"),s.Registry.getConferenceManager().add(Z,s.Registry.getCredentials());var Re=s.Registry.getConferenceManager().get(Z);Re.getPeerConnectionManager().addPcHandler(j,V,Y,Z,J,re,ce);var pe={endpointInfo:s.Registry.getEndpoint().serialize()};s.Registry.getCredentials().getUserIdObject()&&(pe.localUserIDObject=s.Registry.getCredentials().getUserIdObject()),Re.userJoinedSent||(s.Registry.getEventMessageBuilder().make(c.internalFabricEvent.userJoined,Z,j,pe),Re.userJoinedSent=!0,s.Registry.getCredentials().getTransportType()===c.transportType.rest&&pe.localUserIDObject&&pe.localUserIDObject.userName&&s.Registry.getEventMessageBuilder().make(c.internalFabricEvent.userDetails,Z,j,{userName:String(pe.localUserIDObject.userName)}));var Oe=this.precalltestIds;this.precalltestIds=[];var te=this.precalltest.getId();te&&Oe.push(te),Oe.length>0&&s.Registry.getEventMessageBuilder().make(c.precalltestEvents.associate,Z,j,{ids:Oe})}},{key:"onSendFabricEvent",value:function(j,V,Y,Z){n.warn("FSM onSendFabricEvent");var J={};Z&&(J=Z).ssrc&&(J.ssrc=String(J.ssrc)),V===c.fabricEvent.activeDeviceList&&(J={mediaDeviceList:i.normalizeMediaDeviceList(Z.deviceList)}),s.Registry.getEventMessageBuilder().make(V,Y,j,J);var re=s.Registry.getConferenceManager().get(Y);if(re){var ce=re.getPeerConnectionManager().getPcHandler(j);V!==c.fabricEvent.fabricTerminated&&V!==c.internalFabricEvent.fabricSetupFailed||(ce.stopUserAliveHandler(),ce.setPcState(c.fabricState.terminated),ce.stopStatsPolling(),re.getPeerConnectionManager().removePcHandler(j)),V===c.fabricEvent.fabricHold&&(ce.setPcState(c.fabricState.hold),ce.stopStatsPolling()),V===c.fabricEvent.fabricResume&&(ce.setPcState(c.fabricState.established),ce.startStatsPolling())}}},{key:"onReportError",value:function(j,V,Y,Z,J,re){n.warn("FSM onReportError");var ce={failureDelay:0,reason:this.callFailureClassifier(Y),function:Y,magicKey:s.Registry.getEndpoint().getMagicKey(),endpoint:s.Registry.getEndpoint().serialize(),level:"debug"};if(Z){var Re=this.formatDomError(Z);ce.message=Re.message,ce.messageType=Re.messageType,ce.name=Z.name,ce.stack=Z.stack}if(j){var pe=s.Registry.getConferenceManager().get(V),Oe=void 0;if(pe&&(Oe=pe.getPeerConnectionManager().getPcHandler(j)),!Oe)return void n.error("onReportError: No handler found for given PeerConnection!");if(ce.failureDelay=a.getCurrent()-Oe.getStartTime(),ce.fabricState=Oe.getPcState(),ce.iceConnectionState=Oe.getIceConnectionState(),(J||re||j&&j.signalingState!=="closed")&&s.Registry.getCredentials().getCollectSDP()&&Y===c.fabricEvent.fabricSetupFailed){var te={};te.localSDP=this.pickSDP(j,J,"localDescription"),te.remoteSDP=this.pickSDP(j,re,"remoteDescription"),s.Registry.getEventMessageBuilder().make(c.callstatsChannels.sdpSubmission,V,j,te)}}Y===c.webRTCFunctions.applicationLog||Y===c.webRTCFunctions.applicationError?s.Registry.getEventMessageBuilder().make(c.fabricEvent.applicationErrorLog,V,j,ce):(s.Registry.getEventMessageBuilder().make(c.fabricEvent.fabricSetupFailed,V,j,ce),Y===c.webRTCFunctions.getUserMedia&&this.handleGUMErrors(V))}},{key:"onAssociateMstWithUserID",value:function(j,V,Y,Z,J,re){var ce=s.Registry.getConferenceManager().get(Y);ce&&(typeof Z!="string"&&(Z+=""),ce.getPeerConnectionManager().getPcHandler(j).updateSSRCInfo(Z,V,J,re))}},{key:"onAttachWifiStatsHandler",value:function(j){s.Registry.getWifiStatsExecutor().setGetWifiStatsMethod(j)}},{key:"onSetProxyConfig",value:function(j){n.warn("FSM onSetProxyConfig"),j.collectorURL&&u.setBaseUrl(j.collectorURL),j.authServiceURL&&u.setAuthServiceUrl(j.authServiceURL),j.csioInternalAPIURL&&u.setQmodelThresholdsAPIUrl(j.csioInternalAPIURL),j.wsURL&&u.setWsUrl(j.wsURL),j.restEventURL&&u.setRestEventUrl(j.restEventURL),j.restStatsURL&&u.setRestStatsUrl(j.restStatsURL),j.appSettingsURL&&u.setConfigServiceUrl(j.appSettingsURL)}},{key:"onSendUserFeedback",value:function(j,V,Y){var Z={feedback:{overallRating:V.overall}};V.video&&(Z.feedback.videoQualityRating=V.video),V.audio&&(Z.feedback.audioQualityRating=V.audio),V.comment&&(Z.feedback.comments=V.comment),s.Registry.getEventMessageBuilder().make(c.callstatsChannels.userFeedback,j,null,Z)}},{key:"onOn",value:function(j,V){s.Registry.getCallbacks().set(j,V)}},{key:"onSetIdentifiers",value:function(j,V){if(j.conferenceID&&(s.Registry.getConferenceManager().updateConferenceId(j.conferenceID),s.Registry.getTransmissionManager().updateConferenceId(j.conferenceID),s.Registry.getTransmissionManager().trySend()),j.remoteUserID&&V){var Y=s.Registry.getConferenceManager().getConferenceForPc(V);if(!Y)return void n.log("onSetIdentifiers conference not found");var Z=Y.getPeerConnectionManager().getPcHandler(V);if(!Z)return void n.log("pcHandler not found");Z.updateRemoteId(j.remoteUserID),s.Registry.getTransmissionManager().trySend()}}},{key:"onMakePrecallTest",value:function(j,V){var Y=this,Z=j,J=V||"callstats";j||(Z=this.authenticator.getIceServers(),J="callstats"),Y.precalltest.start(Z,J,Y.precalltestCallback.bind(Y))}},{key:"handleGUMErrors",value:function(j){var V=s.Registry.getConferenceManager().get(j);if(V||(s.Registry.getConferenceManager().add(j,s.Registry.getCredentials()),V=s.Registry.getConferenceManager().get(j)),!V.getUcId()){var Y={endpointInfo:s.Registry.getEndpoint().serialize()};s.Registry.getEventMessageBuilder().make(c.internalFabricEvent.userJoined,j,null,Y),V.userJoinedSent=!0}}},{key:"callFailureClassifier",value:function(j){var V=void 0;return c.webRTCFunctions.hasOwnProperty(j)?j===c.webRTCFunctions.createOffer||j===c.webRTCFunctions.createAnswer||j===c.webRTCFunctions.setRemoteDescription?V=c.callFailureReasons.negotiationFailure:j===c.webRTCFunctions.setLocalDescription||j===c.webRTCFunctions.addIceCandidate?V=c.callFailureReasons.sdpError:j===c.webRTCFunctions.getUserMedia?V=c.callFailureReasons.mediaConfigError:j===c.webRTCFunctions.iceConnectionFailure?V=c.callFailureReasons.iceFailure:j===c.webRTCFunctions.signalingError?V=c.callFailureReasons.signalingError:(j===c.webRTCFunctions.applicationLog||c.webRTCFunctions.applicationError)&&(V=c.callFailureReasons.applicationLog):V=c.callFailureReasons.invalidWebRTCFunctionName,V}},{key:"formatDomError",value:function(j){var V={},Y={};j&&(window.DOMException&&j instanceof window.DOMException?(Y.message=j.message,Y.name=j.name,V.messageType="domError"):(j===void 0?"undefined":m(j))==="object"?(j.message&&(Y.message=j.message),j.name&&(Y.name=j.name),j.constraintName&&(Y.name=j.constraintName),j.stack&&(Y.stack=j.stack),V.messageType="json"):(Y=j,V.messageType="text"));var Z=this.truncateLog(Y);return(Z===void 0?"undefined":m(Z))==="object"?V.message=JSON.stringify(Z):V.message=Z,V}},{key:"pickSDP",value:function(j,V,Y){return V||(j&&j[Y]?j[Y].sdp:"")}},{key:"truncateString",value:function(j){return j.length>2e4&&(n.log("Log exceeds 20kb, It will be truncated"),j=j.substring(0,2e4)),j}},{key:"truncateLog",value:function(j){return j&&(typeof j=="string"?j=this.truncateString(j):(j===void 0?"undefined":m(j))==="object"&&j.message&&(j.message=this.truncateString(j.message)),j)}}]),$}(o.StateMachine);b.MainFSM=H},{"../config/constants":33,"../config/settings":34,"../statspipeline/statsadapter":69,"../statspipeline/statsassembler":70,"../statspipeline/statsmonitor":72,"../statspipeline/statsparser":73,"../statspipeline/statstransmitter":74,"../utility/csiologger":88,"../utility/registry":95,"../utility/timestamps":99,"../utility/utils":101,"./statemachine":37,"./utility":38}],36:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0});var _=function(){function m(f,o){for(var s=0;s<o.length;s++){var n=o[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(f,n.key,n)}}return function(f,o,s){return o&&m(f.prototype,o),s&&m(f,s),f}}(),t=function(){function m(f,o){(function(s,n){if(!(s instanceof n))throw new TypeError("Cannot call a class as a function")})(this,m),this.type=f,this.args=o!==void 0?o:null}return _(m,[{key:"getType",value:function(){return this.type}},{key:"getArgs",value:function(){return this.args}}]),m}();b.ProgramEvent=t},{}],37:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.StateMachine=void 0;var _=function(){function o(s,n){for(var i=0;i<n.length;i++){var a=n[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(s,a.key,a)}}return function(s,n,i){return n&&o(s.prototype,n),i&&o(s,i),s}}(),t=S("./programevent"),m=function(o){if(o&&o.__esModule)return o;var s={};if(o!=null)for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(s[n]=o[n]);return s.default=o,s}(S("../utility/csiologger")),f=function(){function o(s){(function(n,i){if(!(n instanceof i))throw new TypeError("Cannot call a class as a function")})(this,o),this.events=[],this.state=s}return _(o,[{key:"fire",value:function(s){for(var n=arguments.length,i=Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];var c=new t.ProgramEvent(s,i);this.events.push(c)}},{key:"proceed",value:function(s,n){m.warn("You need to overwrite the proceed function inan extended StateMachine")}},{key:"setState",value:function(s){this.state=s}},{key:"getState",value:function(){return this.state}},{key:"run",value:function(){if(!(this.events.length<1)){var s=this.events.shift();this.proceed(s.getType(),s.getArgs())}}}]),o}();b.StateMachine=f},{"../utility/csiologger":88,"./programevent":36}],38:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.getPublicPrecalltestResults=function(_){var t={mediaConnectivity:!1,throughput:null,fractionalLoss:null,rtt:null};return _&&_.tests&&(t.provider=_.provider,_.tests.rtt&&(t.rtt=_.tests.rtt.median,t.mediaConnectivity=!0),_.tests.throughput&&(t.throughput=_.tests.throughput.average,t.fractionalLoss=Math.max(_.tests.throughput.fractionLostBytes,0),t.mediaConnectivity=!0),_.tests.ice&&(_.tests.ice.relayTcpSuccess||_.tests.ice.relayTlsSuccess||_.tests.ice.relayUdpSuccess)&&(t.mediaConnectivity=!0)),t}},{}],39:[function(S,p,b){function _(a){if(a&&a.__esModule)return a;var c={};if(a!=null)for(var u in a)Object.prototype.hasOwnProperty.call(a,u)&&(c[u]=a[u]);return c.default=a,c}Object.defineProperty(b,"__esModule",{value:!0}),b.GetStatsHandler=void 0;var t=function(){function a(c,u){for(var g=0;g<u.length;g++){var h=u[g];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(c,h.key,h)}}return function(c,u,g){return u&&a(c.prototype,u),g&&a(c,g),c}}(),m=_(S("../config/constants")),f=S("../statspipeline/statsadapter"),o=S("../utility/registry"),s=S("../utility/rttregistry"),n=_(S("../utility/csiologger")),i=function(){function a(c,u,g,h,C){(function(E,y){if(!(E instanceof y))throw new TypeError("Cannot call a class as a function")})(this,a),this.pc=c,this.interval=g,this.codeBase=h,this.browserName=C,this.getStatsTimer=null,this.isPromiseBased=!0,this.pcHash=u,this.genericevent=o.Registry.getGenericEventHandler()}return t(a,[{key:"startStatsPolling",value:function(){var c=this;c.getStatsTimer||(n.log("startStatsPolling for ",c.pcHash),this.getStatsTimer=setInterval(function(){c.csioGetStats(c.statsHandler,c.pcHash)},c.interval))}},{key:"stopStatsPolling",value:function(){this.getStatsTimer&&(clearInterval(this.getStatsTimer),this.getStatsTimer=null)}},{key:"csioGetStats",value:function(c,u){var g=m.codeBaseType.firefox,h=m.codeBaseType.chrome,C=m.codeBaseType.edge,E=m.browserName.safari;if(this.pc){if(this.pc.iceConnectionState==="closed")return void this.stopStatsPolling();try{this.isTemaSys()?this.getStatsTemasys(c,u):this.codeBase===g?this.getStatsFirefox(c,u):this.browserName===E?this.getStatsSafari(c,u):this.codeBase===h?this.getStatsChrome(c,u):this.codeBase===C&&this.getStatsEdge(c,u)}catch(y){n.log("csioGetStats: Error ",y)}}}},{key:"getStatsTemasys",value:function(c,u){this.pc.getStats(null,function(g){c(g,u)},function(g){n.log("getStatsTemasys error",g)})}},{key:"getStatsFirefox",value:function(c,u){var g=this,h=this.pc;if(g.isPromiseBased)try{h.getStats().then(function(C){c(C,u)}).catch(function(C){g.isPromiseBased=!1,h.getStats(null,function(E){c(E,u)})})}catch(C){g.isPromiseBased=!1,g.genericevent.sendEvent(m.logEvents.getStatsError,{msg:"Firefox getStats reports error ",error:C.message+":"+C.stack}),h.getStats(null,function(E){c(E,u)})}else h.getStats(null,function(C){c(C,u)})}},{key:"getStatsChrome",value:function(c,u){var g=this,h=g.pc;if(window&&window.csioReactNative)h.getStats(null,function(C){c(C,u)},function(C){g.genericevent.sendEvent(m.logEvents.getStatsError,{msg:"react-native getStats reports error",error:C.message+":"+C.stack})});else if(g.isPromiseBased)try{h.getStats().then(function(C){(0,s.getRTTRegistry)().update(h),c(C,u)}).catch(function(C){n.log("Chrome getStats Error ",C),g.isPromiseBased=!1,g.genericevent.sendEvent(m.logEvents.getStatsError,{msg:"Chrome getStats reports error",error:C.message+":"+C.stack}),h.getStats(function(E){c(E,u)})})}catch(C){g.isPromiseBased=!1,g.genericevent.sendEvent(m.logEvents.getStatsError,{msg:"Chrome getStats reports error",error:C.message+":"+C.stack}),h.getStats(function(E){c(E,u)})}else h.getStats(function(C){c(C,u)})}},{key:"getStatsEdge",value:function(c,u){var g=this;g.pc.getStats().then(function(h){c(h,u)}).catch(function(h){c({},u),h?g.genericevent.sendEvent(m.logEvents.getStatsError,{msg:"Edge getStats reports error",error:h.message+":"+h.stack}):g.genericevent.sendEvent(m.logEvents.getStatsError,{msg:"Edge getStats reports error"})})}},{key:"getStatsSafari",value:function(c,u){var g=this;g.pc.getStats().then(function(h){c(h,u)}).catch(function(h){g.genericevent.sendEvent(m.logEvents.getStatsError,{msg:"Safari getStats reports error",error:h.message+":"+h.stack})})}},{key:"statsHandler",value:function(c,u){var g=o.Registry.getStatsAdapter();if(c&&g)try{g.transmit(f.StatsAdapterIO.RawStatsIn,c,u)}catch(h){n.log("statsHandler 123: Error ",h),o.Registry.getGenericEventHandler().sendEvent(m.logEvents.error,{msg:"statsHandler: Error",error:h.message+":"+h.stack})}}},{key:"iceCandidatesHandler",value:function(c,u){u(o.Registry.getStatsAdapter().getIceCandidates(c))}},{key:"getIceCandidates",value:function(){var c=this;return new Promise(function(u,g){c.csioGetStats(c.iceCandidatesHandler,function(h){u(h)})})}},{key:"isTemaSys",value:function(){return!!(window&&window.AdapterJS&&window.AdapterJS.WebRTCPlugin&&window.AdapterJS.WebRTCPlugin.plugin)}}]),a}();b.GetStatsHandler=i},{"../config/constants":33,"../statspipeline/statsadapter":69,"../utility/csiologger":88,"../utility/registry":95,"../utility/rttregistry":96}],40:[function(S,p,b){function _(a){if(a&&a.__esModule)return a;var c={};if(a!=null)for(var u in a)Object.prototype.hasOwnProperty.call(a,u)&&(c[u]=a[u]);return c.default=a,c}Object.defineProperty(b,"__esModule",{value:!0}),b.PcCallbackHandler=void 0;var t=function(){function a(c,u){for(var g=0;g<u.length;g++){var h=u[g];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(c,h.key,h)}}return function(c,u,g){return u&&a(c.prototype,u),g&&a(c,g),c}}(),m=_(S("../config/constants")),f=S("../utility/registry"),o=_(S("../utility/timestamps")),s=_(S("../config/callstatserrors")),n=_(S("../utility/csiologger")),i=function(){function a(c,u,g,h,C,E){var y=this;(function(w,O){if(!(w instanceof O))throw new TypeError("Cannot call a class as a function")})(this,a),u&&(this.conferenceId=c,this.pc=u,this.getStatsHandler=g,this.userAlive=h,this.callback=E,this.remoteId=C,this.clocksync=f.Registry.getClockSync(),this.emb=f.Registry.getEventMessageBuilder(),this.precalltest=f.Registry.getPreCallTest(),this.genericevent=f.Registry.getGenericEventHandler(),this.iceCandidates=[],this.iceConnectionState=u.iceConnectionState,this.iceGatheringState=u.iceGatheringState,this.signalingState=u.signalingState,this.oldIceConnectionState="",this.oldIceGatheringState="",this.iceConnectionStateTS="",this.negotiationNeeded=0,this.pcState=m.fabricState.initializing,this.disruptedTS=0,this.connectionDisruptedTS=0,this.startTime=o.getCurrent(),this.established=!1,this.activeIceCandidatePair=null,this.prevActiveIceCandidatePair=null,this.localIceCandidates=[],this.remoteIceCandidates=[],this.iceCandidatePairs=[],this.iceConnectivityDelay=0,this.iceGatheringDelay=0,this.fabricSetupSent=!1,this.pc&&this.pc.addEventListener?(this.pc.addEventListener("icecandidate",this.iceCandidateCallback.bind(this),!1),this.pc.addEventListener("iceconnectionstatechange",this.iceConnectionStateChangeCallback.bind(this),!1),this.pc.addEventListener("signalingstatechange",this.pcSignalingStateChangeCallback.bind(this),!1),this.pc.addEventListener("negotiationneeded",this.pcNegotiationNeededCallback.bind(this),!1)):this.pc&&this.pc.attachEvent?(n.info("attachEvent"),this.pc.attachEvent("onicecandidate",this.iceCandidateCallback.bind(this)),this.pc.attachEvent("oniceconnectionstatechange",this.iceConnectionStateChangeCallback.bind(this)),this.pc.attachEvent("onsignalingstatechange",this.pcSignalingStateChangeCallback.bind(this)),this.pc.attachEvent("onnegotiationneeded",this.pcNegotiationNeededCallback.bind(this))):n.error("callstats cannot monitor or collect stats"),!u||u.iceConnectionState!=="connected"&&u.iceConnectionState!=="completed"||(this.pcState=m.fabricState.established,this.getStatsHandler.getIceCandidates().then(function(w){y.localIceCandidates=w.localIceCandidates,y.remoteIceCandidates=w.remoteIceCandidates,y.iceCandidatePairs=w.iceCandidatePairs,y.prevActiveIceCandidatePair=y.activeIceCandidatePair,y.activeIceCandidatePair=y.getActiveIceCandidatePair(),y.sendfabricSetup(),y.startStatsPolling()})))}return t(a,[{key:"iceCandidateCallback",value:function(c){if(c&&c.candidate){var u=c.candidate.candidate.split(" ");if(u[4]!=="0"&&u[5]!=="0"){var g=u[4].indexOf(":")!==-1,h=u[1]==="1"?"rtp":"rtcp",C={transport:u[2],protocol:h,typePreference:u[3],address:g?"["+u[4]+"]:"+u[5]:u[4]+":"+u[5],type:u[7],media:c.candidate.sdpMid};this.iceCandidates.indexOf(C)===-1&&(this.iceCandidates.push(C),n.warn("CALLBACK: ICE candidate",C))}}}},{key:"iceConnectionStateChangeCallback",value:function(c){var u=this;if(c){n.log("pc states ",this.pc.iceGatheringState,this.pc.iceConnectionState),this.iceConnectionStateTS=this.clocksync.getSynchronizedTimestamp(),this.handleIceGatheringState(),this.handleIceConnectionState(),n.log("states ",this.iceGatheringState,this.iceConnectionState),this.iceGatheringState==="complete"&&this.iceConnectionState==="checking"&&this.handleIceChecking();var g={prevIceConnectionState:this.oldIceConnectionState,currIceConnectionState:this.iceConnectionState},h=this.iceConnectionState;this.getStatsHandler.getIceCandidates().then(function(C){u.localIceCandidates=C.localIceCandidates,u.remoteIceCandidates=C.remoteIceCandidates,u.iceCandidatePairs=C.iceCandidatePairs,u.prevActiveIceCandidatePair=u.activeIceCandidatePair,u.activeIceCandidatePair=u.getActiveIceCandidatePair(),h==="connected"||h==="completed"?u.handleIceConnectedOrCompleted(g):h==="failed"?u.handleIceFailed(g):h==="disconnected"?u.handleIceDisconnected(g):h==="closed"?u.handleIceClosed(g):h==="new"&&u.handleIceRestart(g)})}}},{key:"sendFabricStateChange",value:function(c){this.emb.make(m.internalFabricEvent.fabricStateChange,this.conferenceId,this.pc,c)}},{key:"handleIceConnectionState",value:function(){this.oldIceConnectionState=this.iceConnectionState,this.iceConnectionState=this.pc.iceConnectionState,n.warn("CALLBACK: ICE connection state change",this.oldIceConnectionState,"->",this.iceConnectionState);var c={changedState:m.fabricStateChangeType.iceConnectionState,prevState:this.oldIceConnectionState,newState:this.iceConnectionState};this.sendFabricStateChange(c)}},{key:"handleIceGatheringState",value:function(){if(this.iceGatheringState!==this.pc.iceGatheringState){this.pc.iceGatheringState==="complete"&&(this.iceGatheringDelay=o.getCurrent()-this.startTime),this.oldIceGatheringState=this.iceGatheringState,this.iceGatheringState=this.pc.iceGatheringState,n.warn("CALLBACK: ICE gathering state change",this.oldIceGatheringState,"->",this.iceGatheringState);var c={changedState:m.fabricStateChangeType.iceGatheringState,prevState:this.oldIceGatheringState,newState:this.iceGatheringState};this.sendFabricStateChange(c)}}},{key:"handleIceChecking",value:function(){var c=o.getCurrent();if(this.oldIceConnectionState==="disconnected"&&(this.pcState===m.fabricState.checkingDisrupted||this.pcState===m.fabricState.disrupted)){var u={prevIceConnectionState:this.oldIceConnectionState,currIceConnectionState:this.iceConnectionState,delay:c-this.connectionDisruptedTS};this.pcState===m.fabricState.disrupted&&(u.prevIceCandidatePair=this.prevActiveIceCandidatePair,u.currIceCandidatePair=this.activeIceCandidatePair,u.delay=c-this.disruptedTS,this.emb.make(m.internalFabricEvent.iceDisruptionEnd,this.conferenceId,this.pc,u)),this.pcState=m.fabricState.initializing,this.emb.make(m.internalFabricEvent.iceConnectionDisruptionEnd,this.conferenceId,this.pc,u)}}},{key:"handleIceConnectedOrCompleted",value:function(c){var u=o.getCurrent();this.pcState===m.fabricState.disrupted&&(c.prevIceCandidatePair=this.prevActiveIceCandidatePair,c.currIceCandidatePair=this.activeIceCandidatePair,c.delay=u-this.disruptedTS,this.emb.make(m.internalFabricEvent.iceDisruptionEnd,this.conferenceId,this.pc,c)),this.iceConnectivityDelay=u-this.startTime,this.established=!0,this.pcState=m.fabricState.established,this.sendfabricSetup(),this.startStatsPolling()}},{key:"sendfabricSetup",value:function(){if(this.fabricSetupSent)n.log("fabricSetup has been sent already");else{var c={delay:o.getCurrent()-this.startTime,iceGatheringDelay:this.iceGatheringDelay,iceConnectivityDelay:this.iceConnectivityDelay,localIceCandidates:this.localIceCandidates,remoteIceCandidates:this.remoteIceCandidates,iceCandidatePairs:this.iceCandidatePairs},u=this.getActiveIceCandidatePair();u&&(c.selectedCandidatePairID=u.id),this.fabricSetupSent=!0;var g=void 0;this.conferenceId&&(g=f.Registry.getConferenceManager().get(this.conferenceId).getPeerConnectionManager().getPcHandler(this.pc),c.remoteEndpointType=g.getRemoteEndpointType(),c.fabricTransmissionDirection=g.getFabricTransmissionDirection()),this.pcState=m.fabricState.established,this.emb.make(m.internalFabricEvent.fabricSetup,this.conferenceId,this.pc,c)}}},{key:"isFabricSetupSent",value:function(){return this.fabricSetupSent}},{key:"startStatsPolling",value:function(){this.getStatsHandler.startStatsPolling()}},{key:"stopStatsPolling",value:function(){this.getStatsHandler.stopStatsPolling()}},{key:"handleIceFailed",value:function(c){c.currIceCandidatePair=this.activeIceCandidatePair,c.failureDelay=o.getCurrent()-this.startTime,c.delay=o.getCurrent()-this.startTime,this.pcState=m.fabricState.failed,c.prevIceConnectionState==="checking"?this.sendIceFailed(c):c.prevIceConnectionState==="completed"||c.prevIceConnectionState==="connected"||c.prevIceConnectionState==="disconnected"&&this.established?this.emb.make(m.internalFabricEvent.fabricDropped,this.conferenceId,this.pc,c):c.prevIceConnectionState==="disconnected"&&this.sendIceFailed(c)}},{key:"getActiveIceCandidatePair",value:function(){var c=null,u=this.iceCandidatePairs;if(u&&u.length>0){var g=u.filter(function(h){return h.selected==="true"||h.googActiveConnection==="true"||h.selected===!0||h.googActiveConnection===!0});g.length>0&&(c=g[0])}return c}},{key:"sendIceFailed",value:function(c){c.localIceCandidates=this.localIceCandidates,c.remoteIceCandidates=this.remoteIceCandidates,c.iceCandidatePairs=this.iceCandidatePairs,n.log("sending icefailed ",c),this.emb.make(m.internalFabricEvent.iceFailed,this.conferenceId,this.pc,c)}},{key:"sendFabricTransportSwitch",value:function(c){var u=this,g={};g.prevIceCandidatePair=u.activeIceCandidatePair,g.relayType=c,g.currIceConnectionState=u.iceConnectionState,g.prevIceConnectionState=u.oldIceConnectionState,g.switchDelay=null,u.getStatsHandler.getIceCandidates().then(function(h){u.localIceCandidates=h.localIceCandidates,u.remoteIceCandidates=h.remoteIceCandidates,u.iceCandidatePairs=h.iceCandidatePairs,u.activeIceCandidatePair=u.getActiveIceCandidatePair(),g.currIceCandidatePair=u.activeIceCandidatePair,g.localIceCandidates=u.localIceCandidates,g.remoteIceCandidates=u.remoteIceCandidates,n.log("sending fabric transport switch ",g),g.currIceConnectionState!=="completed"&&g.currIceConnectionState!=="connected"||g.prevIceConnectionState!=="completed"&&g.prevIceConnectionState!=="connected"||u.emb.make(m.internalFabricEvent.fabricTransportSwitch,u.conferenceId,u.pc,g)})}},{key:"handleIceDisconnected",value:function(c){var u=o.getCurrent();this.startTime=u,c.prevIceConnectionStateTs=this.iceConnectionStateTS,c.currIceCandidatePair=this.activeIceCandidatePair,c.prevIceConnectionState==="connected"||c.prevIceConnectionState==="completed"?(this.pcState=m.fabricState.disrupted,this.disruptedTS=u,this.emb.make(m.internalFabricEvent.iceDisruptionStart,this.conferenceId,this.pc,c),this.callback&&this.callback(s.csError.appConnectivityError,"Connectivity check for PC object to "+this.remoteId+" failed.")):c.prevIceConnectionState==="checking"&&(this.pcState=m.fabricState.checkingDisrupted,this.connectionDisruptedTS=u,this.emb.make(m.internalFabricEvent.iceConnectionDisruptionStart,this.conferenceId,this.pc,c),this.callback&&this.callback(s.csError.appConnectivityError,"Connectivity check for PC object to "+this.remoteId+" failed."))}},{key:"handleIceClosed",value:function(c){c.prevIceConnectionState==="new"||c.prevIceConnectionState==="checking"?(c.failureDelay=o.getCurrent()-this.startTime,c.localIceCandidates=this.localIceCandidates,c.remoteIceCandidates=this.remoteIceCandidates,c.iceCandidatePairs=this.iceCandidatePairs,this.emb.make(m.internalFabricEvent.iceAborted,this.conferenceId,this.pc,c)):c.prevIceConnectionState!=="connected"&&c.prevIceConnectionState!=="completed"||(c.prevIceCandidatePair=this.activeIceCandidatePair,this.emb.make(m.internalFabricEvent.iceTerminated,this.conferenceId,this.pc,c)),this.pcState=m.fabricState.terminated,this.stopStatsPolling()}},{key:"handleIceRestart",value:function(c){c.prevIceCandidatePair=this.prevActiveIceCandidatePair,c.prevIceConnectionState!=="new"&&(n.log("iceRestarted sending"),this.established=!1,this.emb.make(m.internalFabricEvent.iceRestarted,this.conferenceId,this.pc,c))}},{key:"pcSignalingStateChangeCallback",value:function(c){var u=this;if(c){var g=this.signalingState;this.signalingState=this.pc.signalingState,n.warn("CALLBACK: signaling state change",g,"->",this.signalingState);var h={changedState:m.fabricStateChangeType.signalingState,prevState:g,newState:this.signalingState};this.sendFabricStateChange(h),this.signalingState!=="have-remote-offer"&&this.signalingState!=="stable"||(this.precalltest.callStarts(),this.genericevent.sendEvent(m.logEvents.log,{msg:"precalltest told to stop "})),this.signalingState==="closed"&&(this.emb.make(m.fabricEvent.fabricTerminated,this.conferenceId,this.pc),this.userAlive.stop(),this.precalltest.callFinished(),this.stopStatsPolling(),this.pcState=m.fabricState.terminated),this.signalingState!=="have-local-offer"&&this.signalingState!=="have-local-pranswer"&&this.signalingState!=="stable"||(n.log(this.signalingState,".. requesting sender config."),f.Registry.getConfigServiceWrapper().initiateSenderConfig(this.pc).then(function(){var C=f.Registry.getConfigServiceWrapper().getSenderConfig();n.log("Sender config:",C);var E=m.callstatsChannels.senderConfiguration;C&&f.Registry.getEventMessageBuilder().make(E,u.conferenceId,u.pc,C)}).catch(function(C){n.warn(C)}))}}},{key:"pcNegotiationNeededCallback",value:function(c){c&&(this.negotiationNeeded++,this.startTime=o.getCurrent(),n.warn("CALLBACK: negotiation needed",this.negotiationNeeded))}}]),a}();b.PcCallbackHandler=i},{"../config/callstatserrors":32,"../config/constants":33,"../utility/csiologger":88,"../utility/registry":95,"../utility/timestamps":99}],41:[function(S,p,b){function _(h){if(h&&h.__esModule)return h;var C={};if(h!=null)for(var E in h)Object.prototype.hasOwnProperty.call(h,E)&&(C[E]=h[E]);return C.default=h,C}function t(h,C){if(!(h instanceof C))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0}),b.PeerConnectionHandler=void 0;var m=function(){function h(C,E){for(var y=0;y<E.length;y++){var w=E[y];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(C,w.key,w)}}return function(C,E,y){return E&&h(C.prototype,E),y&&h(C,y),C}}(),f=S("../utility/registry"),o=S("../peerconnection/pccallbackhandler"),s=S("../browserapi/devices"),n=S("./useralivehandler"),i=S("./getstatshandler"),a=_(S("../config/constants")),c=_(S("../utility/timestamps")),u=_(S("../utility/csiologger")),g=function(){function h(C){t(this,h),this.pc=C.pc,this.remoteId=C.remoteId,this.fabricUsage=C.fabricUsage,this.callback=C.callback,this.conferenceId=C.conferenceId,this.remoteEndpointType=C.remoteEndpointType,this.fabricTransmissionDirection=C.fabricTransmissionDirection,this.clocksync=f.Registry.getClockSync(),this.startTime=this.clocksync.getSynchronizedTimestamp(),this.credentials=f.Registry.getCredentials(),this.pcHash=this.generatePcHash(),this.ssrcMap=new Map,this.localSdp=null,this.remoteSdp=null,this.transportInfo=null,this.userAliveHandler=new n.UserAliveHandler(this.conferenceId,this.pc),this.userAliveHandler.start(),this.emb=f.Registry.getEventMessageBuilder(),this.devices=new s.Devices(this.conferenceId,this.pc);var E=f.Registry.getEndpoint();this.getStatsHandler=new i.GetStatsHandler(this.pc,this.pcHash,5e3,E.getCodeBase(),E.getBrowserName()),this.pcCallbackHandler=new o.PcCallbackHandler(this.conferenceId,this.pc,this.getStatsHandler,this.userAliveHandler,this.remoteId,this.callback),this.devices.collectConnected(),this.fabricTransmissionDirection||(this.fabricTransmissionDirection="sendrecv"),this.remoteEndpointType||(this.remoteEndpointType="peer")}return m(h,[{key:"getFabricTransmissionDirection",value:function(){return this.fabricTransmissionDirection}},{key:"getRemoteEndpointType",value:function(){return this.remoteEndpointType}},{key:"stopUserAliveHandler",value:function(){this.userAliveHandler.stop()}},{key:"getPcState",value:function(){return this.pcCallbackHandler.pcState}},{key:"stopStatsPolling",value:function(){this.getStatsHandler.stopStatsPolling()}},{key:"startStatsPolling",value:function(){this.getStatsHandler.startStatsPolling()}},{key:"setPcState",value:function(C){C in a.fabricState?this.pcCallbackHandler.pcState=C:u.error("setPcState: Invalid state")}},{key:"getAppId",value:function(){return this.credentials.getAppId()}},{key:"getLocalId",value:function(){return this.credentials.getUserId()}},{key:"getConferenceId",value:function(){return this.conferenceId}},{key:"getPeerConnection",value:function(){return this.pc}},{key:"getRemoteId",value:function(){return this.remoteId}},{key:"isFabricSetupSent",value:function(){return this.pcCallbackHandler.isFabricSetupSent()}},{key:"getStartTime",value:function(){return this.startTime}},{key:"getCallback",value:function(){return this.callback}},{key:"getPcHash",value:function(){return this.pcHash}},{key:"getIceCandidates",value:function(){return this.pcCallbackHandler?this.pcCallbackHandler.iceCandidates:null}},{key:"getIceConnectionState",value:function(){return this.pcCallbackHandler?this.pcCallbackHandler.iceConnectionState:null}},{key:"getNegotiationsNumber",value:function(){return this.pcCallbackHandler?this.pcCallbackHandler.negotiationNeeded:0}},{key:"sendFabricTransportSwitch",value:function(C){this.pcCallbackHandler&&this.pcCallbackHandler.sendFabricTransportSwitch(C)}},{key:"getSdp",value:function(){return{localSdp:this.localSdp,remoteSdp:this.remoteSdp}}},{key:"setSdp",value:function(C,E){this.localSdp=C,this.remoteSdp=E}},{key:"generatePcHash",value:function(){var C=(Math.random()+1).toString(36);return C.substring(2,C.length)}},{key:"getTransportInfo",value:function(){return this.transportInfo}},{key:"setTransportInfo",value:function(C){this.transportInfo=C}},{key:"updateSDP",value:function(C){var E=this,y=void 0,w=void 0;if(this.pc&&this.pc.localDescription&&(y=this.pc.localDescription.sdp),this.pc&&this.pc.remoteDescription&&(w=this.pc.remoteDescription.sdp),y&&w&&(y!==this.localSdp||w!==this.remoteSdp)){this.parseSDP(y,a.streamType.outbound),this.parseSDP(w,a.streamType.inbound);var O={localSDP:y!==this.localSdp?y:"",remoteSDP:w!==this.remoteSdp?w:""};y===""&&remoteSDP===""||!f.Registry.getCredentials().getCollectSDP()||this.emb.make(a.internalFabricEvent.sdpSubmission,this.conferenceId,this.pc,O),C&&C.forEach(function(P){var F=String(P.data.ssrc),H=E.ssrcMap.get(F);H||(H={}),H.mediaType=P.data.mediaType,H.reportType=P.data.isRemote?"remote":"local",H.ssrc=F,E.ssrcMap.set(F,H)});var L=[];this.ssrcMap.forEach(function(P,F){P.msid&&P.mslabel&&P.label&&L.push(P)});for(var I={ssrcData:L},k=0;k<I.ssrcData.length;k+=1)I.ssrcData[k].userID=f.Registry.getCredentials().getUserId();this.emb.make(a.internalFabricEvent.ssrcMap,this.conferenceId,this.pc,I),this.setSdp(y,w)}}},{key:"parseSDP",value:function(C,E){var y=this,w=RegExp.prototype.test.bind(/^([a-z])=(.*)/),O=/^ssrc:(\d*) ([\w_]*):(.*)/,L=/^ssrc-group:SIM (\d*)/;C.split(/(\r\n|\r|\n)/).filter(w).forEach(function(I){var k=I[0],P=I.slice(2);if(k==="a"&&O.test(P)){var F=P.match(O),H=F[1],D=F[2],$=F[3],j=y.ssrcMap.get(H);if(j||(j={}),j.ssrc=H,j[D]=$,j.localStartTime=c.getCurrent(),j.syncedStartTime=y.clocksync.getSynchronizedTimestamp(),j.streamType=E,!L.test(P))return void y.ssrcMap.set(H,j);j.ssrcGroup={},j.ssrcGroup[E]={},j.ssrcGroup[E].simulcastGroup=P.match(/\d+/g),y.ssrcMap.set(H,j)}})}},{key:"getSSRCInfo",value:function(C){return this.ssrcMap.get(C)}},{key:"setupVideoTagMethods",value:function(C,E){var y=this,w=document.getElementById(C);w&&(w.oncanplay=function(){var O={ssrc:String(E),highResTs:c.getCurrent()};y.emb.make(a.internalFabricEvent.mediaPlaybackStart,y.conferenceId,y.pc,O)},w.onsuspend=function(){var O={ssrc:String(E),highResTs:c.getCurrent()};y.emb.make(a.internalFabricEvent.mediaPlaybackSuspended,y.conferenceId,y.pc,O)})}},{key:"updateSSRCInfo",value:function(C,E,y,w){var O=this.ssrcMap.get(C);O||(O={}),O.ssrc=C,O.remoteUserID=E,O.usageLabel=y,O.associatedVideoTag=w,this.ssrcMap.set(C,O),w&&E!==this.credentials.getUserId()&&this.setupVideoTagMethods(w,C)}},{key:"updateConferenceId",value:function(C){this.conferenceId=C,this.userAliveHandler.updateConferenceId(C)}},{key:"updateRemoteId",value:function(C){this.remoteId=C}}],[{key:"Builder",get:function(){return function(){function C(){t(this,C)}return m(C,[{key:"withPc",value:function(E){return this.pc=E,this}},{key:"withRemoteId",value:function(E){return this.remoteId=E,this}},{key:"withFabricUsage",value:function(E){return this.fabricUsage=E,this}},{key:"withConferenceId",value:function(E){return this.conferenceId=E,this}},{key:"withRemoteEndpointType",value:function(E){return this.remoteEndpointType=E,this}},{key:"withFabricTransmissionDirection",value:function(E){return this.fabricTransmissionDirection=E,this}},{key:"withCallback",value:function(E){return this.callback=E,this}},{key:"make",value:function(){return new h(this)}}]),C}()}}]),h}();b.PeerConnectionHandler=g},{"../browserapi/devices":19,"../config/constants":33,"../peerconnection/pccallbackhandler":40,"../utility/csiologger":88,"../utility/registry":95,"../utility/timestamps":99,"./getstatshandler":39,"./useralivehandler":43}],42:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.PeerConnectionManager=void 0;var _=function(){function f(o,s){for(var n=0;n<s.length;n++){var i=s[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(o,i.key,i)}}return function(o,s,n){return s&&f(o.prototype,s),n&&f(o,n),o}}(),t=S("./peerconnectionhandler"),m=function(){function f(){(function(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")})(this,f),this.pcHandlers=new Map}return _(f,[{key:"removePcHandler",value:function(o){var s=this.getPcHandler(o);if(s){var n=s.getPcHash();this.pcHandlers.delete(n)}}},{key:"addPcHandler",value:function(o,s,n,i,a,c,u){if(!this.getPcHandler(o)){var g=new t.PeerConnectionHandler.Builder().withPc(o).withRemoteId(s).withFabricUsage(n).withConferenceId(i).withRemoteEndpointType(a).withFabricTransmissionDirection(c).withCallback(u).make();this.pcHandlers.set(g.getPcHash(),g)}}},{key:"getPcHandler",value:function(o){var s=null;return o&&this.pcHandlers.forEach(function(n,i){n&&n.getPeerConnection()===o&&(s=n)}),s}},{key:"getPcHandlerByHash",value:function(o){return o&&this.pcHandlers.has(o)?this.pcHandlers.get(o):null}},{key:"updateConferenceId",value:function(o){this.pcHandlers.forEach(function(s,n){s.updateConferenceId(o)})}}]),f}();b.PeerConnectionManager=m},{"./peerconnectionhandler":41}],43:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.UserAliveHandler=void 0;var _=function(){function s(n,i){for(var a=0;a<i.length;a++){var c=i[a];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(n,c.key,c)}}return function(n,i,a){return i&&s(n.prototype,i),a&&s(n,a),n}}(),t=function(s){if(s&&s.__esModule)return s;var n={};if(s!=null)for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(n[i]=s[i]);return n.default=s,n}(S("../config/constants")),m=S("../utility/timeoutprocess"),f=S("../utility/registry"),o=function(s){function n(i,a){(function(u,g){if(!(u instanceof g))throw new TypeError("Cannot call a class as a function")})(this,n);var c=function(u,g){if(!u)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!g||typeof g!="object"&&typeof g!="function"?u:g}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,1e4));return c.emb=f.Registry.getEventMessageBuilder(),c.pc=a,c.conferenceId=i,c.setCallback(c.send),c}return function(i,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof a);i.prototype=Object.create(a&&a.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(i,a):i.__proto__=a)}(n,s),_(n,[{key:"send",value:function(){this.conferenceId!==t.tmpConferenceId&&this.pc&&this.emb.make(t.internalFabricEvent.userAlive,this.conferenceId,this.pc)}},{key:"updateConferenceId",value:function(i){this.conferenceId=i}}]),n}(m.TimeoutProcess);b.UserAliveHandler=o},{"../config/constants":33,"../utility/registry":95,"../utility/timeoutprocess":98}],44:[function(S,p,b){function _(O){if(O&&O.__esModule)return O;var L={};if(O!=null)for(var I in O)Object.prototype.hasOwnProperty.call(O,I)&&(L[I]=O[I]);return L.default=O,L}Object.defineProperty(b,"__esModule",{value:!0}),b.Authenticator=void 0;var t=function(){function O(L,I){for(var k=0;k<I.length;k++){var P=I[k];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(L,P.key,P)}}return function(L,I,k){return I&&O(L.prototype,I),k&&O(L,k),L}}(),m=function O(L,I,k){L===null&&(L=Function.prototype);var P=Object.getOwnPropertyDescriptor(L,I);if(P===void 0){var F=Object.getPrototypeOf(L);return F===null?void 0:O(F,I,k)}if("value"in P)return P.value;var H=P.get;return H!==void 0?H.call(k):void 0},f=S("./jwt/jwt"),o=S("./jwt/jwttoken"),s=_(S("../config/settings")),n=_(S("../utility/base64")),i=_(S("../config/callstatserrors")),a=_(S("../config/constants")),c=_(S("../browserapi/localstorage")),u=_(S("../utility/json")),g=S("./xmlhttp"),h=S("./xmlhttpservice"),C=S("../utility/registry"),E=_(S("../utility/csiologger")),y=s.authRetryTimeout,w=function(O){function L(){(function(k,P){if(!(k instanceof P))throw new TypeError("Cannot call a class as a function")})(this,L);var I=function(k,P){if(!k)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!P||typeof P!="object"&&typeof P!="function"?k:P}(this,(L.__proto__||Object.getPrototypeOf(L)).call(this,"Authenticator"));return I.clockSync=C.Registry.getClockSync(),I.credentials=C.Registry.getCredentials(),I}return function(I,k){if(typeof k!="function"&&k!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof k);I.prototype=Object.create(k&&k.prototype,{constructor:{value:I,enumerable:!1,writable:!0,configurable:!0}}),k&&(Object.setPrototypeOf?Object.setPrototypeOf(I,k):I.__proto__=k)}(L,O),t(L,[{key:"initiate",value:function(I,k){var P=this;return this.inProgress?(k&&k(i.csError.authOngoing,null),new Promise(function(F,H){H(new Error(P.name+": in progress"))})):this.credentials.getAppId()&&this.credentials.getUserId()?(this.initCallback=k,typeof I=="function"?(this.setTokenGenerator(I),m(L.prototype.__proto__||Object.getPrototypeOf(L.prototype),"initiate",this).call(this)):new Promise(function(F,H){P.createTokenGenerator(I).then(function(D){P.setTokenGenerator(D),m(L.prototype.__proto__||Object.getPrototypeOf(L.prototype),"initiate",P).call(P).then(function(){F()},function($){H($)})},function(D){H(new Error(P.name+": tokenGenerator creation problem ("+D+")"))})})):new Promise(function(F,H){H(new Error(P.name+": credentials not set"))})}},{key:"getToken",value:function(){var I=null;return this.token&&(I=this.token.getToken()),I}},{key:"isTokenValid",value:function(){return!!this.token&&this.token.isValid(this.credentials)}},{key:"getElapsed",value:function(){return this.isCompleted()?this.elapsed:null}},{key:"getIceServers",value:function(){return this.iceServers}},{key:"reset",value:function(){this.token=null,this.reauthTimer=null,this.renew=!1,this.credentials=null,this.jwt=new f.Jwt,this.tokenGenerator=function(I,k){k("Token generator is not set")},this.elapsed=0,this.iceServers=null,m(L.prototype.__proto__||Object.getPrototypeOf(L.prototype),"reset",this).call(this)}},{key:"setupToken",value:function(I){c.store("csio_auth_data",JSON.stringify(I)),this.token=new o.JwtToken(I,this.clockSync)}},{key:"clearReauthTimer",value:function(){this.reauthTimer!==null&&(clearTimeout(this.reauthTimer),this.reauthTimer=null)}},{key:"setupReauthTimer",value:function(I){var k=this;k.clearReauthTimer(),k.reauthTimer=setTimeout(function(){k.reAuthenticate()},I)}},{key:"reAuthenticate",value:function(){this.inProgress||(this.inProgress=!0,this.token=null,this.sendRequest())}},{key:"handleErrorActions",value:function(I){if(I.length!==0){var k=I.shift();if(k.action===i.authErrorActions.RETRY){var P=k.params.timeout?k.params.timeout:s.authRetryTimeout;this.setupReauthTimer(P),this.handleErrorActions(I)}k.action===i.authErrorActions.GET_NEW_TOKEN&&(this.renew=!0,this.handleErrorActions(I)),k.action===i.authErrorActions.REPORT_ERROR&&(E.error(this.name+": "+k.params.errorReason),this.handleErrorActions(I))}}},{key:"setTokenGenerator",value:function(I){this.tokenGenerator=I}},{key:"handleResponse",value:function(I){var k=I.getXhr(),P=I.getElapsed(),F=u.parse(k.response);if(!F)return E.error(this.name+": invalid authentication response"),void this.sendNextRequest();if(F["urn:x-callstats:auth:errorActions"]&&F["urn:x-callstats:auth:errorActions"].length>0)this.handleErrorActions(F["urn:x-callstats:auth:errorActions"]);else{if(k.status===200){if(F.token_type!=="bearer")return E.error(this.name+": successful, but token type was not bearer. Scheduling retry."),void this.sendNextRequest();this.setupToken(F.access_token),F.iceServers&&(this.iceServers=F.iceServers);var H=parseInt(1e3*parseInt(F.expires_in)*.9);return this.setupReauthTimer(H),this.renew=!1,this.initCallback&&this.initCallback(i.csError.success,a.csCallBackMessages.authSuccessful),this.elapsed=P,void this.completeProcess()}E.error("Authentication failed, but no error actions were defined in response."),this.sendNextRequest()}}},{key:"request",value:function(){var I=this;this.clearReauthTimer();var k=new Promise(function(P,F){I.tempResolve=P,I.tempReject=F});return this.tokenGenerator(this.renew,function(P,F){if(P!==null)return I.initCallback&&I.initCallback(i.csError.tokenGenerationError,P.toString()),I.rejectCb(new Error(I.name+": tokenGenerationError")),E.error("tokenGenerationError ",P),null;var H=s.authServiceUrl+"authenticate",D={client_id:I.credentials.userId+"@"+I.credentials.getAppId(),code:F,grant_type:"authorization_code"};(0,g.sendPostRequest)(H,{"Content-Type":"application/x-www-form-urlencoded"},y,D).then(function($){I.tempResolve($)},function($){I.tempReject($)})}),k}},{key:"tokenGeneratorCreator",value:function(I,k){var P=this;return function(F,H){var D=null;if(!F&&D!==null)return H(null,D);var $=P.credentials,j={userID:$.getUserId(),appID:$.getAppId()};k&&(j.keyId=k),P.jwt.sign({alg:"HS256"},j,I).then(function(V){D=V,H(null,V)}).catch(function(V){H(V)})}}},{key:"createTokenGenerator",value:function(I){var k=this;return new Promise(function(P,F){var H=null;I.indexOf(":")>-1&&(H=n.strtohex(I.split(":")[0]),I=I.split(":")[1]),k.jwt.importKey(I).then(function(D){I=null;var $=k.tokenGeneratorCreator(D,H);P($)}).catch(function(D){E.error(k.name+": could not import key ("+D+")"),F(D)})})}}]),L}(h.XMLHttpService);b.Authenticator=w},{"../browserapi/localstorage":20,"../config/callstatserrors":32,"../config/constants":33,"../config/settings":34,"../utility/base64":85,"../utility/csiologger":88,"../utility/json":93,"../utility/registry":95,"./jwt/jwt":52,"./jwt/jwttoken":53,"./xmlhttp":58,"./xmlhttpservice":59}],45:[function(S,p,b){function _(i){if(i&&i.__esModule)return i;var a={};if(i!=null)for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(a[c]=i[c]);return a.default=i,a}Object.defineProperty(b,"__esModule",{value:!0}),b.GenericEventHandler=void 0;var t=function(){function i(a,c){for(var u=0;u<c.length;u++){var g=c[u];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(a,g.key,g)}}return function(a,c,u){return c&&i(a.prototype,c),u&&i(a,u),a}}(),m=_(S("../config/settings")),f=S("./xmlhttp"),o=S("../utility/registry"),s=_(S("../utility/csiologger")),n=function(){function i(){(function(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function")})(this,i),this.credentials=o.Registry.getCredentials(),this.enabled=!1}return t(i,[{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1}},{key:"sendEvent",value:function(a,c){this.send(a,c).then(function(u){s.log("Got generic response: %o",u)}).catch(function(u){s.log("Got error for generic request",u)})}},{key:"send",value:function(a,c){if(!this.enabled)return new Promise(function(g,h){h(new Error("GenericEvent Error: not enabled"))});var u=this;return new Promise(function(g,h){var C={appID:u.credentials.appId,userID:encodeURIComponent(u.credentials.userId),version:m.version,eventType:a,data:c},E=m.baseUrl+"generics";(0,f.sendPostRequest)(E,{"Content-Type":"application/json"},5e3,C).then(function(y){g(y.getXhr().response)},function(y){h(y)})})}}]),i}();b.GenericEventHandler=n},{"../config/settings":34,"../utility/csiologger":88,"../utility/registry":95,"./xmlhttp":58}],46:[function(S,p,b){function _(u){if(u&&u.__esModule)return u;var g={};if(u!=null)for(var h in u)Object.prototype.hasOwnProperty.call(u,h)&&(g[h]=u[h]);return g.default=u,g}Object.defineProperty(b,"__esModule",{value:!0}),b.ClockSync=void 0;var t=function(){function u(g,h){for(var C=0;C<h.length;C++){var E=h[C];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(g,E.key,E)}}return function(g,h,C){return h&&u(g.prototype,h),C&&u(g,C),g}}(),m=function u(g,h,C){g===null&&(g=Function.prototype);var E=Object.getOwnPropertyDescriptor(g,h);if(E===void 0){var y=Object.getPrototypeOf(g);return y===null?void 0:u(y,h,C)}if("value"in E)return E.value;var w=E.get;return w!==void 0?w.call(C):void 0},f=_(S("../config/settings")),o=S("./xmlhttp"),s=_(S("../utility/timestamps")),n=S("./xmlhttpservice"),i=S("../utility/registry"),a=_(S("../config/constants")),c=function(u){function g(){(function(C,E){if(!(C instanceof E))throw new TypeError("Cannot call a class as a function")})(this,g);var h=function(C,E){if(!C)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!E||typeof E!="object"&&typeof E!="function"?C:E}(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,"ClockSync"));return h.currentOffset=0,h.completed=!1,h}return function(h,C){if(typeof C!="function"&&C!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof C);h.prototype=Object.create(C&&C.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),C&&(Object.setPrototypeOf?Object.setPrototypeOf(h,C):h.__proto__=C)}(g,u),t(g,[{key:"initiate",value:function(){return this.startTime=s.getCurrent(),m(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"initiate",this).call(this)}},{key:"getSynchronizedTimestamp",value:function(){return s.getCurrent()+this.currentOffset}},{key:"getElapsed",value:function(){return this.isCompleted()?this.endTime-this.startTime:null}},{key:"getOffset",value:function(){return this.currentOffset}},{key:"reset",value:function(){this.currentOffset=0,this.offsetResults=[],this.startTime=0,this.endTime=0,m(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"reset",this).call(this)}},{key:"request",value:function(){var h=f.baseUrl+"clockSync";return(0,o.sendGetRequest)(h,null,5e3)}},{key:"handleResponse",value:function(h){var C=h.getXhr(),E=h.getElapsed(),y=JSON.parse(C.response),w=s.getCurrent();this.handleMessage(y,E,w)}},{key:"handleMessage",value:function(h,C,E){var y=C/2;y>6e4?this.offsetResults=[]:this.addOffset(h,y,E),this.offsetResults.length>=5?(this.calculateOffset(),this.endTime=s.getCurrent(),this.completeProcess()):this.sendRequest()}},{key:"isCompleted",value:function(){return this.completed}},{key:"addOffset",value:function(h,C,E){var y=h.now+C-E;this.offsetResults.push(y)}},{key:"calculateOffset",value:function(){var h=this.offsetResults.reduce(function(C,E){return C+E});this.currentOffset=h/this.offsetResults.length,this.currentOffset=isNaN(this.currentOffset)?0:this.currentOffset,i.Registry.getGenericEventHandler().sendEvent(a.logEvents.log,{msg:"clockSync Done, offset is: "+this.currentOffset+"results length"+this.offsetResults.length}),this.offsetResults=[],this.completed=!0}}]),g}(n.XMLHttpService);b.ClockSync=c},{"../config/constants":33,"../config/settings":34,"../utility/registry":95,"../utility/timestamps":99,"./xmlhttp":58,"./xmlhttpservice":59}],47:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0});var _=function(){function m(f,o){for(var s=0;s<o.length;s++){var n=o[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(f,n.key,n)}}return function(f,o,s){return o&&m(f.prototype,o),s&&m(f,s),f}}(),t=function(){function m(){(function(f,o){if(!(f instanceof o))throw new TypeError("Cannot call a class as a function")})(this,m),this.connected=!1,this.reconnected=!1,this.conferenceUrl={}}return _(m,[{key:"setup",value:function(){return new Promise(function(f,o){f()})}},{key:"isReady",value:function(){return this.connected}},{key:"send",value:function(f){}}]),m}();b.CollectorConnection=t},{}],48:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.ConfigServiceGet=void 0;var _=function(){function n(i,a){for(var c=0;c<a.length;c++){var u=a[c];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(i,u.key,u)}}return function(i,a,c){return a&&n(i.prototype,a),c&&n(i,c),i}}(),t=function n(i,a,c){i===null&&(i=Function.prototype);var u=Object.getOwnPropertyDescriptor(i,a);if(u===void 0){var g=Object.getPrototypeOf(i);return g===null?void 0:n(g,a,c)}if("value"in u)return u.value;var h=u.get;return h!==void 0?h.call(c):void 0},m=S("../xmlhttp"),f=S("../xmlhttpservice"),o=S("../../utility/registry"),s=function(n){function i(){return function(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function")}(this,i),function(a,c){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!c||typeof c!="object"&&typeof c!="function"?a:c}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"ConfigService"))}return function(a,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}(i,n),_(i,[{key:"initiate",value:function(a){var c=this;return this.url=a,this.authToken=o.Registry.getAuthenticator().getToken(),this.authToken?t(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"initiate",this).call(this):new Promise(function(u,g){g(new Error(c.name+": authToken has to be string"))})}},{key:"getConfig",value:function(){return this.config}},{key:"getElapsed",value:function(){return this.isCompleted()?this.elapsed:null}},{key:"reset",value:function(){this.authToken=null,this.url=null,this.config=null,this.elapsed=0,t(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"reset",this).call(this)}},{key:"request",value:function(){var a={Authorization:"Bearer "+this.authToken};return(0,m.sendGetRequest)(this.url,a,2e3)}},{key:"handleResponse",value:function(a){var c=a.getXhr(),u=a.getElapsed();this.config=JSON.parse(c.response),this.elapsed=u,this.completeProcess()}}]),i}(f.XMLHttpService);b.ConfigServiceGet=s},{"../../utility/registry":95,"../xmlhttp":58,"../xmlhttpservice":59}],49:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.ConfigServicePost=void 0;var _=function(){function o(s,n){for(var i=0;i<n.length;i++){var a=n[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(s,a.key,a)}}return function(s,n,i){return n&&o(s.prototype,n),i&&o(s,i),s}}(),t=function o(s,n,i){s===null&&(s=Function.prototype);var a=Object.getOwnPropertyDescriptor(s,n);if(a===void 0){var c=Object.getPrototypeOf(s);return c===null?void 0:o(c,n,i)}if("value"in a)return a.value;var u=a.get;return u!==void 0?u.call(i):void 0},m=S("../xmlhttp"),f=function(o){function s(){return function(n,i){if(!(n instanceof i))throw new TypeError("Cannot call a class as a function")}(this,s),function(n,i){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||typeof i!="object"&&typeof i!="function"?n:i}(this,(s.__proto__||Object.getPrototypeOf(s)).call(this))}return function(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof i);n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(n,i):n.__proto__=i)}(s,o),_(s,[{key:"initiate",value:function(n,i){return this.body=i,t(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"initiate",this).call(this,n)}},{key:"request",value:function(){var n={Authorization:"Bearer "+this.authToken,"Content-Type":"application/json"};return(0,m.sendPostRequest)(this.url,n,2e3,this.body)}}]),s}(S("./configserviceget").ConfigServiceGet);b.ConfigServicePost=f},{"../xmlhttp":58,"./configserviceget":48}],50:[function(S,p,b){function _(c){if(c&&c.__esModule)return c;var u={};if(c!=null)for(var g in c)Object.prototype.hasOwnProperty.call(c,g)&&(u[g]=c[g]);return u.default=c,u}Object.defineProperty(b,"__esModule",{value:!0}),b.ConfigServiceWrapper=void 0;var t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},m=function(){function c(u,g){for(var h=0;h<g.length;h++){var C=g[h];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(u,C.key,C)}}return function(u,g,h){return g&&c(u.prototype,g),h&&c(u,h),u}}(),f=S("./configserviceget"),o=S("./configservicepost"),s=_(S("../../config/settings")),n=S("../../utility/registry"),i=_(S("../../utility/csiologger")),a=function(){function c(){(function(u,g){if(!(u instanceof g))throw new TypeError("Cannot call a class as a function")})(this,c),this.internalConfigService=new f.ConfigServiceGet,this.appConfigService=new f.ConfigServiceGet,this.senderConfigService=new o.ConfigServicePost,this.defaultSenderConfig=null}return m(c,[{key:"initiateInternalConfig",value:function(){var u=this,g=n.Registry.getCredentials().getAppId();if(!g)return new Promise(function(C,E){i.log("appId has to be string"),E(new Error(u.internalConfigService.name+": appId has to be string"))});var h=s.configServiceUrl+g;return this.internalConfigService.initiate(h+"/configurations/internal")}},{key:"initiateAppConfig",value:function(){var u=this,g=n.Registry.getCredentials().getAppId();if(!g)return new Promise(function(C,E){i.log("appId has to be string"),E(new Error(u.appConfigService.name+": appId has to be string"))});var h=s.configServiceUrl+g;return this.appConfigService.initiate(h+"/configurations")}},{key:"initiateSenderConfig",value:function(u){var g=this;if(this.senderConfigService.getConfig())return new Promise(function(w,O){i.log("sender config already present"),O(new Error(g.senderConfigService.name+": sender config already present"))});var h=n.Registry.getCredentials().getAppId(),C=n.Registry.getCredentials().getUserId();if(!h||!C)return new Promise(function(w,O){i.log("appId and userId have to be string"),O(new Error(g.senderConfigService.name+": appId and userId have to be string"))});if(this.defaultSenderConfig=this.getCurrentVideoSenderConfig(u),!this.defaultSenderConfig)return new Promise(function(w,O){i.log("Could not obtain a sender config"),O(new Error(g.senderConfigService.name+": Could not obtain a sender config"))});var E=s.configServiceUrl+h,y={app_id:h,local_id:C,rtc_rtp_parameters:this.defaultSenderConfig};return this.senderConfigService.initiate(E+"/configurations",y)}},{key:"getInternalConfig",value:function(){return this.internalConfigService.getConfig()}},{key:"getAppDefaultConfig",value:function(){var u=this.appConfigService.getConfig(),g={peerConnection:null,media:null};return u.default&&(u.default.peerConnection&&(g.peerConnection=u.default.peerConnection),u.default.media&&(g.media=u.default.media)),g}},{key:"getAppRecommendedConfig",value:function(){var u=this.appConfigService.getConfig(),g={};return u.recommended&&(u.recommended.peerConnection&&(g.peerConnection=u.recommended.peerConnection),u.recommended.media&&(g.media=u.recommended.media)),g}},{key:"getSenderConfig",value:function(){var u=this.senderConfigService.getConfig();return u&&u.recommended&&u.recommended.sender?u.recommended.sender:null}},{key:"getDefaultSenderConfig",value:function(){return this.defaultSenderConfig?this.defaultSenderConfig:null}},{key:"getInternalElapsed",value:function(){return this.internalConfigService.getElapsed()}},{key:"getAppElapsed",value:function(){return this.appConfigService.getElapsed()}},{key:"getSenderElapsed",value:function(){return this.senderConfigService.getElapsed()}},{key:"getCurrentVideoSenderConfig",value:function(u){var g={encodings:[{maxBitrate:0}]},h=n.Registry.getConferenceManager().getConferenceForPc(u);if(!h)return i.warn("No conference found for PC, skipping"),null;if(h.getPeerConnectionManager().pcHandlers.size>1)return i.warn("Multiple PCs found, skipping"),null;if(!u.getSenders||typeof u.getSenders!="function")return i.warn("Get senders error"),g;for(var C=u.getSenders(),E=void 0,y=0;y<C.length;y+=1){var w=C[y];if((w===void 0?"undefined":t(w))!=="object"||!w.track||t(w.track)!=="object"||!w.track.kind)return i.warn("Access senders error"),null;if(w.track.kind==="video"){if(E)return i.warn("Multiple video sender, skipping"),null;E=w}}if(!E)return i.warn("No video sender found"),null;if(!E.getParameters||typeof E.getParameters!="function")return i.warn("Sender getParameters error"),g;var O=E.getParameters();return(O===void 0?"undefined":t(O))!=="object"?null:("encodings"in O||(O.encodings=[]),O.encodings.length===0&&O.encodings.push({maxBitrate:0}),O)}}]),c}();b.ConfigServiceWrapper=a},{"../../config/settings":34,"../../utility/csiologger":88,"../../utility/registry":95,"./configserviceget":48,"./configservicepost":49}],51:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.ConnectionManager=void 0;var _=function(){function n(i,a){for(var c=0;c<a.length;c++){var u=a[c];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(i,u.key,u)}}return function(i,a,c){return a&&n(i.prototype,a),c&&n(i,c),i}}(),t=function(n){if(n&&n.__esModule)return n;var i={};if(n!=null)for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a]);return i.default=n,i}(S("../config/constants")),m=S("./wscollectorconnection"),f=S("./restcollectorconnection"),o=S("../utility/registry"),s=function(){function n(){(function(i,a){if(!(i instanceof a))throw new TypeError("Cannot call a class as a function")})(this,n),this.connection=null}return _(n,[{key:"setupCollectorConnection",value:function(i){i===t.transportType.rest?this.connection=new f.RestCollectorConnection:this.connection=new m.WsCollectorConnection}},{key:"setup",value:function(){return this.connection?this.connection.setup():new Promise(function(i,a){a()})}},{key:"isReady",value:function(){return!!this.connection&&this.connection.isReady()}},{key:"send",value:function(i){this.connection?this.connection.send(i):o.Registry.getGenericEventHandler().sendEvent(t.logEvents.error,{msg:"Connection not available to the collector"})}}]),n}();b.ConnectionManager=s},{"../config/constants":33,"../utility/registry":95,"./restcollectorconnection":54,"./wscollectorconnection":57}],52:[function(S,p,b){function _(i){if(i&&i.__esModule)return i;var a={};if(i!=null)for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(a[c]=i[c]);return a.default=i,a}Object.defineProperty(b,"__esModule",{value:!0}),b.Jwt=void 0;var t=function(){function i(a,c){for(var u=0;u<c.length;u++){var g=c[u];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(a,g.key,g)}}return function(a,c,u){return c&&i(a.prototype,c),u&&i(a,u),a}}(),m=_(S("../../utility/base64")),f=_(S("../../utility/csiologger")),o=S("../../utility/registry"),s=_(S("../../config/constants")),n=function(){function i(){(function(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function")})(this,i),this.cryptotype=null,window.crypto&&window.crypto.subtle?(this.cryptotype="standard",this.subtlecrypto=window.crypto.subtle):window.crypto&&!window.crypto.subtle&&window.crypto.webkitSubtle?(this.cryptotype="webkit",this.subtlecrypto=window.crypto.webkitSubtle):window.msCrypto&&window.msCrypto.subtle?(this.cryptotype="ie",this.subtlecrypto=window.msCrypto.subtle):(this.subtlecrypto=null,f.info("WebCryptography API not supported in this browser.")),this.browserName=o.Registry.getEndpoint().getBrowserName()}return t(i,[{key:"sign",value:function(a,c,u){var g=this;return new Promise(function(h,C){a.alg!=="HS256"&&C("Use header.alg=HS256"),a=JSON.stringify(a),typeof c!="string"&&(c=JSON.stringify(c));var E=m.urlencodeUnicode(a)+"."+m.urlencodeUnicode(c);window.csioReactNative&&window.csiosign(E,u,function(k,P){if(k)return f.log("Token sign error",k),void C(error);h(P)});var y=new ArrayBuffer(E.length),w=new Uint8Array(y),O={name:"HMAC"};g.cryptotype!=="ie"&&g.cryptotype!=="webkit"&&g.browserName!==s.browserName.edge||(O.hash={name:"sha-256"});for(var L=E.length-1;L>=0;L--)w[L]=E.charCodeAt(L);var I=g.subtlecrypto.sign(O,u,w);g.cryptotype==="ie"?(I.onerror=C,I.oncomplete=function(k){E=g.buildToken(k.target.result,E),h(E)}):I.then(function(k){E=g.buildToken(k,E),h(E)}).catch(function(k){C(k)})})}},{key:"buildToken",value:function(a,c){for(var u="",g=new Uint8Array(a),h=g.byteLength,C=0;C<h;C++)u+=String.fromCharCode(g[C]);return c+"."+m.urlencode(u)}},{key:"decode",value:function(a){try{var c=a.split(".")[1],u=m.decode(c);return JSON.parse(u)}catch{return f.error("Could not decode token. "),null}}},{key:"importKey",value:function(a){var c=this;return new Promise(function(u,g){if(window.csioReactNative)u(a);else{if(c.cryptotype==="webkit")for(;a.length<32;)a+="\0";var h={kty:"oct",k:m.urlencode(a),alg:"HS256"},C={name:"HMAC",hash:{name:"SHA-256"}};if(c.cryptotype==="ie"?h.extractable=!1:h.ext=!1,c.cryptotype==="webkit"&&(C=null,h.use="sig"),c.cryptotype==="ie"||c.cryptotype==="webkit"){var E=JSON.stringify(h);h=new Uint8Array(E.length);for(var y=0;y<E.length;y++)h[y]=E.charCodeAt(y)}var w=c.subtlecrypto.importKey("jwk",h,C,!1,["sign"]);c.cryptotype==="ie"?(w.onerror=g,w.oncomplete=function(O){u(O.target.result)}):w.then(u).catch(g)}})}}]),i}();b.Jwt=n},{"../../config/constants":33,"../../utility/base64":85,"../../utility/csiologger":88,"../../utility/registry":95}],53:[function(S,p,b){function _(i){if(i&&i.__esModule)return i;var a={};if(i!=null)for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(a[c]=i[c]);return a.default=i,a}Object.defineProperty(b,"__esModule",{value:!0}),b.JwtToken=void 0;var t=function(){function i(a,c){for(var u=0;u<c.length;u++){var g=c[u];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(a,g.key,g)}}return function(a,c,u){return c&&i(a.prototype,c),u&&i(a,u),a}}(),m=S("./jwt"),f=S("../../utility/registry"),o=_(S("../../config/constants")),s=_(S("../../utility/csiologger")),n=function(){function i(a){(function(c,u){if(!(c instanceof u))throw new TypeError("Cannot call a class as a function")})(this,i),this.token=a,this.statsSubmissionInterval=15e3,this.collectSDP=!1,this.appId=null,this.userId=null,this.tokenPayload=null,this.jwt=new m.Jwt,this.expires=null,this.clockSync=f.Registry.getClockSync(),this.adaptiveInterval=!1,this.transportType=o.transportType.rest,this.setupTokenPayload(),this.restApiTransport=!1}return t(i,[{key:"getToken",value:function(){return this.token}},{key:"setupTokenPayload",value:function(){var a=this.jwt.decode(this.token);if(this.statsSubmissionInterval=parseInt(a.submissionInterval,10),this.collectSDP=a.collectSDP,this.adaptiveInterval=a.adaptiveInterval,this.appId=a.appID,this.userId=a.userID,this.restApiTransport=a.restApiTransport,navigator.mozGetUserMedia){var c=a.expiry.split(" ").join("T");this.expires=Date.parse(c)}else this.expires=new Date(a.expiry);this.restApiTransport?this.transportType=o.transportType.rest:this.transportType=o.transportType.ws,s.info("transportType is ",this.transportType,this.restApiTransport),f.Registry.getCredentials().setStatsSubmissionInterval(this.statsSubmissionInterval),f.Registry.getCredentials().setCollectSDP(this.collectSDP),f.Registry.getCredentials().setTransportType(this.transportType),f.Registry.getCredentials().setAdaptiveInterval(this.adaptiveInterval)}},{key:"isValid",value:function(a){var c=this,u=!1;return c.token!==null&&c.appId===a.appId&&c.userId===encodeURIComponent(a.userId)&&new Date(this.clockSync.getSynchronizedTimestamp())<c.expires&&(u=!0),u}}]),i}();b.JwtToken=n},{"../../config/constants":33,"../../utility/csiologger":88,"../../utility/registry":95,"./jwt":52}],54:[function(S,p,b){function _(c){if(c&&c.__esModule)return c;var u={};if(c!=null)for(var g in c)Object.prototype.hasOwnProperty.call(c,g)&&(u[g]=c[g]);return u.default=c,u}Object.defineProperty(b,"__esModule",{value:!0}),b.RestCollectorConnection=void 0;var t=function(){function c(u,g){for(var h=0;h<g.length;h++){var C=g[h];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(u,C.key,C)}}return function(u,g,h){return g&&c(u.prototype,g),h&&c(u,h),u}}(),m=S("../utility/registry"),f=S("./xmlhttp"),o=S("./collectorconnection"),s=S("./restrelays"),n=_(S("../config/constants")),i=_(S("../utility/csiologger")),a=function(c){function u(){(function(h,C){if(!(h instanceof C))throw new TypeError("Cannot call a class as a function")})(this,u);var g=function(h,C){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!C||typeof C!="object"&&typeof C!="function"?h:C}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this));return g.relays=new s.RestRelays,g}return function(g,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof h);g.prototype=Object.create(h&&h.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),h&&(Object.setPrototypeOf?Object.setPrototypeOf(g,h):g.__proto__=h)}(u,c),t(u,[{key:"isReady",value:function(){return!0}},{key:"send",value:function(g){var h={"Content-Type":"application/json",Authorization:"Bearer "+m.Registry.getAuthenticator().getToken()},C=g.eventType,E=g.confID,y=g.ucID,w=this.relays,O=w.getRequestUrl(C,E,y);if(O){var L=this.getMessage(C,g);i.log("sending ",O,g),(0,f.sendPostRequest)(O,h,5e3,L).then(function(I){if(I&&I.xhr){var k=JSON.parse(I.xhr.response);k&&k.status!=="success"&&(m.Registry.getGenericEventHandler().sendEvent(n.logEvents.restResponseError,{msg:"response failure "+E+":"+C+":"+k.msg+":"+k.status+JSON.stringify(g)}),i.error("Response error:",k.msg,g)),w.handleResponse(C,k,E)}else i.log("Response for request is null")},function(I){i.error(I)})}else i.warn("No action for message type: "+C)}},{key:"getMessage",value:function(g,h){delete h.confID,delete h.channel,delete h.token,delete h.appID,delete h.action,delete h.ucID,delete h.version,delete h.timeShift;var C=decodeURIComponent(h.localID);h.localID=C;var E=decodeURIComponent(h.remoteID);return h.remoteID=E,g===n.callstatsChannels.processedStats&&(h.eventType="stats"),h}}]),u}(o.CollectorConnection);b.RestCollectorConnection=a},{"../config/constants":33,"../utility/csiologger":88,"../utility/registry":95,"./collectorconnection":47,"./restrelays":55,"./xmlhttp":58}],55:[function(S,p,b){function _(g){if(g&&g.__esModule)return g;var h={};if(g!=null)for(var C in g)Object.prototype.hasOwnProperty.call(g,C)&&(h[C]=g[C]);return h.default=g,h}function t(g,h){if(!(g instanceof h))throw new TypeError("Cannot call a class as a function")}function m(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return function(C,E,y){C.status==="success"?g&&g(C,E):h&&h(C)}}Object.defineProperty(b,"__esModule",{value:!0}),b.RestRelays=void 0;var f=function(){function g(h,C){for(var E=0;E<C.length;E++){var y=C[E];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(h,y.key,y)}}return function(h,C,E){return C&&g(h.prototype,C),E&&g(h,E),h}}(),o=_(S("../config/constants")),s=_(S("../config/settings")),n=S("../utility/registry"),i=S("../utility/url"),a=_(S("../utility/csiologger")),c=function(){function g(){t(this,g),this.items=function(h){var C=m();return new Map([[o.fabricEvent.fabricTerminated,new u(s.restEventUrl,"/events/fabric/terminated",C)],[o.fabricEvent.audioMute,new u(s.restEventUrl,"/events/media/actions",C)],[o.fabricEvent.audioUnmute,new u(s.restEventUrl,"/events/media/actions",C)],[o.fabricEvent.videoPause,new u(s.restEventUrl,"/events/media/actions",C)],[o.fabricEvent.videoResume,new u(s.restEventUrl,"/events/media/actions",C)],[o.fabricEvent.screenShareStart,new u(s.restEventUrl,"/events/media/actions",C)],[o.fabricEvent.screenShareStop,new u(s.restEventUrl,"/events/media/actions",C)],[o.fabricEvent.activeDeviceList,new u(s.restEventUrl,"/events/devices/list",C)],[o.fabricEvent.applicationErrorLog,new u(s.restEventUrl,"/events/app/logs",C)],[o.fabricEvent.dominantSpeaker,new u(s.restEventUrl,"/events/dominantspeaker",C)],[o.fabricEvent.fabricHold,new u(s.restEventUrl,"/events/fabric/actions",C)],[o.fabricEvent.fabricResume,new u(s.restEventUrl,"/events/fabric/actions",C)],[o.internalFabricEvent.fabricSetup,new u(s.restEventUrl,"/events/fabric/setup",C)],[o.fabricEvent.fabricSetupFailed,new u(s.restEventUrl,"/events/fabric/setupfailed",C)],[o.internalFabricEvent.userJoined,new u(s.restEventUrl,"",m(function(E,y){y=decodeURIComponent(y);var w=n.Registry.getConferenceManager().get(y);w&&(a.log("UcId is - ",E.ucID,y),w.setUcId(E.ucID),n.Registry.getTransmissionManager().trySend())}))],[o.internalFabricEvent.userLeft,new u(s.restEventUrl,"/events/user/left",C)],[o.internalFabricEvent.userAlive,new u(s.restEventUrl,"/events/user/alive",C)],[o.internalFabricEvent.fabricTransportSwitch,new u(s.restEventUrl,"/events/fabric/transportchange",C)],[o.internalFabricEvent.mediaPlaybackStart,new u(s.restEventUrl,"/events/media/pipeline",C)],[o.internalFabricEvent.mediaPlaybackSuspended,new u(s.restEventUrl,"/events/media/pipeline",C)],[o.internalFabricEvent.mediaPlaybackStalled,new u(s.restEventUrl,"/events/media/pipeline",C)],[o.internalFabricEvent.ssrcMap,new u(s.restEventUrl,"/events/ssrcmap",C)],[o.internalFabricEvent.connectedDeviceList,new u(s.restEventUrl,"/events/devices/list",C)],[o.internalFabricEvent.sdpSubmission,new u(s.restEventUrl,"/events/sdp",C)],[o.internalFabricEvent.iceDisruptionStart,new u(s.restEventUrl,"/events/ice/status",C)],[o.internalFabricEvent.iceDisruptionEnd,new u(s.restEventUrl,"/events/ice/status",C)],[o.internalFabricEvent.iceConnectionDisruptionStart,new u(s.restEventUrl,"/events/ice/status",C)],[o.internalFabricEvent.iceConnectionDisruptionEnd,new u(s.restEventUrl,"/events/ice/status",C)],[o.internalFabricEvent.iceAborted,new u(s.restEventUrl,"/events/ice/status",C)],[o.internalFabricEvent.iceTerminated,new u(s.restEventUrl,"/events/ice/status",C)],[o.internalFabricEvent.iceFailed,new u(s.restEventUrl,"/events/ice/status",C)],[o.internalFabricEvent.iceRestarted,new u(s.restEventUrl,"/events/ice/status",C)],[o.internalFabricEvent.fabricDropped,new u(s.restEventUrl,"/events/fabric/status",C)],[o.callstatsChannels.processedStats,new u(s.restStatsUrl,"/stats",C)],[o.internalFabricEvent.fabricStateChange,new u(s.restEventUrl,"/events/fabric/statechange",C)],[o.callstatsChannels.userFeedback,new u(s.restEventUrl,"/events/feedback",C)],[o.precalltestEvents.results,new u(s.restEventUrl,"/events/precall",C)],[o.precalltestEvents.associate,new u(s.restEventUrl,"/events/precall",C)],[o.internalFabricEvent.userDetails,new u(s.restEventUrl,"/events/userdetails",C)]])}()}return f(g,[{key:"getRequestUrl",value:function(h,C,E){return this.items.has(h)?this.items.get(h).getRequestUrl(h,C,E):(a.warn("EventType Unsupported ",h),null)}},{key:"handleResponse",value:function(h,C,E){this.items.has(h)?this.items.get(h).handleResponse(C,E,h):a.warn("No response handler for event type "+h)}}]),g}(),u=function(){function g(h,C){var E=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;t(this,g),this.baseUrl=h,this.urlAppendix=C,this.responseHandler=E}return f(g,[{key:"getRequestUrl",value:function(h,C,E){return this.makeRequestUrl(h,C,E),this.requestUrl.toString()}},{key:"makeRequestUrl",value:function(h,C,E){h===o.precalltestEvents.results?this.requestUrl=new i.Url(this.baseUrl,n.Registry.getCredentials().getAppId(),this.urlAppendix):(h===o.internalFabricEvent.userJoined&&E&&(E=""),this.requestUrl=new i.Url(this.baseUrl,n.Registry.getCredentials().getAppId()+"/conferences/"+C,E,this.urlAppendix))}},{key:"handleResponse",value:function(h,C,E){this.responseHandler(h,C,E)}}]),g}();b.RestRelays=c},{"../config/constants":33,"../config/settings":34,"../utility/csiologger":88,"../utility/registry":95,"../utility/url":100}],56:[function(S,p,b){function _(a){if(a&&a.__esModule)return a;var c={};if(a!=null)for(var u in a)Object.prototype.hasOwnProperty.call(a,u)&&(c[u]=a[u]);return c.default=a,c}Object.defineProperty(b,"__esModule",{value:!0}),b.TransmissionManager=void 0;var t=function(){function a(c,u){for(var g=0;g<u.length;g++){var h=u[g];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(c,h.key,h)}}return function(c,u,g){return u&&a(c.prototype,u),g&&a(c,g),c}}(),m=_(S("../utility/timestamps")),f=S("../collections/cache"),o=S("../utility/registry"),s=_(S("../config/constants")),n=_(S("../utility/csiologger")),i=function(){function a(){(function(c,u){if(!(c instanceof u))throw new TypeError("Cannot call a class as a function")})(this,a),this.cache=[],this.connectionManager=o.Registry.getConnectionManager(),this.lastTS=0,this.timerStarted=!1}return t(a,[{key:"send",value:function(c){(c.isCachable()||c.canBeSent())&&(this.cache[c.getConferenceId()]||(this.cache[c.getConferenceId()]=new f.Cache),this.cache[c.getConferenceId()].add(c,c.isPriority()),this.trySend())}},{key:"trySend",value:function(){if(this.connectionManager.isReady())return this.timerStarted?void 0:this.timeToSend()?void(this.sendMessage()&&this.startTimer()):void(this.getCacheLength()>0&&this.startTimer());this.setupConnection()}},{key:"setupConnection",value:function(){this.connectionManager.setup().then(function(){n.log("Connected to connectionManager")}).catch(function(c){return n.log("Could not connect to connectionManager",c)})}},{key:"sendMessage",value:function(){var c=void 0,u=void 0;if(this.getCacheLength()===0)return!1;for(var g in this.cache)if(this.cache.hasOwnProperty(g)&&(u=g,(c=this.cache[u].peak())&&c.canBeSent()))break;return!(!c||!c.canBeSent())&&(n.log("sending message type :",c.toJson().action,c.toJson()),c=this.cache[u].pop(),this.lastTS=m.getCurrent(),this.connectionManager.send(c.toJson()),!0)}},{key:"startTimer",value:function(){var c=this;this.timerStarted||this.getCacheLength()!=0&&(this.timerStarted=!0,setTimeout(function(){c.timerStarted=!1,c.trySend()},200))}},{key:"timeToSend",value:function(){return m.getCurrent()>=this.lastTS+200}},{key:"getCacheLength",value:function(){var c=0;for(var u in this.cache)this.cache.hasOwnProperty(u)&&(c+=this.cache[u].length());return c}},{key:"updateConferenceId",value:function(c){var u=s.tmpConferenceId;this.cache[u]&&this.cache[u].updateConferenceId(c)}}]),a}();b.TransmissionManager=i},{"../collections/cache":25,"../config/constants":33,"../utility/csiologger":88,"../utility/registry":95,"../utility/timestamps":99}],57:[function(S,p,b){function _(a){if(a&&a.__esModule)return a;var c={};if(a!=null)for(var u in a)Object.prototype.hasOwnProperty.call(a,u)&&(c[u]=a[u]);return c.default=a,c}Object.defineProperty(b,"__esModule",{value:!0}),b.WsCollectorConnection=void 0;var t=function(){function a(c,u){for(var g=0;g<u.length;g++){var h=u[g];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(c,h.key,h)}}return function(c,u,g){return u&&a(c.prototype,u),g&&a(c,g),c}}(),m=_(S("../config/callstatserrors")),f=_(S("../config/constants")),o=_(S("../config/settings")),s=S("../utility/registry"),n=_(S("../utility/csiologger")),i=function(a){function c(){(function(g,h){if(!(g instanceof h))throw new TypeError("Cannot call a class as a function")})(this,c);var u=function(g,h){if(!g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!h||typeof h!="object"&&typeof h!="function"?g:h}(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));return u.wsConnection=null,u.wsConnectionState=f.wsConnectionState.closed,u.connected=!1,u.reconnected=!1,u}return function(u,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof g);u.prototype=Object.create(g&&g.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),g&&(Object.setPrototypeOf?Object.setPrototypeOf(u,g):u.__proto__=g)}(c,a),t(c,[{key:"onOpenHandler",value:function(){var u=this;u.wsConnectionState=f.wsConnectionState.connected,u.connected?u.reconnected=!0:u.connected=!0,u.reconnected=!1}},{key:"onCloseHandler",value:function(){var u=this;u.wsConnectionState=f.wsConnectionState.closed,n.log("**** Connection to the backend closed."),u.wsConnection&&(u.wsConnection=null)}},{key:"onErrorHandler",value:function(u){var g=this;g.wsConnectionState=f.wsConnectionState.closed,n.log("**** Connection establishment to the backend failed."),g.callback&&g.callback(m.csError.wsChannelFailure,"WebSocket establishment failed.",u)}},{key:"onMessageHandler",value:function(u){var g=u.data,h=JSON.parse(g);if(h.status==="200 OK"){if(h.event==="feedback")window.localStorage.removeItem("feedback");else if(h.event===f.internalFabricEvent.userJoined){var C=s.Registry.getConferenceManager().get(decodeURIComponent(h.conferenceID));C&&C.setUcId(h.ucID),n.log("UcId =",h.ucID),s.Registry.getTransmissionManager().trySend()}}else n.error("Collector error:",h.reason)}},{key:"setup",value:function(){var u=this;return new Promise(function(g,h){if(u.wsConnectionState===f.wsConnectionState.initiated||u.wsConnectionState===f.wsConnectionState.connected)return n.log("setupWebSocketConnection is called when already connected!"),u.callback&&u.callback(m.csError.success,f.csCallBackMessages.wsConnected),void g();u.wsConnectionState=f.wsConnectionState.initiated,n.log("creating new WebSocket",o.wsUrl),u.wsConnection=new WebSocket(o.wsUrl,"echo-protocol"),u.wsConnection.onopen=function(){g(),u.onOpenHandler()},u.wsConnection.onclose=function(){u.onCloseHandler()},u.wsConnection.onerror=function(C){h(C),u.onErrorHandler(C)},u.wsConnection.onmessage=function(C){u.onMessageHandler(C)}})}},{key:"isReady",value:function(){return!(!this.wsConnection||this.wsConnection.readyState!==1)}},{key:"getState",value:function(){return this.wsConnection?this.wsConnection.readyState:-1}},{key:"send",value:function(u){this.wsConnection.send(JSON.stringify(u))}}]),c}(S("./collectorconnection").CollectorConnection);b.WsCollectorConnection=i},{"../config/callstatserrors":32,"../config/constants":33,"../config/settings":34,"../utility/csiologger":88,"../utility/registry":95,"./collectorconnection":47}],58:[function(S,p,b){function _(i){if(i&&i.__esModule)return i;var a={};if(i!=null)for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(a[c]=i[c]);return a.default=i,a}function t(i,a,c,u,g){return new Promise(function(h,C){var E,y=null,w=new XMLHttpRequest,O=s.Registry.getEndpoint().getBrowserName();if(w){for(var L in E=f.getCurrent(),w.open(i,a),O!==o.browserName.msie&&(w.timeout=u),c)c.hasOwnProperty(L)&&w.setRequestHeader(L,c[L]);var I=null;if(i==="POST"){if(c["Content-Type"]==="application/x-www-form-urlencoded"){var k=[];for(var P in g)g.hasOwnProperty(P)&&k.push(encodeURIComponent(P)+"="+encodeURIComponent(g[P]));I=k.join("&")}c["Content-Type"]==="application/json"&&(I=JSON.stringify(g))}w.onload=function(){y=f.getCurrent();var F=new n(w,y-E);h(F)},w.ontimeout=function(){C(new Error("connection timeout"))},w.onreadystatechange=function(){w.readyState===4&&w.status===0&&C(new Error("no server response received"))},w.send(I)}else C(new Error("creating instance failed"))})}Object.defineProperty(b,"__esModule",{value:!0});var m=function(){function i(a,c){for(var u=0;u<c.length;u++){var g=c[u];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(a,g.key,g)}}return function(a,c,u){return c&&i(a.prototype,c),u&&i(a,u),a}}();b.sendGetRequest=function(i,a,c){return t("GET",i,a,c,null)},b.sendPostRequest=function(i,a,c,u){return t("POST",i,a,c,u)};var f=_(S("../utility/timestamps")),o=_(S("../config/constants")),s=S("../utility/registry"),n=function(){function i(a,c){(function(u,g){if(!(u instanceof g))throw new TypeError("Cannot call a class as a function")})(this,i),this.xhr=a,this.elapsed=c}return m(i,[{key:"getXhr",value:function(){return this.xhr}},{key:"getElapsed",value:function(){return this.elapsed}}]),i}()},{"../config/constants":33,"../utility/registry":95,"../utility/timestamps":99}],59:[function(S,p,b){function _(s,n){if(!(s instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0}),b.XMLHttpService=void 0;var t=function(){function s(n,i){for(var a=0;a<i.length;a++){var c=i[a];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(n,c.key,c)}}return function(n,i,a){return i&&s(n.prototype,i),a&&s(n,a),n}}(),m=S("../utility/sigmoid"),f=function(s){if(s&&s.__esModule)return s;var n={};if(s!=null)for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(n[i]=s[i]);return n.default=s,n}(S("../utility/csiologger")),o=function(){function s(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"XMLHttpService",i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e4;_(this,s),this.name=n,this.minRetryTimeout=i,this.sigmoid=new m.Sigmoid(a-i,15,.5),this.reset()}return t(s,[{key:"reset",value:function(){this.inProgress=!1,this.completed=!1,this.resolveCb&&this.rejectCb(new Error(this.name+": resetting")),this.resolveCb=null,this.rejectCb=null}},{key:"initiate",value:function(){var n=this;if(this.inProgress)return new Promise(function(a,c){c(new Error(n.name+": in progress"))});var i=new Promise(function(a,c){n.resolveCb=a,n.rejectCb=c});return this.inProgress=!0,this.sendRequest(),i}},{key:"isCompleted",value:function(){return this.completed}},{key:"handleSendError",value:function(n){f.log(this.name+": send next request ("+n+")"),this.sendNextRequest()}},{key:"handleResponseProxy",value:function(n){this.handleResponse(n),this.resetTimeout()}},{key:"handleResponse",value:function(n){f.error(this.name+": handleResponse() not implemented"),this.completeProcess()}},{key:"completeProcess",value:function(){this.inProgress=!1,this.completed=!0,this.resolveCb.apply(this,arguments)}},{key:"request",value:function(){return f.error(this.name+": request() not implemented!"),new Promise(function(n,i){n()})}},{key:"sendRequest",value:function(){if(this.inProgress){var n=this.request();n&&n.then(this.handleResponseProxy.bind(this),this.handleSendError.bind(this))}}},{key:"sendNextRequest",value:function(){setTimeout(this.sendRequest.bind(this),this.getTimeout())}},{key:"resetTimeout",value:function(){this.sigmoid.reset()}},{key:"getTimeout",value:function(){return this.minRetryTimeout+this.sigmoid.getActual()}}]),s}();b.XMLHttpService=o},{"../utility/csiologger":88,"../utility/sigmoid":97}],60:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.Measurement=void 0;var _=function(){function o(s,n){for(var i=0;i<n.length;i++){var a=n[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(s,a.key,a)}}return function(s,n,i){return n&&o(s.prototype,n),i&&o(s,i),s}}(),t=S("./resolution"),m=function(o){if(o&&o.__esModule)return o;var s={};if(o!=null)for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(s[n]=o[n]);return s.default=o,s}(S("./validator")),f=function(){function o(){(function(s,n){if(!(s instanceof n))throw new TypeError("Cannot call a class as a function")})(this,o),this.pcHash=null,this.ssrc=null,this.streamType=null,this.mediaType=null,this.resolution=null,this.frameRateReceived=null,this.frameHeight=null,this.frameWidth=null,this.droppedFramesNum=null,this.framesReceived=null,this.rtt=null,this.jitter=null,this.lostPackets=-1,this.receivedPackets=-1,this.sentPackets=-1,this.discardedPackets=-1,this.sentBytes=-1,this.receivedBytes=-1,this.track=null,this.fractionLost=0}return _(o,null,[{key:"make",value:function(s,n,i,a,c,u,g,h,C,E,y,w,O,L,I,k,P,F){var H=new o,D=function($,j){[void 0,null].indexOf(j)===-1&&(H[$]=j)};return D("pcHash",s),D("ssrc",n),D("streamType",i),D("mediaType",a),D("frameRateReceived",c),D("frameHeight",m.checkForNan(parseInt(u,10))),D("frameWidth",m.checkForNan(parseInt(g,10))),D("droppedFramesNum",h),D("framesReceived",C),D("rtt",E),D("jitter",y),D("lostPackets",w),D("receivedPackets",O),D("sentPackets",L),D("discardedPackets",I),D("sentBytes",k),D("receivedBytes",P),D("track",F),H.setFrameRateReceived(c),H}}]),_(o,[{key:"getPcHash",value:function(){return this.pcHash}},{key:"getSSRC",value:function(){return this.ssrc}},{key:"getStreamType",value:function(){return this.streamType}},{key:"getMediaType",value:function(){return this.mediaType}},{key:"getResolution",value:function(){return this.resolution?this.resolution.toString():null}},{key:"getFrameRateReceived",value:function(){return this.frameRateReceived}},{key:"getFrameHeight",value:function(){return this.frameHeight}},{key:"getFrameWidth",value:function(){return this.frameWidth}},{key:"getDroppedFramesNum",value:function(){return this.droppedFramesNum}},{key:"getFramesReceived",value:function(){return this.framesReceived}},{key:"setFrameRateReceived",value:function(s){this.frameRateReceived=s,this.frameRateReceived!==void 0&&this.frameWidth!==void 0&&this.frameHeight!==void 0&&this.frameWidth>0&&this.frameHeight>0?this.resolution=new t.Resolution(this.frameWidth,this.frameHeight,this.frameRateReceived):this.resolution=null}},{key:"getJitter",value:function(){return this.jitter}},{key:"getRTT",value:function(){return this.rtt}},{key:"getLostPackets",value:function(){return this.lostPackets}},{key:"getDiscardedPackets",value:function(){return this.discardedPackets}},{key:"getReceivedPackets",value:function(){return this.receivedPackets}},{key:"getSentPackets",value:function(){return this.sentPackets}},{key:"getSentBytes",value:function(){return this.sentBytes}},{key:"getReceivedBytes",value:function(){return this.receivedBytes}},{key:"setFractionLost",value:function(s){this.fractionLost=s===void 0?null:s}},{key:"getFractionLost",value:function(){return this.fractionLost}},{key:"extractTrack",value:function(){var s=this.track;return this.track=null,s}},{key:"toString",value:function(){return"pcHash: "+this.pcHash+", ssrc: "+this.ssrc+", streamType: "+this.streamType+", mediaType: "+this.mediaType+", frameRateReceived: "+this.frameRateReceived+", frameHeight: "+this.frameHeight+", frameWidth: "+this.frameWidth+", droppedFramesNum: "+this.droppedFramesNum+", rtt: "+this.rtt+", jitter: "+this.jitter+", lostPackets: "+this.lostPackets+", receivedPackets: "+this.receivedPackets+", sentPackets: "+this.sentPackets+", discardedPackets: "+this.discardedPackets+", sentBytes: "+this.sentBytes+", receivedBytes: "+this.receivedBytes}}]),o}();b.Measurement=f},{"./resolution":68,"./validator":83}],61:[function(S,p,b){function _(i){if(i&&i.__esModule)return i;var a={};if(i!=null)for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(a[c]=i[c]);return a.default=i,a}function t(i,a){if(!(i instanceof a))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0}),b.CPULimitationObserver=void 0;var m=function(){function i(a,c){for(var u=0;u<c.length;u++){var g=c[u];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(a,g.key,g)}}return function(a,c,u){return c&&i(a.prototype,c),u&&i(a,u),a}}(),f=_(S("../../config/constants")),o=_(S("../../utility/timestamps")),s=function(){function i(){t(this,i),this.ewmaDiscardedPackets=0,this.ewmaLostPackets=0,this.ewmaDroppedFrames=0,this.last=0,this.noticed=0}return m(i,[{key:"test",value:function(a){var c=a.discardedPackets,u=a.lostPackets;if(!u||u<1||!c||c<1)return!1;if(this.last===0)return this.last=o.getCurrent(),this.ewmaLostPackets=u,this.ewmaDiscardedPackets=c,!1;var g=o.getCurrent(),h=Math.max(g-this.last,1),C=Math.min((5e3-h)/5e3,.9),E=a.droppedFrames;return this.ewmaLostPackets=this.ewmaLostPackets*C+u,this.ewmaDroppedFrames=this.ewmaDroppedFrames*C+E,this.ewmaDiscardedPackets=this.ewmaDiscardedPackets*C+c,!(!E||E<1)&&!(1<this.ewmaLostPackets||1<this.ewmaDiscardedPackets)&&!(g-this.noticed<1e4)&&!(this.ewmaDroppedFrames<1)&&(this.noticed=g,!0)}}]),i}(),n=function(){function i(a){t(this,i),this.notifyCallback=a,this.inbVideoTesters=new Map}return m(i,[{key:"accept",value:function(a){for(var c=a.filter(function(h){return h.getMediaType()===f.mediaType.video&&h.getStreamType()===f.streamType.inbound}),u=0;u<c.length;++u){var g=c[u];this.checkInboundVideo(g)}}},{key:"checkInboundVideo",value:function(a){var c=a.peek(),u=a.getSSRC();if(this.inbVideoTesters.has(u)||this.inbVideoTesters.set(u,new s),this.inbVideoTesters.get(u).test(c)){var g={reason:f.limitationType.cpu,ssrc:u};this.notifyCallback(g)}}},{key:"toString",value:function(){return"CPULimitationObserver"}}]),i}();b.CPULimitationObserver=n},{"../../config/constants":33,"../../utility/timestamps":99}],62:[function(S,p,b){function _(n){if(n&&n.__esModule)return n;var i={};if(n!=null)for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a]);return i.default=n,i}Object.defineProperty(b,"__esModule",{value:!0}),b.OneWayMediaObserver=void 0;var t=function(){function n(i,a){for(var c=0;c<a.length;c++){var u=a[c];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(i,u.key,u)}}return function(i,a,c){return a&&n(i.prototype,a),c&&n(i,c),i}}(),m=_(S("../../config/constants")),f=S("../onewaymediadisruption"),o=_(S("../../utility/timestamps")),s=function(){function n(i){(function(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function")})(this,n),this.notifierCallback=i,this.inbOneWayAudioDisruption={sent:!1,started:0,hasTrafficTs:0},this.outbOneWayAudioDisruption={sent:!1,started:0,hasTrafficTs:0}}return t(n,[{key:"accept",value:function(i){var a=i.filter(function(g){return g.getMediaType()==m.mediaType.audio&&g.getStreamType()===m.streamType.inbound}),c=i.filter(function(g){return g.getMediaType()==m.mediaType.audio&&g.getStreamType()===m.streamType.outbound}),u=[this.getInbOneWayAudioDisruption(a,c),this.getOutbOneWayAudioDisruption(a,c)].filter(function(g){return g!==null});0<u.length&&this.notifierCallback(u)}},{key:"toString",value:function(){return"DisruptionObserver"}},{key:"getInbOneWayAudioDisruption",value:function(i,a){var c=this.inbOneWayAudioDisruption;if(c.sent)return null;var u=a.filter(function(C){return C.getStartTime()===0}).length<1,g=a.filter(function(C){return!C.hasTraffic()}).length<1;if(!u||g)return null;var h=i.filter(function(C){return!C.hasTraffic()}).length<1;return 0<i.length&&h?(c.started=0,null):c.started===0?(c.started=o.getCurrent(),null):o.getCurrent()-5e3<c.started?null:(c.sent=!0,new f.OneWayMediaDisruption(m.oneWayMediaTypes.audio))}},{key:"getOutbOneWayAudioDisruption",value:function(i,a){var c=this.outbOneWayAudioDisruption;if(c.sent)return null;var u=i.filter(function(C){return C.getStartTime()===0}).length<1,g=i.filter(function(C){return!C.hasTraffic()}).length<1;if(!u||!g)return null;var h=a.filter(function(C){return!C.hasTraffic()}).length<1;return 0<a.length&&h?(c.started=0,null):c.started===0?(c.started=o.getCurrent(),null):o.getCurrent()-5e3<c.started?null:(c.sent=!0,new f.OneWayMediaDisruption(m.oneWayMediaTypes.audio))}}]),n}();b.OneWayMediaObserver=s},{"../../config/constants":33,"../../utility/timestamps":99,"../onewaymediadisruption":66}],63:[function(S,p,b){function _(i){if(i&&i.__esModule)return i;var a={};if(i!=null)for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(a[c]=i[c]);return a.default=i,a}function t(i,a){if(!(i instanceof a))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0}),b.QPSumObserver=void 0;var m=function(){function i(a,c){for(var u=0;u<c.length;u++){var g=c[u];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(a,g.key,g)}}return function(a,c,u){return c&&i(a.prototype,c),u&&i(a,u),a}}(),f=_(S("../../config/constants")),o=_(S("../../utility/timestamps")),s=function(){function i(a){t(this,i),this.lastQpSum=null,this.qpAvg=null,this.noticed=0}return m(i,[{key:"test",value:function(a){var c=a.getTrack();if(!c||!c.data||!c.data.qpSum)return!1;if(!this.lastQpSum)return this.lastQpSum=c.data.qpSum,!1;var u=c.data.qpSum-this.lastQpSum;this.lastQpSum=c.data.qpSum,this.qpAvg===null?this.qpAvg=u:this.qpAvg=.2*u+.8*this.qpAvg;var g=Math.max(2*this.qpAvg,1);if(u<this.qpAvg+g)return!1;var h=o.getCurrent();return this.noticed<h-1e4}}]),i}(),n=function(){function i(a){t(this,i),this.notifyCallback=a,this.testers=new Map}return m(i,[{key:"accept",value:function(a){for(var c=0;c<a.length;++c){var u=a[c];if(u.getMediaType()===f.mediaType.video){var g=u.getSSRC();if(this.testers.has(g)||this.testers.set(g,new s(u)),this.testers.get(g).test(u)){var h={reason:f.qualityDisruptionTypes.qpchange};this.notifyCallback(h)}}}}},{key:"toString",value:function(){return"QPSumObserver"}}]),i}();b.QPSumObserver=n},{"../../config/constants":33,"../../utility/timestamps":99}],64:[function(S,p,b){function _(a){if(a&&a.__esModule)return a;var c={};if(a!=null)for(var u in a)Object.prototype.hasOwnProperty.call(a,u)&&(c[u]=a[u]);return c.default=a,c}function t(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0}),b.SendingTrigger=void 0;var m=function(){function a(c,u){for(var g=0;g<u.length;g++){var h=u[g];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(c,h.key,h)}}return function(c,u,g){return u&&a(c.prototype,u),g&&a(c,g),c}}(),f=_(S("../../utility/timestamps")),o=_(S("../validator")),s=function(){function a(c,u,g){t(this,a),this.last=null,this.actual=0,this.name=c,this.alpha=u,this.supplier=g}return m(a,[{key:"update",value:function(c){if(this.last!==null){var u=Math.abs(c-this.last);this.actual=u*this.alpha+this.actual*(1-this.alpha),this.last=c}else this.last=c}},{key:"doTest",value:function(c){var u=this.last;return this.update(c),u!==null&&u+this.supplier(this.actual)<c}}]),a}(),n=function(){function a(){t(this,a);var c=this;this.marginFactor=1,this.rttTester=new s("RTT Tester",.2,function(u){return Math.max(50,u)*c.marginFactor}),this.throughputTester=new s("Throughput Tester",.1,function(u){return Math.max(100,u)*c.marginFactor}),this.FLTester=new s("FL Tester",.1,function(u){return Math.max(.2,u)*c.marginFactor}),this.lastDecreased=f.getCurrent()}return m(a,[{key:"test",value:function(c){var u=c.peek();if(!u)return!1;var g=c.getTrack().data,h=u.getRTT(),C=o.checkForNan(parseInt(g.csioIntBRKbps,10)),E=u.getFractionLost();if(this.rttTester.doTest(h)||this.throughputTester.doTest(C)||this.FLTester.doTest(E))return this.marginFactor=Math.min(2*this.marginFactor,15),!0;var y=f.getCurrent();return 3e3<y-this.lastChanged&&(this.marginFactor=Math.max(this.marginFactor-.5,1),this.lastDecreased=y),!1}}]),a}(),i=function(){function a(c){t(this,a),this.notifyCallback=c,this.minInterval=1e3,this.maxInterval=3e4,this.notified=0,this.testers=new Map}return m(a,[{key:"setup",value:function(c,u){this.minInterval=c,this.maxInterval=u}},{key:"accept",value:function(c){var u=f.getCurrent(),g=u-this.notified;if(this.minInterval!==this.maxInterval){if(!(g<this.minInterval)){if(g<this.maxInterval&&this.doSend(c)===!1)return;this.notifyCallback(),this.notified=u}}else this.minInterval<=g&&(this.notifyCallback(),this.notified=u)}},{key:"setIntervals",value:function(c,u){this.minInterval=c,this.maxInterval=u}},{key:"toString",value:function(){return"SendingTrigger"}},{key:"doSend",value:function(c){for(var u=0;u<c.length;++u){var g=c[u],h=g.getSSRC();if(this.testers.has(h)||this.testers.set(h,new n),this.testers.get(h).test(g))return!0}return!1}}]),a}();b.SendingTrigger=i},{"../../utility/timestamps":99,"../validator":83}],65:[function(S,p,b){function _(s){if(s&&s.__esModule)return s;var n={};if(s!=null)for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(n[i]=s[i]);return n.default=s,n}Object.defineProperty(b,"__esModule",{value:!0}),b.ThroughputObserver=void 0;var t=function(){function s(n,i){for(var a=0;a<i.length;a++){var c=i[a];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(n,c.key,c)}}return function(n,i,a){return i&&s(n.prototype,i),a&&s(n,a),n}}(),m=_(S("../../config/constants")),f=_(S("../../utility/timestamps")),o=function(){function s(n){(function(i,a){if(!(i instanceof a))throw new TypeError("Cannot call a class as a function")})(this,s),this.notifierCallback=n,this.observations=new Map}return t(s,[{key:"accept",value:function(n){var i=n.filter(function(c){return c.getMediaType()===m.mediaType.video&&c.getStreamType()===m.streamType.outbound});if(!(i.length<1)){var a=this;i.forEach(function(c){a.observe(c)})}}},{key:"toString",value:function(){return"ThroughputObserver"}},{key:"getObservations",value:function(n){return this.observations.has(n)?this.observations.get(n):(this.observations.set(n,{ssrc:0,started:0,max:0,maxTs:0,stable:0,stableTs:0,ready:!1,maxVerified:!1,stableVerified:!1}),this.observations.get(n))}},{key:"observe",value:function(n){var i=n.getSSRC(),a=this.getObservations(i),c=f.getCurrent();if(a.ready!==!0){if(a.started===0)return a.ssrc=i,void(a.started=c);var u=n.getTrack().data,g=u.csioIntBRKbps,h=Math.min(50,.05*g);if(a.max<g?(a.max=g,a.maxTs=c):1e4<c-a.maxTs&&(a.maxVerified=!0),!(c-a.started<15e3)&&(g-h<u.csioAvgBRKbps&&u.csioAvgBRKbps<g+h&&(a.stableTs=c,a.stable=g,a.stableVerified=!0),a.stableVerified&&a.maxVerified)){var C={ssrc:String(a.ssrc),maxsendingKBitrate:a.max,timeToMaxSendingKBitrate:a.maxTs-a.started,stablesendingKBitrate:a.stable,timeToStableSendingKBitrate:a.stableTs-a.started};this.notifierCallback(C),a.ready=!0}}}}]),s}();b.ThroughputObserver=o},{"../../config/constants":33,"../../utility/timestamps":99}],66:[function(S,p,b){function _(f,o){if(!(f instanceof o))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var t=function(){function f(o,s){for(var n=0;n<s.length;n++){var i=s[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(o,i.key,i)}}return function(o,s,n){return s&&f(o.prototype,s),n&&f(o,n),o}}(),m=function(){function f(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"0";_(this,f),this.mediaType=o,this.ssrc=s}return t(f,[{key:"getContent",value:function(){return{mediaType:this.mediaType,ssrc:this.ssrc}}}]),f}();b.OneWayMediaDisruption=m},{}],67:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0});var _=function(){function m(f,o){for(var s=0;s<o.length;s++){var n=o[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(f,n.key,n)}}return function(f,o,s){return o&&m(f.prototype,o),s&&m(f,s),f}}(),t=function(){function m(f,o,s,n,i,a){(function(c,u){if(!(c instanceof u))throw new TypeError("Cannot call a class as a function")})(this,m),this.candidatePair=f,this.codec=o,this.pcHash=s,this.trackStats=n,this.transportStats=i,this.measurements=a}return _(m,[{key:"getCandidatePair",value:function(){return this.candidatePair}},{key:"getCodec",value:function(){return this.codec}},{key:"getPcHash",value:function(){return this.pcHash}},{key:"getTrackStats",value:function(){return this.trackStats}},{key:"getTransportStats",value:function(){return this.transportStats}},{key:"getMeasurements",value:function(){return this.measurements}}]),m}();b.PcStats=t},{}],68:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0});var _=function(){function m(f,o){for(var s=0;s<o.length;s++){var n=o[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(f,n.key,n)}}return function(f,o,s){return o&&m(f.prototype,o),s&&m(f,s),f}}(),t=function(){function m(f,o,s){(function(n,i){if(!(n instanceof i))throw new TypeError("Cannot call a class as a function")})(this,m),this.width=f,this.height=o,this.frameRate=s}return _(m,[{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getFrameRate",value:function(){return this.frameRate}},{key:"toString",value:function(){return this.width&&this.height&&this.frameRate?this.width.toString()+"X"+this.height.toString()+"X"+this.frameRate.toString():null}}]),m}();b.Resolution=t},{}],69:[function(S,p,b){function _(a){if(a&&a.__esModule)return a;var c={};if(a!=null)for(var u in a)Object.prototype.hasOwnProperty.call(a,u)&&(c[u]=a[u]);return c.default=a,c}Object.defineProperty(b,"__esModule",{value:!0}),b.StatsAdapter=b.StatsAdapterIO=void 0;var t=function(){function a(c,u){for(var g=0;g<u.length;g++){var h=u[g];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(c,h.key,h)}}return function(c,u,g){return u&&a(c.prototype,u),g&&a(c,g),c}}(),m=_(S("../config/constants")),f=S("../collections/component"),o=S("../utility/registry"),s=_(S("../utility/hash")),n=b.StatsAdapterIO={RawStatsIn:"RawStatsIn",RawStatsOut:"RawStatsOut",UnprocessedOut:"UnprocessedOut"},i=function(a){function c(u,g){(function(C,E){if(!(C instanceof E))throw new TypeError("Cannot call a class as a function")})(this,c);var h=function(C,E){if(!C)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!E||typeof E!="object"&&typeof E!="function"?C:E}(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,"StatsAdapter"));return h.bindPort(n.RawStatsIn,h.receiveRawData,h),h.declarePort(n.RawStatsOut),h.declarePort(n.UnprocessedOut),h.codeBase=u,h.browser=g,h}return function(u,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof g);u.prototype=Object.create(g&&g.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),g&&(Object.setPrototypeOf?Object.setPrototypeOf(u,g):u.__proto__=g)}(c,a),t(c,[{key:"receiveRawData",value:function(u,g){if(u){var h=this.extractRawStats(u);if(h){window&&window.csioReactNative&&(h=this.removeValues(h)),this.isConnected(n.UnprocessedOut)&&this.transmit(n.UnprocessedOut,h,g);var C=this.processRawStats(h,g);if(C&&C.transportStats)for(var E=0;E<C.transportStats.length;E++)C.transportStats[E].hash=this.getTransportHash(C.transportStats[E]);C&&C.transportStats&&this.checkTransportStatsUpdates(C.transportStats,g),C&&C.trackStats&&(C=this.backFillTrackStats(C)),C&&C.transportStats&&C.candidatePair&&(C=this.backFillCandidatePairStats(C)),C.pcHash=g,this.transmit(n.RawStatsOut,C)}}}},{key:"removeValues",value:function(u){for(var g=0;g<u.length;++g){var h=u[g];if(h&&h.values){for(var C=0;C<h.values.length;++C)Object.assign(h,h.values[C]);delete h.values}}return u}},{key:"getIceCandidates",value:function(u){if(!u)return{localIceCandidates:[],remoteIceCandidates:[],iceCandidatePairs:[]};var g=this.extractRawStats(u);return this.processRawStatsForIceInfo(g)}},{key:"extractRawStats",value:function(u){var g=[];if(u&&u.result)g=u.result();else if(u&&u.forEach)u.forEach(function(C){g.push(C)});else for(var h in u)u.hasOwnProperty(h)&&g.push(u[h]);return g}},{key:"normalizeIceCandidates",value:function(u){for(var g=0;g<u.length;g+=1){var h=u[g];h.transport=h.protocol?h.protocol:"udp",h.ip=h.ip?h.ip:h.ipAddress,h.port=h.portNumber?Number(h.portNumber):h.port,h.transport==="ssltcp"&&(h.transport="tcp"),h.id||(h.id="csio"+h.port)}return u}},{key:"normalizeCanidatePairs",value:function(u){for(var g=0;g<u.length;g+=1){var h=u[g];h.state==="in-progress"&&(h.state="inprogress"),h.state||(h.state="succeeded"),h.nominated||(h.nominated=h.googActiveConnection==="true"),h.priority||(h.priority=123),h.id||(h.id="csio"+h.priority)}return u}},{key:"processRawStatsForIceInfo",value:function(u){var g=[],h=[],C=[],E=void 0;if(!u)return{localIceCandidates:g,remoteIceCandidates:h,iceCandidatePairs:C};for(var y=0;y<u.length;++y){var w=this.getParsedStats(u[y]),O=this.statsClassifier(w);if(O.candidatePair)C.push(O.candidatePair);else if(O.transportStats){if(O.transportStats.type==="transport"){E=O.transportStats.selectedCandidatePairId;continue}C.push(O.transportStats)}else O.localCandidate?g.push(O.localCandidate):O.remoteCandidate&&h.push(O.remoteCandidate)}if(E)for(var L=0;L<C.length;++L)C[L].id===E&&(C[L].googActiveConnection="true");return{localIceCandidates:this.normalizeIceCandidates(g),remoteIceCandidates:this.normalizeIceCandidates(h),iceCandidatePairs:this.normalizeCanidatePairs(C)}}},{key:"processRawStats",value:function(u,g){var h={},C={},E={};h.tracks=[],h.candidatePair=[],h.transportStats=[],h.trackStats=[],h.codec=[];for(var y=0;y<u.length;y++){var w=this.getParsedStats(u[y]),O=this.statsClassifier(w);O.tracks?h.tracks.push(O.tracks):O.candidatePair?h.candidatePair.push(O.candidatePair):O.transportStats?this.codeBase!==m.codeBaseType.firefox?(parseInt(O.transportStats.bytesReceived,10)>0||parseInt(O.transportStats.bytesSent,10)>0)&&(h.transportStats.push(O.transportStats),O.transportStats.googActiveConnection!=="true"&&O.transportStats.googActiveConnection!==!0||(h.activeConnectionIndex=O.transportStats.length)):O.transportStats.selected!=="true"&&O.transportStats.selected!==!0||(h.transportStats.push(O.transportStats),h.activeConnectionIndex=O.transportStats.length):O.bwe?h.bwe=O.bwe:O.trackStats?h.trackStats.push(O.trackStats):O.codec?h.codec.push(O.codec):O.localCandidate?C[O.localCandidate.id]=O.localCandidate:O.remoteCandidate&&(E[O.remoteCandidate.id]=O.remoteCandidate)}if(h.tracks){var L=o.Registry.getConferenceManager().getConferenceForPcHash(g),I=void 0;L&&(I=L.getPeerConnectionManager().getPcHandlerByHash(g)),h.tracks.forEach(function(k){var P=I.getSSRCInfo(k.data.ssrc);P!==void 0&&P.localStartTime||I&&(I.updateSDP(h.tracks),P=I.getSSRCInfo(k.data.ssrc)),P&&(k.cname=P.cname,k.msid=P.msid,k.associatedVideoTag=P.associatedVideoTag,k.usageLabel=P.usageLabel)})}return h.transportStats&&this.codeBase===m.codeBaseType.firefox&&(h.transportStats=this.getAddressInfoFromCandidates(h.transportStats,C,E)),h}},{key:"getParsedStats",value:function(u){var g={};if(u.timestamp instanceof Date&&(g.timestamp=u.timestamp.getTime().toString()),u.type&&(g.type=u.type),u.names){for(var h=u.names(),C=0;C<h.length;++C)g[h[C]]=u.stat(h[C]);u.id&&(g.id=u.id)}else Object.assign(g,u);if(g.values){for(var E=0;E<g.values.length;++E)Object.assign(g,g.values[E]);delete g.values}return g}},{key:"statsClassifier",value:function(u){var g={},h=function(){for(var y=arguments.length,w=Array(y),O=0;O<y;O++)w[O]=arguments[O];return w.indexOf(u.type)!==-1},C=h("inbound-rtp","inboundrtp","remote-inbound-rtp"),E=u.isRemote==="true"||u.isRemote===!0;return C||h("outbound-rtp","outboundrtp","remote-outbound-rtp")?(g.tracks={},g.tracks.data=u,g.tracks.ssrc=u.ssrc,g.tracks.streamType=C?"inbound":"outbound",g.tracks.reportType="local",u.isRemote!==void 0&&(g.tracks.reportType=E?"remote":"local")):h("candidatepair")&&u.selected?g.transportStats=u:h("localcandidate","local-candidate")?g.localCandidate=u:h("remotecandidate","remote-candidate")?g.remoteCandidate=u:h("transport","googCandidatePair")?g.transportStats=u:h("VideoBwe")?g.bwe=u:h("track")?g.trackStats=u:h("candidate-pair")?g.candidatePair=u:h("codec")?g.codec=u:h("ssrc")&&(g.tracks={},g.tracks.data=u,g.tracks.ssrc=u.ssrc,g.tracks.reportType="local",g.tracks.streamType=u.bytesSent?"outbound":"inbound"),g}},{key:"getAddressInfoFromCandidates",value:function(u,g,h){for(var C=void 0,E=void 0,y=0;y<u.length;y++)C=g[u[y].localCandidateId],E=h[u[y].remoteCandidateId],C&&E&&(u[y].localAddr=C.ipAddress+":"+C.portNumber,u[y].remoteAddr=E.ipAddress+":"+E.portNumber,u[y].localAddrType=C.candidateType,u[y].remoteAddrType=E.candidateType,u[y].transportType=C.transport);return u}},{key:"getTransportHash",value:function(u){var g=void 0;return u&&(this.codeBase===m.codeBaseType.chrome?u.googLocalAddress?(g=u.googLocalAddress).concat(":",u.googRemoteAddress):u.selectedCandidatePairId&&(g=u.selectedCandidatePairId):this.codeBase===m.codeBaseType.firefox&&(g=u.localAddr).concat(":",u.remoteAddr)),s.generateHash(g)}},{key:"backFillTrackStats",value:function(u){for(var g=u.tracks.length,h=void 0,C=void 0,E=void 0,y=0;y<g;y++)(h=u.tracks[y]).data.trackId&&(C=this.getStatsForId(u.trackStats,h.data.trackId))&&(u.tracks[y].data=this.mergeObjects(u.tracks[y].data,C)),h.data.codecId&&(E=this.getStatsForId(u.codec,h.data.codecId))&&(u.tracks[y].data=this.mergeObjects(u.tracks[y].data,E));return u}},{key:"backFillCandidatePairStats",value:function(u){for(var g=u.transportStats.length,h=void 0,C=void 0,E=0;E<g;E++)(C=u.transportStats[E]).selectedCandidatePairId&&(h=this.getStatsForId(u.candidatePair,C.selectedCandidatePairId))&&(u.transportStats[E]=this.mergeObjects(u.transportStats[E],h));return u}},{key:"mergeObjects",value:function(u,g){for(var h in g)g.hasOwnProperty(h)&&h!=="id"&&h!=="type"&&(u[h]=g[h]);return u}},{key:"getStatsForId",value:function(u,g){if(u){var h=u.filter(function(C){return C.id===g});if(h.length>0)return h[0]}}},{key:"formatRelayType",value:function(u){var g="None";switch(u){case 0:g="TURN/TLS";break;case 1:g="TURN/TCP";break;case 2:g="TURN/UDP"}return g}},{key:"getRelayType",value:function(u,g){var h=this,C=void 0;return g.getIceCandidates().some(function(E){if(E.typePreference){var y=E.typePreference>>24;return E.protocol==="rtp"&&E.address===u&&(y>=0&&y<=2&&(C=h.formatTypePreference(y)),!0)}return!1}),C}},{key:"getTransportInfo",value:function(u,g){for(var h={},C=!1,E=0;E<u.length;E++){var y=u[E];if(navigator.mozGetUserMedia&&y.type==="candidatepair"&&(y.selected==="true"||y.selected===!0)){h.foundActive=!0,h.localAddr=y.localAddr,h.remoteAddr=y.remoteAddr,h.localAddrType=y.localAddrType,h.remoteAddrType=y.remoteAddrType,h.transportType=y.transportType,h.localCandidateId=y.localCandidateId,h.remoteCandidateId=y.remoteCandidateId;break}if(y.type==="googCandidatePair"&&(y.googActiveConnection==="true"||y.googActiveConnection===!0)){h.foundActive=!0,h.localAddr=y.googLocalAddress,h.remoteAddr=y.googRemoteAddress,h.localAddrType=y.googLocalCandidateType,h.remoteAddrType=y.googRemoteCandidateType,h.transportType=y.googTransportType;break}if(y.type==="transport"){C=!0,y.selectedCandidatePairId&&(h.selectedCandidatePairId=y.selectedCandidatePairId);break}}return C&&h.localAddr&&(h.ipv6=h.localAddr.indexOf("[")===0,h.relayType=getRelayType(h.localAddr,g)),h}},{key:"sendFabricTransportSwitch",value:function(u,g){u.sendFabricTransportSwitch(g)}},{key:"checkTransportStatsUpdates",value:function(u,g){var h=o.Registry.getConferenceManager().getConferenceForPcHash(g);if(h){var C=h.getPeerConnectionManager().getPcHandlerByHash(g);if(C){var E=this.getTransportInfo(u,C),y=C.getTransportInfo();y&&(y.localAddr===E.localAddr&&y.remoteAddr===E.remoteAddr&&y.transportType===E.transportType&&y.selectedCandidatePairId===E.selectedCandidatePairId&&y.localCandidateId===E.localCandidateId&&y.remoteCandidateId===E.remoteCandidateId||(C.setTransportInfo(E),this.sendFabricTransportSwitch(C,E.relayType)))}}}}]),c}(f.Component);b.StatsAdapter=i},{"../collections/component":26,"../config/constants":33,"../utility/hash":92,"../utility/registry":95}],70:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.StatsAssembler=b.StatsAssemblerIO=void 0;var _=function(){function o(s,n){for(var i=0;i<n.length;i++){var a=n[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(s,a.key,a)}}return function(s,n,i){return n&&o(s.prototype,n),i&&o(s,i),s}}(),t=S("../collections/component"),m=b.StatsAssemblerIO={StatsTupleIn:"StatsTupleIn",CallstatsOut:"CallstatsOut"},f=function(o){function s(){(function(i,a){if(!(i instanceof a))throw new TypeError("Cannot call a class as a function")})(this,s);var n=function(i,a){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||typeof a!="object"&&typeof a!="function"?i:a}(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,"StatsAssembler"));return n.pcHashes=[],n.bindPort(m.StatsTupleIn,n.receiveStats,n),n.declarePort(m.CallstatsOut),n}return function(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof i);n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(n,i):n.__proto__=i)}(s,o),_(s,[{key:"receiveStats",value:function(n){for(var i=this,a=0;a<n.tracks.length;a++)(function(y){var w=n.tracks[y];if(i.pcHashes.find(function(O){return O===w.pcHash}))return"continue";i.pcHashes.push(w.pcHash)})(a);var c=n.getTransportStats();for(a=0;a<this.pcHashes.length;a++){var u=this.pcHashes[a],g={};g.codec=n.getCodec(),g.trackStats=n.getTrackStats(),g.tracks=[];for(var h=0;h<n.tracks.length;h++){var C=n.tracks[h];C.pcHash===u&&g.tracks.push(C)}var E=c.get(u);E.length==1?g.Transport=E[0]:g.Transport=E,this.transmit(m.CallstatsOut,u,g)}}}]),s}(t.Component);b.StatsAssembler=f},{"../collections/component":26}],71:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.StatsCallbackBuilder=void 0;var _=function(){function f(o,s){for(var n=0;n<s.length;n++){var i=s[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(o,i.key,i)}}return function(o,s,n){return s&&f(o.prototype,s),n&&f(o,n),o}}(),t=S("../utility/registry"),m=function(){function f(){(function(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")})(this,f),this.callback=null}return _(f,[{key:"setCallback",value:function(o){this.callback=o}},{key:"buildStats",value:function(o,s){this.callback&&this.buildFromUnifiedFormat(o,s)}},{key:"getConnectionState",value:function(){return navigator.onLine===!0?"online":"offline"}},{key:"buildConferenceUrl",value:function(o){var s=o.getConferenceId(),n=t.Registry.getConferenceManager().get(s);return n?n.getUrl():null}},{key:"buildFromUnifiedFormat",value:function(o,s){var n={};n.connectionState=this.getConnectionState(),n.conferenceURL=this.buildConferenceUrl(s),n.fabricState=s.getPcState(),n.streams={},n.mediaStreamTracks=[];for(var i=0;i<o.length;i++){var a=o[i];if(a.type==="inbound-rtp"||a.type==="outbound-rtp"||a.type==="ssrc"||a.type==="inboundrtp"||a.type==="outboundrtp"){var c={ssrc:a.ssrc,statsType:a.type,fractionLoss:a.csioIntFL,bitrate:a.csioIntBRKbps,quality:a.csioMark,mediaType:a.csioMediaType,jitter:a.jitter,audioOutputLevel:a.audioOutputLevel,audioIntputLevel:a.audioInputLevel,audioLevel:a.audioLevel,averageRTT:a.csioAvgRtt,averageJitter:a.csioAvgJitter,packetLossPercentage:a.csioPktLossPercentage,rtt:a.roundTripTime,packetRate:a.csioIntPR,remoteUserID:s.getRemoteId()},u=s.getSSRCInfo(a.ssrc+"");u&&(c.cname=u.cname,c.msid=u.msid,c.usageLabel=u.usageLabel,c.associatedVideoTag=u.associatedVideoTag),a.hasOwnProperty("googRtt")&&(c.rtt=a.googRtt),a.hasOwnProperty("mozRtt")&&(c.rtt=a.mozRtt),a.hasOwnProperty("googJitterReceived")&&(c.jitter=a.googJitterReceived),c.statsType==="inboundrtp"?c.statsType="inbound-rtp":c.statsType==="outboundrtp"?c.statsType="outbound-rtp":c.statsType==="ssrc"&&(a.id.indexOf("send")>0?c.statsType="outbound-rtp":c.statsType="inbound-rtp"),c.statsType!=="remote-inbound-rtp"&&c.statsType!=="remote-outbound-rtp"&&(a.isRemote!==!0&&a.isRemote!=="true"||(c.statsType="remote-"+c.statsType)),n.streams[a.ssrc]=c,n.mediaStreamTracks.push(c)}}this.callback(n)}}]),f}();b.StatsCallbackBuilder=m},{"../utility/registry":95}],72:[function(S,p,b){function _(w){if(w&&w.__esModule)return w;var O={};if(w!=null)for(var L in w)Object.prototype.hasOwnProperty.call(w,L)&&(O[L]=w[L]);return O.default=w,O}Object.defineProperty(b,"__esModule",{value:!0}),b.StatsMonitor=b.StatsMonitorIO=void 0;var t=function(){function w(O,L){for(var I=0;I<L.length;I++){var k=L[I];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(O,k.key,k)}}return function(O,L,I){return L&&w(O.prototype,L),I&&w(O,I),O}}(),m=S("../collections/component"),f=S("./tracksmonitor"),o=S("./transportsmonitor"),s=S("./statstuple"),n=S("../utility/registry"),i=S("./monitorhooks/sendingtrigger"),a=S("./monitorhooks/onewaymediaobserver"),c=S("./monitorhooks/throughputobserver"),u=S("./monitorhooks/cpulimitationobserver"),g=S("./monitorhooks/qpsumobserver"),h=_(S("../config/constants")),C=_(S("../utility/csiologger")),E=b.StatsMonitorIO={PcStatsTupleIn:"PcStatsTupleIn",StatsTupleOut:"StatsTupleOut"},y=function(w){function O(L){(function(k,P){if(!(k instanceof P))throw new TypeError("Cannot call a class as a function")})(this,O);var I=function(k,P){if(!k)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!P||typeof P!="object"&&typeof P!="function"?k:P}(this,(O.__proto__||Object.getPrototypeOf(O)).call(this,"StatsMonitor"));return I.bindPort(E.PcStatsTupleIn,I.receive,I),I.declarePort(E.StatsTupleOut),I.lastPcStats=null,I.lastPcHash=null,I.tracksmonitor=new f.TracksMonitor,I.transportsmonitor=new o.TransportsMonitor(L),I.candidatepairs=new Map,I.monitorhooks=[],I.sendingTrigger=new i.SendingTrigger(I.sendStatsTuple.bind(I)),I.oneWayMediaObserver=new a.OneWayMediaObserver(I.sendDisruptions.bind(I)),I.throughputObserver=new c.ThroughputObserver(I.sendThroughputObservations.bind(I)),I.cpuLimitationObserver=new u.CPULimitationObserver(I.sendCPULimitationObservations.bind(I)),I.qpSumObserver=new g.QPSumObserver(I.sendQPSumDistortions.bind(I)),I.setupHooks(),I}return function(L,I){if(typeof I!="function"&&I!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof I);L.prototype=Object.create(I&&I.prototype,{constructor:{value:L,enumerable:!1,writable:!0,configurable:!0}}),I&&(Object.setPrototypeOf?Object.setPrototypeOf(L,I):L.__proto__=I)}(O,w),t(O,[{key:"setupHooks",value:function(){this.monitorhooks.push(this.sendingTrigger.accept.bind(this.sendingTrigger)),this.monitorhooks.push(this.oneWayMediaObserver.accept.bind(this.oneWayMediaObserver)),this.monitorhooks.push(this.throughputObserver.accept.bind(this.throughputObserver)),this.monitorhooks.push(this.cpuLimitationObserver.accept.bind(this.cpuLimitationObserver)),this.monitorhooks.push(this.qpSumObserver.accept.bind(this.qpSumObserver))}},{key:"setIntervals",value:function(L,I){this.sendingTrigger.setup(L,I)}},{key:"receive",value:function(L){var I=L.getPcHash(),k=L.getMeasurements();this.candidatepairs.set(I,L.getCandidatePair()),this.transportsmonitor.set(I,L.getTransportStats());for(var P=0;P<k.length;P++){var F=k[P],H=this.tracksmonitor.getMonitor(F);H?H.add(F):C.warn("No monitor for ssrc "+F.getSSRC())}this.lastPcStats=L,this.lastPcHash=I;for(var D=this.tracksmonitor.getMonitors(),$=this.monitorhooks,j=0;j<$.length;j++)(0,$[j])(D)}},{key:"getCandidatePairs",value:function(){var L=[];return this.candidatepairs.forEach(function(I,k){var P=[k,I];L.push(P)}),L}},{key:"sendStatsTuple",value:function(){var L=new s.StatsTuple(this.getCandidatePairs(),this.lastPcStats.getCodec(),this.lastPcStats.getTrackStats(),this.transportsmonitor.getIntervalStats(),this.tracksmonitor.extractTracks());this.transmit(E.StatsTupleOut,L)}},{key:"sendDisruptions",value:function(L){var I=this;L.forEach(function(k){I.sendEventMsg(h.internalFabricEvent.oneWayMedia,k.getContent())})}},{key:"sendCPULimitationObservations",value:function(L){}},{key:"sendQPSumDistortions",value:function(L){}},{key:"sendThroughputObservations",value:function(L){this.sendEventMsg(h.internalFabricEvent.sendingThroughputObservations,L)}},{key:"sendEventMsg",value:function(L,I){if(this.lastPcHash){var k=n.Registry.getConferenceManager().getConferenceForPcHash(this.lastPcHash);if(k){var P=k.getPeerConnectionManager().getPcHandlerByHash(this.lastPcHash),F=P.getPeerConnection(),H=P.getConferenceId();n.Registry.getEventMessageBuilder().make(L,H,F,I)}}}}]),O}(m.Component);b.StatsMonitor=y},{"../collections/component":26,"../config/constants":33,"../utility/csiologger":88,"../utility/registry":95,"./monitorhooks/cpulimitationobserver":61,"./monitorhooks/onewaymediaobserver":62,"./monitorhooks/qpsumobserver":63,"./monitorhooks/sendingtrigger":64,"./monitorhooks/throughputobserver":65,"./statstuple":75,"./tracksmonitor":81,"./transportsmonitor":82}],73:[function(S,p,b){function _(g){if(g&&g.__esModule)return g;var h={};if(g!=null)for(var C in g)Object.prototype.hasOwnProperty.call(g,C)&&(h[C]=g[C]);return h.default=g,h}Object.defineProperty(b,"__esModule",{value:!0}),b.StatsParser=b.StatsParserIO=void 0;var t=function(){function g(h,C){for(var E=0;E<C.length;E++){var y=C[E];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(h,y.key,y)}}return function(h,C,E){return C&&g(h.prototype,C),E&&g(h,E),h}}(),m=S("../collections/component"),f=S("./measurement"),o=S("./pcstats"),s=S("../utility/rttregistry"),n=_(S("./validator")),i=_(S("../config/constants")),a=_(S("../utility/csiologger")),c=b.StatsParserIO={RawStatsIn:"RawStatsIn",PcStatsTupleOut:"PcStatsTupleOut"},u=function(g){function h(){(function(E,y){if(!(E instanceof y))throw new TypeError("Cannot call a class as a function")})(this,h);var C=function(E,y){if(!E)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!y||typeof y!="object"&&typeof y!="function"?E:y}(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,"StatsParser"));return C.bindPort(c.RawStatsIn,C.receive,C),C.declarePort(c.PcStatsTupleOut),C}return function(C,E){if(typeof E!="function"&&E!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof E);C.prototype=Object.create(E&&E.prototype,{constructor:{value:C,enumerable:!1,writable:!0,configurable:!0}}),E&&(Object.setPrototypeOf?Object.setPrototypeOf(C,E):C.__proto__=E)}(h,g),t(h,[{key:"receive",value:function(C){if(C!==null){for(var E=C.tracks,y=[],w=0;w<E.length;++w){var O=E[w];if(O&&O.data){var L=f.Measurement.make(C.pcHash,this.getSSRC(O),this.getStreamType(O),this.getMediaType(O),this.getFrameRateReceived(O),this.getFrameHeight(O),this.getFrameWidth(O),this.getDroppedFramesNum(O),this.getFramesReceived(O),this.getRTT(O),this.getJitter(O),this.getLostPackets(O),this.getReceivedPackets(O),this.getSentPackets(O),this.getDiscardedPackets(O),this.getSentBytes(O),this.getReceivedBytes(O),O);y.push(L)}else a.log("No track or track.data.")}var I=new o.PcStats(C.candidatePair,C.codec,C.pcHash,C.trackStats,C.transportStats,y);this.transmit(c.PcStatsTupleOut,I)}else a.warn("Stats object can not be null")}},{key:"getSSRC",value:function(C){return C.ssrc}},{key:"getStreamType",value:function(C){return C.streamType===i.streamType.inbound?i.streamType.inbound:C.streamType===i.streamType.outbound?i.streamType.outbound:void 0}},{key:"getSentBytes",value:function(C){if(C.data.bytesSent===void 0)return-1;var E=n.checkForNan(parseInt(C.data.bytesSent,10));return E!==null?E:-1}},{key:"getReceivedBytes",value:function(C){if(C.data.bytesReceived===void 0)return-1;var E=n.checkForNan(parseInt(C.data.bytesReceived,10));return E!==null?E:-1}},{key:"getReceivedPackets",value:function(C){if(C.data.packetsReceived===void 0)return-1;var E=n.checkForNegativeValue(parseInt(C.data.packetsReceived,10));return E!==null?E:-1}},{key:"getSentPackets",value:function(C){if(C.data.packetsSent===void 0)return-1;var E=n.checkForNegativeValue(parseInt(C.data.packetsSent,10));return E!==null?E:-1}},{key:"getDiscardedPackets",value:function(C){if(C.data.discardedPackets===void 0)return-1;var E=n.checkForNan(parseInt(C.data.discardedPackets,10));return E!==null?E:-1}},{key:"getLostPackets",value:function(C){if(C.data.packetsLost===void 0)return-1;var E=n.checkForNegativeValue(parseInt(C.data.packetsLost,10));return E!==null?E:-1}},{key:"getDroppedFramesNum",value:function(C){if(C.data.droppedFrames===void 0)return-1;var E=n.checkForNegativeValue(parseInt(C.data.droppedFrames,10));return E!==null?E:-1}},{key:"getFramesReceived",value:function(C){if(C.data.framesReceived===void 0)return-1;var E=n.checkForNegativeValue(parseInt(C.data.framesReceived,10));return E!==null?E:-1}},{key:"getFrameRateReceived",value:function(C){var E=null;return C.data.googFrameRateOutput!==void 0?E=parseInt(C.data.googFrameRateOutput,10):C.data.googFrameRateDecoded!==void 0?E=parseInt(C.data.googFrameRateDecoded,10):C.data.googFrameRateReceived!==void 0?E=parseInt(C.data.googFrameRateReceived,10):C.data.googFrameRateSent!==void 0?E=parseInt(C.data.googFrameRateSent,10):C.data.framerateMean!==void 0?E=parseInt(C.data.framerateMean,10):C.data.framesPerSecond!==void 0&&(E=parseInt(C.data.framesPerSecond,10)),E!==void 0&&(E=n.checkForNegativeValue(E)),E}},{key:"getFrameHeight",value:function(C){var E=void 0;return C.data.googFrameHeightReceived!==void 0?E=C.data.googFrameHeightReceived:C.data.googFrameHeightSent!==void 0?E=C.data.googFrameHeightSent:C.data.frameHeight!==void 0&&(E=C.data.frameHeight),E}},{key:"getJitter",value:function(C){return C.data.googJitterReceived!==void 0?n.checkForNan(parseFloat(C.data.googJitterReceived,10)):C.data.jitter!==void 0?n.checkForNan(parseFloat(C.data.jitter,10)):void 0}},{key:"getFrameWidth",value:function(C){return C.data.googFrameWidthReceived!==void 0?C.data.googFrameWidthReceived:C.data.googFrameWidthSent!==void 0?C.data.googFrameWidthSent:C.data.frameWidth!==void 0?C.data.frameWidth:void 0}},{key:"getRTT",value:function(C){var E=function(O){return isNaN(O)||O<0?null:O};if(C.data.googRtt!==void 0)return E(parseFloat(C.data.googRtt,10));if(C.data.mozRtt!==void 0)return E(parseFloat(C.data.mozRtt,10));if(C.data.roundTripTime)return E(parseFloat(C.data.roundTripTime,10));var y=this.getSSRC(C),w=(0,s.getRTTRegistry)().getRTT(y);return w&&(C.data.roundTripTime=w),w}},{key:"getMediaType",value:function(C){var E=i.mediaType.unknown;return C.data&&C.data.mediaType!==void 0?C.data.mediaType:(C.data.googFrameRateReceived!==void 0||C.data.googFrameRateSent!==void 0?E=i.mediaType.video:C.data.audioInputLevel!==void 0||C.data.audioOutputLevel!==void 0?E=i.mediaType.audio:C.data.mediaType?E=C.data.mediaType:C.data.framerateMean!==void 0&&(E=i.mediaType.video),E)}}]),h}(m.Component);b.StatsParser=u},{"../collections/component":26,"../config/constants":33,"../utility/csiologger":88,"../utility/rttregistry":96,"./measurement":60,"./pcstats":67,"./validator":83}],74:[function(S,p,b){function _(a){if(a&&a.__esModule)return a;var c={};if(a!=null)for(var u in a)Object.prototype.hasOwnProperty.call(a,u)&&(c[u]=a[u]);return c.default=a,c}Object.defineProperty(b,"__esModule",{value:!0}),b.StatsTransmitter=b.StatsTransmitterIO=void 0;var t=function(){function a(c,u){for(var g=0;g<u.length;g++){var h=u[g];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(c,h.key,h)}}return function(c,u,g){return u&&a(c.prototype,u),g&&a(c,g),c}}(),m=S("../collections/component"),f=S("../utility/registry"),o=_(S("../config/constants")),s=_(S("../utility/csiologger")),n=b.StatsTransmitterIO={CallstatsIn:"CallstatsIn",UnprocessedIn:"UnprocessedIn"},i=function(a){function c(){(function(g,h){if(!(g instanceof h))throw new TypeError("Cannot call a class as a function")})(this,c);var u=function(g,h){if(!g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!h||typeof h!="object"&&typeof h!="function"?g:h}(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,"StatsTransmitter"));return u.battery=f.Registry.getBattery(),u.lastUnprocessedStats={},u.bindPort(n.CallstatsIn,u.receiveCallstats,u),u.bindPort(n.UnprocessedIn,u.receiveUnprocessed,u),u}return function(u,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof g);u.prototype=Object.create(g&&g.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),g&&(Object.setPrototypeOf?Object.setPrototypeOf(u,g):u.__proto__=g)}(c,a),t(c,[{key:"receiveUnprocessed",value:function(u,g){this.lastUnprocessedStats[g]=u}},{key:"receiveCallstats",value:function(u,g){var h;(h=this.getUnifiedFormat(g,u))?this.send(u,h):s.warn("Content can not be sent")}},{key:"send",value:function(u,g){var h=f.Registry.getConferenceManager().getConferenceForPcHash(u);if(h){var C=h.getPeerConnectionManager().getPcHandlerByHash(u);if(C){var E=C.getPcState();E!==o.fabricState.terminated&&E!==o.fabricState.hold&&(f.Registry.getEventMessageBuilder().make(o.callstatsChannels.processedStats,C.getConferenceId(),C.getPeerConnection(),g),this.sendToStatsCallback(g.stats,C))}}}},{key:"sendToStatsCallback",value:function(u,g){var h=f.Registry.getStatsCallbackBuilder();h&&h.buildStats(u,g)}},{key:"getUnifiedFormat",value:function(u,g){for(var h=this.lastUnprocessedStats[g],C=[],E=0;E<h.length;E++){var y=h[E],w={};if(y.id&&(w.id=y.id),y.timestamp&&(w.timestamp=y.timestamp),y.type&&(w.type=y.type),y.names)for(var O=y.names(),L=0;L<O.length;++L)w[O[L]]=y.stat(O[L]);else Object.assign(w,y);if(w.values){for(var I=0;I<w.values.length;++I)Object.assign(w,w.values[I]);delete w.values}var k=function(H){for(var D=0;D<u.tracks.length;D++){var $=u.tracks[D];if($.data.id===H.id&&$.data.type===H.type)return $.data}return H.id===u.Transport.id&&H.type===u.Transport.type?u.Transport:null}(y);if(k){for(var P in k)if(k.hasOwnProperty(P)){if(P==="id"||P==="type"||P==="timestamp")continue;w[P]=k[P]}C.push(w)}else C.push(w)}var F={stats:C};return F.wifiStats=f.Registry.getWifiStatsExecutor().getWifiStats(),F.batteryStatus={},F.batteryStatus.batteryLevel=this.battery.getLevel(),F.batteryStatus.isBatteryCharging=this.battery.getCharging(),F}}]),c}(m.Component);b.StatsTransmitter=i},{"../collections/component":26,"../config/constants":33,"../utility/csiologger":88,"../utility/registry":95}],75:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0});var _=function(){function m(f,o){for(var s=0;s<o.length;s++){var n=o[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(f,n.key,n)}}return function(f,o,s){return o&&m(f.prototype,o),s&&m(f,s),f}}(),t=function(){function m(f,o,s,n,i){(function(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function")})(this,m),this.candidatePairs=f,this.codec=o,this.trackStats=s,this.transportStats=n,this.tracks=i}return _(m,[{key:"getCandidatePairs",value:function(){return this.candidatePairs}},{key:"getCodec",value:function(){return this.codec}},{key:"getTrackStats",value:function(){return this.trackStats}},{key:"getTransportStats",value:function(){return this.transportStats}},{key:"getTracks",value:function(){return this.tracks}}]),m}();b.StatsTuple=t},{}],76:[function(S,p,b){function _(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}function t(o,s){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!s||typeof s!="object"&&typeof s!="function"?o:s}Object.defineProperty(b,"__esModule",{value:!0}),b.SWAvg=void 0;var m=function(){function o(s,n){for(var i=0;i<n.length;i++){var a=n[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(s,a.key,a)}}return function(s,n,i){return n&&o(s.prototype,n),i&&o(s,i),s}}(),f=function(o){function s(n,i){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;_(this,s);var c=t(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,n,i,a));return c.sum=0,c.counter=0,c}return function(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof i);n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(n,i):n.__proto__=i)}(s,o),m(s,[{key:"add",value:function(n){this.filter(n)&&(this.sum+=this.extract(n),++this.counter,this.calculate())}},{key:"remove",value:function(n){this.filter(n)&&(this.sum-=this.extract(n),--this.counter,this.calculate())}},{key:"calculate",value:function(){var n=0;this.counter<1||(n=this.sum/this.counter),this.notify(n)}}]),s}(S("./swplugin").SWPlugin);b.SWAvg=f},{"./swplugin":79}],77:[function(S,p,b){function _(i,a){if(!(i instanceof a))throw new TypeError("Cannot call a class as a function")}function t(i,a){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||typeof a!="object"&&typeof a!="function"?i:a}Object.defineProperty(b,"__esModule",{value:!0}),b.SWBTreePercentile=void 0;var m=function(i,a){if(Array.isArray(i))return i;if(Symbol.iterator in Object(i))return function(c,u){var g=[],h=!0,C=!1,E=void 0;try{for(var y,w=c[Symbol.iterator]();!(h=(y=w.next()).done)&&(g.push(y.value),!u||g.length!==u);h=!0);}catch(O){C=!0,E=O}finally{try{!h&&w.return&&w.return()}finally{if(C)throw E}}return g}(i,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")},f=function(){function i(a,c){for(var u=0;u<c.length;u++){var g=c[u];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(a,g.key,g)}}return function(a,c,u){return c&&i(a.prototype,c),u&&i(a,u),a}}(),o=S("./swplugin"),s=S("../../collections/binarytree"),n=function(i){function a(c,u,g,h){var C=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,E=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,y=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null;_(this,a);var w=t(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,g,h,E));if(99<c||c<1)throw new RangeError("Percentile parameter must be between 1 and 99");return w.comparator=u,w.percentile=c,w.meanCalcer=y,w.estimator=C,w.ratio=c/(100-c),w.maxtree=new s.BinaryTree(u),w.mintree=new s.BinaryTree(u),w.ratio<1?w.required=1/w.ratio+1:1<w.ratio?w.required=w.ratio+1:w.required=2,w.result=null,w}return function(c,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof u);c.prototype=Object.create(u&&u.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),u&&(Object.setPrototypeOf?Object.setPrototypeOf(c,u):c.__proto__=u)}(a,i),f(a,[{key:"add",value:function(c){if(this.filter(c)){if(this.maxtree.getNodeCounter()<1)return this.maxtree.insert(c),void this.calculate();this.comparator(c,this.maxtree.getTopValue())<=0?this.maxtree.insert(c):this.mintree.insert(c),this.balancing(),this.calculate()}}},{key:"remove",value:function(c){if(this.filter(c)){var u=this.mintree.getNodeCounter();this.maxtree.getNodeCounter()<1?this.mintree.delete(c):u<1||this.comparator(c,this.maxtree.getTopValue())<=0?this.maxtree.delete(c):this.mintree.delete(c),this.calculate()}}},{key:"getThresholds",value:function(){var c=this.mintree.getSize(),u=this.maxtree.getSize(),g=c+1,h=u+1;return 1<this.ratio?(g=Math.ceil(c*this.ratio),h=Math.floor(u/this.ratio)+1):this.ratio<1&&(g=Math.floor(c*this.ratio)+1,h=Math.ceil(u/this.ratio)),[g,h]}},{key:"balancing",value:function(){var c=this.mintree,u=this.maxtree,g=c.getSize(),h=u.getSize();if(!(h+g<this.required)){if(g<1)return void c.insertNodeAtBottom(u.popTopNode());for(h<1&&u.insertNodeAtTop(c.popBottomNode());;){var C=1<c.getNodeCounter(),E=1<u.getNodeCounter(),y=c.getBottomNode().getLength(),w=u.getTopNode().getLength();if(c.getNodeCounter()<1||u.getNodeCounter()<1)break;var O=this.getThresholds(),L=m(O,2),I=L[0],k=L[1];if(E&=g+w<=k,C&=h+y<=I,g=c.getSize(),I<(h=u.getSize())&&E)c.insertNodeAtBottom(u.popTopNode());else{if(!(k<g&&C))break;u.insertNodeAtTop(c.popBottomNode())}}}}},{key:"getMean",value:function(c,u){return this.meanCalcer?this.meanCalcer(c,u):c}},{key:"estimate",value:function(c,u){return this.estimator?this.estimator(c,u):null}},{key:"calculate",value:function(){var c=null,u=this.mintree,g=this.maxtree,h=u.getSize(),C=g.getSize(),E=C+h;if(!(E<1)){if(E<this.required||h<1||C<1){if(E==0)return;var y=void 0,w=void 0;h<1?(y=this.maxtree.getBottomValue(),w=this.maxtree.getTopValue()):C<1?(y=this.mintree.getBottomValue(),w=this.mintree.getTopValue()):(w=this.mintree.getTopValue(),y=this.maxtree.getBottomValue());var O=this.estimate(y,w);return void this.notify(O)}var L=g.getTopNode(),I=u.getBottomNode();if(L||I){if(!L){var k=this.extract(I);return void this.notify(k)}if(!I){var P=this.extract(L);return void this.notify(P)}var F=E*(this.percentile/100);if(Number.isInteger(F)){var H=Math.floor(F);c=Math.ceil(F+1)<=C?L.peek():H<=C?this.getMean(L.peek(),I.peek()):I.peek()}else{var D=C/h;c=this.ratio<D?L.peek():D<this.ratio||this.ratio<1?I.peek():L.peek()}var $=this.extract(c);this.notify($)}}}}]),a}(o.SWPlugin);b.SWBTreePercentile=n},{"../../collections/binarytree":23,"./swplugin":79}],78:[function(S,p,b){function _(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}function t(o,s){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!s||typeof s!="object"&&typeof s!="function"?o:s}Object.defineProperty(b,"__esModule",{value:!0}),b.SWFunctor=void 0;var m=function(){function o(s,n){for(var i=0;i<n.length;i++){var a=n[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(s,a.key,a)}}return function(s,n,i){return n&&o(s.prototype,n),i&&o(s,i),s}}(),f=function(o){function s(n,i){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;_(this,s);var c=t(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,null,null,a));return c.addFunc=n,c.remFunc=i,c}return function(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof i);n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(n,i):n.__proto__=i)}(s,o),m(s,[{key:"add",value:function(n){this.filter(n)&&this.addFunc&&this.addFunc(n)}},{key:"remove",value:function(n){this.filter(n)&&this.remFunc&&this.remFunc(n)}},{key:"toString",value:function(){return"SWFuncPlugin"}}]),s}(S("./swplugin").SWPlugin);b.SWFunctor=f},{"./swplugin":79}],79:[function(S,p,b){function _(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0}),b.SWPlugin=void 0;var t=function(){function o(s,n){for(var i=0;i<n.length;i++){var a=n[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(s,a.key,a)}}return function(s,n,i){return n&&o(s.prototype,n),i&&o(s,i),s}}(),m=function(o){if(o&&o.__esModule)return o;var s={};if(o!=null)for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(s[n]=o[n]);return s.default=o,s}(S("../../utility/csiologger")),f=function(){function o(s,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;_(this,o),this.extractorFnc=s,this.notifierFnc=n,this.filterFunc=i}return t(o,[{key:"notify",value:function(s){this.notifierFnc?this.notifierFnc(s):m.warn("Failed notification for "+this.toString())}},{key:"extract",value:function(s){return this.extractorFnc?this.extractorFnc(s):(m.warn(this.toString()+" tried to extract without extractorFnc"),null)}},{key:"filter",value:function(s){return!this.filterFunc||this.filterFunc(s)}},{key:"add",value:function(s){m.log("Abstract method is called width value: "+s)}},{key:"remove",value:function(s){m.log("Abstract method is called with value: "+s)}},{key:"toString",value:function(){return"SWPlugin"}}]),o}();b.SWPlugin=f},{"../../utility/csiologger":88}],80:[function(S,p,b){function _(O){if(O&&O.__esModule)return O;var L={};if(O!=null)for(var I in O)Object.prototype.hasOwnProperty.call(O,I)&&(L[I]=O[I]);return L.default=O,L}function t(O,L){if(!(O instanceof L))throw new TypeError("Cannot call a class as a function")}function m(O,L){return L.green<=O?h.avQualityRatings.excellent:L.red<O?h.avQualityRatings.fair:h.avQualityRatings.bad}function f(O,L){return L.red<O?h.avQualityRatings.bad:L.green<=O?h.avQualityRatings.fair:h.avQualityRatings.excellent}Object.defineProperty(b,"__esModule",{value:!0}),b.TrackMonitor=void 0;var o=function O(L,I,k){L===null&&(L=Function.prototype);var P=Object.getOwnPropertyDescriptor(L,I);if(P===void 0){var F=Object.getPrototypeOf(L);return F===null?void 0:O(F,I,k)}if("value"in P)return P.value;var H=P.get;return H!==void 0?H.call(k):void 0},s=function(){function O(L,I){for(var k=0;k<I.length;k++){var P=I[k];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(L,P.key,P)}}return function(L,I,k){return I&&O(L.prototype,I),k&&O(L,k),L}}(),n=S("../utility/registry"),i=S("../collections/slidingwindow"),a=S("../statspipeline/swplugins/swavg"),c=S("../statspipeline/swplugins/swbtreepercentile"),u=S("../statspipeline/swplugins/swfunctor"),g=_(S("../utility/timestamps")),h=_(S("../config/constants")),C=_(S("../utility/csiologger")),E=S("../utility/rttregistry"),y=function(){function O(){t(this,O),this.evaluators=[]}return s(O,[{key:"addEvaluator",value:function(L){var I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,k={processFnc:L,weight:I};this.evaluators.push(k)}},{key:"getQuality",value:function(L){for(var I=0,k=[],P=0,F=0;F<this.evaluators.length;F++){var H=this.evaluators[F],D=0,$=H.processFnc?H.processFnc(L):0;if($){if($===h.avQualityRatings.bad)D=h.qualityRating.bad;else if($===h.avQualityRatings.fair)D=h.qualityRating.fair;else if($===h.avQualityRatings.excellent)D=h.qualityRating.excellent;else if($===h.avQualityRatings.unknown)continue;I+=H.weight,k.push({result:D,weight:H.weight})}}for(var j=0;j<k.length;j++){var V=k[j];P+=V.result*(V.weight/I)}return(P=Math.floor(P))===h.qualityRating.excellent?h.avQualityRatings.excellent:P===h.qualityRating.good||P===h.qualityRating.fair||P===h.qualityRating.poor?h.avQualityRatings.fair:P===h.qualityRating.bad?h.avQualityRatings.bad:void 0}}]),O}(),w=function(O){function L(I,k,P,F){t(this,L);var H=function(D,$){if(!D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!$||typeof $!="object"&&typeof $!="function"?D:$}(this,(L.__proto__||Object.getPrototypeOf(L)).call(this,I,k));return H.thresholds=[],H.enableThresholds=!1,H.requestTime=0,H.started=0,H.created=g.getCurrent(),H.mediaType=F,H.streamType=P,H.qualityHelper=new y,H.metrics=H.makeTrack(),H.lastTrack={},H.prevFrameRateMean=null,H.ssrc=null,H.scsHelper={total:0,above:0,ccDriven:0,sumMaxBitrateDiff:0,sumThroughputDiff:0,prevCsioAvgBRKbps:0},H}return function(I,k){if(typeof k!="function"&&k!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof k);I.prototype=Object.create(k&&k.prototype,{constructor:{value:I,enumerable:!1,writable:!0,configurable:!0}}),k&&(Object.setPrototypeOf?Object.setPrototypeOf(I,k):I.__proto__=k)}(L,O),s(L,null,[{key:"make",value:function(I,k,P,F){var H=new L(I,k,P,F),D=H.metrics;return H.attach(new a.SWAvg(function($){return $.getJitter()},function($){D.csioAvgJitter=$},function($){var j=$.getJitter();return j!=null})),H.attach(new a.SWAvg(function($){return $.getRTT()},function($){D.csioAvgRtt=$},function($){var j=$.getRTT();return j!=null})),H.attach(new c.SWBTreePercentile(95,function($,j){var V=$.getJitter(),Y=j.getJitter();return V==Y?0:V<Y?-1:1},function($){return $.getJitter()},function($){D.csioPercentileJitter=$},function($,j){return j?j.getJitter():$?$.getJitter():void 0},function($){var j=$.getJitter();return j!=null},function($,j){return $})),H.attach(new c.SWBTreePercentile(95,function($,j){var V=$.getRTT(),Y=j.getRTT();return V==Y?0:V<Y?-1:1},function($){return $.getRTT()},function($){D.csioSig2Latency=$,D.csioeM=$+40},function($,j){return j?j.getRTT():$?$.getRTT():void 0},function($){var j=$.getRTT();return j!=null},function($,j){return $})),P===h.streamType.inbound?L.setupInboundMonitor(H):P===h.streamType.outbound?L.setupOutboundMonitor(H):C.warn("Unrecognized streamType ("+P+") at TrackMonitor"),F===h.mediaType.audio?L.setupAudioMonitor(H):F===h.mediaType.video?L.setupVideoMonitor(H):C.warn("Unrecognized mediaType ("+F+") at TrackMonitor"),P===h.streamType.inbound&&F===h.mediaType.audio?L.setupInbAudioQualityEvaluator(H):P===h.streamType.inbound&&F===h.mediaType.video?L.setupInbVideoQualityEvaluator(H):P===h.streamType.outbound&&F===h.mediaType.audio?L.setupOutbAudioQualityEvaluator(H):P===h.streamType.outbound&&F===h.mediaType.video&&(L.setupOutbVideoQualityEvaluator(H),L.setupSCSValidator(H)),H.addPostProcess(function($){D.csioMark=H.getQuality($)}),H}},{key:"setupInbAudioQualityEvaluator",value:function(I){var k=I.metrics;I.addQualityEvaluator(function(P){return k.csioIntBRKbps===void 0||k.csioIntBRKbps===null||k.csioIntBRKbps<0?h.avQualityRatings.unknown:m(k.csioIntBRKbps,h.throughputThreshold.audio)}),I.addQualityEvaluator(function(P){return k.csioIntFL===void 0||k.csioIntFL===null||k.csioIntFL<0?h.avQualityRatings.unknown:f(k.csioIntFL,h.fractionalLossThreshold.audio)}),I.addQualityEvaluator(function(P){return k.csioeM===void 0||k.csioeM===null?h.avQualityRatings.unknown:f(k.csioeM,h.eModelThreshold.audio)})}},{key:"setupOutbAudioQualityEvaluator",value:function(I){var k=I.metrics;I.addQualityEvaluator(function(P){return k.csioIntBRKbps===void 0||k.csioIntBRKbps===null||k.csioIntBRKbps<0?h.avQualityRatings.unknown:m(k.csioIntBRKbps,h.throughputThreshold.audio)}),I.addQualityEvaluator(function(P){return k.csioeM===void 0||k.csioeM===null?h.avQualityRatings.unknown:f(k.csioeM,h.eModelThreshold.audio)})}},{key:"setupInbVideoQualityEvaluator",value:function(I){var k=I.metrics;I.addQualityEvaluator(function(P){return k.csioIntBRKbps===void 0||k.csioIntBRKbps===null||k.csioIntBRKbps<0?h.avQualityRatings.unknown:m(k.csioIntBRKbps,h.throughputThreshold.video)}),I.addQualityEvaluator(function(P){return k.csioFrameRateMean===void 0||k.csioFrameRateMean===null?h.avQualityRatings.unknown:k.csioFrameRateMean&&I.prevFrameRateMean?m(k.csioFrameRateMean/I.prevFrameRateMean,h.currOverPrevFrameRateThreshold.video):h.avQualityRatings.bad}),I.addQualityEvaluator(function(P){return k.csioSig2Latency===void 0||k.csioSig2Latency===null?h.avQualityRatings.unknown:f(k.csioSig2Latency,h.rttThreshold.video)})}},{key:"setupOutbVideoQualityEvaluator",value:function(I){var k=I.metrics;I.addQualityEvaluator(function(P){return k.csioIntBRKbps==null||k.csioIntBRKbps==null?h.avQualityRatings.unknown:m(k.csioIntBRKbps,h.throughputThreshold.video)}),I.addQualityEvaluator(function(P){return k.csioFrameRateMean===void 0||k.csioFrameRateMean===null?h.avQualityRatings.unknown:k.csioFrameRateMean&&I.prevFrameRateMean?m(k.csioFrameRateMean/I.prevFrameRateMean,h.currOverPrevFrameRateThreshold.video):h.avQualityRatings.bad}),I.addQualityEvaluator(function(P){return k.csioSig2Latency===void 0||k.csioSig2Latency===null?h.avQualityRatings.unknown:f(k.csioSig2Latency,h.rttThreshold.video)})}},{key:"setupInboundMonitor",value:function(I){var k=I.metrics;I.addPreProcess(function(P){var F=P.getLostPackets(),H=P.getReceivedPackets(),D=I.getRequestedMeasurement(),$=0,j=0;D?($=F-D.getLostPackets(),j=H-D.getReceivedPackets()):($=F,j=H);var V=0;if((0<$||0<j)&&(V=$/(j+$)),k.csioIntPktLoss=$,k.csioIntFL=V,P.setFractionLost(V),!P.getFrameRateReceived()&&P.getFramesReceived()&&0<I.started){var Y=P.getFramesReceived(),Z=g.getCurrent()-I.started;k.csioEstFrameRatePerSecond=1e3*Y/Z;var J=P.getSSRC(),re=(0,E.getRTTRegistry)().getFrameRate(J);re&&(k.legacyFrameRatePerSecond=re)}}),I.attach(new u.SWFunctor(function(P){var F=g.getCurrent(),H=P.getResolution(),D=I.getRequestedMeasurement(),$=I.getRequestTime(),j=P.getLostPackets(),V=8*P.getReceivedBytes(),Y=P.getReceivedPackets(),Z=F-I.getStartTime(),J=0,re=0,ce=0,Re=0,pe=1e3,Oe=Math.max(F-I.getStartTime(),pe);D?(Re=Y-D.getReceivedPackets(),J=V-8*D.getReceivedBytes(),re=j-D.getLostPackets(),ce=Math.max(F-$,pe)):(n.Registry.getCredentials().getAdaptiveInterval(),pe=n.Registry.getCredentials().getStatsSubmissionInterval(),Oe=Math.max(F-I.getStartTime(),pe),Re=Y,J=V,re=j,ce=Math.max(Oe,pe)),k.csioIntPktRcv=Re,k.csioIntPR=Re/(ce/1e3),k.csioAvgBRKbps=V/Oe,k.csioIntBRKbps=J/ce,k.csioAvgPacketSize=P.getReceivedBytes()/Y,k.csioIntMs=Z,k.csioTimeElapseMs=ce,k.csiores=H,k.csioPktLostPercentage=re/J*100},null,null)),I.attach(new c.SWBTreePercentile(95,function(P,F){var H=P.getFractionLost(),D=F.getFractionLost();return H==D?0:H<D?-1:1},function(P){return P.getFractionLost()},function(P){k.csioPercentileFl=P},function(P,F){return F?F.getFractionLost():P?P.getFractionLost():void 0},function(P){var F=P.getFractionLost();return F!=null},function(P,F){return P}))}},{key:"setupOutboundMonitor",value:function(I){var k=I.metrics;I.addPreProcess(function(P){var F=P.getLostPackets(),H=P.getSentPackets(),D=I.getRequestedMeasurement(),$=0,j=0;D?($=F-D.getLostPackets(),j=H-D.getSentPackets()):($=F,j=H);var V=0;(0<$||0<j)&&(V=$/(j+$)),k.csioIntPktLoss=$,k.csioIntFL=V,P.setFractionLost(V)}),I.attach(new u.SWFunctor(function(P){var F=g.getCurrent(),H=P.getResolution(),D=I.getRequestedMeasurement(),$=I.getRequestTime(),j=P.getLostPackets(),V=8*P.getSentBytes(),Y=P.getSentPackets(),Z=F-I.getStartTime(),J=0,re=0,ce=0,Re=0,pe=1e3,Oe=Math.max(F-I.getStartTime(),pe);D?(Re=Y-D.getSentPackets(),J=V-8*D.getSentBytes(),re=j-D.getLostPackets(),ce=Math.max(F-$,pe)):(n.Registry.getCredentials().getAdaptiveInterval(),pe=n.Registry.getCredentials().getStatsSubmissionInterval(),Oe=Math.max(F-I.getStartTime(),pe),Re=Y,J=V,re=j,ce=Math.max(Oe,pe)),k.csioIntPktRcv=Re,k.csioAvgBRKbps=V/Oe,k.csioIntBRKbps=J/ce,k.csioIntPR=Re/(ce/1e3),k.csioAvgPacketSize=P.getSentBytes()/Y,k.csioIntMs=Z,k.csioTimeElapseMs=ce,k.csiores=H,k.csioPktLostPercentage=re/J*100},null,null)),I.attach(new c.SWBTreePercentile(95,function(P,F){var H=P.getFractionLost(),D=F.getFractionLost();return H==D?0:H<D?-1:1},function(P){return P.getFractionLost()},function(P){k.csioPercentileFl=P},function(P,F){return F?F.getFractionLost():P?P.getFractionLost():void 0},function(P){var F=P.getFractionLost();return F!=null},function(P,F){return P}))}},{key:"setupAudioMonitor",value:function(I){var k=I.metrics;I.attach(new u.SWFunctor(function(P){k.csioMediaType=h.mediaType.audio},null,null))}},{key:"setupVideoMonitor",value:function(I){var k=I.metrics;I.attach(new a.SWAvg(function(P){return P.getFrameRateReceived()},function(P){I.prevFrameRateMean=k.csioFrameRateMean,k.csioFrameRateMean=P},function(P){var F=P.getFrameRateReceived();return F!=null})),I.attach(new a.SWAvg(function(P){return P.getFrameHeight()},function(P){k.csioFrameHeightMean=P},function(P){var F=P.getFrameHeight();return F!=null})),I.attach(new a.SWAvg(function(P){return P.getFrameWidth()},function(P){k.csioFrameWidthMean=P},function(P){var F=P.getFrameWidth();return F!=null})),I.attach(new c.SWBTreePercentile(95,function(P,F){var H=P.getFrameRateReceived(),D=F.getFrameRateReceived();return H==D?0:H<D?-1:1},function(P){return P.getFrameRateReceived()},function(P){k.csioFrameRate95Percentile=P},function(P,F){return F?F.getFrameRateReceived():P?P.getFrameRateReceived():void 0},function(P){var F=P.getFrameRateReceived();return F!=null},function(P,F){return P})),I.attach(new c.SWBTreePercentile(50,function(P,F){var H=P.getFrameRateReceived(),D=F.getFrameRateReceived();return H==D?0:H<D?-1:1},function(P){return P.getFrameRateReceived()},function(P){k.csioFrameRate50Percentile=P},function(P,F){return F?F.getFrameRateReceived():P?P.getFrameRateReceived():void 0},function(P){var F=P.getFrameRateReceived();return F!=null},function(P,F){return P})),I.attach(new c.SWBTreePercentile(95,function(P,F){var H=P.getFrameHeight(),D=F.getFrameHeight();return H==D?0:H<D?-1:1},function(P){return P.getFrameHeight()},function(P){k.csioFrameHeight95Percentile=P},function(P,F){return F?F.getFrameHeight():P?P.getFrameHeight():void 0},function(P){var F=P.getFrameHeight();return F!=null},function(P,F){return P})),I.attach(new c.SWBTreePercentile(50,function(P,F){var H=P.getFrameHeight(),D=F.getFrameHeight();return H==D?0:H<D?-1:1},function(P){return P.getFrameHeight()},function(P){k.csioFrameHeight50Percentile=P},function(P,F){return F?F.getFrameHeight():P?P.getFrameHeight():void 0},function(P){var F=P.getFrameHeight();return F!=null},function(P,F){return P})),I.attach(new c.SWBTreePercentile(95,function(P,F){var H=P.getFrameWidth(),D=F.getFrameWidth();return H==D?0:H<D?-1:1},function(P){return P.getFrameWidth()},function(P){k.csioFrameWidth95Percentile=P},function(P,F){return F?F.getFrameWidth():P?P.getFrameWidth():void 0},function(P){var F=P.getFrameWidth();return F!=null},function(P,F){return P})),I.attach(new c.SWBTreePercentile(50,function(P,F){var H=P.getFrameWidth(),D=F.getFrameWidth();return H==D?0:H<D?-1:1},function(P){return P.getFrameWidth()},function(P){k.csioFrameWidth50Percentile=P},function(P,F){return F?F.getFrameWidth():P?P.getFrameWidth():void 0},function(P){var F=P.getFrameWidth();return F!=null},function(P,F){return P})),I.attach(new u.SWFunctor(function(P){k.csioMediaType=h.mediaType.video},null,null))}},{key:"setupSCSValidator",value:function(I){var k=I.metrics;I.attach(new u.SWFunctor(function(P){var F=n.Registry.getConfigServiceWrapper().getSenderConfig();if(!F||!F.rtc_rtp_parameters||!F.rtc_rtp_parameters.encodings)return k.csioSCSValidationSampleCount=null,k.csioAvgMaxBitrateDiff=null,k.csioAvgDeltaThroughput=null,k.csioMaxBitrateAboveRatio=null,void(k.csioCCDrivenRatio=null);var H=0;F.rtc_rtp_parameters.encodings.forEach(function(re){re&&(H=Math.max(H,re.maxBitrate))});var D=0,$=n.Registry.getConfigServiceWrapper().getDefaultSenderConfig();if($&&$.encodings){$.encodings.forEach(function(re){D=Math.max(D,re.maxBitrate)});var j,V,Y=0,Z=null,J=I.getSCSHelper();0<D&&.9*D<1e3*k.csioAvgBRKbps?(Y=H-D,Z=!1):(Y=H-1e3*k.csioAvgBRKbps,Z=!0),V=0<Y,j=k.csioAvgBRKbps-k.prevCsioAvgBRKbps,J.prevCsioAvgBRKbps=k.csioAvgBRKbps,k.csioSCSValidationSampleCount=++J.total,J.sumMaxBitrateDiff+=Y,k.csioAvgMaxBitrateDiff=J.sumMaxBitrateDiff/J.total,J.sumThroughputDiff+=j,k.csioAvgDeltaThroughput=J.sumThroughputDiff/J.total,V&&(J.above+=1),k.csioMaxBitrateAboveRatio=J.above/J.total,Z&&(J.ccDriven+=1),k.csioCCDrivenRatio=J.ccDriven/J.total}},null,null))}}]),s(L,[{key:"makeTrack",value:function(){var I={csioMediaType:void 0,csioMark:void 0,csioIntBRKbps:void 0,csioAvgBRKbps:void 0,csioIntFL:void 0,csioIntMs:void 0,csioIntPR:void 0,csioPercentileFl:void 0,csioAvgJitter:void 0,csioAvgRtt:void 0,csioPercentileJitter:void 0,csioSig2Latency:void 0,csioTimeElapseMs:void 0,csioeM:void 0,csiores:void 0,csioFrameWidth95Percentile:void 0,csioFrameWidth50Percentile:void 0,csioFrameHeight95Percentile:void 0,csioFrameHeight50Percentile:void 0,csioFrameRate95Percentile:void 0,csioFrameRate50Percentile:void 0,csioFrameWidthMean:void 0,csioFrameHeightMean:void 0,csioFrameRateMean:void 0,csioIntPktRcv:void 0,csioSCSValidationSampleCount:null,csioAvgMaxBitrateDiff:null,csioAvgDeltaThroughput:null,csioMaxBitrateAboveRatio:null,csioCCDrivenRatio:null};return I}},{key:"getSSRC",value:function(){return this.ssrc}},{key:"add",value:function(I){this.ssrc=I.getSSRC(),this.lastTrack=I.extractTrack(),this.lastTrack.pcHash=I.getPcHash(),this.started===0&&(this.started=g.getCurrent()),o(L.prototype.__proto__||Object.getPrototypeOf(L.prototype),"add",this).call(this,I)}},{key:"hasTraffic",value:function(){return 0<this.metrics.csioIntBRKbps}},{key:"getTrack",value:function(){var I=this.lastTrack;return Object.assign(I.data,this.metrics),I}},{key:"extractTrack",value:function(){var I=this.lastTrack;return Object.assign(I.data,this.metrics),this.requestTime=g.getCurrent(),this.requestedMeasurement=this.peek(),I}},{key:"getMediaType",value:function(){return this.mediaType}},{key:"getStreamType",value:function(){return this.streamType}},{key:"getStartTime",value:function(){return this.started}},{key:"getCreationTime",value:function(){return this.created}},{key:"getRequestTime",value:function(){return Math.max(this.started,this.requestTime)}},{key:"getRequestedMeasurement",value:function(){return this.requestedMeasurement}},{key:"getSCSHelper",value:function(){return this.scsHelper}},{key:"addQualityEvaluator",value:function(I){var k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;this.qualityHelper.addEvaluator(I,k)}},{key:"getQuality",value:function(I){return this.qualityHelper.getQuality(I)}},{key:"addPreProcess",value:function(I){o(L.prototype.__proto__||Object.getPrototypeOf(L.prototype),"addPreProcess",this).call(this,I)}},{key:"addPostProcess",value:function(I){o(L.prototype.__proto__||Object.getPrototypeOf(L.prototype),"addPostProcess",this).call(this,I)}}]),L}(i.SlidingWindow);b.TrackMonitor=w},{"../collections/slidingwindow":28,"../config/constants":33,"../statspipeline/swplugins/swavg":76,"../statspipeline/swplugins/swbtreepercentile":77,"../statspipeline/swplugins/swfunctor":78,"../utility/csiologger":88,"../utility/registry":95,"../utility/rttregistry":96,"../utility/timestamps":99}],81:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.TracksMonitor=void 0;var _=function(){function o(s,n){for(var i=0;i<n.length;i++){var a=n[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(s,a.key,a)}}return function(s,n,i){return n&&o(s.prototype,n),i&&o(s,i),s}}(),t=S("./trackmonitor"),m=function(o){if(o&&o.__esModule)return o;var s={};if(o!=null)for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(s[n]=o[n]);return s.default=o,s}(S("../config/constants")),f=function(){function o(){(function(s,n){if(!(s instanceof n))throw new TypeError("Cannot call a class as a function")})(this,o),this.inbMonitors=new Map,this.outbMonitors=new Map}return _(o,[{key:"getMonitor",value:function(s){var n=s.getStreamType(),i=s.getMediaType(),a=s.getSSRC(),c=null;return n===m.streamType.inbound?i===m.mediaType.audio?c=this.getInbAudioMonitor(a):i===m.mediaType.video&&(c=this.getInbVideoMonitor(a)):n===m.streamType.outbound&&(i===m.mediaType.audio?c=this.getOutbAudioMonitor(a):i===m.mediaType.video&&(c=this.getOutbVideoMonitor(a))),c}},{key:"extractTracks",value:function(){var s=[];return this.outbMonitors.forEach(function(n,i){s.push(n.extractTrack())}),this.inbMonitors.forEach(function(n,i){s.push(n.extractTrack())}),s}},{key:"getTracks",value:function(){var s=[];return this.outbMonitors.forEach(function(n,i){s.push(n.getTrack())}),this.inbMonitors.forEach(function(n,i){s.push(n.getTrack())}),s}},{key:"getMonitors",value:function(){var s=[];return this.outbMonitors.forEach(function(n,i){s.push(n)}),this.inbMonitors.forEach(function(n,i){s.push(n)}),s}},{key:"getInbAudioMonitor",value:function(s){var n=this.inbMonitors.get(s);return n||(n=t.TrackMonitor.make(1e3,3e4,m.streamType.inbound,m.mediaType.audio),this.inbMonitors.set(s,n)),n}},{key:"getInbVideoMonitor",value:function(s){var n=this.inbMonitors.get(s);return n||(n=t.TrackMonitor.make(1e3,3e4,m.streamType.inbound,m.mediaType.video),this.inbMonitors.set(s,n)),n}},{key:"getOutbAudioMonitor",value:function(s){var n=this.outbMonitors.get(s);return n||(n=t.TrackMonitor.make(1e3,3e4,m.streamType.outbound,m.mediaType.audio),this.outbMonitors.set(s,n)),n}},{key:"getOutbVideoMonitor",value:function(s){var n=this.outbMonitors.get(s);return n||(n=t.TrackMonitor.make(1e3,3e4,m.streamType.outbound,m.mediaType.video),this.outbMonitors.set(s,n)),n}}]),o}();b.TracksMonitor=f},{"../config/constants":33,"./trackmonitor":80}],82:[function(S,p,b){function _(a){if(a&&a.__esModule)return a;var c={};if(a!=null)for(var u in a)Object.prototype.hasOwnProperty.call(a,u)&&(c[u]=a[u]);return c.default=a,c}function t(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0}),b.TransportsMonitor=void 0;var m=function(){function a(c,u){for(var g=0;g<u.length;g++){var h=u[g];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(c,h.key,h)}}return function(c,u,g){return u&&a(c.prototype,u),g&&a(c,g),c}}(),f=_(S("../config/constants")),o=_(S("../utility/timestamps")),s=S("../utility/rttregistry"),n=function(){function a(c){t(this,a),this.previous=c,this.actual=c,this.outdated=o.getCurrent()}return m(a,[{key:"setActual",value:function(c){this.actual=c}},{key:"outdate",value:function(){this.previous=this.actual,this.outdated=o.getCurrent()}},{key:"getActual",value:function(){return this.actual}},{key:"getPrevious",value:function(){return this.previous}},{key:"getElapsedTime",value:function(){return o.getCurrent()-this.outdated}}]),a}(),i=function(){function a(c){t(this,a),this.stats=new Map,this.codeBase=c}return m(a,[{key:"set",value:function(c,u){var g=this.stats.get(c);g?g.setActual(u):this.stats.set(c,new n(u))}},{key:"getIntervalStats",value:function(){var c=this,u=new Map;return this.stats.forEach(function(g,h){u.set(h,c.getIntervalStat(g)),g.outdate()}),u}},{key:"getIntervalStat",value:function(c){var u=null;switch(this.codeBase){case f.codeBaseType.chrome:u=this.getIntervalStatForChrome(c);break;default:u=c.getActual()}return u}},{key:"getIntervalStatForChrome",value:function(c){var u=c.getActual(),g=c.getPrevious(),h=c.getElapsedTime();if(!g)return actual;for(var C=0;C<u.length;++C){var E=u[C],y=g[C];if(!y||!E)return u;var w=parseInt(y.bytesReceived,10),O=parseInt(y.bytesSent,10);E.csioReceivedBwKbps=8*(parseInt(E.bytesReceived,10)-w)/h,E.csioSentBwKbps=8*(parseInt(E.bytesSent,10)-O)/h,E.csioIntBytesReceived=parseInt(E.bytesReceived,10)-w,E.csioIntBytesSent=parseInt(E.bytesSent,10)-O,y.packetsSent!==void 0&&E.packetsSent!==void 0&&(E.csioSentPacketRate=(parseInt(E.packetsSent,10)-parseInt(y.packetsSent,10))/(h/1e3),E.csioIntPacketsSent=parseInt(E.packetsSent,10)-parseInt(y.packetsSent,10)),y.packetsReceived!==void 0&&E.packetsReceived!==void 0&&(E.csioReceivedPacketRate=(parseInt(E.packetsReceived,10)-parseInt(y.packetsReceived,10))/(h/1e3),E.csioIntPacketsReceived=parseInt(E.packetsReceived,10)-parseInt(y.packetsReceived,10)),this.codeBase==f.codeBaseType.chrome&&(E.currentRoundTripTime=(0,s.getRTTRegistry)().getTransportRTT())}return u}}]),a}();b.TransportsMonitor=i},{"../config/constants":33,"../utility/rttregistry":96,"../utility/timestamps":99}],83:[function(S,p,b){function _(t){return isNaN(t)?null:t}Object.defineProperty(b,"__esModule",{value:!0}),b.checkForNan=_,b.checkForNegativeValue=function(t){return _(t)!==null&&0<t?t:null}},{}],84:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0});var _=function(){function m(f,o){for(var s=0;s<o.length;s++){var n=o[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(f,n.key,n)}}return function(f,o,s){return o&&m(f.prototype,o),s&&m(f,s),f}}(),t=function(){function m(){(function(f,o){if(!(f instanceof o))throw new TypeError("Cannot call a class as a function")})(this,m),this.getWifiStatsMethod=null,this.wifiStats=null,this.interval=1e4}return _(m,[{key:"setGetWifiStatsMethod",value:function(f){this.getWifiStatsMethod=f,this.wifiStatsHandler()}},{key:"getWifiStats",value:function(){return this.wifiStats}},{key:"wifiStatsHandler",value:function(){var f=this;f.getWifiStatsMethod&&f.getWifiStatsMethod().then(function(o){f.wifiStats=JSON.parse(o),setTimeout(function(){f.wifiStatsHandler()},f.interval)}).catch(function(){setTimeout(function(){f.wifiStatsHandler()},f.interval)})}}]),m}();b.WifiStatsExecutor=t},{}],85:[function(S,p,b){function _(m){return window.btoa(m)}function t(m){return window.atob(m)}Object.defineProperty(b,"__esModule",{value:!0}),b.encode=_,b.decode=t,b.urlencode=function(m){return _(m).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")},b.urlencodeUnicode=function(m){return function(f){return _(encodeURIComponent(f).replace(/%([0-9A-F]{2})/g,function(o,s){return String.fromCharCode("0x"+s)}))}(m).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")},b.strtohex=function(m){for(var f=t(m.replace(/[ \r\n]+$/,"")),o=[],s=0;s<f.length;++s){var n=f.charCodeAt(s).toString(16);n.length===1&&(n="0"+n),o.push(n)}return o.join("")}},{}],86:[function(S,p,b){function _(n){if(n&&n.__esModule)return n;var i={};if(n!=null)for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a]);return i.default=n,i}Object.defineProperty(b,"__esModule",{value:!0}),b.Callbacks=void 0;var t=function(){function n(i,a){for(var c=0;c<a.length;c++){var u=a[c];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(i,u.key,u)}}return function(i,a,c){return a&&n(i.prototype,a),c&&n(i,c),i}}(),m=_(S("../config/constants")),f=S("./registry"),o=_(S("./csiologger")),s=function(){function n(){(function(i,a){if(!(i instanceof a))throw new TypeError("Cannot call a class as a function")})(this,n),this.callbacks={}}return t(n,[{key:"set",value:function(i,a){if(typeof a=="function")return m.callbackFunctions.hasOwnProperty(i)?(this.callbacks[i]=a,void(i===m.callbackFunctions.stats&&f.Registry.getStatsCallbackBuilder().setCallback(a))):void o.error("Couldn't set callback: "+i)}},{key:"get",value:function(i){return this.callbacks.hasOwnProperty(i)?this.callbacks[i]:null}}]),n}();b.Callbacks=s},{"../config/constants":33,"./csiologger":88,"./registry":95}],87:[function(S,p,b){function _(n){if(n&&n.__esModule)return n;var i={};if(n!=null)for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a]);return i.default=n,i}Object.defineProperty(b,"__esModule",{value:!0}),b.Credentials=void 0;var t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},m=function(){function n(i,a){for(var c=0;c<a.length;c++){var u=a[c];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(i,u.key,u)}}return function(i,a,c){return a&&n(i.prototype,a),c&&n(i,c),i}}(),f=_(S("../config/constants")),o=_(S("./csiologger")),s=function(){function n(){(function(i,a){if(!(i instanceof a))throw new TypeError("Cannot call a class as a function")})(this,n),this.appId=null,this.userId=null,this.userIdObject=null,this.deviceId=null,this.statsSubmissionInterval=15e3,this.collectSDP=!1,this.transportType=f.transportType.rest,this.adaptiveInterval=!1}return m(n,[{key:"getAppId",value:function(){return this.appId}},{key:"setAppId",value:function(i){this.appId=typeof i=="string"?parseInt(i,10):i}},{key:"getUserId",value:function(){return this.userId}},{key:"setUserId",value:function(i){(i===void 0?"undefined":t(i))==="object"?(this.userId=i.aliasName,this.setUserIdObject(i)):this.userId=i}},{key:"getUserIdObject",value:function(){return this.userIdObject}},{key:"setUserIdObject",value:function(i){this.userIdObject=i}},{key:"getStatsSubmissionInterval",value:function(){return this.statsSubmissionInterval}},{key:"setStatsSubmissionInterval",value:function(i){o.log("setStatsSubmissionInterval is ",i),this.statsSubmissionInterval=i}},{key:"getCollectSDP",value:function(){return this.collectSDP}},{key:"setCollectSDP",value:function(i){this.collectSDP=i}},{key:"getTransportType",value:function(){return this.transportType}},{key:"setTransportType",value:function(i){this.transportType=i}},{key:"getAdaptiveInterval",value:function(){return this.adaptiveInterval}},{key:"setAdaptiveInterval",value:function(i){this.adaptiveInterval=i}}]),n}();b.Credentials=s},{"../config/constants":33,"./csiologger":88}],88:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.info=function(){var t;_.csioDebug==="true"&&(t=console).info.apply(t,arguments)},b.log=function(){var t;_.csioDebug==="true"&&(t=console).log.apply(t,arguments)},b.warn=function(){var t;_.csioDebug==="true"&&(t=console).warn.apply(t,arguments)},b.error=function(){var t;(t=console).warn.apply(t,arguments)};var _=function(t){if(t&&t.__esModule)return t;var m={};if(t!=null)for(var f in t)Object.prototype.hasOwnProperty.call(t,f)&&(m[f]=t[f]);return m.default=t,m}(S("../config/settings"))},{"../config/settings":34}],89:[function(S,p,b){function _(i){if(i&&i.__esModule)return i;var a={};if(i!=null)for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(a[c]=i[c]);return a.default=i,a}Object.defineProperty(b,"__esModule",{value:!0}),b.Endpoint=void 0;var t=function(){function i(a,c){for(var u=0;u<c.length;u++){var g=c[u];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(a,g.key,g)}}return function(a,c,u){return c&&i(a.prototype,c),u&&i(a,u),a}}(),m=_(S("../browserapi/localstorage")),f=_(S("../browserapi/detectbrowser")),o=_(S("../utility/timestamps")),s=_(S("../utility/hash")),n=function(){function i(){(function(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function")})(this,i),this.id=null,this.appversion=null,this.magicKey=Math.floor(4294967296*Math.random()),this.browserName=null,this.browserVersion=null,this.osName=null,this.osVersion=null,this.codeBase=null,this.userAgent=null,this.retrieveId()}return t(i,[{key:"setup",value:function(){var a=f.detect();this.browserName=a.browserName,this.browserVersion=a.browserVersion,this.osName=a.os,this.osVersion=a.osVersion,this.codeBase=a.codeBase,this.userAgent=a.userAgent}},{key:"retrieveId",value:function(){var a=this,c=m.get("endpointID");if(c===null){var u=o.getCurrent(),g=Math.random()*u;s.generateSHA256(g.toString(),function(h){a.id=h,m.store("endpointID",h)})}else this.id=c}},{key:"getId",value:function(){return this.id}},{key:"getAppVersion",value:function(){return this.appversion}},{key:"setAppVersion",value:function(a){this.appversion=a}},{key:"getMagicKey",value:function(){return this.magicKey}},{key:"getBrowserName",value:function(){return this.browserName}},{key:"getBrowserVersion",value:function(){return this.browserVersion}},{key:"getOsName",value:function(){return this.osName}},{key:"getOsVersion",value:function(){return this.osVersion}},{key:"getCodeBase",value:function(){return this.codeBase}},{key:"getUserAgent",value:function(){return this.userAgent}},{key:"serialize",value:function(){return{type:"browser",buildName:this.browserName,buildVersion:this.browserVersion,appVersion:this.appversion,os:this.osName,osVersion:this.osVersion,userAgent:this.userAgent}}}]),i}();b.Endpoint=n},{"../browserapi/detectbrowser":18,"../browserapi/localstorage":20,"../utility/hash":92,"../utility/timestamps":99}],90:[function(S,p,b){function _(c){if(c&&c.__esModule)return c;var u={};if(c!=null)for(var g in c)Object.prototype.hasOwnProperty.call(c,g)&&(u[g]=c[g]);return u.default=c,u}Object.defineProperty(b,"__esModule",{value:!0}),b.EventMessage=void 0;var t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},m=function(){function c(u,g){for(var h=0;h<g.length;h++){var C=g[h];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(u,C.key,C)}}return function(u,g,h){return g&&c(u.prototype,g),h&&c(u,h),u}}(),f=_(S("../config/constants")),o=_(S("../config/settings")),s=S("./registry"),n=_(S("./csiologger")),i=function(){function c(u,g,h,C){(function(E,y){if(!(E instanceof y))throw new TypeError("Cannot call a class as a function")})(this,c),this.eventType=u,this.customEntries=h,this.pcHandler=C,this.auth=s.Registry.getAuthenticator(),this.clocksync=s.Registry.getClockSync(),this.timestamp=this.clocksync.getSynchronizedTimestamp(),this.conferenceId=g,this.clockUnSynced=!this.clocksync.isCompleted()}return m(c,[{key:"updateConferenceId",value:function(u){n.log("updating conferenceId to ",this.eventType,this.conferenceId,u),this.conferenceId=u}},{key:"toJson",value:function(){if(!this.canBeSent())return null;var u=this.getCommonHeader();return Object.assign(u,this.customEntries),this.eventType===f.internalFabricEvent.userJoined&&delete u.connectionID,u}},{key:"getCallback",value:function(){return this.pcHandler?this.pcHandler.getCallback():null}},{key:"canBeSent",value:function(){var u=void 0,g=f.tmpConferenceId;if(this.conferenceId===g||this.pcHandler&&!this.pcHandler.getRemoteId())return!1;if(this.eventType!==f.precalltestEvents.results){var h=s.Registry.getConferenceManager().get(this.conferenceId);if(!h)return!1;u=h.getUcId()}return!!this.auth.getToken()&&(this.auth.isTokenValid()?!!(this.isPriority()||this.clocksync.isCompleted()&&u)&&!(this.eventType===f.internalFabricEvent.userAlive&&!u):(this.auth.reAuthenticate(),!1))}},{key:"isCachable",value:function(){return[f.internalFabricEvent.userAlive].indexOf(this.eventType)===-1}},{key:"isPriority",value:function(){var u=!1;return this.eventType!==f.internalFabricEvent.userJoined&&this.eventType!==f.precalltestEvents.results&&this.eventType!==f.internalFabricEvent.userAlive||(u=!0),u}},{key:"getConferenceId",value:function(){return this.conferenceId}},{key:"getCommonHeader",value:function(){var u={version:o.version,callstatsVersion:o.version,channel:this.decideChannel(),timestamp:this.timestamp,action:this.eventType,eventType:this.eventType,localID:encodeURIComponent(s.Registry.getCredentials().getUserId()),timeShift:0,appID:s.Registry.getCredentials().getAppId(),deviceID:s.Registry.getEndpoint().getId(),token:this.auth.getToken(),confID:encodeURIComponent(this.conferenceId)};this.clockUnSynced&&(u.timestamp+=this.clocksync.getOffset());var g=s.Registry.getConferenceManager().get(this.conferenceId);return u.ucID=g?g.getUcId():null,this.pcHandler?(u.remoteID=encodeURIComponent(this.pcHandler.getRemoteId()),u.connectionID=this.pcHandler.getPcHash()):(u.remoteID=encodeURIComponent(s.Registry.getCredentials().getUserId()),u.connectionID=encodeURIComponent(s.Registry.getCredentials().getUserId())),u.remoteID||(u.remoteID=encodeURIComponent(s.Registry.getCredentials().getUserId())),u}},{key:"decideChannel",value:function(){if(this.eventType==f.callstatsChannels.sdpSubmission)return f.callstatsChannels.sdpSubmission;if(this.eventType==f.callstatsChannels.userFeedback)return f.callstatsChannels.userFeedback;if(this.eventType==f.callstatsChannels.processedStats)return f.callstatsChannels.processedStats;for(var u in f.precalltestEvents)if(this.eventType==f.precalltestEvents[u])return f.callstatsChannels.preCallTest;return f.callstatsChannels.callstatsEvent}}],[{key:"checkCustomEntries",value:function(u,g){if(!a[u])return n.error("eventType not recognized:",u),!1;var h=a[u];for(var C in h)if(!g.hasOwnProperty(C)||t(g[C])!==h[C])return n.error("customEntries for",u,"should have",C,"of type",h[C]),!1;return!0}}]),c}(),a={};a[f.internalFabricEvent.userJoined]={endpointInfo:"object"},a[f.internalFabricEvent.userLeft]={},a[f.internalFabricEvent.userAlive]={},a[f.internalFabricEvent.userDetails]={userName:"string"},a[f.internalFabricEvent.connectedDeviceList]={mediaDeviceList:"object"},a[f.fabricEvent.activeDeviceList]={mediaDeviceList:"object"},a[f.fabricEvent.audioMute]={},a[f.fabricEvent.audioUnmute]={},a[f.fabricEvent.videoPause]={},a[f.fabricEvent.videoResume]={},a[f.fabricEvent.screenShareStart]={},a[f.fabricEvent.screenShareStop]={},a[f.internalFabricEvent.mediaPlaybackStart]={ssrc:"string"},a[f.internalFabricEvent.mediaPlaybackSuspended]={ssrc:"string"},a[f.internalFabricEvent.mediaPlaybackStalled]={ssrc:"string"},a[f.internalFabricEvent.oneWayMedia]={mediaType:"string",ssrc:"string"},a[f.internalFabricEvent.fabricSetup]={localIceCandidates:"object",remoteIceCandidates:"object",iceCandidatePairs:"object"},a[f.fabricEvent.fabricSetupFailed]={failureDelay:"number",reason:"string",function:"string",endpoint:"object"},a[f.internalFabricEvent.fabricStateChange]={changedState:"string",prevState:"string",newState:"string"},a[f.internalFabricEvent.fabricDropped]={prevIceConnectionState:"string",currIceConnectionState:"string",currIceCandidatePair:"object",failureDelay:"number"},a[f.internalFabricEvent.iceConnectionDisruptionStart]={prevIceConnectionState:"string",currIceConnectionState:"string",prevIceConnectionStateTs:"number",currIceCandidatePair:"object"},a[f.internalFabricEvent.iceConnectionDisruptionEnd]={prevIceConnectionState:"string",currIceConnectionState:"string",delay:"number"},a[f.internalFabricEvent.iceDisruptionStart]={prevIceConnectionState:"string",currIceConnectionState:"string",prevIceConnectionStateTs:"number",currIceCandidatePair:"object"},a[f.internalFabricEvent.iceDisruptionEnd]={prevIceConnectionState:"string",currIceConnectionState:"string",prevIceCandidatePair:"object"},a[f.internalFabricEvent.iceFailed]={localIceCandidates:"object",prevIceConnectionState:"string",currIceConnectionState:"string",currIceCandidatePair:"object",failureDelay:"number"},a[f.internalFabricEvent.iceAborted]={prevIceConnectionState:"string",currIceConnectionState:"string"},a[f.internalFabricEvent.iceRestarted]={prevIceConnectionState:"string",currIceConnectionState:"string",prevIceCandidatePair:"object"},a[f.internalFabricEvent.fabricTransportSwitch]={prevIceCandidatePair:"object",currIceCandidatePair:"object"},a[f.internalFabricEvent.iceTerminated]={prevIceConnectionState:"string",currIceConnectionState:"string"},a[f.fabricEvent.fabricTerminated]={},a[f.fabricEvent.fabricHold]={},a[f.fabricEvent.fabricResume]={},a[f.callstatsChannels.sdpSubmission]={localSDP:"string",remoteSDP:"string"},a[f.internalFabricEvent.ssrcMap]={ssrcData:"object"},a[f.callstatsChannels.userFeedback]={feedback:"object"},a[f.internalFabricEvent.sendingThroughputObservations]={ssrc:"string",maxsendingKBitrate:"number",timeToMaxSendingKBitrate:"number",stablesendingKBitrate:"number",timeToStableSendingKBitrate:"number"},a[f.fabricEvent.dominantSpeaker]={},a[f.fabricEvent.applicationErrorLog]={message:"string",messageType:"string"},a[f.callstatsChannels.processedStats]={stats:"object"},a[f.callstatsChannels.senderConfiguration]={rtc_rtp_parameters:"object"},a[f.internalFabricEvent.limitationObservations]={reason:"string"},a[f.qualityDisruptionTypes.qpchange]={reason:"string"},a[f.precalltestEvents.results]={results:"object"},a[f.precalltestEvents.associate]={ids:"object"},b.EventMessage=i},{"../config/constants":33,"../config/settings":34,"./csiologger":88,"./registry":95}],91:[function(S,p,b){function _(a){if(a&&a.__esModule)return a;var c={};if(a!=null)for(var u in a)Object.prototype.hasOwnProperty.call(a,u)&&(c[u]=a[u]);return c.default=a,c}Object.defineProperty(b,"__esModule",{value:!0}),b.EventMessageBuilder=void 0;var t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},m=function(){function a(c,u){for(var g=0;g<u.length;g++){var h=u[g];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(c,h.key,h)}}return function(c,u,g){return u&&a(c.prototype,u),g&&a(c,g),c}}(),f=S("./eventmessage"),o=_(S("../config/constants")),s=S("./registry"),n=_(S("./csiologger")),i=function(){function a(){(function(c,u){if(!(c instanceof u))throw new TypeError("Cannot call a class as a function")})(this,a),this.transmissionmanager=s.Registry.getTransmissionManager()}return m(a,[{key:"make",value:function(c,u,g){var h=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};if(typeof c!="string"||h===null||(h===void 0?"undefined":t(h))!=="object")return n.error("failed typeof checks:",c,c===void 0?"undefined":t(c),h===void 0?"undefined":t(h),h),s.Registry.getGenericEventHandler().sendEvent(o.logEvents.error,{msg:"failed typeof checks:"+c+":"+(h===void 0?"undefined":t(h))+":"+(c===void 0?"undefined":t(c))}),!1;if(u===null&&c!==o.precalltestEvents.results)return n.error("failed conferenceId checks:",c,u),s.Registry.getGenericEventHandler().sendEvent(o.logEvents.error,{msg:"failed conferenceId checks:"+c}),!1;if(!g&&c!==o.callstatsChannels.userFeedback&&c!==o.fabricEvent.applicationErrorLog&&c!==o.fabricEvent.fabricSetupFailed&&c!==o.internalFabricEvent.userJoined&&c!==o.precalltestEvents.results)return n.error("peerconnection cannot be null",c),s.Registry.getGenericEventHandler().sendEvent(o.logEvents.error,{msg:"peerconnection cannot be null"+c}),!1;if(!f.EventMessage.checkCustomEntries(c,h))return n.error("failed checks:",c,h),s.Registry.getGenericEventHandler().sendEvent(o.logEvents.error,{msg:"failed customEntries checks:"+c}),!1;var C=void 0;if(u){var E=s.Registry.getConferenceManager().get(u);E&&g&&(C=E.getPeerConnectionManager().getPcHandler(g))}var y=new f.EventMessage(c,u,h,C);return this.transmissionmanager.send(y),!0}}]),a}();b.EventMessageBuilder=i},{"../config/constants":33,"./csiologger":88,"./eventmessage":90,"./registry":95}],92:[function(S,p,b){function _(f){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,s=0;if(!f)return s;for(var n=0,i=f.length;n<i;n++)s=(s<<5)-s+f.charCodeAt(n),s|=0;return o&&o(s+""),s+""}function t(f){for(var o=[],s=0;s<f.length;++s){var n=f.charCodeAt(s);n<128?o[o.length]=n:n>127&&n<2048?(o[o.length]=n>>6|192,o[o.length]=63&n|128):(o[o.length]=n>>12|224,o[o.length]=n>>6&63|128,o[o.length]=63&n|128)}return new Uint8Array(o).buffer}function m(f){for(var o=new DataView(f),s="",n=void 0,i=0;i<o.byteLength;i++)(n=o.getUint8(i).toString(16)).length<2&&(n="0"+n),s+=n;return s}Object.defineProperty(b,"__esModule",{value:!0}),b.generateSHA256=function(f,o){var s={name:"SHA-256"};if(window.crypto){var n=window.crypto.subtle||window.crypto.webkitSubtle;if(!n)return void _(f,o);n.digest(s,t(f)).then(function(a){o(m(a))}).catch(function(){_(f,o)})}else if(window.msCrypto){if(!window.msCrypto.subtle)return void _(f,o);var i=window.msCrypto.subtle.digest(s,t(f));i.oncomplete=function(a){a.target&&o(m(a.target.result))},i.onerror=function(){_(f,o)}}else _(f,o)},b.generateHash=_},{}],93:[function(S,p,b){function _(t){return!!/^[\],:{}\s]*$/.test(t.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))}Object.defineProperty(b,"__esModule",{value:!0}),b.isValid=_,b.parse=function(t){var m=null;return t===null||_(t)&&(m=JSON.parse(t)),m}},{}],94:[function(S,p,b){function _(o){if(o&&o.__esModule)return o;var s={};if(o!=null)for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(s[n]=o[n]);return s.default=o,s}Object.defineProperty(b,"__esModule",{value:!0}),b.setErrorEventListener=function(){window&&window.addEventListener&&window.addEventListener("error",function(o){var s=t.Registry.getGenericEventHandler();if(o&&o.filename&&o.filename.indexOf("callstats")>-1){for(var n=!1,i={fileName:o.filename,line:o.lineno,col:o.colno,jsVersion:m.version,eventType:"error",message:o.message,pageURL:window.location.href},a=t.Registry.getConferenceManager().getConferenceIds(),c=0;c<a.length;c++)i.conferenceID=a[c],s.sendEvent(f.logEvents.error,i),n=!0;n||s.sendEvent(f.logEvents.error,i)}})};var t=S("./registry"),m=_(S("../config/settings")),f=_(S("../config/constants"))},{"../config/constants":33,"../config/settings":34,"./registry":95}],95:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.Registry=void 0;var _=function(){function Fe(xe,et){for(var tt=0;tt<et.length;tt++){var nt=et[tt];nt.enumerable=nt.enumerable||!1,nt.configurable=!0,"value"in nt&&(nt.writable=!0),Object.defineProperty(xe,nt.key,nt)}}return function(xe,et,tt){return et&&Fe(xe.prototype,et),tt&&Fe(xe,tt),xe}}(),t=S("../services/clocksync"),m=S("../services/configservice/configservicewrapper"),f=S("../services/authenticator"),o=S("../services/backendlog"),s=S("../services/transmissionmanager"),n=S("./eventmessagebuilder"),i=S("../conference/conferencemanager"),a=S("../utility/credentials"),c=S("../statspipeline/statsadapter"),u=S("../statspipeline/statsparser"),g=S("../statspipeline/statsmonitor"),h=S("../statspipeline/statstransmitter"),C=S("../statspipeline/statsassembler"),E=S("../utility/endpoint"),y=S("../browserapi/battery"),w=S("precalltest"),O=S("../statspipeline/wifistatsexecutor"),L=S("./callbacks"),I=S("../statspipeline/statscallbackbuilder"),k=S("../services/connectionmanager"),P=null,F=null,H=null,D=null,$=null,j=null,V=null,Y=null,Z=null,J=null,re=null,ce=null,Re=null,pe=null,Oe=null,te=null,oe=null,_e=null,we=null,Ee=null,De=function(){function Fe(){(function(xe,et){if(!(xe instanceof et))throw new TypeError("Cannot call a class as a function")})(this,Fe)}return _(Fe,null,[{key:"getConferenceManager",value:function(){return te||(te=new i.ConferenceManager),te}},{key:"getStatsCallbackBuilder",value:function(){return we||(we=new I.StatsCallbackBuilder),we}},{key:"getClockSync",value:function(){return F||(F=new t.ClockSync),F}},{key:"getWifiStatsExecutor",value:function(){return oe||(oe=new O.WifiStatsExecutor),oe}},{key:"getAuthenticator",value:function(){return H||(H=new f.Authenticator),H}},{key:"getConfigServiceWrapper",value:function(){return D||(D=new m.ConfigServiceWrapper),D}},{key:"getGenericEventHandler",value:function(){return $||($=new o.GenericEventHandler).enable(),$}},{key:"getConnectionManager",value:function(){return Ee||(Ee=new k.ConnectionManager),Ee}},{key:"getTransmissionManager",value:function(){return j||(j=new s.TransmissionManager),j}},{key:"getEventMessageBuilder",value:function(){return V||(V=new n.EventMessageBuilder),V}},{key:"getCredentials",value:function(){return Y||(Y=new a.Credentials),Y}},{key:"getEndpoint",value:function(){return Z||(Z=new E.Endpoint),Z}},{key:"getStatsAdapter",value:function(){if(!J){var xe=Fe.getEndpoint().getCodeBase(),et=Fe.getEndpoint().getBrowserName();J=new c.StatsAdapter(xe,et)}return J}},{key:"getPreCallTest",value:function(){return P||(P=new w.PreCallTest),P}},{key:"getStatsParser",value:function(){return re||(re=new u.StatsParser),re}},{key:"getStatsMonitor",value:function(){if(!ce){var xe=Fe.getEndpoint().getCodeBase();ce=new g.StatsMonitor(xe)}return ce}},{key:"getStatsTransmitter",value:function(){return Re||(Re=new h.StatsTransmitter),Re}},{key:"getStatsAssembler",value:function(){return pe||(pe=new C.StatsAssembler),pe}},{key:"getBattery",value:function(){return Oe||(Oe=new y.Battery),Oe}},{key:"getCallbacks",value:function(){return _e||(_e=new L.Callbacks),_e}}]),Fe}();b.Registry=De},{"../browserapi/battery":17,"../conference/conferencemanager":31,"../services/authenticator":44,"../services/backendlog":45,"../services/clocksync":46,"../services/configservice/configservicewrapper":50,"../services/connectionmanager":51,"../services/transmissionmanager":56,"../statspipeline/statsadapter":69,"../statspipeline/statsassembler":70,"../statspipeline/statscallbackbuilder":71,"../statspipeline/statsmonitor":72,"../statspipeline/statsparser":73,"../statspipeline/statstransmitter":74,"../statspipeline/wifistatsexecutor":84,"../utility/credentials":87,"../utility/endpoint":89,"./callbacks":86,"./eventmessagebuilder":91,precalltest:2}],96:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0});var _=function(){function o(s,n){for(var i=0;i<n.length;i++){var a=n[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(s,a.key,a)}}return function(s,n,i){return n&&o(s.prototype,n),i&&o(s,i),s}}();b.getRTTRegistry=function(){return m===null&&(m=new f),m};var t=function(o){if(o&&o.__esModule)return o;var s={};if(o!=null)for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(s[n]=o[n]);return s.default=o,s}(S("../statspipeline/validator")),m=null,f=function(){function o(){(function(s,n){if(!(s instanceof n))throw new TypeError("Cannot call a class as a function")})(this,o),this.rtts=new Map,this.frameRates=new Map,this.transportRTT=null}return _(o,[{key:"getFrameRateReceived",value:function(s){for(var n=null,i=["googFrameRateOutput","googFrameRateDecoded","googFrameRateReceived","googFrameRateSent","framerateMean","framesPerSecond"],a=0,c=i.length;a<c;a++){var u=i[a];if((n=s.stat(u))!==void 0)break}return n}},{key:"update",value:function(s){var n=this;s.getStats(function(i){for(var a=[],c=i.result(),u=0;u<c.length;++u){var g=c[u];if(g.type!=="googCandidatePair"){if(g.type==="ssrc"){var h=n.getFrameRateReceived(g),C=g.stat("googRtt"),E=g.stat("ssrc");C&&n.rtts.set(t.checkForNan(parseInt(E,10)),t.checkForNan(parseInt(C,10))),h&&n.frameRates.set(t.checkForNan(parseInt(E,10)),t.checkForNan(parseInt(h,10)))}}else{var y=g.stat("googRtt");a.push(y)}}n.transportRTT=Math.max.apply(Math,a)})}},{key:"getTransportRTT",value:function(){return this.transportRTT}},{key:"getRTT",value:function(s){var n=t.checkForNan(parseInt(s,10));return this.rtts.has(n)?this.rtts.get(n):null}},{key:"getFrameRate",value:function(s){var n=t.checkForNan(parseInt(s,10));return this.frameRates.has(n)?this.frameRates.get(n):null}}]),o}()},{"../statspipeline/validator":83}],97:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0});var _=function(){function m(f,o){for(var s=0;s<o.length;s++){var n=o[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(f,n.key,n)}}return function(f,o,s){return o&&m(f.prototype,o),s&&m(f,s),f}}(),t=function(){function m(f,o,s){(function(n,i){if(!(n instanceof i))throw new TypeError("Cannot call a class as a function")})(this,m),this.max=f,this.midpoint=o,this.stepness=s,this.actualStep=0,this.reset()}return _(m,[{key:"reset",value:function(){this.actualStep=0}},{key:"setMidpoint",value:function(f){this.midpoint=f}},{key:"setMax",value:function(f){this.max=f}},{key:"setStepness",value:function(f){this.stepness=f}},{key:"increaseActualStep",value:function(f){this.actualStep+=f}},{key:"getActual",value:function(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;return this.actualStep+=f,this.max/(1+Math.exp(-1*this.stepness*(this.actualStep-this.midpoint)))}}]),m}();b.Sigmoid=t},{}],98:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.TimeoutProcess=void 0;var _=function(){function f(o,s){for(var n=0;n<s.length;n++){var i=s[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(o,i.key,i)}}return function(o,s,n){return s&&f(o.prototype,s),n&&f(o,n),o}}(),t=function(f){if(f&&f.__esModule)return f;var o={};if(f!=null)for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(o[s]=f[s]);return o.default=f,o}(S("./csiologger")),m=function(){function f(o){(function(s,n){if(!(s instanceof n))throw new TypeError("Cannot call a class as a function")})(this,f),this.interval=o,this.timerId=null,this.callback=function(){t.warn("no callback function set",this)}}return _(f,[{key:"setCallback",value:function(o){this.callback=o}},{key:"start",value:function(){var o=this;this.timerId=setInterval(function(){o.callback()},this.interval)}},{key:"stop",value:function(){clearInterval(this.timerId),this.timerId=null}},{key:"isStarted",value:function(){return this.timerId!==null}}]),f}();b.TimeoutProcess=m},{"./csiologger":88}],99:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.getCurrent=function(){return window&&window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now()},b.getSinceOrigin=function(){return window&&window.performance&&window.performance.now?window.performance.now():null}},{}],100:[function(S,p,b){function _(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},m=function(){function o(s,n){for(var i=0;i<n.length;i++){var a=n[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(s,a.key,a)}}return function(s,n,i){return n&&o(s.prototype,n),i&&o(s,i),s}}(),f=function(){function o(s){_(this,o),this.base=s;for(var n=arguments.length,i=Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];this.appendixes=i}return m(o,null,[{key:"concat",value:function(s,n){if(!n)return s;if(!s)return n;var i=s.substr(s.length-1)==="/",a=n.substring(0,1)==="/";return i||a?i&&a?s+n.substring(1):s+n:s+"/"+n}}]),m(o,[{key:"append",value:function(s){this.appendixes.push(s)}},{key:"toString",value:function(){var s=this.getString(this.base),n=this;return this.appendixes.forEach(function(i){if(i!=null){var a=n.getString(i);s=o.concat(s,a)}}),s}},{key:"getString",value:function(s){switch(s===void 0?"undefined":t(s)){case"function":return this.getString(s());case"number":return s+"";case"string":default:return s}}}]),o}();b.Url=f},{}],101:[function(S,p,b){Object.defineProperty(b,"__esModule",{value:!0}),b.normalizeMediaDeviceList=function(_){var t=[];if(!_)return t;for(var m=0;m<_.length;m++){var f={};f.mediaDeviceID=_[m].deviceId,f.groupID=_[m].groupId,f.kind=_[m].kind,f.label=_[m].label,t.push(f)}return t},b.isIntegerPollyfill=function(){Number.isInteger||(Number.isInteger=Number.isInteger||function(_){return typeof _=="number"&&isFinite(_)&&Math.floor(_)===_})},b.assignPollyfill=function(){typeof Object.assign!="function"&&Object.defineProperty(Object,"assign",{value:function(_,t){if(_==null)throw new TypeError("Cannot convert undefined or null to object");for(var m=Object(_),f=1;f<arguments.length;f++){var o=arguments[f];if(o!=null)for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(m[s]=o[s])}return m},writable:!0,configurable:!0})}},{}]},{},[22])}).call(this,K("./node_modules/webpack/buildin/global.js"))},"./lib/stats/httpRequest.ts":function(Se,U,K){var G=this&&this.__createBinding||(Object.create?function(b,_,t,m){m===void 0&&(m=t),Object.defineProperty(b,m,{enumerable:!0,get:function(){return _[t]}})}:function(b,_,t,m){m===void 0&&(m=t),b[m]=_[t]}),q=this&&this.__setModuleDefault||(Object.create?function(b,_){Object.defineProperty(b,"default",{enumerable:!0,value:_})}:function(b,_){b.default=_}),x=this&&this.__importStar||function(b){if(b&&b.__esModule)return b;var _={};if(b!=null)for(var t in b)t!=="default"&&Object.prototype.hasOwnProperty.call(b,t)&&G(_,b,t);return q(_,b),_};Object.defineProperty(U,"__esModule",{value:!0}),U.fetchIPAddress=U.uploadConsoleLogsToBucket=U.getPreSignedS3URL=U.validateCallStats=void 0;const N=x(K("./node_modules/plivo-jssip/dist/plivo-jssip.min.js")),S=x(K("./lib/constants.ts")),p={log:K("./lib/logger.ts").Logger};U.validateCallStats=function(b,_,t){return new Promise((m,f)=>{let o,s,n=b;b.toLowerCase().startsWith("sip:")&&(n=b.split(":")[1]),o=t?new URL(S.STATS_API_URL_ACCESS_TOKEN):new URL(S.STATS_API_URL),s=t?Object.assign({jwt:_},n.includes("puser")&&{from:n}):{username:n,password:_,domain:S.DOMAIN};const i={method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(s)};fetch(o,i).then(a=>{a.ok?a.text().then(c=>{if(c){const u=JSON.parse(c);p.log.info(`${S.LOGCAT.LOGIN} | Call Stats key generated - `,u.data),m(u)}else p.log.info("Call insights is not enabled"),f("Call insights is not enabled")}):(p.log.info(`${S.LOGCAT.LOGIN} | Call Stats key generation failed - `,a),f("Incorrect response code"))}).catch(a=>{p.log.error(`${S.LOGCAT.LOGIN} | Error in getting token from call stats`,a.message),f(a)})})},U.getPreSignedS3URL=(b,_)=>{let t,m;_?(t=new URL(S.S3BUCKET_API_URL_JWT),m=Object.assign({jwt:b.accessToken,call_uuid:b.calluuid},b.username.includes("puser")&&{from:b.username})):(t=new URL(S.S3BUCKET_API_URL),m=b);const f={method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(m)};return new Promise((o,s)=>{fetch(t,f).then(n=>{n.ok?n.text().then(i=>{if(!i)return p.log.error("Response is not valid"),void s("Response is not valid");o(JSON.parse(i))}).catch(i=>{p.log.error("Did not get s3 url to upload",i),s("Did not get s3 url to upload")}):(p.log.error("WS API server did not return the presigned S3 Url for uploading call logs"),s("Bad response from server"))}).catch(n=>{p.log.error("WS API server did not return the presigned S3 Url for uploading call logs",n),s("API server did not return the presigned S3 Url for uploading call logs")})})},U.uploadConsoleLogsToBucket=function(b,_){return new Promise((t,m)=>{const f=new URL(b.data),o=p.log.consolelogs(),s=[];_&&s.push(`${JSON.stringify(_)} 
`),s.push(o);const n=new Blob(s,{type:"text/plain;charset=utf-8"}),i=new Headers;i.append("Content-Type","text/plain"),fetch(f,{method:"PUT",headers:i,body:n}).then(()=>{p.log.info("Log file uploaded to server"),t("done")}).catch(a=>{p.log.error(`${S.LOGCAT.CALL_QUALITY} | Log file was not uploaded to server`,a.message),m("Log file was not uploaded to server")})})},U.fetchIPAddress=b=>new Promise(_=>{const t=new N.Message(b.phone);t.on("succeeded",m=>{m.response&&m.response.body?_(m.response.body):_(new Error("couldn't retrieve ipaddress"))}),t.on("failed",()=>{_(new Error("couldn't retrieve ipaddress"))}),t.send("admin","ipAddress","MESSAGE")})},"./lib/stats/mediaMetrics.ts":function(Se,U,K){var G=this&&this.__createBinding||(Object.create?function(o,s,n,i){i===void 0&&(i=n),Object.defineProperty(o,i,{enumerable:!0,get:function(){return s[n]}})}:function(o,s,n,i){i===void 0&&(i=n),o[i]=s[n]}),q=this&&this.__setModuleDefault||(Object.create?function(o,s){Object.defineProperty(o,"default",{enumerable:!0,value:s})}:function(o,s){o.default=s}),x=this&&this.__importStar||function(o){if(o&&o.__esModule)return o;var s={};if(o!=null)for(var n in o)n!=="default"&&Object.prototype.hasOwnProperty.call(o,n)&&G(s,o,n);return q(s,o),s};Object.defineProperty(U,"__esModule",{value:!0}),U.processStreams=U.emitMetrics=void 0;const N=K("./lib/logger.ts"),S=x(K("./lib/constants.ts")),p={log:N.Logger};U.emitMetrics=function(o,s,n,i,a,c,u){const g=this;if(this.options.enableQualityTracking===S.DEFAULT_ENABLE_QUALITY_TRACKING&&this.options.enableTracking||this.options.enableQualityTracking===S.LOCALONLY){const h={group:o,level:s,type:n,value:i,active:a,desc:c||"",stream:u};g.emit("mediaMetrics",h)}};const b=function(o,s,n,i){const a=this,c=a.storage?a.storage[o]:[];if(c.length===2){c.push(Number(s));const u={};let g=null;c.forEach(h=>{u[h]=u[h]+1||1}),Object.keys(u).forEach(h=>{u[h]>=2&&(g=Number(h))}),typeof g=="number"&&a.storage?(a.storage.warning[o]=!0,g>1?p.log.debug(`Same audio level detected for ${o} : `,JSON.stringify(c)):p.log.debug(`${S.LOGCAT.CALL} | Audio mute detected for ${o} : `,JSON.stringify(c)),i&&o==="local_audio"||U.emitMetrics.call(a,"audio","warning","no_audio_received",g,!0,o,n)):a.storage&&a.storage.warning[o]&&(a.storage.warning[o]=!1,U.emitMetrics.call(a,"audio","warning","no_audio_received",0,!1,o,n))}else c.push(Number(s));c.length===3&&c.splice(0,2)},_=function(o,s){const n=Number(s),i=this,a=i.storage?i.storage[o]:[];if(a.length===2){a.push(n);const c=a.filter(u=>u>400);if(c.length>=2){const u=(c.reduce((g,h)=>g+h)/c.length).toFixed(2);i.storage&&(i.storage.warning[o]=!0),p.log.debug(`${S.LOGCAT.CALL} | ${o} : getting high rtt  : `,JSON.stringify(c)),U.emitMetrics.call(i,"network","warning","high_rtt",u,!0,"high latency","None")}else i.storage&&i.storage.warning[o]&&(i.storage.warning[o]=!1,U.emitMetrics.call(i,"network","warning","high_rtt",0,!1,"high latency","None"))}else a.push(n);a.length===3&&a.splice(0,2)},t=function(o,s,n){const i=Number(s),a=this,c=a.storage?a.storage[o]:[];if(c.length===2){c.push(i);const u=c.filter(g=>g>30);if(u.length>=2){const g=u.reduce((h,C)=>h+C)/u.length;a.storage&&(a.storage.warning[o]=!0),p.log.debug(`${S.LOGCAT.CALL} | ${o} : getting high jitter rate : `,JSON.stringify(u)),U.emitMetrics.call(a,"network","warning","high_jitter",g,!0,o,n)}else a.storage&&a.storage.warning[o]&&(a.storage.warning[o]=!1,U.emitMetrics.call(a,"network","warning","high_jitter",0,!1,o,n))}else c.push(i);c.length===3&&c.splice(0,2)},m=function(o,s){const n=this,i=n.storage?n.storage[o]:[];if(i.length===2){i.push(s);const a=i.filter(c=>c<3.5);a.length>=2?(n.storage&&(n.storage.warning[o]=!0),p.log.debug(`${S.LOGCAT.CALL} | ${o} : getting low mos : `,JSON.stringify(i)),U.emitMetrics.call(n,"network","warning","low_mos",a[0],!0,o,"None")):n.storage&&n.storage.warning[o]&&(n.storage.warning[o]=!1,U.emitMetrics.call(n,"network","warning","low_mos",0,!1,o,"None"))}else i.push(s);i.length===3&&i.splice(0,2)},f=function(o,s,n){const i=Number(s),a=this,c=a.storage?a.storage[o]:[];if(c.length===2){c.push(i);const u=c.filter(g=>a.storage&&a.storage.audioCodec==="opus"?g>=.1:g>=.02);if(u.length>=2){let g=u.reduce((h,C)=>h+C)/u.length;g=parseFloat(g.toFixed(3)),a.storage&&(a.storage.warning[o]=!0),p.log.debug(`${S.LOGCAT.CALL} |
        ${o} : packet loss value is high :`,JSON.stringify(u)),U.emitMetrics.call(a,"network","warning","high_packetloss",g,!0,o,n)}else a.storage&&a.storage.warning[o]&&(a.storage.warning[o]=!1,U.emitMetrics.call(a,"network","warning","high_packetloss",0,!1,o,n))}else c.push(i);c.length===3&&c.splice(0,2)};U.processStreams=function(o,s){const n=this;n.storage&&n.storage.startAnalysis&&(o.local&&(_.call(n,"rtt",o.local.rtt),t.call(n,"jitterLocalMeasures",o.local.jitter,"local"),m.call(n,"mosRemoteMeasures",o.local.mos),f.call(n,"packetLossLocalMeasures",o.local.fractionLoss,"local"),b.call(n,"local_audio",o.local.audioLevel,"local",s)),o.remote&&(t.call(n,"jitterRemoteMeasures",o.remote.jitter,"remote"),f.call(n,"packetLossRemoteMeasures",o.remote.fractionLoss,"remote"),b.call(n,"remote_audio",o.remote.audioLevel,"remote",s)))}},"./lib/stats/nonRTPStats.ts":function(Se,U,K){var G=this&&this.__createBinding||(Object.create?function(f,o,s,n){n===void 0&&(n=s),Object.defineProperty(f,n,{enumerable:!0,get:function(){return o[s]}})}:function(f,o,s,n){n===void 0&&(n=s),f[n]=o[s]}),q=this&&this.__setModuleDefault||(Object.create?function(f,o){Object.defineProperty(f,"default",{enumerable:!0,value:o})}:function(f,o){f.default=o}),x=this&&this.__importStar||function(f){if(f&&f.__esModule)return f;var o={};if(f!=null)for(var s in f)s!=="default"&&Object.prototype.hasOwnProperty.call(f,s)&&G(o,f,s);return q(o,f),o},N=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(U,"__esModule",{value:!0}),U.onToggleMute=U.onSDPfailure=U.onMediaFailure=U.onIceFailure=U.signallingEvent=U.sendFeedbackEvent=U.sendCallRingingEvent=U.sendCallSummaryEvent=U.sendCallAnsweredEvent=U.AppError=U.sendEvents=U.addCallInfo=void 0;const S=N(K("./package.json")),p=x(K("./lib/utils/device.ts")),b=K("./lib/logger.ts"),_=x(K("./lib/constants.ts")),t=N(K("./lib/utils/browserDetection.ts")),m={log:b.Logger};U.addCallInfo=function(f,o,s,n){const i=o;return i.callstats_key=s,i.callUUID=f.sipCallID,i.corelationId=f.sipCallID,i.xcallUUID=f.callUUID,i.timeStamp=Date.now(),i.userName=n,i.domain=_.DOMAIN,i.source=_.STATS_SOURCE,i.version=_.STATS_VERSION,i},U.sendEvents=function(f,o){const s=this;if(s.statsSocket&&s.callstatskey&&o&&o.sipCallID){const n=U.addCallInfo(o,f,s.callstatskey,s.userName);s.statsSocket.send(n,s),s.isUnregisterPending===!0&&(s.isUnregisterPending=!1,s.phone&&s.phone.stop(),s.deferFeedback=!0,s.statsSocket.disconnect(),s.statsSocket=null),f.msg==="CALL_SUMMARY"&&s.isAccessToken&&!s.isLoggedIn&&(s.emit("onLogout","ACCESS_TOKEN_EXPIRED"),s.logout())}else m.log.debug(`${_.LOGCAT.CALL} | Cannot send event `,f.msg," mandatory parameters (statsSocket, sipCallID, callstatskey) not defined ")},U.AppError=function(f,o){const s=this;if(s.userName&&s.callStats){const n=(s._currentSession?s._currentSession.callUUID:null)||s.userName;Object.prototype.toString.call(f)==="[object Object]"&&(f=JSON.stringify(f)),o&&m.log.debug(`Call summary ${n}
`,f),s.callStats.reportError(null,n,s.callStats.webRTCFunctions.applicationLog,f)}return!0},U.sendCallAnsweredEvent=function(f,o){var s;const n=this;if(!n.callstatskey)return;const i=p.getClientVersion(),a=p.getSDKVersion(),c=p.getOS(),u={msg:"CALL_ANSWERED",info:"Outgoing call answered",clientName:t.default().browser,userAgent:navigator.userAgent,clientVersionMajor:i.major||i[0]||"0",clientVersionMinor:i.minor||i[1]||"0",clientVersionPatch:i.patch||i[2]||"0",sdkName:S.default.name,sdkVersionMajor:a.major,sdkVersionMinor:a.minor,sdkVersionPatch:a.patch,devicePlatform:navigator.platform,deviceOs:c,noiseReduction:{enabled:(s=n.enableNoiseReduction)!==null&&s!==void 0&&s,noiseSuprressionStarted:n.noiseSuppresion.started},setupOptions:n.options};f&&(u.audioDeviceInfo=f),o&&(u.info="Incoming call answered"),U.sendEvents.call(n,u,n._currentSession)},U.sendCallSummaryEvent=function(f,o,s,n){var i;const a=this;if(!a.callstatskey)return;const c=p.getClientVersion(),u=p.getSDKVersion(),g=p.getOS(),h={msg:"CALL_SUMMARY",signalling:o,mediaConnection:s,clientName:t.default().browser,userAgent:navigator.userAgent,clientVersionMajor:c.major||c[0]||"0",clientVersionMinor:c.minor||c[1]||"0",clientVersionPatch:c.patch||c[2]||"0",sdkName:S.default.name,sdkVersionMajor:u.major,sdkVersionMinor:u.minor,sdkVersionPatch:u.patch,devicePlatform:navigator.platform,deviceOs:g,setupOptions:a.options,noiseReduction:{enabled:(i=a.enableNoiseReduction)!==null&&i!==void 0&&i,noiseSuprressionStarted:a.noiseSuppresion.started},isAudioDeviceToggled:a.deviceToggledInCurrentSession,isNetworkChanged:a.networkChangeInCurrentSession,jsFramework:a.jsFramework};f&&(h.audioDeviceInfo=f),U.sendEvents.call(a,h,n)},U.sendCallRingingEvent=function(f,o,s,n){var i;const a=this;if(!a.callstatskey)return;const c=p.getClientVersion(),u=p.getSDKVersion(),g=p.getOS(),h={msg:"CALL_RINGING",signalling:o,mediaConnection:s,clientName:t.default().browser,userAgent:navigator.userAgent,clientVersionMajor:c.major||c[0]||"0",clientVersionMinor:c.minor||c[1]||"0",clientVersionPatch:c.patch||c[2]||"0",sdkName:S.default.name,sdkVersionMajor:u.major,sdkVersionMinor:u.minor,sdkVersionPatch:u.patch,devicePlatform:navigator.platform,deviceOs:g,setupOptions:a.options,noiseReduction:{enabled:(i=a.enableNoiseReduction)!==null&&i!==void 0&&i,noiseSuprressionStarted:a.noiseSuppresion.started},isAudioDeviceToggled:a.deviceToggledInCurrentSession,isNetworkChanged:a.networkChangeInCurrentSession,jsFramework:a.jsFramework};f&&(h.audioDeviceInfo=f),U.sendEvents.call(a,h,n)},U.sendFeedbackEvent=function(f,o){const s=this;if(f.callUUID&&s.callstatskey){const n={msg:"FEEDBACK",info:o};n.sdkVersion=S.default.version,U.sendEvents.call(s,n,f)}},U.signallingEvent=function(f){return _.SIP_ERROR_CODE[f]},U.onIceFailure=function(f,o){const s=this;if(f.callUUID&&s.callstatskey){const n={msg:"ICE_FAILURE",error:o.message};U.sendEvents.call(s,n,f)}},U.onMediaFailure=function(f,o){const s=this;if(f.callUUID&&s.callstatskey){const n={msg:"MEDIA_FAILURE",error:o.message};U.sendEvents.call(s,n,f)}},U.onSDPfailure=function(f,o){const s=this;if(f.callUUID&&s.callstatskey){const n={msg:"SDP_FAILURE",error:o.message};U.sendEvents.call(s,n,f)}},U.onToggleMute=function(f,o){const s=this;if(s.callstatskey){const n={msg:"TOGGLE_MUTE",action:o};U.sendEvents.call(s,n,f)}}},"./lib/stats/rtpStats.ts":function(Se,U,K){var G=this&&this.__createBinding||(Object.create?function(y,w,O,L){L===void 0&&(L=O),Object.defineProperty(y,L,{enumerable:!0,get:function(){return w[O]}})}:function(y,w,O,L){L===void 0&&(L=O),y[L]=w[O]}),q=this&&this.__setModuleDefault||(Object.create?function(y,w){Object.defineProperty(y,"default",{enumerable:!0,value:w})}:function(y,w){y.default=w}),x=this&&this.__importStar||function(y){if(y&&y.__esModule)return y;var w={};if(y!=null)for(var O in y)O!=="default"&&Object.prototype.hasOwnProperty.call(y,O)&&G(w,y,O);return q(w,y),w},N=this&&this.__awaiter||function(y,w,O,L){return new(O||(O=Promise))(function(I,k){function P(D){try{H(L.next(D))}catch($){k($)}}function F(D){try{H(L.throw(D))}catch($){k($)}}function H(D){var $;D.done?I(D.value):($=D.value,$ instanceof O?$:new O(function(j){j($)})).then(P,F)}H((L=L.apply(y,w||[])).next())})};Object.defineProperty(U,"__esModule",{value:!0}),U.GetRTPStats=U.handleWebRTCStats=void 0;const S=x(K("./lib/constants.ts")),p=K("./lib/media/audioLevel.ts"),b=K("./lib/stats/mediaMetrics.ts"),_={log:K("./lib/logger.ts").Logger},t=function(y,w){return y!=null&&!isNaN(y)||w!=null&&!isNaN(w)?y==null||isNaN(y)?w:w==null||isNaN(w)?y:y+w:null},m=function(){const y=this;y.audioTimer=setInterval(()=>{y.senderMediaStream&&y.senderMediaStream.active===!1&&(y.senderMediaStream.getTracks().forEach(w=>w.stop()),y.senderMediaStream=null,navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(w=>w).then(w=>{y.senderMediaStream=w,y.localAudioLevelHelper=new p.AudioLevel(y.senderMediaStream)}).catch(w=>{this.clientScope.emit("onMediaPermission",{status:"failure",error:w.message})})),y.clientScope.isCallMuted||(y.audioInputLevel=t(y.audioInputLevel,y.localAudioLevelHelper.getAudioLevel()),y.audioInputCount+=1),y.audioOutputLevel=t(y.audioOutputLevel,y.remoteAudioLevelHelper.getAudioLevel()),y.audioOutputCount+=1},S.AUDIO_INTERVAL)},f=function(){const y=this;y.audioInputLevel=null,y.audioOutputLevel=null,y.audioInputCount=0,y.audioOutputCount=0},o=function(y,w="int",O=y,L=!1){let I;return y==null||isNaN(y)?(I=L?O:y,I):(I=Number(w==="int"?y:Number(y).toFixed(3)),I)},s=function(y){return y==null||isNaN(y)?null:y};function n(y){this.packets.prePacketsReceived=o(s(y.remote.packetsReceived)),this.packets.prePacketsSent=o(s(y.local.packetsSent)),this.packets.preRemotePacketsLoss=o(s(y.remote.packetsLost)),this.packets.preLocalPacketsLoss=o(s(y.local.packetsLost))}const i=function(y,w,O,L,I){const k=this;let P=0,F=0;const H=k.storage.audioCodec==="opus"?95:93.2;let D;P=O+2*L+10,F=P<160?H-P/40:H-(P-120)/10,F-=100*I*2.5,F<=0?D=1:F<100?(D=1+.035*F+7e-6*F*(F-60)*(100-F),D=parseFloat(D.toFixed(3))):D=4.5,y.push(D),_.log.debug(`mos ${w}`,D),w==="mosLocalMeasures"&&(k.collected.local.mos=Number(D)||0),w==="mosRemoteMeasures"&&(k.collected.local.mos=Math.min(Number(D)||0,k.collected.local.mos))},a=function(y,w,O,L){const I=this,k=I.storage[y];s(O)!=null&&s(L)!=null&&Number(w||0)!==0?(I.clientScope.browserDetails.browser==="firefox"&&(w=1e3*Number(w),O=1e3*Number(O)),k.length===2?(i.call(I,k,y,w,O,L),k.filter(P=>P<3).length>=2?I.storage.warning[y]=!0:I.storage.warning[y]&&(I.storage.warning[y]=!1)):i.call(I,k,y,w,O,L),k.length===3&&k.splice(0,2)):I.collected.local.mos=null},c=function(y){const w=this;if(!w.baseStatsCollected){const P=o(y.local.packetsLost),F=o(y.remote.packetsLost),H=o(y.local.packetsSent),D=o(y.remote.packetsReceived)+F;return w.collected.local.fractionLoss=P===0&&H===0?0:H===0?1:o(P/H,"float"),w.collected.remote.fractionLoss=F===0&&D===0?0:D===0?1:o(F/D,"float"),n.call(w,y),void(w.baseStatsCollected=!0)}const O=o(y.local.packetsLost)-w.packets.preLocalPacketsLoss,L=o(y.local.packetsSent)-w.packets.prePacketsSent;w.collected.local.fractionLoss=O===0&&L===0?0:L===0?1:o(O/L,"float");const I=o(y.remote.packetsLost)-w.packets.preRemotePacketsLoss,k=o(y.remote.packetsReceived)-w.packets.prePacketsReceived+I;w.collected.remote.fractionLoss=I===0&&k===0?0:k===0?1:o(I/k,"float"),a.call(w,"mosLocalMeasures",w.collected.local.rtt,w.collected.local.jitter,w.collected.local.fractionLoss),a.call(w,"mosRemoteMeasures",w.collected.local.rtt,w.collected.remote.jitter,w.collected.remote.fractionLoss),n.call(w,y)},u=function(y){const w=this;w.statsSocket&&w.callstatskey&&w._currentSession&&w.rtp_enabled&&(this.options.enableQualityTracking===S.DEFAULT_ENABLE_QUALITY_TRACKING&&this.options.enableTracking||this.options.enableQualityTracking===S.REMOTEONLY)&&(w.statsSocket.send(y,w),window._PlivoDevLogging&&_.log.info(y)),w._currentSession&&w._currentSession.session&&w.browserDetails.browser==="chrome"&&(this.options.enableQualityTracking===S.DEFAULT_ENABLE_QUALITY_TRACKING&&this.options.enableTracking||this.options.enableQualityTracking===S.LOCALONLY)&&b.processStreams.call(w,y,w._currentSession.session.isMuted().audio)},g=function(y){const w=this;w.statsSocket&&w.callstatskey&&w.rtp_enabled&&(_.log.debug(`${S.LOGCAT.CALL} | Sending CALL_STATS_DUMP Event`),w.statsSocket.send(y,w))},h=function(y){const w=this;var O;w.collected={msg:"CALL_STATS",callstats_key:w.callstatskey,local:{},remote:{},codec:y.codec,xcallUUID:w.xcallUUID,callUUID:w.callUUID,corelationId:w.corelationId,userName:w.userName,timeStamp:Date.now(),domain:S.DOMAIN,source:S.STATS_SOURCE,version:S.STATS_VERSION,networkType:y.networkType||"unknown",networkEffectiveType:navigator.connection?navigator.connection.effectiveType:"unknown",networkDownlinkSpeed:navigator.connection?navigator.connection.downlink:-1,statsIOUsed:w.statsioused,pdd:w.clientScope.timeTakenForStats.pdd?w.clientScope.timeTakenForStats.pdd.end-w.clientScope.timeTakenForStats.pdd.init:0,mediaSetupTime:(O=w.clientScope,O.timeTakenForStats.mediaSetup?O.timeTakenForStats.mediaSetup.end-O.timeTakenForStats.mediaSetup.init:0)},w.collected.local.audioLevel=o(y.local.audioInputLevel,"int",-100,!0),w.collected.remote.audioLevel=o(y.remote.audioOutputLevel,"int",-100,!0),w.collected.remote.jitterBufferDelay=o(y.remote.jitterBufferDelay,"int",null,!0),w.collected.local.googEchoCancellationReturnLoss=o(y.local.googEchoCancellationReturnLoss,"int",null,!0),w.collected.local.googEchoCancellationReturnLossEnhancement=o(y.local.googEchoCancellationReturnLossEnhancement,"int",null,!0),w.collected.remote.googJitterBufferMs=o(y.remote.googJitterBufferMs,"int",null,!0),w.collected.remote.packetsDiscarded=o(y.remote.packetsDiscarded,"int",null,!0),w.clientScope.browserDetails.browser==="chrome"||this.clientScope.browserDetails.browser==="edge"?(w.collected.local.rtt=o(y.local.googRtt,"float"),w.collected.local.jitter=o(y.local.jitter,"float"),w.collected.remote.jitter=o(y.remote.jitter,"float")):w.clientScope.browserDetails.browser!=="firefox"&&w.clientScope.browserDetails.browser!=="safari"||(w.collected.local.rtt=o(y.local.rtt,"float"),w.collected.local.jitter=o(y.local.jitter,"float"),w.collected.remote.jitter=o(y.remote.jitter,"float")),w.collected.remote.packetsReceived=o(y.remote.packetsReceived),w.collected.local.packetsSent=o(y.local.packetsSent),w.collected.remote.bytesReceived=o(y.remote.bytesReceived),w.collected.local.bytesSent=o(y.local.bytesSent),w.collected.remote.packetsLost=o(y.remote.packetsLost),w.collected.local.packetsLost=o(y.local.packetsLost),w.collected.remote.ssrc=o(y.remote.ssrc),w.collected.local.ssrc=o(y.local.ssrc),c.call(w,y),u.call(w.clientScope,w.collected)},C=function(){try{return this.pc.remoteDescription.sdp.match(/rtpmap:.*/)[0].split(" ")[1].split("/")[0]}catch(y){return _.log.debug("Error fetching codec from remote description message",y),""}};U.handleWebRTCStats=function(y){y.codec=C.call(this);const w=this.pc.getSenders();w&&(this.rtpsender=w[0].getStats(),this.rtpsender.then(O=>{Array.from(O.values()).forEach(I=>{if(I.type==="outbound-rtp"&&(y.local.rtt=I.rtt==null||isNaN(I.rtt)?y.local.rtt:I.rtt,y.local.jitter=I.jitter==null||isNaN(I.jitter)?y.local.jitter:I.jitter,y.local.packetsSent=I.packetsSent==null||isNaN(I.packetsSent)?y.local.packetsSent:I.packetsSent,y.local.packetsLost=I.packetsLost==null||isNaN(I.packetsLost)?y.local.packetsLost:I.packetsLost,y.local.bytesSent=I.bytesSent==null||isNaN(I.bytesSent)?y.local.bytesSent:I.bytesSent,y.local.ssrc=I.ssrc==null||isNaN(I.ssrc)?y.local.ssrc:I.ssrc),I.type==="remote-inbound-rtp"){const F=I;y.local.googRtt=F.roundTripTime==null||isNaN(F.roundTripTime)?y.local.googRtt:Math.round(1e3*F.roundTripTime),y.local.rtt=F.roundTripTime==null||isNaN(F.roundTripTime)?y.local.rtt:F.roundTripTime,y.local.jitter=F.jitter==null||isNaN(F.jitter)?y.local.jitter:F.jitter,y.local.packetsLost=F.packetsLost==null||isNaN(F.packetsLost)?y.local.packetsLost:F.packetsLost}if(I.type!=="candidate-pair"||y.local.rtt!=null&&!isNaN(y.local.rtt)||(y.local.rtt=I.currentRoundTripTime),I.type==="local-candidate"){y.networkType=I.networkType;const F={id:I.id,address:I.address,port:I.port,relatedAddress:I.relatedAddress,relatedPort:I.relatedPort};if(this.localCandidateInfo)if(Object.keys(this.localCandidateInfo).length===0)this.localCandidateInfo[I.timestamp]=F;else try{(k=this.localCandidateInfo,P=I.id,new Promise(H=>{let D=!1;Object.keys(k).forEach($=>{k[$].id===P&&(D=!0)}),H(D)})).then(H=>{H===!1&&(_.log.debug(`${S.LOGCAT.CALL} | Local Candidate Info Change`),this.localCandidateInfo[I.timestamp]=F)})}catch(H){_.log.debug(`${S.LOGCAT.CALL} | Error in getStats LocalStreams API during Local Candidate Info Check `,H.message)}}var k,P;I.type==="media-source"&&this.clientScope.browserDetails.browser==="chrome"&&(y.local.googEchoCancellationReturnLoss=Math.floor(I.echoReturnLoss),y.local.googEchoCancellationReturnLossEnhancement=Math.floor(I.echoReturnLossEnhancement))}),this.rtpreceiver=this.pc.getReceivers()[0].getStats();let L=0;this.pc.getReceivers()[0].getStats().then(I=>{Array.from(I.values()).forEach(k=>{k.type==="media-playout"&&(L=k.totalPlayoutDelay),k.type==="inbound-rtp"&&(y.remote=k,y.local.audioInputLevel=this.audioInputLevel/this.audioInputCount,y.remote.audioOutputLevel=this.audioOutputLevel/this.audioOutputCount,y.remote.jitterBufferDelay=Math.floor((k.jitterBufferDelay+L)/1e4),y.remote.googJitterBufferMs=Math.floor(k.jitterBufferDelay/k.jitterBufferEmittedCount*1e3),f.call(this),this.clientScope.browserDetails.browser==="safari"&&(y=function(P){return P.local.rtt=P.local.rtt==null?null:1e3*Number(P.local.rtt),P.local.jitter=P.local.jitter==null?null:1e3*Number(P.local.jitter),P.remote.jitter=P.remote.jitter==null?null:1e3*Number(P.remote.jitter),P}(y)),this.clientScope.browserDetails.browser!=="chrome"&&this.clientScope.browserDetails.browser!=="edge"||(y.remote.jitter=k.jitter==null?null:Math.floor(1e3*k.jitter),y.local.jitter=y.local.jitter==null?null:Math.floor(1e3*y.local.jitter)),h.call(this,y))})}).catch(I=>{_.log.debug(`${S.LOGCAT.CALL} | Error in getStats RemoteStreams API `,I.message)})}).catch(O=>{_.log.debug(`${S.LOGCAT.CALL} | Error in getStats LocalStreams API `,O.message)}))};const E=function(){const y=this;y.statsTimer=setInterval(()=>{const w={codec:"",local:{},remote:{},networkType:""};y.clientScope.browserDetails.browser==="chrome"||y.clientScope.browserDetails.browser==="edge"||y.clientScope.browserDetails.browser==="firefox"||y.clientScope.browserDetails.browser==="safari"?U.handleWebRTCStats.call(y,w):_.log.error(`${S.LOGCAT.LOGIN} | Plivo Browser SDK is not supported in ${y.clientScope.browserDetails.browser}`)},S.GETSTATS_INTERVAL)};U.GetRTPStats=class{constructor(y){if(this.localCandidateInfo={},this.sendCallStatsDump=function(w){return new Promise((O,L)=>{const I=this.rtpsender;I&&I.then(P=>{Array.from(P.values()).forEach(F=>{F.type==="local-candidate"&&(w.localCandidate.id=F.id,w.localCandidate.address=F.address,w.localCandidate.port=F.port,w.localCandidate.relatedAddress=F.relatedAddress,w.localCandidate.relatedPort=F.relatedPort,w.localCandidate.candidateType=F.candidateType,w.localCandidate.usernameFragment=F.usernameFragment),F.type==="remote-candidate"&&(w.remoteCandidate.id=F.id,w.remoteCandidate.address=F.address,w.remoteCandidate.port=F.port,w.remoteCandidate.candidateType=F.candidateType,w.remoteCandidate.usernameFragment=F.usernameFragment),F.type==="transport"&&(w.transport.id=F.id,w.transport.dtlsRole=F.dtlsRole,w.transport.dtlsState=F.dtlsState,w.transport.iceRole=F.iceRole,w.transport.iceState=F.iceState,w.transport.packetsReceived=F.packetsReceived,w.transport.packetsSent=F.packetsSent,w.transport.selectedCandidatePairChanges=F.selectedCandidatePairChanges,w.transport.selectedCandidatePairId=F.selectedCandidatePairId),F.type==="candidate-pair"&&(w.candidatePair.id=F.id,w.candidatePair.availableOutgoingBitrate=F.availableOutgoingBitrate,w.candidatePair.consentRequestsSent=F.consentRequestsSent,w.candidatePair.lastPacketReceivedTimestamp=F.lastPacketReceivedTimestamp,w.candidatePair.lastPacketSentTimestamp=F.lastPacketSentTimestamp,w.candidatePair.localCandidateId=F.localCandidateId,w.candidatePair.remoteCandidateId=F.remoteCandidateId,w.candidatePair.nominated=F.nominated,w.candidatePair.packetsDiscardedOnSend=F.packetsDiscardedOnSend,w.candidatePair.packetsReceived=F.packetsReceived,w.candidatePair.packetsSent=F.packetsSent,w.candidatePair.requestsReceived=F.requestsReceived,w.candidatePair.requestsSent=F.requestsSent,w.candidatePair.responsesReceived=F.responsesReceived,w.candidatePair.responsesSent=F.responsesSent,w.candidatePair.state=F.state,w.candidatePair.transportId=F.transportId,w.candidatePair.writable=F.writable),F.type==="outbound-rtp"&&(w.outboundRTP.bytesSent=F.bytesSent,w.outboundRTP.packetsSent=F.packetsSent,w.outboundRTP.retransmittedBytesSent=F.retransmittedBytesSent,w.outboundRTP.retransmittedPacketsSent=F.retransmittedBytesSent,w.outboundRTP.transportId=F.transportId),F.type==="remote-inbound-rtp"&&(w.remoteInboundRTP.fractionLost=F.fractionLost,w.remoteInboundRTP.packetsLost=F.packetsLost,w.remoteInboundRTP.roundTripTime=F.roundTripTime,w.remoteInboundRTP.roundTripTimeMeasurements=F.roundTripTimeMeasurements,w.remoteInboundRTP.totalRoundTripTime=F.totalRoundTripTime,w.remoteInboundRTP.transportId=F.transportId)}),w.changedCandidatedInfo=this.localCandidateInfo}).catch(P=>{_.log.debug(`${S.LOGCAT.CALL} | Error during CALL_STATS_DUMP event creation `,P.message)});const k=this.rtpreceiver;k&&k.then(P=>{Array.from(P.values()).forEach(F=>{F.type==="inbound-rtp"&&(w.inboundRTP.bytesReceived=F.bytesReceived,w.inboundRTP.jitterBufferDelay=F.jitterBufferDelay,w.inboundRTP.jitterBufferEmittedCount=F.jitterBufferEmittedCount,w.inboundRTP.jitterBufferMinimumDelay=F.jitterBufferMinimumDelay,w.inboundRTP.jitterBufferTargetDelay=F.jitterBufferTargetDelay,w.inboundRTP.packetsDiscarded=F.packetsDiscarded,w.inboundRTP.packetsLost=F.packetsLost,w.inboundRTP.packetsReceived=F.packetsReceived,w.inboundRTP.totalSamplesDuration=F.totalSamplesDuration,w.inboundRTP.totalSamplesReceived=F.totalSamplesDuration,w.inboundRTP.transportId=F.transportId),F.type==="remote-outbound-rtp"&&(w.remoteOutboundRTP.bytesSent=F.bytesSent,w.remoteOutboundRTP.packetsSent=F.packetsSent,w.remoteOutboundRTP.reportsSent=F.reportsSent,w.remoteOutboundRTP.totalRoundTripTime=F.totalRoundTripTime,w.remoteOutboundRTP.transportId=F.transportId)}),_.log.debug(`${S.LOGCAT.CALL} | Created CALL_STATS_DUMP Event`),g.call(this.clientScope,w)}).catch(P=>{_.log.debug(`${S.LOGCAT.CALL} | Error during CALL_STATS_DUMP event creation `,P.message),L(new Error("Error in getStats LocalStreams API"))}),O()})},this.stop=()=>N(this,void 0,void 0,function*(){const w={msg:"CALL_STATS_DUMP",callUUID:this.callUUID,xcallUUID:this.xcallUUID,source:S.STATS_SOURCE,timeStamp:Date.now(),version:S.STATS_VERSION,changedCandidatedInfo:{},localCandidate:{},remoteCandidate:{},transport:{},candidatePair:{},outboundRTP:{},remoteInboundRTP:{},inboundRTP:{},remoteOutboundRTP:{}};this.sendCallStatsDump(w),this.localAudioLevelHelper.stop(),this.remoteAudioLevelHelper.stop()}),this.clientScope=y,this.pc=y._currentSession.session.connection,this.xcallUUID=y._currentSession.callUUID,this.callUUID=y._currentSession.sipCallID,this.corelationId=y._currentSession.sipCallID,this.userName=y.userName,this.storage=y.storage,this.callstatskey=y.callstatskey,this.statsioused=y.statsioused,!this.pc||!this.callUUID)return this.pc||_.log.error("pc obj is null, webrtc stats error"),void(this.callUUID||_.log.error("CallUUID is null, webrtc stats error"));this.baseStatsCollected=!1,this.packets={},this.senderMediaStream=new MediaStream,this.senderMediaStream.addTrack(this.pc.getSenders()[0].track),this.receiverMediaStream=new MediaStream,this.receiverMediaStream.addTrack(this.pc.getReceivers()[0].track),this.localAudioLevelHelper=new p.AudioLevel(this.senderMediaStream),this.remoteAudioLevelHelper=new p.AudioLevel(this.receiverMediaStream),this.audioInputLevel=null,this.audioOutputLevel=null,this.audioInputCount=0,this.audioOutputCount=0,m.call(this),E.call(this)}}},"./lib/stats/setup.ts":function(Se,U,K){var G=this&&this.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(U,"__esModule",{value:!0}),U.initCallStatsIO=U.createStatsSocket=void 0;const q=K("./lib/stats/ws.ts"),x=K("./lib/logger.ts"),N=G(K("./lib/utils/browserDetection.ts")),S={log:x.Logger};U.createStatsSocket=function(){const _=this;!_.statsSocket&&_.callstatskey&&(_.statsSocket=new q.StatsSocket,_.statsSocket.connect())};let p=_=>{const{streams:t}=_;window._PlivoDevLogging&&S.log.info(t)};const b=(_,t)=>{S.log.debug(`Stats Initializing Status: err= ${_} msg= ${t}`)};U.initCallStatsIO=function(){const _=this;if(_.options.enableTracking&&!_.callStats){_.options.appSecret!=null||_.options.appId!=null?_.statsioused=!0:_.statsioused=!1,window.csioChromeLegacyGetStats=!0;const t={disableBeforeUnloadHandler:!1,applicationVersion:"2.2.18-rc.2",disablePrecalltest:!0};if(N.default().browser!=="chrome"&&(p=null),_.options.appId){_.callStats=typeof window.callstats>"u"?K("./lib/stats/callstatsio.js"):new window.callstats;const m=_.options.appSecret;_.callStats.initialize(_.options.appId,m,_.userName,b,p,t)}S.log.debug("enableTracking initialized")}}},"./lib/stats/ws.ts":function(Se,U,K){var G=this&&this.__createBinding||(Object.create?function(s,n,i,a){a===void 0&&(a=i),Object.defineProperty(s,a,{enumerable:!0,get:function(){return n[i]}})}:function(s,n,i,a){a===void 0&&(a=i),s[a]=n[i]}),q=this&&this.__setModuleDefault||(Object.create?function(s,n){Object.defineProperty(s,"default",{enumerable:!0,value:n})}:function(s,n){s.default=n}),x=this&&this.__importStar||function(s){if(s&&s.__esModule)return s;var n={};if(s!=null)for(var i in s)i!=="default"&&Object.prototype.hasOwnProperty.call(s,i)&&G(n,s,i);return q(n,s),n};Object.defineProperty(U,"__esModule",{value:!0}),U.StatsSocket=void 0;const N=K("./lib/logger.ts"),S=x(K("./lib/constants.ts"));let p=S.SOCKET_SEND_STATS_RETRY_SECONDS_COUNT,b=S.SOCKET_SEND_STATS_RETRY_ATTEMPTS;const _={log:N.Logger};function t(){this.isConnecting=!1,_.log.debug(`stats socket ${this.url} connected`)}function m(s){_.log.debug("stats socket close()",s);const n=this;_.log.debug(`stats socket ${n.url} closed`),s.wasClean===!1&&(_.log.debug("stats socket abrupt disconnection,  reconnecting in ",S.STATSSOCKET_RECONNECT_SEC/1e3+" sec"),n.isConnected()||setTimeout(()=>{n.connect()},S.STATSSOCKET_RECONNECT_SEC))}function f(s){_.log.info("received stats socket message: ",s.data)}function o(s){this.isConnecting=!1,_.log.debug(`stats socket ${this.url} error: ${s}`)}U.StatsSocket=class{constructor(){this.connect=()=>{if(!this.ws){_.log.debug(`${S.LOGCAT.CALL}| opening stats socket`);try{this.isConnecting=!0,this.ws=new WebSocket(this.url),this.ws.onopen=t.bind(this),this.ws.onclose=m.bind(this),this.ws.onmessage=f.bind(this),this.ws.onerror=o.bind(this)}catch(s){_.log.error("stats socket open error : ",s),o.call(this,s)}}},this.disconnect=()=>{_.log.debug("stats socket disconnect()"),this.ws?(this.ws.onopen=()=>{},this.ws.onclose=()=>{},this.ws.onmessage=()=>{},this.ws.onerror=()=>{},this.ws.close(),this.ws=null):_.log.debug(`${S.LOGCAT.LOGOUT}| webSocket instance not found`)},this.isConnected=()=>!(!this.ws||this.ws.readyState!==this.ws.OPEN),this.send=(s,n)=>{if(b===S.SOCKET_SEND_STATS_RETRY_ATTEMPTS&&this.messageBuffer.push(JSON.stringify(s)),this.isConnected()&&navigator.onLine){for(_.log.debug("stats : ",s);this.messageBuffer.length;)if(this.ws){const i=this.messageBuffer.shift();this.ws.send(i),_.log.debug("stats send success"),n.callSession!=null||s.msg!=="CALL_SUMMARY"&&s.msg!=="FEEDBACK"||(this.disconnect(),n.statsSocket=null,n.networkChangeInCurrentSession=!1,n.deviceToggledInCurrentSession=!1)}return b!==S.SOCKET_SEND_STATS_RETRY_ATTEMPTS&&(b=S.SOCKET_SEND_STATS_RETRY_ATTEMPTS,p=S.SOCKET_SEND_STATS_RETRY_SECONDS_COUNT),!0}return s.msg==="CALL_SUMMARY"&&(_.log.debug("retrying to send call summary event"),b===S.SOCKET_SEND_STATS_RETRY_ATTEMPTS&&(b=S.SOCKET_SEND_STATS_RETRY_ATTEMPTS,p=S.SOCKET_SEND_STATS_RETRY_SECONDS_COUNT,_.log.error(`${S.LOGCAT.CALL} | Error in sending call summary event due to retry exhaustion`))),setTimeout(()=>{p+=1,b-=1,this.send(s,n)},900*p),_.log.warn(`${S.LOGCAT.CALL} | statsSocket is not open, retrying to connect`),this.reconnect(),!1},this.reconnect=()=>{navigator.onLine&&!this.isConnecting&&(this.ws=null,this.connect())},this.url=S.STATSSOCKET_URL,this.ws=null,this.messageBuffer=[],this.isConnecting=!1,this.connect()}heartbeat(s){if(this.isConnected()){const n=JSON.stringify({heartbeat:"healthy",username:s.userName});return this.ws&&this.ws.send(n),_.log.debug("sent heartbeat to stats socket :",n),!0}return _.log.error("unable to send heartbeat, statsSocket is not open"),this.reconnect(),!1}}},"./lib/storage.ts":function(Se,U,K){Object.defineProperty(U,"__esModule",{value:!0});class G{constructor(){this.TAG="PlivoLogStorage",this.getData=()=>{var x;return(x=window.localStorage.getItem(this.TAG))!==null&&x!==void 0?x:""},this.clear=()=>window.localStorage.removeItem(this.TAG)}static getInstance(){return this.instance||(this.instance=new G),this.instance}setData(x,N,S){const p=this.getData(),b=x+N+S,_=p?`${JSON.parse(p)}
${b}`:b,t=JSON.stringify(_);window.localStorage.setItem(this.TAG,t)}}U.default=G,G.instance=null},"./lib/utils/browserDetection.ts":function(Se,U,K){var G=this&&this.__importDefault||function(x){return x&&x.__esModule?x:{default:x}};Object.defineProperty(U,"__esModule",{value:!0});const q=G(K("./node_modules/webrtc-adapter/src/js/adapter_core.js"));U.default=()=>{const x={version:q.default.browserDetails.version,browser:q.default.browserDetails.browser};return window.opr&&opr.addons||window.opera||navigator.userAgent.indexOf("OPR/")>=0?(x.browser="opera",x):typeof InstallTrigger<"u"?(x.browser="firefox",x):/constructor/i.test(window.HTMLElement)||(!window.safari||typeof safari<"u"&&safari.pushNotification).toString()==="[object SafariRemoteNotification]"?(x.browser="safari",x):window.StyleMedia||window.chrome&&(window.chrome.webstore||window.chrome.runtime)&&navigator.userAgent.indexOf("Edg")!==-1?(x.browser="edge",x):(window.chrome&&(window.chrome.webstore||window.chrome.runtime)&&(x.browser="chrome"),x)}},"./lib/utils/codecPreference.ts":function(Se,U,K){Object.defineProperty(U,"__esModule",{value:!0});const G=function(q,x){const N=new RegExp(`a=rtpmap:.* ${q}(.*)`,"ig");if(x.match(N)){const S=x.match(N)?x.match(N):null;let p=[""];return S&&(p=S[0].split(" ")),p[0].match(/\d+/)}return!1};U.default=function(q,x){if(q.length>0){const N=["OPUS","G722","PCMA","PCMU","ISAC","CN"];let S="";q.forEach(b=>{const _=N.indexOf(b);_>-1&&N.splice(_,1);const t=G(b,x);t&&(S+=`${t} `)}),S=S.slice(0,-1);const p=x.match(/m=audio .*[a-z] (.*)/i);x=p?x.replace(p[1],S):x,x=function(b,_){let t;return b.forEach(m=>{const f=G(m,_);t=new RegExp(`
a=rtpmap:.*${m}/.*`,"ig"),_=_.replace(t,""),t=new RegExp(`
a=fmtp:${f} (.*)`,"ig"),_=_.replace(t,""),t=new RegExp(`
a=rtcp-fb:${f} (.*)`,"ig"),_=_.replace(t,"")}),_}(N,x)}return x}},"./lib/utils/device.ts":function(Se,U,K){var G=this&&this.__importDefault||function(N){return N&&N.__esModule?N:{default:N}};Object.defineProperty(U,"__esModule",{value:!0}),U.getClientVersion=U.getSDKVersion=U.checkMediaDevices=U.getOS=void 0;const q=G(K("./node_modules/semver-parser/index.js")),x=G(K("./package.json"));U.getOS=()=>{let N="Unknown OS";return navigator.userAgent.indexOf("Win")!==-1&&(N="Windows"),navigator.userAgent.indexOf("Mac")!==-1&&(N="Macintosh"),navigator.userAgent.indexOf("Linux")!==-1&&(N="Linux"),navigator.userAgent.indexOf("Android")!==-1&&(N="Android"),navigator.userAgent.indexOf("like Mac")!==-1&&(N="iOS"),navigator.userAgent.indexOf("CrOS")!==-1&&(N="Chromium"),N},U.checkMediaDevices=()=>{if(!navigator.mediaDevices)throw/Chrome/.test(navigator.userAgent)?new Error("This Chrome version supports microphone access only in HTTPS web applications. https://bit.ly/2SiWjWN"):/Firefox/.test(navigator.userAgent)?new Error("This Firefox version supports microphone access only in HTTPS web applications. https://mzl.la/2LSLIkr"):new Error("This Browser version supports microphone access only in HTTPS web applications.")},U.getSDKVersion=()=>q.default.parseSemVer(x.default.version,!1),U.getClientVersion=()=>{const N=(()=>{const S=navigator.appName,p=navigator.userAgent;let b,_=p.match(/(opera|chrome|safari|firefox|msie|trident)\/?\s*(\.?\d+(\.\d+)*)/i);return _&&(b=p.match(/version\/([.\d]+)/i))!==null&&(_[2]=b[1]),_=_?[_[1],_[2]]:[S,navigator.appVersion,"-?"],_[1]})();return q.default.parseSemVer(N,!1).matches?q.default.parseSemVer(N,!1):N.split(".")}},"./lib/utils/feedback.ts":function(Se,U,K){var G=this&&this.__createBinding||(Object.create?function(p,b,_,t){t===void 0&&(t=_),Object.defineProperty(p,t,{enumerable:!0,get:function(){return b[_]}})}:function(p,b,_,t){t===void 0&&(t=_),p[t]=b[_]}),q=this&&this.__setModuleDefault||(Object.create?function(p,b){Object.defineProperty(p,"default",{enumerable:!0,value:b})}:function(p,b){p.default=b}),x=this&&this.__importStar||function(p){if(p&&p.__esModule)return p;var b={};if(p!=null)for(var _ in p)_!=="default"&&Object.prototype.hasOwnProperty.call(p,_)&&G(b,p,_);return q(b,p),b};Object.defineProperty(U,"__esModule",{value:!0}),U.validateFeedback=void 0;const N=x(K("./lib/constants.ts")),S={log:K("./lib/logger.ts").Logger};U.validateFeedback=function(p,b,_,t,m,f){return new Promise((o,s)=>{if(!m)return S.log.error(`submitCallQualityFeedback() username is null, isLoggedIn : ${f}`),void s("username not found");if(!p)return S.log.error("submitCallQualityFeedback() callUUID is mandatory"),void s("callUUID is mandatory");if(!b)return S.log.error("submitCallQualityFeedback() starRating is not given "),void s("Star rating is Mandatory");const n=Number(b);return n<=0||n>5?(S.log.error(`submitCallQualityFeedback() starRating: ${n} , starRating should be from 1-5 range`),void s("score should be from 1-5 range")):_&&_.toString().length>280?(S.log.error("submitCallQualityFeedback() max length for note is 280 characters"),void s("Maximum length for note is 280 charecters")):void function(i,a,c,u=[],g){const h=[];if(Array.isArray(u)){if(g!==5&&(!u||u.length<1))return S.log.error("submitCallQualityFeedback() Atleast one issue is mandatory for feedback"),void a("Atleast one issue is mandatory for feedback");if(u.length>=1&&(u.forEach(C=>{if(typeof C=="string"){const E=C.trim().toUpperCase(),y=N.DEFAULT_COMMENTS[E];y&&h.push(y)}}),h.length<1)){const C=Object.keys(N.DEFAULT_COMMENTS);if(g!==5)return S.log.error(`submitCallQualityFeedback() Issues must be from the predefined list of issues for feedback -${C}`),void a(`Issues must be from the predefined list of issues - ${C}`);S.log.debug(`submitCallQualityFeedback() Feedback with full rating without any Issues or matches from predefined list of issues -${C}`)}i({overall:g,comment:`${h} ${c}`||""})}else a("Attribute issues should be an array")}(o,s,_,t,n)})}},"./lib/utils/frameworkDetection.ts":function(Se,U,K){Object.defineProperty(U,"__esModule",{value:!0}),U.default=()=>{const G=[];return(window.React||document.querySelector("[data-reactroot], [data-reactid]")||(()=>{const q=document.querySelectorAll("*");for(let x=0;x<q.length;x+=1)if(/react/.test(q[x])||/React/.test(q[x]))return!0;return!1})())&&G.push("React"),(window.angular||document.querySelector(".ng-binding, [ng-app], [data-ng-app], [ng-controller], [data-ng-controller], [ng-repeat], [ng-version], [data-ng-repeat]")||document.querySelector('script[src*="angular.js"], script[src*="angular.min.js"]'))&&G.push("Angular.js"),window.Backbone&&G.push("Backbone.js"),window.Ember&&G.push("Ember.js"),window.Vue&&G.push("Vue.js"),window.Meteor&&G.push("Meteor.js"),window.jQuery&&G.push("jQuery.js"),G}},"./lib/utils/headers.ts":function(Se,U,K){Object.defineProperty(U,"__esModule",{value:!0}),U.receiveExtraHeader=U.checkExtraHeaderJWTVal=U.checkExtraHeaderVal=U.checkExtraHeaderKey=void 0,U.checkExtraHeaderKey=function(G){const q=G.toUpperCase();return q.startsWith("X-PH")||q==="X-PLIVO-JWT"?/^([a-z0-9A-Z-]){1,19}$/.test(G.substr(5))!==!1:!1},U.checkExtraHeaderVal=function(G){return/^([a-z0-9A-Z_\-+()%.]){1,120}$/.test(G)!==!1},U.checkExtraHeaderJWTVal=function(G){return/^([a-z0-9A-Z_\-+()%.]){1,500}$/.test(G)!==!1},U.receiveExtraHeader=function(G,q){const x={};return Object.keys(q).forEach(N=>{const S=G.getHeader(N),p=U.checkExtraHeaderKey,b=N.toUpperCase()==="X-PLIVO-JWT"?U.checkExtraHeaderJWTVal:U.checkExtraHeaderVal;p(N)&&b(S)&&(x[N]=S)}),x}},"./lib/utils/loggerUtil.ts":function(Se,U,K){Object.defineProperty(U,"__esModule",{value:!0}),U.LoggerUtil=void 0;class G{constructor(x){this.sipCallID="",this.userName="",this.client=x,G.instance=this}static getInstance(){return this.instance||null}getSipCallID(){var x;return this.sipCallID?this.sipCallID:this.client._currentSession?(this.sipCallID=(x=this.client._currentSession.sipCallID)!==null&&x!==void 0?x:"",this.sipCallID):""}setSipCallID(x){this.sipCallID=x}getUserName(){return this.userName}setUserName(x){this.userName=x}}U.LoggerUtil=G},"./lib/utils/networkManager.ts":function(Se,U,K){var G=this&&this.__createBinding||(Object.create?function(o,s,n,i){i===void 0&&(i=n),Object.defineProperty(o,i,{enumerable:!0,get:function(){return s[n]}})}:function(o,s,n,i){i===void 0&&(i=n),o[i]=s[n]}),q=this&&this.__setModuleDefault||(Object.create?function(o,s){Object.defineProperty(o,"default",{enumerable:!0,value:s})}:function(o,s){o.default=s}),x=this&&this.__importStar||function(o){if(o&&o.__esModule)return o;var s={};if(o!=null)for(var n in o)n!=="default"&&Object.prototype.hasOwnProperty.call(o,n)&&G(s,o,n);return q(s,o),s},N=this&&this.__awaiter||function(o,s,n,i){return new(n||(n=Promise))(function(a,c){function u(C){try{h(i.next(C))}catch(E){c(E)}}function g(C){try{h(i.throw(C))}catch(E){c(E)}}function h(C){var E;C.done?a(C.value):(E=C.value,E instanceof n?E:new n(function(y){y(E)})).then(u,g)}h((i=i.apply(o,s||[])).next())})};Object.defineProperty(U,"__esModule",{value:!0}),U.resetPingPong=U.startPingPong=U.reconnectSocket=U.sendNetworkChangeEvent=U.sendInfoReInvite=U.getNetworkData=U.socketReconnectionRetry=U.restartStatSocket=U.ConnectionState=void 0;const S=x(K("./node_modules/plivo-jssip/dist/plivo-jssip.min.js")),p=K("./lib/constants.ts"),b=K("./lib/logger.ts"),_=K("./lib/stats/nonRTPStats.ts"),t=K("./lib/stats/setup.ts");U.ConnectionState={CONNECTED:"connected",DISCONNECTED:"disconnected"};const m={log:b.Logger};let f=!0;U.restartStatSocket=o=>{m.log.info(`${p.LOGCAT.CALL} | Restarting websocket if callstatsKey present: ${o.callstatskey} and internet available: ${navigator.onLine}`),o.callstatskey&&navigator.onLine&&o._currentSession&&(o.statsSocket&&(o.statsSocket.disconnect(),o.statsSocket=null),t.createStatsSocket.call(o))},U.socketReconnectionRetry=o=>{let s=1;clearInterval(o.connectionRetryInterval),o.connectionRetryInterval=null,o.isConnected()?m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} | Already connected: ${o.isConnected()}. Cannot start another connection attempt interval`):(m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} | Starting the connection interval`),o.connectionRetryInterval=setInterval(()=>{m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} | Checking WS connection status with count ${s}`),o.phone._transport.socket._ws&&o.phone._transport.socket._ws.readyState===0?(m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} | WS is not ready state`),s>=p.WS_RECONNECT_RETRY_COUNT?(m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} | Retry count exhausted. Changing domain`),o.phone._transport.disconnect(),s=1):(m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} | Connection cannot be established. Increasing the reconnect count`),o.phone._transport.disconnect(!0),o.phone._transport.connect(),s+=1)):(m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} | WS is in ready state or WS instance is available: ${!!o.phone._transport.socket._ws}. Clearing the connection check interval`),clearInterval(o.connectionRetryInterval),o.connectionRetryInterval=null)},p.WS_RECONNECT_RETRY_INTERVAL))},U.getNetworkData=(o,s)=>({newNetworkInfo:{networkType:navigator.connection?navigator.connection.effectiveType:"unknown",ip:typeof s=="string"?s:""},previousNetworkInfo:{networkType:o.currentNetworkInfo.networkType,ip:o.currentNetworkInfo.ip}}),U.sendInfoReInvite=(o,s)=>{if(o._currentSession){const n=U.getNetworkData(o,s);n.newNetworkInfo.ip===n.previousNetworkInfo.ip?(m.log.info(`${p.LOGCAT.CALL} | ip did not changed. Sending info`),o._currentSession.session.sendInfo("command/reconnect")):(m.log.info(`${p.LOGCAT.CALL} | Ip changed. Sending re-invite`),o._currentSession.session.renegotiate({rtcOfferConstraints:{iceRestart:!0},sendReinviteOnly:!0}))}else m.log.info(`${p.LOGCAT.CALL} | No Active Session to send info or re-invite`)},U.sendNetworkChangeEvent=(o,s)=>N(void 0,void 0,void 0,function*(){const n=U.getNetworkData(o,s),i={msg:"NETWORK_CHANGE",previousNetworkInfo:n.previousNetworkInfo,newNetworkInfo:n.newNetworkInfo,reconnectionTimestamp:o.networkReconnectionTimestamp,disconnectionTimestamp:o.networkDisconnectedTimestamp};m.log.info(`${p.LOGCAT.CALL} | The network changed from ${JSON.stringify(i.previousNetworkInfo)} to ${JSON.stringify(i.newNetworkInfo)}`),o._currentSession&&o._currentSession.serverFeatureFlags.indexOf("ft_info")!==-1&&U.sendInfoReInvite(o,s),_.sendEvents.call(o,i,o._currentSession),o.currentNetworkInfo={networkType:n.newNetworkInfo.networkType,ip:typeof s=="string"?s:""},o.networkDisconnectedTimestamp=null,o.networkReconnectionTimestamp=null}),U.reconnectSocket=o=>{var s,n;if(navigator.onLine){m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} | re-connecting websocket`);const i=(s=o.lastIncomingCall)!==null&&s!==void 0?s:o._currentSession;if(i&&i.state===i.STATE.RINGING)m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} | Terminating ${i.direction} call with calluuid ${i.callUUID} due to network change in ringing state`),i.isCallTerminatedDuringRinging=!0,i.session.terminate();else if(o._currentSession&&o._currentSession.serverFeatureFlags.indexOf("ft_info")===-1){const a=!!o._currentSession&&((n=o._currentSession)===null||n===void 0?void 0:n.session.renegotiate({rtcOfferConstraints:{iceRestart:!0}}));m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} | Renegotiate Ice :: ${a}`)}else m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} | Closing previous websocket connection. Starting a new one`),o.phone&&(o.phone._transport.disconnect(!0),o.phone._transport.connect(),U.socketReconnectionRetry(o));U.restartStatSocket(o)}},U.startPingPong=({client:o,networkChangeInterval:s,messageCheckTimeout:n})=>{o.networkChangeInterval==null&&(o.networkChangeInterval=setInterval(()=>{var i;if(f||m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} |  Checking for network availablity`),!o.phone||o.phone.isConnected()&&o.phone.isRegistered()?o.phone||m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} | Websocket instance is not available. Is Internet available ${navigator.onLine}`):m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} | Websocket state is connecting: ${o.phone._transport.isConnecting()}, registering: ${o.phone.isRegistering()}, connected: ${o.phone.isConnected()} or registered: ${o.phone.isRegistered()}. Is Internet available ${navigator.onLine}`),navigator.onLine&&o.phone&&!o.phone._transport.isConnecting()&&!o.phone.isRegistering()){let a=!1,c=!1,u=null;if(o.networkDisconnectedTimestamp=new Date().getTime(),!f)if(f=!0,c=!0,o._currentSession&&o._currentSession.serverFeatureFlags.indexOf("ft_info")===-1){const h=o._currentSession.session.renegotiate({rtcOfferConstraints:{iceRestart:!0}});m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} | Restarting Connection and Renegotiate Ice :: ${h}`)}else m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} | Restarting Connection`),o.phone._transport.connect(),U.socketReconnectionRetry(o);const g=setTimeout(()=>{m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} | Ping request timed out in ${n}. Restarting the connection if options response not received: ${!a}`),a||(c=!0,o.connectionInfo={state:U.ConnectionState.DISCONNECTED,reason:"Ping Timed Out"},U.reconnectSocket(o),u=null),clearTimeout(g)},n);u=new S.Message(o.phone),u.on("failed",h=>{var C,E,y,w;a=!0,g&&clearTimeout(g),c||h.cause==="Not Found"&&(!((C=o.phone)===null||C===void 0)&&C.isConnected())&&(!((E=o.phone)===null||E===void 0)&&E.isRegistered())||(m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} | Ping request failed with err: ${h.cause}, Client is connected: ${(y=o.phone)===null||y===void 0?void 0:y.isConnected()} and client is registered: ${(w=o.phone)===null||w===void 0?void 0:w.isRegistered()}. Restarting the connection`),o.connectionInfo={state:U.ConnectionState.DISCONNECTED,reason:`Ping failed with err ${h.cause}`},U.reconnectSocket(o),u=null),c=!1,o.emit("onOptionsMessage",h.cause)}),u.send("admin","pong","OPTIONS")}if(!navigator.onLine&&o.phone&&!o.phone._transport.isConnecting()&&!o.phone.isRegistering()&&f){const a=(i=o.lastIncomingCall)!==null&&i!==void 0?i:o._currentSession;a&&a.state===a.STATE.RINGING&&(a.isCallTerminatedDuringRinging=!0,a.direction==="incoming"&&a.session.terminate(),m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} | Terminating ${a.direction} call with calluuid ${a.callUUID} due to network change in ringing state`)),m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} | Websocket disconnected since internet is not available`),o.connectionInfo={state:U.ConnectionState.DISCONNECTED,reason:"No Internet"},o.phone._transport.disconnect(!0),f=!1}},s))},U.resetPingPong=({client:o,networkChangeInterval:s,messageCheckTimeout:n})=>{clearInterval(o.networkChangeInterval),o.networkChangeInterval=null,m.log.debug(`${p.LOGCAT.NETWORK_CHANGE} | Re-Starting the ping-pong with interval: ${s} and timeout: ${n}`),U.startPingPong({client:o,messageCheckTimeout:n,networkChangeInterval:s})}},"./lib/utils/oneWayAudio.ts":function(Se,U,K){var G=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(U,"__esModule",{value:!0}),U.owaNotification=U.owaCallback=U.detectOWA=U.getWebRTCStats=void 0;const q=K("./lib/stats/mediaMetrics.ts"),x=K("./lib/logger.ts"),N=K("./lib/constants.ts"),S=G(K("./lib/utils/browserDetection.ts")),p={log:x.Logger};let b,_,t,m;const f=function(a){m&&m(null,a)},o=function(a,c){p.log.debug(`${N.LOGCAT.CALL} creating remote offer`),a.setRemoteDescription(c).then(()=>{c.type==="offer"&&a.createAnswer().then(u=>{p.log.info(`${N.LOGCAT.CALL} | SDP Answer created: ${u}`),a.setLocalDescription(u).then(()=>{}).catch(f),o(_,u)}).catch(f)}).catch(f)},s=function(a,c){c.candidate&&a.addIceCandidate(c.candidate).then().catch(f)},n=function(){p.log.debug(`${N.LOGCAT.CALL} stopping local stream after detecting one way audio`),b&&b.getTracks().forEach(a=>{a.stop(),b&&b.removeTrack(a),b=null}),_.signalingState==="stable"&&_.close(),t.signalingState==="stable"&&t.close()};U.getWebRTCStats=function(a){return new Promise((c,u)=>{const g=a.getSenders(),h={bytesSent:null,audioInputLevel:null};g?g[0].getStats(a.getLocalStreams()[0].getAudioTracks()[0]).then(C=>{Array.from(C.values()).forEach(E=>{E.type==="outbound-rtp"&&(h.bytesSent=E.bytesSent),E.type==="media-source"&&(h.audioInputLevel=E.audioLevel),h.bytesSent&&h.audioInputLevel&&c(h)}),h.bytesSent===null&&h.audioInputLevel===null&&m(null,"stats not collectd")}).catch(C=>{u(C)}):u(h)})};const i=function(){p.log.debug(`Precheck ice state : ${_.iceConnectionState}`);let a=0;(function c(){_.getLocalStreams()[0]&&U.getWebRTCStats(_).then(u=>{u.bytesSent&&u.audioInputLevel?Number(u.audioInputLevel)<=0&&a!==2?(a+=1,setTimeout(c,1e3),p.log.debug(`Precheck re-attempt: ${a}`)):(m&&m(u,null),setTimeout(n,3e3)):m(null,"error gathering stats")}).catch(u=>{f(u)})})()};U.detectOWA=a=>{m=a,_=new RTCPeerConnection(null),t=new RTCPeerConnection(null),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(c=>{var u;b=c,u=_,p.log.debug(`${N.LOGCAT.CALL} creating local offer`),u.addStream(b),u.createOffer().then(g=>{p.log.info(`${N.LOGCAT.CALL} | SDP Offer created:- ${g}`),u.setLocalDescription(g).then(()=>{o(t,g)}).catch(f)}).catch(f)}).catch(f),_.onicecandidate=c=>{s(t,c)},t.onicecandidate=c=>{s(_,c)},setTimeout(i,500)},U.owaCallback=function(a,c,u,g){const h=this;return h&&h.owaLastDetect&&(h.owaLastDetect.time=new Date),c?(p.log.error(`${N.LOGCAT.CALL} | Error in detecting microphone status `,c.message),h&&h.emit&&h.emit("onMediaPermission",{status:"failure",error:c.name}),u(`media - ${c.name}`),!1):(p.log.debug(`${N.LOGCAT.LOGIN} getUserMedia precheck `,a),Number(a.bytesSent)===0&&Number(a.audioInputLevel)===0?(p.log.error(`${N.LOGCAT.CALL} | chrome lost access to microphone - restart browser`,c.message),q.emitMetrics.call(this,"audio","warning","no_microphone_access",0,!0,"chrome lost access to microphone - restart browser","None"),h&&h.owaLastDetect&&(h.owaLastDetect.isOneWay=!0),u("no_microphone_access"),!1):(Number(a.audioInputLevel)===0&&(p.log.error(`${N.LOGCAT.CALL} | microphone is muted`,c.message),q.emitMetrics.call(this,"audio","warning","no_microphone_access",0,!0,"microphone is muted","None")),g(),!0))},U.owaNotification=a=>{a&&a.signalingState!=="closed"&&S.default().browser==="chrome"&&U.getWebRTCStats(a).then(c=>{c.bytesSent&&p.log.debug(`${N.LOGCAT.CALL} | Bytes sent by WebSDK client: ${c.bytesSent} audioInputLevel: ${c.audioInputLevel}`),c.bytesSent===0&&c.audioInputLevel===0&&(p.log.debug(`${N.LOGCAT.CALL} | One way audio detected`),q.emitMetrics.call(this,"audio","warning","no_microphone_access",0,!0,"no access to your microphone","None"))}).catch(c=>{p.log.debug(`${N.LOGCAT.CALL} | Error while gathering webrtc stats ${c}`)})}},"./lib/utils/options.ts":function(Se,U,K){var G=this&&this.__createBinding||(Object.create?function(t,m,f,o){o===void 0&&(o=f),Object.defineProperty(t,o,{enumerable:!0,get:function(){return m[f]}})}:function(t,m,f,o){o===void 0&&(o=f),t[o]=m[f]}),q=this&&this.__setModuleDefault||(Object.create?function(t,m){Object.defineProperty(t,"default",{enumerable:!0,value:m})}:function(t,m){t.default=m}),x=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var m={};if(t!=null)for(var f in t)f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)&&G(m,t,f);return q(m,t),m};Object.defineProperty(U,"__esModule",{value:!0});const N=x(K("./lib/constants.ts")),S={log:K("./lib/logger.ts").Logger},p={codecs:N.DEFAULT_CODECS,enableTracking:!0,enableQualityTracking:N.DEFAULT_ENABLE_QUALITY_TRACKING,debug:N.DEFAULT_LOG_LEVEL,permOnClick:!1,enableIPV6:!1,audioConstraints:N.AUDIO_CONSTRAINTS,dscp:!0,appId:null,appSecret:null,registrationDomainSocket:null,clientRegion:null,preDetectOwa:!1,disableRtpTimeOut:!1,allowMultipleIncomingCalls:!1,closeProtection:!1,useDefaultAudioDevice:!1,maxAverageBitrate:N.MAX_AVERAGE_BITRATE,dtmfOptions:N.DEFAULT_DTMFOPTIONS,enableNoiseReduction:!1,usePlivoStunServer:!1,registrationRefreshTimer:N.REGISTER_EXPIRES_SECONDS,noiseReductionFilePath:""},b=function(t,m){return typeof m=="boolean"||(S.log.error(`${t} has to be boolean. ${m} is not accepted`),!1)},_=function(t,m){return typeof m=="number"||(S.log.error(`${t} has to be number. ${m} is not accepted`),!1)};U.default=function(t){return typeof t<"u"&&Object.keys(t).forEach(m=>{switch(m){case"enableTracking":b(m,t[m])?p.enableTracking=t[m]:p.enableTracking=!0;break;case"enableQualityTracking":if(t[m]!==void 0){const o=t[m].toString().toUpperCase();N.ENABLE_QUALITY_TRACKING_ALLOWED_VALUES.indexOf(o)!==-1?p.enableQualityTracking=o:S.log.error(`The value set for ${m} is ${t[m]} which is not valid. Please choose one from following string values : [ ${N.ENABLE_QUALITY_TRACKING_ALLOWED_VALUES} ]`)}break;case"debug":t[m]=t[m].toUpperCase(),function(o){const s=N.DEBUG_MODES;return s.indexOf(o)!==-1||(S.log.error(`debug method ${o} is not allowed`),S.log.debug("Allowed list for debug: ",s),!1)}(t[m])?(p.debug=t[m],t[m]==="ALL-PLAIN"&&(p[m]="ALL"),S.log.setLevel(t[m])):S.log.setLevel("INFO");break;case"permOnClick":b(m,t[m])&&(this.permOnClick=t[m],p.permOnClick=t[m]);break;case"audioConstraints":t[m]&&typeof t[m]=="object"?p.audioConstraints=t[m]:p.audioConstraints=N.AUDIO_CONSTRAINTS;break;case"dscp":b(m,t[m])&&(p.dscp=t[m]);break;case"enableNoiseReduction":b(m,t[m])&&(p.enableNoiseReduction=t[m]);break;case"codecs":(function(o){const s=N.DEFAULT_CODECS;if(Array.isArray(o)){let n=!0;return o.forEach(i=>{s.indexOf(i)===-1&&(n=!1,S.log.warn("Ignoring invalid codec - ",i),S.log.debug("Allowed list: ",s))}),n}return S.log.error("Please send codecs in array format. Eg:",s),!1})(t[m])&&(p.codecs=t[m]);break;case"useDefaultAudioDevice":b(m,t[m])&&(p.useDefaultAudioDevice=t[m]);break;case"usePlivoStunServer":b(m,t[m])&&(p.usePlivoStunServer=t[m]);break;case"appSecret":p.appSecret=t[m];break;case"appId":p.appId=t[m];break;case"registrationRefreshTimer":_(m,t[m])&&(t[m]>=N.MIN_REGISTRATION_REFRESH_TIMER&&t[m]<=N.MAX_REGISTRATION_REFRESH_TIMER?p.registrationRefreshTimer=t[m]:S.log.error(`registrationRefreshTimer should be an integer in between ${N.MIN_REGISTRATION_REFRESH_TIMER} and ${N.MAX_REGISTRATION_REFRESH_TIMER}`));break;case"registrationDomainSocket":p.registrationDomainSocket=t[m];break;case"enableIPV6":break;case"clientRegion":(function(o){const s=N.REGION;return s.indexOf(o)!==-1||(S.log.error(`region name ${o} is not allowed`),S.log.debug("Allowed list for regions: ",s),!1)})(t[m])&&(p.clientRegion=t[m]);break;case"preDetectOwa":b(m,t[m])&&(p.preDetectOwa=!1);break;case"disableRtpTimeOut":b(m,t[m])&&(p.disableRtpTimeOut=t[m]);break;case"noiseReductionFilePath":typeof t[m]=="string"&&(p.noiseReductionFilePath=t[m]);break;case"allowMultipleIncomingCalls":b(m,t[m])&&(p.allowMultipleIncomingCalls=t[m]);break;case"closeProtection":b(m,t[m])&&(p.closeProtection=t[m]);break;case"maxAverageBitrate":_(m,t[m])&&(t[m]>=N.MIN_AVERAGE_BITRATE&&t[m]<=N.MAX_AVERAGE_BITRATE&&(f=t[m])===Math.round(f)?p.maxAverageBitrate=Math.floor(t[m]):S.log.error(`maxAverageBitrate should be an integer in between ${N.MIN_AVERAGE_BITRATE} and ${N.MAX_AVERAGE_BITRATE}`));break;case"dtmfOptions":t[m]&&typeof t[m]=="object"?p.dtmfOptions=function(o){let s;const n=[];if(!o||!("sendDtmfType"in o))return N.DEFAULT_DTMFOPTIONS;s=o.sendDtmfType;const i=N.DTMF_OPTIONS;return Array.isArray(s)?(s.forEach(a=>{i.indexOf(a.toUpperCase())===-1?(S.log.warn("Ignoring invalid dtmf option - ",a),S.log.debug("Allowed list of dtmf options : ",i)):n.push(a.toUpperCase())}),n.length===0?N.DEFAULT_DTMFOPTIONS:{sendDtmfType:n}):(S.log.error("Please send dtmfoption in following format. Eg: ",N.DEFAULT_DTMFOPTIONS),N.DEFAULT_DTMFOPTIONS)}(t[m]):p.dtmfOptions=N.DEFAULT_DTMFOPTIONS;break;default:S.log.warn(`Ignoring invalid option key ${m}`)}var f}),p}},"./lib/utils/token.js":function(Se,U){var K=function(){if(this.constructor===K)throw new Error("Can't instantiate abstract class!")};K.prototype.getAccessToken=function(){throw new Error("Abstract method!")},Se.exports=K},"./node_modules/events/events.js":function(Se,U,K){var G,q=typeof Reflect=="object"?Reflect:null,x=q&&typeof q.apply=="function"?q.apply:function(i,a,c){return Function.prototype.apply.call(i,a,c)};G=q&&typeof q.ownKeys=="function"?q.ownKeys:Object.getOwnPropertySymbols?function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:function(i){return Object.getOwnPropertyNames(i)};var N=Number.isNaN||function(i){return i!==i};function S(){S.init.call(this)}Se.exports=S,Se.exports.once=function(i,a){return new Promise(function(c,u){function g(){h!==void 0&&i.removeListener("error",h),c([].slice.call(arguments))}var h;a!=="error"&&(h=function(C){i.removeListener(a,g),u(C)},i.once("error",h)),i.once(a,g)})},S.EventEmitter=S,S.prototype._events=void 0,S.prototype._eventsCount=0,S.prototype._maxListeners=void 0;var p=10;function b(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}function _(i){return i._maxListeners===void 0?S.defaultMaxListeners:i._maxListeners}function t(i,a,c,u){var g,h,C,E;if(b(c),(h=i._events)===void 0?(h=i._events=Object.create(null),i._eventsCount=0):(h.newListener!==void 0&&(i.emit("newListener",a,c.listener?c.listener:c),h=i._events),C=h[a]),C===void 0)C=h[a]=c,++i._eventsCount;else if(typeof C=="function"?C=h[a]=u?[c,C]:[C,c]:u?C.unshift(c):C.push(c),(g=_(i))>0&&C.length>g&&!C.warned){C.warned=!0;var y=new Error("Possible EventEmitter memory leak detected. "+C.length+" "+String(a)+" listeners added. Use emitter.setMaxListeners() to increase limit");y.name="MaxListenersExceededWarning",y.emitter=i,y.type=a,y.count=C.length,E=y,console&&console.warn&&console.warn(E)}return i}function m(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(i,a,c){var u={fired:!1,wrapFn:void 0,target:i,type:a,listener:c},g=m.bind(u);return g.listener=c,u.wrapFn=g,g}function o(i,a,c){var u=i._events;if(u===void 0)return[];var g=u[a];return g===void 0?[]:typeof g=="function"?c?[g.listener||g]:[g]:c?function(h){for(var C=new Array(h.length),E=0;E<C.length;++E)C[E]=h[E].listener||h[E];return C}(g):n(g,g.length)}function s(i){var a=this._events;if(a!==void 0){var c=a[i];if(typeof c=="function")return 1;if(c!==void 0)return c.length}return 0}function n(i,a){for(var c=new Array(a),u=0;u<a;++u)c[u]=i[u];return c}Object.defineProperty(S,"defaultMaxListeners",{enumerable:!0,get:function(){return p},set:function(i){if(typeof i!="number"||i<0||N(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");p=i}}),S.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},S.prototype.setMaxListeners=function(i){if(typeof i!="number"||i<0||N(i))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+i+".");return this._maxListeners=i,this},S.prototype.getMaxListeners=function(){return _(this)},S.prototype.emit=function(i){for(var a=[],c=1;c<arguments.length;c++)a.push(arguments[c]);var u=i==="error",g=this._events;if(g!==void 0)u=u&&g.error===void 0;else if(!u)return!1;if(u){var h;if(a.length>0&&(h=a[0]),h instanceof Error)throw h;var C=new Error("Unhandled error."+(h?" ("+h.message+")":""));throw C.context=h,C}var E=g[i];if(E===void 0)return!1;if(typeof E=="function")x(E,this,a);else{var y=E.length,w=n(E,y);for(c=0;c<y;++c)x(w[c],this,a)}return!0},S.prototype.addListener=function(i,a){return t(this,i,a,!1)},S.prototype.on=S.prototype.addListener,S.prototype.prependListener=function(i,a){return t(this,i,a,!0)},S.prototype.once=function(i,a){return b(a),this.on(i,f(this,i,a)),this},S.prototype.prependOnceListener=function(i,a){return b(a),this.prependListener(i,f(this,i,a)),this},S.prototype.removeListener=function(i,a){var c,u,g,h,C;if(b(a),(u=this._events)===void 0)return this;if((c=u[i])===void 0)return this;if(c===a||c.listener===a)--this._eventsCount===0?this._events=Object.create(null):(delete u[i],u.removeListener&&this.emit("removeListener",i,c.listener||a));else if(typeof c!="function"){for(g=-1,h=c.length-1;h>=0;h--)if(c[h]===a||c[h].listener===a){C=c[h].listener,g=h;break}if(g<0)return this;g===0?c.shift():function(E,y){for(;y+1<E.length;y++)E[y]=E[y+1];E.pop()}(c,g),c.length===1&&(u[i]=c[0]),u.removeListener!==void 0&&this.emit("removeListener",i,C||a)}return this},S.prototype.off=S.prototype.removeListener,S.prototype.removeAllListeners=function(i){var a,c,u;if((c=this._events)===void 0)return this;if(c.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):c[i]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete c[i]),this;if(arguments.length===0){var g,h=Object.keys(c);for(u=0;u<h.length;++u)(g=h[u])!=="removeListener"&&this.removeAllListeners(g);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(a=c[i])=="function")this.removeListener(i,a);else if(a!==void 0)for(u=a.length-1;u>=0;u--)this.removeListener(i,a[u]);return this},S.prototype.listeners=function(i){return o(this,i,!0)},S.prototype.rawListeners=function(i){return o(this,i,!1)},S.listenerCount=function(i,a){return typeof i.listenerCount=="function"?i.listenerCount(a):s.call(i,a)},S.prototype.listenerCount=s,S.prototype.eventNames=function(){return this._eventsCount>0?G(this._events):[]}},"./node_modules/plivo-jssip/dist/plivo-jssip.min.js":function(Se,U,K){Se.exports=function G(q,x,N){function S(_,t){if(!x[_]){if(!q[_]){if(p)return p(_,!0);var m=new Error("Cannot find module '"+_+"'");throw m.code="MODULE_NOT_FOUND",m}var f=x[_]={exports:{}};q[_][0].call(f.exports,function(o){return S(q[_][1][o]||o)},f,f.exports,G,q,x,N)}return x[_].exports}for(var p=!1,b=0;b<N.length;b++)S(N[b]);return S}({1:[function(G,q,x){const N=G("./Utils"),S=G("./Constants"),p=G("./Grammar"),b=G("./URI"),_=G("./Socket"),t=G("./Exceptions");x.settings={authorization_user:null,password:null,realm:null,ha1:null,display_name:null,uri:null,contact_uri:null,instance_id:null,use_preloaded_route:!1,session_timers:!0,session_timers_refresh_method:S.UPDATE,no_answer_timeout:60,register:!0,register_expires:600,registrar_server:null,sockets:null,connection_recovery_max_interval:S.CONNECTION_RECOVERY_MAX_INTERVAL,connection_recovery_min_interval:S.CONNECTION_RECOVERY_MIN_INTERVAL,via_host:`${N.createRandomToken(12)}.invalid`};const m={mandatory:{sockets(f){const o=[];if(_.isSocket(f))o.push({socket:f});else{if(!Array.isArray(f)||!f.length)return;for(const s of f)Object.prototype.hasOwnProperty.call(s,"socket")&&_.isSocket(s.socket)?o.push(s):_.isSocket(s)&&o.push({socket:s})}return o},uri(f){/^sip:/i.test(f)||(f=`${S.SIP}:${f}`);const o=b.parse(f);return o&&o.user?o:void 0}},optional:{authorization_user:f=>p.parse(`"${f}"`,"quoted_string")===-1?void 0:f,authorization_jwt(f){if(typeof f=="string")return f},user_agent(f){if(typeof f=="string")return f},connection_recovery_max_interval(f){if(N.isDecimal(f)){const o=Number(f);if(o>0)return o}},connection_recovery_min_interval(f){if(N.isDecimal(f)){const o=Number(f);if(o>0)return o}},contact_uri(f){if(typeof f=="string"){const o=p.parse(f,"SIP_URI");if(o!==-1)return o}},display_name:f=>f,instance_id:f=>(/^uuid:/i.test(f)&&(f=f.substr(5)),p.parse(f,"uuid")===-1?void 0:f),no_answer_timeout(f){if(N.isDecimal(f)){const o=Number(f);if(o>0)return o}},session_timers(f){if(typeof f=="boolean")return f},session_timers_refresh_method(f){if(typeof f=="string"&&((f=f.toUpperCase())===S.INVITE||f===S.UPDATE))return f},password:f=>String(f),realm:f=>String(f),ha1:f=>String(f),register(f){if(typeof f=="boolean")return f},register_expires(f){if(N.isDecimal(f)){const o=Number(f);if(o>0)return o}},registrar_server(f){/^sip:/i.test(f)||(f=`${S.SIP}:${f}`);const o=b.parse(f);return o?o.user?void 0:o:void 0},use_preloaded_route(f){if(typeof f=="boolean")return f}}};x.load=(f,o)=>{for(const s in m.mandatory){if(!o.hasOwnProperty(s))throw new t.ConfigurationError(s);{const n=o[s],i=m.mandatory[s](n);if(i===void 0)throw new t.ConfigurationError(s,n);f[s]=i}}for(const s in m.optional)if(o.hasOwnProperty(s)){const n=o[s];if(N.isEmpty(n))continue;const i=m.optional[s](n);if(i===void 0)throw new t.ConfigurationError(s,n);f[s]=i}}},{"./Constants":2,"./Exceptions":6,"./Grammar":7,"./Socket":20,"./URI":25,"./Utils":26}],2:[function(G,q,x){const N=G("../package.json");q.exports={USER_AGENT:`${N.title} ${N.version}`,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",BYE:"Terminated",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",DIALOG_ERROR:"Dialog Error",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484,424],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",REFER:"REFER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",DTMF_TRANSPORT:{INFO:"INFO",RFC2833:"RFC2833"},REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",424:"Bad Location Information",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"JsSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER,INFO,NOTIFY",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69,SESSION_EXPIRES:90,MIN_SESSION_EXPIRES:60,CONNECTION_RECOVERY_MAX_INTERVAL:30,CONNECTION_RECOVERY_MIN_INTERVAL:2,SESSION_CONSTANTS:{STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9}}},{"../package.json":55}],3:[function(G,q,x){const N=G("./SIPMessage"),S=G("./Constants"),p=G("./Transactions"),b=G("./Dialog/RequestSender"),_=G("./Utils"),t=G("debug")("JsSIP:Dialog"),m={STATUS_EARLY:1,STATUS_CONFIRMED:2};q.exports=class{static get C(){return m}constructor(f,o,s,n=m.STATUS_CONFIRMED){if(this._owner=f,this._ua=f._ua,this._uac_pending_reply=!1,this._uas_pending_reply=!1,!o.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};o instanceof N.IncomingResponse&&(n=o.status_code<200?m.STATUS_EARLY:m.STATUS_CONFIRMED);const i=o.parseHeader("contact");s==="UAS"?(this._id={call_id:o.call_id,local_tag:o.to_tag,remote_tag:o.from_tag,toString(){return this.call_id+this.local_tag+this.remote_tag}},this._state=n,this._remote_seqnum=o.cseq,this._local_uri=o.parseHeader("to").uri,this._remote_uri=o.parseHeader("from").uri,this._remote_target=i.uri,this._route_set=o.getHeaders("record-route"),this._ack_seqnum=this._remote_seqnum):s==="UAC"&&(this._id={call_id:o.call_id,local_tag:o.from_tag,remote_tag:o.to_tag,toString(){return this.call_id+this.local_tag+this.remote_tag}},this._state=n,this._local_seqnum=o.cseq,this._local_uri=o.parseHeader("from").uri,this._remote_uri=o.parseHeader("to").uri,this._remote_target=i.uri,this._route_set=o.getHeaders("record-route").reverse(),this._ack_seqnum=null),this._ua.newDialog(this),t(`new ${s} dialog created with status ${this._state===m.STATUS_EARLY?"EARLY":"CONFIRMED"}`)}get id(){return this._id}get local_seqnum(){return this._local_seqnum}set local_seqnum(f){this._local_seqnum=f}get owner(){return this._owner}get uac_pending_reply(){return this._uac_pending_reply}set uac_pending_reply(f){this._uac_pending_reply=f}get uas_pending_reply(){return this._uas_pending_reply}update(f,o){this._state=m.STATUS_CONFIRMED,t(`dialog ${this._id.toString()}  changed to CONFIRMED state`),o==="UAC"&&(this._route_set=f.getHeaders("record-route").reverse())}terminate(){t(`dialog ${this._id.toString()} deleted`),this._ua.destroyDialog(this)}sendRequest(f,o={}){const s=_.cloneArray(o.extraHeaders),n=_.cloneObject(o.eventHandlers),i=o.body||null,a=this._createRequest(f,s,i);return n.onAuthenticated=()=>{this._local_seqnum+=1},new b(this,a,n).send(),a}receiveRequest(f){this._checkInDialogRequest(f)&&(f.method===S.ACK&&this._ack_seqnum!==null?this._ack_seqnum=null:f.method===S.INVITE&&(this._ack_seqnum=f.cseq),this._owner.receiveRequest(f))}_createRequest(f,o,s){o=_.cloneArray(o),this._local_seqnum||(this._local_seqnum=Math.floor(1e4*Math.random()));const n=f===S.CANCEL||f===S.ACK?this._local_seqnum:this._local_seqnum+=1;return new N.OutgoingRequest(f,this._remote_target,this._ua,{cseq:n,call_id:this._id.call_id,from_uri:this._local_uri,from_tag:this._id.local_tag,to_uri:this._remote_uri,to_tag:this._id.remote_tag,route_set:this._route_set},o,s)}_checkInDialogRequest(f){if(this._remote_seqnum)if(f.cseq<this._remote_seqnum){if(f.method!==S.ACK)return f.reply(500),!1;if(this._ack_seqnum===null||f.cseq!==this._ack_seqnum)return!1}else f.cseq>this._remote_seqnum&&(this._remote_seqnum=f.cseq);else this._remote_seqnum=f.cseq;if(f.method===S.INVITE||f.method===S.UPDATE&&f.body){if(this._uac_pending_reply===!0)f.reply(491);else{if(this._uas_pending_reply===!0){const o=1+(10*Math.random()|0);return f.reply(500,null,[`Retry-After:${o}`]),!1}{this._uas_pending_reply=!0;const o=()=>{f.server_transaction.state!==p.C.STATUS_ACCEPTED&&f.server_transaction.state!==p.C.STATUS_COMPLETED&&f.server_transaction.state!==p.C.STATUS_TERMINATED||(f.server_transaction.removeListener("stateChanged",o),this._uas_pending_reply=!1)};f.server_transaction.on("stateChanged",o)}}f.hasHeader("contact")&&f.server_transaction.on("stateChanged",()=>{f.server_transaction.state===p.C.STATUS_ACCEPTED&&(this._remote_target=f.parseHeader("contact").uri)})}else f.method===S.NOTIFY&&f.hasHeader("contact")&&f.server_transaction.on("stateChanged",()=>{f.server_transaction.state===p.C.STATUS_COMPLETED&&(this._remote_target=f.parseHeader("contact").uri)});return!0}}},{"./Constants":2,"./Dialog/RequestSender":4,"./SIPMessage":19,"./Transactions":22,"./Utils":26,debug:30}],4:[function(G,q,x){const N=G("../Constants"),S=G("../Transactions"),p=G("../RequestSender"),b={onRequestTimeout:()=>{},onTransportError:()=>{},onSuccessResponse:()=>{},onErrorResponse:()=>{},onAuthenticated:()=>{},onDialogError:()=>{}};q.exports=class{constructor(_,t,m){this._dialog=_,this._ua=_._ua,this._request=t,this._eventHandlers=m,this._reattempt=!1,this._reattemptTimer=null;for(const f in b)Object.prototype.hasOwnProperty.call(b,f)&&(this._eventHandlers[f]||(this._eventHandlers[f]=b[f]))}get request(){return this._request}send(){const _=new p(this._ua,this._request,{onRequestTimeout:()=>{this._eventHandlers.onRequestTimeout()},onTransportError:()=>{this._eventHandlers.onTransportError()},onAuthenticated:t=>{this._eventHandlers.onAuthenticated(t)},onReceiveResponse:t=>{this._receiveResponse(t)}});if(_.send(),(this._request.method===N.INVITE||this._request.method===N.UPDATE&&this._request.body)&&_.clientTransaction.state!==S.C.STATUS_TERMINATED){this._dialog.uac_pending_reply=!0;const t=()=>{_.clientTransaction.state!==S.C.STATUS_ACCEPTED&&_.clientTransaction.state!==S.C.STATUS_COMPLETED&&_.clientTransaction.state!==S.C.STATUS_TERMINATED||(_.clientTransaction.removeListener("stateChanged",t),this._dialog.uac_pending_reply=!1)};_.clientTransaction.on("stateChanged",t)}}_receiveResponse(_){if(_.status_code===408||_.status_code===481){for(const t in this._ua._sessions)this._ua._sessions[t].isEnded()||this._ua._sessions[t].emitNoCallExists(_);this._eventHandlers.onDialogError(_)}else _.method===N.INVITE&&_.status_code===491?this._reattempt?_.status_code>=200&&_.status_code<300?this._eventHandlers.onSuccessResponse(_):_.status_code>=300&&this._eventHandlers.onErrorResponse(_):(this._request.cseq=this._dialog.local_seqnum+=1,this._reattemptTimer=setTimeout(()=>{this._dialog.owner.status!==N.SESSION_CONSTANTS.STATUS_TERMINATED&&(this._reattempt=!0,this._request_sender.send())},1e3)):_.status_code>=200&&_.status_code<300?this._eventHandlers.onSuccessResponse(_):_.status_code>=300&&this._eventHandlers.onErrorResponse(_)}}},{"../Constants":2,"../RequestSender":18,"../Transactions":22}],5:[function(G,q,x){const N=G("./Utils"),S=G("debug")("JsSIP:DigestAuthentication"),p=G("debug")("JsSIP:ERROR:DigestAuthentication");p.log=console.warn.bind(console),q.exports=class{constructor(b){this._credentials=b,this._cnonce=null,this._nc=0,this._ncHex="00000000",this._algorithm=null,this._realm=null,this._nonce=null,this._opaque=null,this._stale=null,this._qop=null,this._method=null,this._uri=null,this._ha1=null,this._response=null}get(b){switch(b){case"realm":return this._realm;case"ha1":return this._ha1;default:return void p('get() | cannot get "%s" parameter',b)}}authenticate({method:b,ruri:_,body:t},m,f=null){if(this._algorithm=m.algorithm,this._realm=m.realm,this._nonce=m.nonce,this._opaque=m.opaque,this._stale=m.stale,this._algorithm){if(this._algorithm!=="MD5")return p('authenticate() | challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this._algorithm="MD5";if(!this._nonce)return p("authenticate() | challenge without Digest nonce, authentication aborted"),!1;if(!this._realm)return p("authenticate() | challenge without Digest realm, authentication aborted"),!1;if(!this._credentials.password){if(!this._credentials.ha1)return p("authenticate() | no plain SIP password nor ha1 provided, authentication aborted"),!1;if(this._credentials.realm!==this._realm)return p('authenticate() | no plain SIP password, and stored `realm` does not match the given `realm`, cannot authenticate [stored:"%s", given:"%s"]',this._credentials.realm,this._realm),!1}if(m.qop)if(m.qop.indexOf("auth-int")>-1)this._qop="auth-int";else{if(!(m.qop.indexOf("auth")>-1))return p('authenticate() | challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this._qop="auth"}else this._qop=null;this._method=b,this._uri=_,this._cnonce=f||N.createRandomToken(12),this._nc+=1;const o=Number(this._nc).toString(16);let s,n;return this._ncHex="00000000".substr(0,8-o.length)+o,this._nc===4294967296&&(this._nc=1,this._ncHex="00000001"),this._credentials.password?this._ha1=N.calculateMD5(`${this._credentials.username}:${this._realm}:${this._credentials.password}`):this._ha1=this._credentials.ha1,this._qop==="auth"?(s=`${this._method}:${this._uri}`,n=N.calculateMD5(s),S('authenticate() | using qop=auth [a2:"%s"]',s),this._response=N.calculateMD5(`${this._ha1}:${this._nonce}:${this._ncHex}:${this._cnonce}:auth:${n}`)):this._qop==="auth-int"?(s=`${this._method}:${this._uri}:${N.calculateMD5(t||"")}`,n=N.calculateMD5(s),S('authenticate() | using qop=auth-int [a2:"%s"]',s),this._response=N.calculateMD5(`${this._ha1}:${this._nonce}:${this._ncHex}:${this._cnonce}:auth-int:${n}`)):this._qop===null&&(s=`${this._method}:${this._uri}`,n=N.calculateMD5(s),S('authenticate() | using qop=null [a2:"%s"]',s),this._response=N.calculateMD5(`${this._ha1}:${this._nonce}:${n}`)),S("authenticate() | response generated"),!0}toString(){const b=[];if(!this._response)throw new Error("response field does not exist, cannot generate Authorization header");return b.push(`algorithm=${this._algorithm}`),b.push(`username="${this._credentials.username}"`),b.push(`realm="${this._realm}"`),b.push(`nonce="${this._nonce}"`),b.push(`uri="${this._uri}"`),b.push(`response="${this._response}"`),this._opaque&&b.push(`opaque="${this._opaque}"`),this._qop&&(b.push(`qop=${this._qop}`),b.push(`cnonce="${this._cnonce}"`),b.push(`nc=${this._ncHex}`)),`Digest ${b.join(", ")}`}}},{"./Utils":26,debug:30}],6:[function(G,q,x){q.exports={ConfigurationError:class extends Error{constructor(N,S){super(),this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=N,this.value=S,this.message=this.value?`Invalid value ${JSON.stringify(this.value)} for parameter "${this.parameter}"`:`Missing parameter: ${this.parameter}`}},InvalidStateError:class extends Error{constructor(N){super(),this.code=2,this.name="INVALID_STATE_ERROR",this.status=N,this.message=`Invalid status: ${N}`}},NotSupportedError:class extends Error{constructor(N){super(),this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=N}},NotReadyError:class extends Error{constructor(N){super(),this.code=4,this.name="NOT_READY_ERROR",this.message=N}}}},{}],7:[function(G,q,x){q.exports=function(){function N(p){return'"'+p.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var S={parse:function(p,b){var _={CRLF:s,DIGIT:n,ALPHA:i,HEXDIG:a,WSP:c,OCTET:u,DQUOTE:g,SP:h,HTAB:C,alphanum:E,reserved:y,unreserved:w,mark:O,escaped:L,LWS:I,SWS:k,HCOLON:P,TEXT_UTF8_TRIM:F,TEXT_UTF8char:H,UTF8_NONASCII:D,UTF8_CONT:$,LHEX:function(){var l;return(l=n())===null&&(/^[a-f]/.test(p.charAt(t))?(l=p.charAt(t),t++):(l=null,o("[a-f]"))),l},token:j,token_nodot:V,separators:function(){var l;return p.charCodeAt(t)===40?(l="(",t++):(l=null,o('"("')),l===null&&(p.charCodeAt(t)===41?(l=")",t++):(l=null,o('")"')),l===null&&(p.charCodeAt(t)===60?(l="<",t++):(l=null,o('"<"')),l===null&&(p.charCodeAt(t)===62?(l=">",t++):(l=null,o('">"')),l===null&&(p.charCodeAt(t)===64?(l="@",t++):(l=null,o('"@"')),l===null&&(p.charCodeAt(t)===44?(l=",",t++):(l=null,o('","')),l===null&&(p.charCodeAt(t)===59?(l=";",t++):(l=null,o('";"')),l===null&&(p.charCodeAt(t)===58?(l=":",t++):(l=null,o('":"')),l===null&&(p.charCodeAt(t)===92?(l="\\",t++):(l=null,o('"\\\\"')),l===null&&(l=g())===null&&(p.charCodeAt(t)===47?(l="/",t++):(l=null,o('"/"')),l===null&&(p.charCodeAt(t)===91?(l="[",t++):(l=null,o('"["')),l===null&&(p.charCodeAt(t)===93?(l="]",t++):(l=null,o('"]"')),l===null&&(p.charCodeAt(t)===63?(l="?",t++):(l=null,o('"?"')),l===null&&(p.charCodeAt(t)===61?(l="=",t++):(l=null,o('"="')),l===null&&(p.charCodeAt(t)===123?(l="{",t++):(l=null,o('"{"')),l===null&&(p.charCodeAt(t)===125?(l="}",t++):(l=null,o('"}"')),l===null&&(l=h())===null&&(l=C())))))))))))))))),l},word:Y,STAR:Z,SLASH:J,EQUAL:re,LPAREN:ce,RPAREN:Re,RAQUOT:pe,LAQUOT:Oe,COMMA:te,SEMI:oe,COLON:_e,LDQUOT:we,RDQUOT:Ee,comment:function l(){var T,A,B,z;if(z=t,(T=ce())!==null){for(A=[],(B=De())===null&&(B=tt())===null&&(B=l());B!==null;)A.push(B),(B=De())===null&&(B=tt())===null&&(B=l());A!==null&&(B=Re())!==null?T=[T,A,B]:(T=null,t=z)}else T=null,t=z;return T},ctext:De,quoted_string:Fe,quoted_string_clean:xe,qdtext:et,quoted_pair:tt,SIP_URI_noparams:nt,SIP_URI:Dt,uri_scheme:St,uri_scheme_sips:_i,uri_scheme_sip:bn,userinfo:Tn,user:gn,user_unreserved:$r,password:nr,hostport:at,host:fe,hostname:ge,domainlabel:Ae,toplabel:Ie,IPv6reference:Ne,IPv6address:Pe,h16:me,ls32:$e,IPv4address:rt,dec_octet:Qe,port:Gt,uri_parameters:ft,uri_parameter:Et,transport_param:Jt,user_param:Ea,method_param:hs,ttl_param:ps,maddr_param:Si,lr_param:rr,other_param:wa,pname:gs,pvalue:ms,paramchar:ir,param_unreserved:vs,headers:Ra,header:Wt,hname:wt,hvalue:Mt,hnv_unreserved:Zt,Request_Response:function(){var l;return(l=La())===null&&(l=Ci()),l},Request_Line:Ci,Request_URI:Aa,absoluteURI:ys,hier_part:_s,net_path:sr,abs_path:ar,opaque_part:En,uric:en,uric_no_slash:or,path_segments:Dn,segment:ht,param:bi,pchar:lr,scheme:wn,authority:Mn,srvr:tn,reg_name:Oa,query:Ss,SIP_Version:Ti,INVITEm:ka,ACKm:qr,OPTIONSm:Vr,BYEm:nn,CANCELm:Ht,REGISTERm:Cs,SUBSCRIBEm:Ia,NOTIFYm:zr,REFERm:bs,Method:Nn,Status_Line:La,Status_Code:Bt,extension_code:Ei,Reason_Phrase:Ts,Allow_Events:function(){var l,T,A,B,z,Q;if(z=t,(l=Fn())!==null){for(T=[],Q=t,(A=te())!==null&&(B=Fn())!==null?A=[A,B]:(A=null,t=Q);A!==null;)T.push(A),Q=t,(A=te())!==null&&(B=Fn())!==null?A=[A,B]:(A=null,t=Q);T!==null?l=[l,T]:(l=null,t=z)}else l=null,t=z;return l},Call_ID:function(){var l,T,A,B,z,Q,ne;return B=t,z=t,(l=Y())!==null?(Q=t,p.charCodeAt(t)===64?(T="@",t++):(T=null,o('"@"')),T!==null&&(A=Y())!==null?T=[T,A]:(T=null,t=Q),(T=T!==null?T:"")!==null?l=[l,T]:(l=null,t=z)):(l=null,t=z),l!==null&&(ne=B,l=void(ae=p.substring(t,ne))),l===null&&(t=B),l},Contact:function(){var l,T,A,B,z,Q,ne;if(z=t,(l=Z())===null)if(Q=t,(l=cr())!==null){for(T=[],ne=t,(A=te())!==null&&(B=cr())!==null?A=[A,B]:(A=null,t=ne);A!==null;)T.push(A),ne=t,(A=te())!==null&&(B=cr())!==null?A=[A,B]:(A=null,t=ne);T!==null?l=[l,T]:(l=null,t=Q)}else l=null,t=Q;return l!==null&&(l=function(he){var ke,Ge;for(Ge=ae.multi_header.length,ke=0;ke<Ge;ke++)if(ae.multi_header[ke].parsed===null){ae=null;break}ae=ae!==null?ae.multi_header:-1}()),l===null&&(t=z),l},contact_param:cr,name_addr:Vt,display_name:Wr,contact_params:wi,c_p_q:Un,c_p_expires:Pa,delta_seconds:Rn,qvalue:Es,generic_param:dt,gen_value:Da,Content_Disposition:function(){var l,T,A,B,z,Q;if(z=t,(l=Ma())!==null){for(T=[],Q=t,(A=oe())!==null&&(B=ur())!==null?A=[A,B]:(A=null,t=Q);A!==null;)T.push(A),Q=t,(A=oe())!==null&&(B=ur())!==null?A=[A,B]:(A=null,t=Q);T!==null?l=[l,T]:(l=null,t=z)}else l=null,t=z;return l},disp_type:Ma,disp_param:ur,handling_param:Ri,Content_Encoding:function(){var l,T,A,B,z,Q;if(z=t,(l=j())!==null){for(T=[],Q=t,(A=te())!==null&&(B=j())!==null?A=[A,B]:(A=null,t=Q);A!==null;)T.push(A),Q=t,(A=te())!==null&&(B=j())!==null?A=[A,B]:(A=null,t=Q);T!==null?l=[l,T]:(l=null,t=z)}else l=null,t=z;return l},Content_Length:function(){var l,T,A;if(A=t,(T=n())!==null)for(l=[];T!==null;)l.push(T),T=n();else l=null;return l!==null&&(l=void(ae=parseInt(l.join("")))),l===null&&(t=A),l},Content_Type:function(){var l,T,A;return T=t,(l=Ai())!==null&&(A=T,l=void(ae=p.substring(t,A))),l===null&&(t=T),l},media_type:Ai,m_type:xn,discrete_type:jn,composite_type:ws,extension_token:dr,x_token:Rs,m_subtype:fr,m_parameter:Yr,m_value:hr,CSeq:function(){var l,T,A,B;return B=t,(l=mn())!==null&&(T=I())!==null&&(A=Nn())!==null?l=[l,T,A]:(l=null,t=B),l},CSeq_value:mn,Expires:function(){var l,T;return T=t,(l=Rn())!==null&&(l=void(ae=l)),l===null&&(t=T),l},Event:function(){var l,T,A,B,z,Q,ne,he;if(z=t,Q=t,(l=Fn())!==null){for(T=[],ne=t,(A=oe())!==null&&(B=dt())!==null?A=[A,B]:(A=null,t=ne);A!==null;)T.push(A),ne=t,(A=oe())!==null&&(B=dt())!==null?A=[A,B]:(A=null,t=ne);T!==null?l=[l,T]:(l=null,t=Q)}else l=null,t=Q;return l!==null&&(he=l[0],l=void(ae.event=he.join("").toLowerCase())),l===null&&(t=z),l},event_type:Fn,From:function(){var l,T,A,B,z,Q,ne;if(z=t,Q=t,(l=nt())===null&&(l=Vt()),l!==null){for(T=[],ne=t,(A=oe())!==null&&(B=pr())!==null?A=[A,B]:(A=null,t=ne);A!==null;)T.push(A),ne=t,(A=oe())!==null&&(B=pr())!==null?A=[A,B]:(A=null,t=ne);T!==null?l=[l,T]:(l=null,t=Q)}else l=null,t=Q;return l!==null&&(l=function(he){var ke=ae.tag;try{ae=new Sr(ae.uri,ae.display_name,ae.params),ke&&ae.setParam("tag",ke)}catch{ae=-1}}()),l===null&&(t=z),l},from_param:pr,tag_param:Oi,Max_Forwards:function(){var l,T,A;if(A=t,(T=n())!==null)for(l=[];T!==null;)l.push(T),T=n();else l=null;return l!==null&&(l=void(ae=parseInt(l.join("")))),l===null&&(t=A),l},Min_Expires:function(){var l,T;return T=t,(l=Rn())!==null&&(l=void(ae=l)),l===null&&(t=T),l},Name_Addr_Header:function(){var l,T,A,B,z,Q,ne,he,ke,Ge;for(he=t,ke=t,l=[],T=Wr();T!==null;)l.push(T),T=Wr();if(l!==null)if((T=Oe())!==null)if((A=Dt())!==null)if((B=pe())!==null){for(z=[],Ge=t,(Q=oe())!==null&&(ne=dt())!==null?Q=[Q,ne]:(Q=null,t=Ge);Q!==null;)z.push(Q),Ge=t,(Q=oe())!==null&&(ne=dt())!==null?Q=[Q,ne]:(Q=null,t=Ge);z!==null?l=[l,T,A,B,z]:(l=null,t=ke)}else l=null,t=ke;else l=null,t=ke;else l=null,t=ke;else l=null,t=ke;return l!==null&&(l=function(kt){try{ae=new Sr(ae.uri,ae.display_name,ae.params)}catch{ae=-1}}()),l===null&&(t=he),l},Proxy_Authenticate:function(){return gr()},challenge:gr,other_challenge:Qr,auth_param:mr,digest_cln:Rt,realm:An,realm_value:Kr,domain:vr,URI:ki,nonce:Ii,nonce_value:Li,opaque:yr,stale:Xr,algorithm:As,qop_options:Na,qop_value:Pi,Proxy_Require:function(){var l,T,A,B,z,Q;if(z=t,(l=j())!==null){for(T=[],Q=t,(A=te())!==null&&(B=j())!==null?A=[A,B]:(A=null,t=Q);A!==null;)T.push(A),Q=t,(A=te())!==null&&(B=j())!==null?A=[A,B]:(A=null,t=Q);T!==null?l=[l,T]:(l=null,t=z)}else l=null,t=z;return l},Record_Route:function(){var l,T,A,B,z,Q,ne;if(z=t,Q=t,(l=Di())!==null){for(T=[],ne=t,(A=te())!==null&&(B=Di())!==null?A=[A,B]:(A=null,t=ne);A!==null;)T.push(A),ne=t,(A=te())!==null&&(B=Di())!==null?A=[A,B]:(A=null,t=ne);T!==null?l=[l,T]:(l=null,t=Q)}else l=null,t=Q;return l!==null&&(l=function(he){var ke,Ge;for(Ge=ae.multi_header.length,ke=0;ke<Ge;ke++)if(ae.multi_header[ke].parsed===null){ae=null;break}ae=ae!==null?ae.multi_header:-1}()),l===null&&(t=z),l},rec_route:Di,Reason:function(){var l,T,A,B,z,Q,ne;if(z=t,Q=t,p.substr(t,3).toLowerCase()==="sip"?(l=p.substr(t,3),t+=3):(l=null,o('"SIP"')),l===null&&(l=j()),l!==null){for(T=[],ne=t,(A=oe())!==null&&(B=Jr())!==null?A=[A,B]:(A=null,t=ne);A!==null;)T.push(A),ne=t,(A=oe())!==null&&(B=Jr())!==null?A=[A,B]:(A=null,t=ne);T!==null?l=[l,T]:(l=null,t=Q)}else l=null,t=Q;return l!==null&&(l=function(he,ke){if(ae.protocol=ke.toLowerCase(),ae.params||(ae.params={}),ae.params.text&&ae.params.text[0]==='"'){var Ge=ae.params.text;ae.text=Ge.substring(1,Ge.length-1),delete ae.params.text}}(0,l[0])),l===null&&(t=z),l},reason_param:Jr,reason_cause:Ua,Require:function(){var l,T,A,B,z,Q;if(z=t,(l=j())!==null){for(T=[],Q=t,(A=te())!==null&&(B=j())!==null?A=[A,B]:(A=null,t=Q);A!==null;)T.push(A),Q=t,(A=te())!==null&&(B=j())!==null?A=[A,B]:(A=null,t=Q);T!==null?l=[l,T]:(l=null,t=z)}else l=null,t=z;return l},Route:function(){var l,T,A,B,z,Q;if(z=t,(l=Mi())!==null){for(T=[],Q=t,(A=te())!==null&&(B=Mi())!==null?A=[A,B]:(A=null,t=Q);A!==null;)T.push(A),Q=t,(A=te())!==null&&(B=Mi())!==null?A=[A,B]:(A=null,t=Q);T!==null?l=[l,T]:(l=null,t=z)}else l=null,t=z;return l},route_param:Mi,Subscription_State:function(){var l,T,A,B,z,Q;if(z=t,(l=xa())!==null){for(T=[],Q=t,(A=oe())!==null&&(B=Os())!==null?A=[A,B]:(A=null,t=Q);A!==null;)T.push(A),Q=t,(A=oe())!==null&&(B=Os())!==null?A=[A,B]:(A=null,t=Q);T!==null?l=[l,T]:(l=null,t=z)}else l=null,t=z;return l},substate_value:xa,subexp_params:Os,event_reason_value:ja,Subject:function(){var l;return(l=F())!==null?l:""},Supported:function(){var l,T,A,B,z,Q;if(z=t,(l=j())!==null){for(T=[],Q=t,(A=te())!==null&&(B=j())!==null?A=[A,B]:(A=null,t=Q);A!==null;)T.push(A),Q=t,(A=te())!==null&&(B=j())!==null?A=[A,B]:(A=null,t=Q);T!==null?l=[l,T]:(l=null,t=z)}else l=null,t=z;return l!==null?l:""},To:function(){var l,T,A,B,z,Q,ne;if(z=t,Q=t,(l=nt())===null&&(l=Vt()),l!==null){for(T=[],ne=t,(A=oe())!==null&&(B=Ni())!==null?A=[A,B]:(A=null,t=ne);A!==null;)T.push(A),ne=t,(A=oe())!==null&&(B=Ni())!==null?A=[A,B]:(A=null,t=ne);T!==null?l=[l,T]:(l=null,t=Q)}else l=null,t=Q;return l!==null&&(l=function(he){var ke=ae.tag;try{ae=new Sr(ae.uri,ae.display_name,ae.params),ke&&ae.setParam("tag",ke)}catch{ae=-1}}()),l===null&&(t=z),l},to_param:Ni,Via:function(){var l,T,A,B,z,Q;if(z=t,(l=Ui())!==null){for(T=[],Q=t,(A=te())!==null&&(B=Ui())!==null?A=[A,B]:(A=null,t=Q);A!==null;)T.push(A),Q=t,(A=te())!==null&&(B=Ui())!==null?A=[A,B]:(A=null,t=Q);T!==null?l=[l,T]:(l=null,t=z)}else l=null,t=z;return l},via_param:Ui,via_params:ks,via_ttl:Fa,via_maddr:Ga,via_received:xi,via_branch:Ha,response_port:Ba,rport:$a,sent_protocol:Is,protocol_name:qa,transport:Va,sent_by:za,via_host:Wa,via_port:Ya,ttl:Ls,WWW_Authenticate:function(){return gr()},Session_Expires:function(){var l,T,A,B,z,Q;if(z=t,(l=Qa())!==null){for(T=[],Q=t,(A=oe())!==null&&(B=Ps())!==null?A=[A,B]:(A=null,t=Q);A!==null;)T.push(A),Q=t,(A=oe())!==null&&(B=Ps())!==null?A=[A,B]:(A=null,t=Q);T!==null?l=[l,T]:(l=null,t=z)}else l=null,t=z;return l},s_e_expires:Qa,s_e_params:Ps,s_e_refresher:Ka,extension_header:function(){var l,T,A,B;return B=t,(l=j())!==null&&(T=P())!==null&&(A=ji())!==null?l=[l,T,A]:(l=null,t=B),l},header_value:ji,message_body:function(){var l,T;for(l=[],T=u();T!==null;)l.push(T),T=u();return l},uuid_URI:function(){var l,T,A;return A=t,p.substr(t,5)==="uuid:"?(l="uuid:",t+=5):(l=null,o('"uuid:"')),l!==null&&(T=_r())!==null?l=[l,T]:(l=null,t=A),l},uuid:_r,hex4:vn,hex8:Ds,hex12:Ms,Refer_To:function(){var l,T,A,B,z,Q,ne;if(z=t,Q=t,(l=nt())===null&&(l=Vt()),l!==null){for(T=[],ne=t,(A=oe())!==null&&(B=dt())!==null?A=[A,B]:(A=null,t=ne);A!==null;)T.push(A),ne=t,(A=oe())!==null&&(B=dt())!==null?A=[A,B]:(A=null,t=ne);T!==null?l=[l,T]:(l=null,t=Q)}else l=null,t=Q;return l!==null&&(l=function(he){try{ae=new Sr(ae.uri,ae.display_name,ae.params)}catch{ae=-1}}()),l===null&&(t=z),l},Replaces:function(){var l,T,A,B,z,Q;if(z=t,(l=Ns())!==null){for(T=[],Q=t,(A=oe())!==null&&(B=Fi())!==null?A=[A,B]:(A=null,t=Q);A!==null;)T.push(A),Q=t,(A=oe())!==null&&(B=Fi())!==null?A=[A,B]:(A=null,t=Q);T!==null?l=[l,T]:(l=null,t=z)}else l=null,t=z;return l},call_id:Ns,replaces_param:Fi,to_tag:Us,from_tag:Gn,early_flag:Xa};if(b!==void 0){if(_[b]===void 0)throw new Error("Invalid rule name: "+N(b)+".")}else b="CRLF";var t=0,m=0,f=[];function o(l){t<m||(t>m&&(m=t,f=[]),f.push(l))}function s(){var l;return p.substr(t,2)===`\r
`?(l=`\r
`,t+=2):(l=null,o('"\\r\\n"')),l}function n(){var l;return/^[0-9]/.test(p.charAt(t))?(l=p.charAt(t),t++):(l=null,o("[0-9]")),l}function i(){var l;return/^[a-zA-Z]/.test(p.charAt(t))?(l=p.charAt(t),t++):(l=null,o("[a-zA-Z]")),l}function a(){var l;return/^[0-9a-fA-F]/.test(p.charAt(t))?(l=p.charAt(t),t++):(l=null,o("[0-9a-fA-F]")),l}function c(){var l;return(l=h())===null&&(l=C()),l}function u(){var l;return/^[\0-\xFF]/.test(p.charAt(t))?(l=p.charAt(t),t++):(l=null,o("[\\0-\\xFF]")),l}function g(){var l;return/^["]/.test(p.charAt(t))?(l=p.charAt(t),t++):(l=null,o('["]')),l}function h(){var l;return p.charCodeAt(t)===32?(l=" ",t++):(l=null,o('" "')),l}function C(){var l;return p.charCodeAt(t)===9?(l="	",t++):(l=null,o('"\\t"')),l}function E(){var l;return/^[a-zA-Z0-9]/.test(p.charAt(t))?(l=p.charAt(t),t++):(l=null,o("[a-zA-Z0-9]")),l}function y(){var l;return p.charCodeAt(t)===59?(l=";",t++):(l=null,o('";"')),l===null&&(p.charCodeAt(t)===47?(l="/",t++):(l=null,o('"/"')),l===null&&(p.charCodeAt(t)===63?(l="?",t++):(l=null,o('"?"')),l===null&&(p.charCodeAt(t)===58?(l=":",t++):(l=null,o('":"')),l===null&&(p.charCodeAt(t)===64?(l="@",t++):(l=null,o('"@"')),l===null&&(p.charCodeAt(t)===38?(l="&",t++):(l=null,o('"&"')),l===null&&(p.charCodeAt(t)===61?(l="=",t++):(l=null,o('"="')),l===null&&(p.charCodeAt(t)===43?(l="+",t++):(l=null,o('"+"')),l===null&&(p.charCodeAt(t)===36?(l="$",t++):(l=null,o('"$"')),l===null&&(p.charCodeAt(t)===44?(l=",",t++):(l=null,o('","'))))))))))),l}function w(){var l;return(l=E())===null&&(l=O()),l}function O(){var l;return p.charCodeAt(t)===45?(l="-",t++):(l=null,o('"-"')),l===null&&(p.charCodeAt(t)===95?(l="_",t++):(l=null,o('"_"')),l===null&&(p.charCodeAt(t)===46?(l=".",t++):(l=null,o('"."')),l===null&&(p.charCodeAt(t)===33?(l="!",t++):(l=null,o('"!"')),l===null&&(p.charCodeAt(t)===126?(l="~",t++):(l=null,o('"~"')),l===null&&(p.charCodeAt(t)===42?(l="*",t++):(l=null,o('"*"')),l===null&&(p.charCodeAt(t)===39?(l="'",t++):(l=null,o(`"'"`)),l===null&&(p.charCodeAt(t)===40?(l="(",t++):(l=null,o('"("')),l===null&&(p.charCodeAt(t)===41?(l=")",t++):(l=null,o('")"')))))))))),l}function L(){var l,T,A,B,z;return B=t,z=t,p.charCodeAt(t)===37?(l="%",t++):(l=null,o('"%"')),l!==null&&(T=a())!==null&&(A=a())!==null?l=[l,T,A]:(l=null,t=z),l!==null&&(l=l.join("")),l===null&&(t=B),l}function I(){var l,T,A,B,z,Q;for(B=t,z=t,Q=t,l=[],T=c();T!==null;)l.push(T),T=c();if(l!==null&&(T=s())!==null?l=[l,T]:(l=null,t=Q),(l=l!==null?l:"")!==null){if((A=c())!==null)for(T=[];A!==null;)T.push(A),A=c();else T=null;T!==null?l=[l,T]:(l=null,t=z)}else l=null,t=z;return l!==null&&(l=" "),l===null&&(t=B),l}function k(){var l;return(l=I())!==null?l:""}function P(){var l,T,A,B,z;for(B=t,z=t,l=[],(T=h())===null&&(T=C());T!==null;)l.push(T),(T=h())===null&&(T=C());return l!==null?(p.charCodeAt(t)===58?(T=":",t++):(T=null,o('":"')),T!==null&&(A=k())!==null?l=[l,T,A]:(l=null,t=z)):(l=null,t=z),l!==null&&(l=":"),l===null&&(t=B),l}function F(){var l,T,A,B,z,Q,ne,he;if(z=t,Q=t,(T=H())!==null)for(l=[];T!==null;)l.push(T),T=H();else l=null;if(l!==null){for(T=[],ne=t,A=[],B=I();B!==null;)A.push(B),B=I();for(A!==null&&(B=H())!==null?A=[A,B]:(A=null,t=ne);A!==null;){for(T.push(A),ne=t,A=[],B=I();B!==null;)A.push(B),B=I();A!==null&&(B=H())!==null?A=[A,B]:(A=null,t=ne)}T!==null?l=[l,T]:(l=null,t=Q)}else l=null,t=Q;return l!==null&&(he=z,l=p.substring(t,he)),l===null&&(t=z),l}function H(){var l;return/^[!-~]/.test(p.charAt(t))?(l=p.charAt(t),t++):(l=null,o("[!-~]")),l===null&&(l=D()),l}function D(){var l;return/^[\x80-\uFFFF]/.test(p.charAt(t))?(l=p.charAt(t),t++):(l=null,o("[\\x80-\\uFFFF]")),l}function $(){var l;return/^[\x80-\xBF]/.test(p.charAt(t))?(l=p.charAt(t),t++):(l=null,o("[\\x80-\\xBF]")),l}function j(){var l,T,A,B;if(A=t,(T=E())===null&&(p.charCodeAt(t)===45?(T="-",t++):(T=null,o('"-"')),T===null&&(p.charCodeAt(t)===46?(T=".",t++):(T=null,o('"."')),T===null&&(p.charCodeAt(t)===33?(T="!",t++):(T=null,o('"!"')),T===null&&(p.charCodeAt(t)===37?(T="%",t++):(T=null,o('"%"')),T===null&&(p.charCodeAt(t)===42?(T="*",t++):(T=null,o('"*"')),T===null&&(p.charCodeAt(t)===95?(T="_",t++):(T=null,o('"_"')),T===null&&(p.charCodeAt(t)===43?(T="+",t++):(T=null,o('"+"')),T===null&&(p.charCodeAt(t)===96?(T="`",t++):(T=null,o('"`"')),T===null&&(p.charCodeAt(t)===39?(T="'",t++):(T=null,o(`"'"`)),T===null&&(p.charCodeAt(t)===126?(T="~",t++):(T=null,o('"~"')))))))))))),T!==null)for(l=[];T!==null;)l.push(T),(T=E())===null&&(p.charCodeAt(t)===45?(T="-",t++):(T=null,o('"-"')),T===null&&(p.charCodeAt(t)===46?(T=".",t++):(T=null,o('"."')),T===null&&(p.charCodeAt(t)===33?(T="!",t++):(T=null,o('"!"')),T===null&&(p.charCodeAt(t)===37?(T="%",t++):(T=null,o('"%"')),T===null&&(p.charCodeAt(t)===42?(T="*",t++):(T=null,o('"*"')),T===null&&(p.charCodeAt(t)===95?(T="_",t++):(T=null,o('"_"')),T===null&&(p.charCodeAt(t)===43?(T="+",t++):(T=null,o('"+"')),T===null&&(p.charCodeAt(t)===96?(T="`",t++):(T=null,o('"`"')),T===null&&(p.charCodeAt(t)===39?(T="'",t++):(T=null,o(`"'"`)),T===null&&(p.charCodeAt(t)===126?(T="~",t++):(T=null,o('"~"'))))))))))));else l=null;return l!==null&&(B=A,l=p.substring(t,B)),l===null&&(t=A),l}function V(){var l,T,A,B;if(A=t,(T=E())===null&&(p.charCodeAt(t)===45?(T="-",t++):(T=null,o('"-"')),T===null&&(p.charCodeAt(t)===33?(T="!",t++):(T=null,o('"!"')),T===null&&(p.charCodeAt(t)===37?(T="%",t++):(T=null,o('"%"')),T===null&&(p.charCodeAt(t)===42?(T="*",t++):(T=null,o('"*"')),T===null&&(p.charCodeAt(t)===95?(T="_",t++):(T=null,o('"_"')),T===null&&(p.charCodeAt(t)===43?(T="+",t++):(T=null,o('"+"')),T===null&&(p.charCodeAt(t)===96?(T="`",t++):(T=null,o('"`"')),T===null&&(p.charCodeAt(t)===39?(T="'",t++):(T=null,o(`"'"`)),T===null&&(p.charCodeAt(t)===126?(T="~",t++):(T=null,o('"~"'))))))))))),T!==null)for(l=[];T!==null;)l.push(T),(T=E())===null&&(p.charCodeAt(t)===45?(T="-",t++):(T=null,o('"-"')),T===null&&(p.charCodeAt(t)===33?(T="!",t++):(T=null,o('"!"')),T===null&&(p.charCodeAt(t)===37?(T="%",t++):(T=null,o('"%"')),T===null&&(p.charCodeAt(t)===42?(T="*",t++):(T=null,o('"*"')),T===null&&(p.charCodeAt(t)===95?(T="_",t++):(T=null,o('"_"')),T===null&&(p.charCodeAt(t)===43?(T="+",t++):(T=null,o('"+"')),T===null&&(p.charCodeAt(t)===96?(T="`",t++):(T=null,o('"`"')),T===null&&(p.charCodeAt(t)===39?(T="'",t++):(T=null,o(`"'"`)),T===null&&(p.charCodeAt(t)===126?(T="~",t++):(T=null,o('"~"')))))))))));else l=null;return l!==null&&(B=A,l=p.substring(t,B)),l===null&&(t=A),l}function Y(){var l,T,A,B;if(A=t,(T=E())===null&&(p.charCodeAt(t)===45?(T="-",t++):(T=null,o('"-"')),T===null&&(p.charCodeAt(t)===46?(T=".",t++):(T=null,o('"."')),T===null&&(p.charCodeAt(t)===33?(T="!",t++):(T=null,o('"!"')),T===null&&(p.charCodeAt(t)===37?(T="%",t++):(T=null,o('"%"')),T===null&&(p.charCodeAt(t)===42?(T="*",t++):(T=null,o('"*"')),T===null&&(p.charCodeAt(t)===95?(T="_",t++):(T=null,o('"_"')),T===null&&(p.charCodeAt(t)===43?(T="+",t++):(T=null,o('"+"')),T===null&&(p.charCodeAt(t)===96?(T="`",t++):(T=null,o('"`"')),T===null&&(p.charCodeAt(t)===39?(T="'",t++):(T=null,o(`"'"`)),T===null&&(p.charCodeAt(t)===126?(T="~",t++):(T=null,o('"~"')),T===null&&(p.charCodeAt(t)===40?(T="(",t++):(T=null,o('"("')),T===null&&(p.charCodeAt(t)===41?(T=")",t++):(T=null,o('")"')),T===null&&(p.charCodeAt(t)===60?(T="<",t++):(T=null,o('"<"')),T===null&&(p.charCodeAt(t)===62?(T=">",t++):(T=null,o('">"')),T===null&&(p.charCodeAt(t)===58?(T=":",t++):(T=null,o('":"')),T===null&&(p.charCodeAt(t)===92?(T="\\",t++):(T=null,o('"\\\\"')),T===null&&(T=g())===null&&(p.charCodeAt(t)===47?(T="/",t++):(T=null,o('"/"')),T===null&&(p.charCodeAt(t)===91?(T="[",t++):(T=null,o('"["')),T===null&&(p.charCodeAt(t)===93?(T="]",t++):(T=null,o('"]"')),T===null&&(p.charCodeAt(t)===63?(T="?",t++):(T=null,o('"?"')),T===null&&(p.charCodeAt(t)===123?(T="{",t++):(T=null,o('"{"')),T===null&&(p.charCodeAt(t)===125?(T="}",t++):(T=null,o('"}"')))))))))))))))))))))))),T!==null)for(l=[];T!==null;)l.push(T),(T=E())===null&&(p.charCodeAt(t)===45?(T="-",t++):(T=null,o('"-"')),T===null&&(p.charCodeAt(t)===46?(T=".",t++):(T=null,o('"."')),T===null&&(p.charCodeAt(t)===33?(T="!",t++):(T=null,o('"!"')),T===null&&(p.charCodeAt(t)===37?(T="%",t++):(T=null,o('"%"')),T===null&&(p.charCodeAt(t)===42?(T="*",t++):(T=null,o('"*"')),T===null&&(p.charCodeAt(t)===95?(T="_",t++):(T=null,o('"_"')),T===null&&(p.charCodeAt(t)===43?(T="+",t++):(T=null,o('"+"')),T===null&&(p.charCodeAt(t)===96?(T="`",t++):(T=null,o('"`"')),T===null&&(p.charCodeAt(t)===39?(T="'",t++):(T=null,o(`"'"`)),T===null&&(p.charCodeAt(t)===126?(T="~",t++):(T=null,o('"~"')),T===null&&(p.charCodeAt(t)===40?(T="(",t++):(T=null,o('"("')),T===null&&(p.charCodeAt(t)===41?(T=")",t++):(T=null,o('")"')),T===null&&(p.charCodeAt(t)===60?(T="<",t++):(T=null,o('"<"')),T===null&&(p.charCodeAt(t)===62?(T=">",t++):(T=null,o('">"')),T===null&&(p.charCodeAt(t)===58?(T=":",t++):(T=null,o('":"')),T===null&&(p.charCodeAt(t)===92?(T="\\",t++):(T=null,o('"\\\\"')),T===null&&(T=g())===null&&(p.charCodeAt(t)===47?(T="/",t++):(T=null,o('"/"')),T===null&&(p.charCodeAt(t)===91?(T="[",t++):(T=null,o('"["')),T===null&&(p.charCodeAt(t)===93?(T="]",t++):(T=null,o('"]"')),T===null&&(p.charCodeAt(t)===63?(T="?",t++):(T=null,o('"?"')),T===null&&(p.charCodeAt(t)===123?(T="{",t++):(T=null,o('"{"')),T===null&&(p.charCodeAt(t)===125?(T="}",t++):(T=null,o('"}"'))))))))))))))))))))))));else l=null;return l!==null&&(B=A,l=p.substring(t,B)),l===null&&(t=A),l}function Z(){var l,T,A,B,z;return B=t,z=t,(l=k())!==null?(p.charCodeAt(t)===42?(T="*",t++):(T=null,o('"*"')),T!==null&&(A=k())!==null?l=[l,T,A]:(l=null,t=z)):(l=null,t=z),l!==null&&(l="*"),l===null&&(t=B),l}function J(){var l,T,A,B,z;return B=t,z=t,(l=k())!==null?(p.charCodeAt(t)===47?(T="/",t++):(T=null,o('"/"')),T!==null&&(A=k())!==null?l=[l,T,A]:(l=null,t=z)):(l=null,t=z),l!==null&&(l="/"),l===null&&(t=B),l}function re(){var l,T,A,B,z;return B=t,z=t,(l=k())!==null?(p.charCodeAt(t)===61?(T="=",t++):(T=null,o('"="')),T!==null&&(A=k())!==null?l=[l,T,A]:(l=null,t=z)):(l=null,t=z),l!==null&&(l="="),l===null&&(t=B),l}function ce(){var l,T,A,B,z;return B=t,z=t,(l=k())!==null?(p.charCodeAt(t)===40?(T="(",t++):(T=null,o('"("')),T!==null&&(A=k())!==null?l=[l,T,A]:(l=null,t=z)):(l=null,t=z),l!==null&&(l="("),l===null&&(t=B),l}function Re(){var l,T,A,B,z;return B=t,z=t,(l=k())!==null?(p.charCodeAt(t)===41?(T=")",t++):(T=null,o('")"')),T!==null&&(A=k())!==null?l=[l,T,A]:(l=null,t=z)):(l=null,t=z),l!==null&&(l=")"),l===null&&(t=B),l}function pe(){var l,T,A,B;return A=t,B=t,p.charCodeAt(t)===62?(l=">",t++):(l=null,o('">"')),l!==null&&(T=k())!==null?l=[l,T]:(l=null,t=B),l!==null&&(l=">"),l===null&&(t=A),l}function Oe(){var l,T,A,B;return A=t,B=t,(l=k())!==null?(p.charCodeAt(t)===60?(T="<",t++):(T=null,o('"<"')),T!==null?l=[l,T]:(l=null,t=B)):(l=null,t=B),l!==null&&(l="<"),l===null&&(t=A),l}function te(){var l,T,A,B,z;return B=t,z=t,(l=k())!==null?(p.charCodeAt(t)===44?(T=",",t++):(T=null,o('","')),T!==null&&(A=k())!==null?l=[l,T,A]:(l=null,t=z)):(l=null,t=z),l!==null&&(l=","),l===null&&(t=B),l}function oe(){var l,T,A,B,z;return B=t,z=t,(l=k())!==null?(p.charCodeAt(t)===59?(T=";",t++):(T=null,o('";"')),T!==null&&(A=k())!==null?l=[l,T,A]:(l=null,t=z)):(l=null,t=z),l!==null&&(l=";"),l===null&&(t=B),l}function _e(){var l,T,A,B,z;return B=t,z=t,(l=k())!==null?(p.charCodeAt(t)===58?(T=":",t++):(T=null,o('":"')),T!==null&&(A=k())!==null?l=[l,T,A]:(l=null,t=z)):(l=null,t=z),l!==null&&(l=":"),l===null&&(t=B),l}function we(){var l,T,A,B;return A=t,B=t,(l=k())!==null&&(T=g())!==null?l=[l,T]:(l=null,t=B),l!==null&&(l='"'),l===null&&(t=A),l}function Ee(){var l,T,A,B;return A=t,B=t,(l=g())!==null&&(T=k())!==null?l=[l,T]:(l=null,t=B),l!==null&&(l='"'),l===null&&(t=A),l}function De(){var l;return/^[!-']/.test(p.charAt(t))?(l=p.charAt(t),t++):(l=null,o("[!-']")),l===null&&(/^[*-[]/.test(p.charAt(t))?(l=p.charAt(t),t++):(l=null,o("[*-[]")),l===null&&(/^[\]-~]/.test(p.charAt(t))?(l=p.charAt(t),t++):(l=null,o("[\\]-~]")),l===null&&(l=D())===null&&(l=I()))),l}function Fe(){var l,T,A,B,z,Q,ne;if(z=t,Q=t,(l=k())!==null)if((T=g())!==null){for(A=[],(B=et())===null&&(B=tt());B!==null;)A.push(B),(B=et())===null&&(B=tt());A!==null&&(B=g())!==null?l=[l,T,A,B]:(l=null,t=Q)}else l=null,t=Q;else l=null,t=Q;return l!==null&&(ne=z,l=p.substring(t,ne)),l===null&&(t=z),l}function xe(){var l,T,A,B,z,Q,ne,he;if(z=t,Q=t,(l=k())!==null)if((T=g())!==null){for(A=[],(B=et())===null&&(B=tt());B!==null;)A.push(B),(B=et())===null&&(B=tt());A!==null&&(B=g())!==null?l=[l,T,A,B]:(l=null,t=Q)}else l=null,t=Q;else l=null,t=Q;return l!==null&&(ne=z,l=(he=p.substring(t,ne).trim()).substring(1,he.length-1).replace(/\\([\x00-\x09\x0b-\x0c\x0e-\x7f])/g,"$1")),l===null&&(t=z),l}function et(){var l;return(l=I())===null&&(p.charCodeAt(t)===33?(l="!",t++):(l=null,o('"!"')),l===null&&(/^[#-[]/.test(p.charAt(t))?(l=p.charAt(t),t++):(l=null,o("[#-[]")),l===null&&(/^[\]-~]/.test(p.charAt(t))?(l=p.charAt(t),t++):(l=null,o("[\\]-~]")),l===null&&(l=D())))),l}function tt(){var l,T,A;return A=t,p.charCodeAt(t)===92?(l="\\",t++):(l=null,o('"\\\\"')),l!==null?(/^[\0-\t]/.test(p.charAt(t))?(T=p.charAt(t),t++):(T=null,o("[\\0-\\t]")),T===null&&(/^[\x0B-\f]/.test(p.charAt(t))?(T=p.charAt(t),t++):(T=null,o("[\\x0B-\\f]")),T===null&&(/^[\x0E-]/.test(p.charAt(t))?(T=p.charAt(t),t++):(T=null,o("[\\x0E-]")))),T!==null?l=[l,T]:(l=null,t=A)):(l=null,t=A),l}function nt(){var l,T,A,B,z,Q;return z=t,Q=t,(l=St())!==null?(p.charCodeAt(t)===58?(T=":",t++):(T=null,o('":"')),T!==null&&(A=(A=Tn())!==null?A:"")!==null&&(B=at())!==null?l=[l,T,A,B]:(l=null,t=Q)):(l=null,t=Q),l!==null&&(l=function(ne){try{ae.uri=new Ja(ae.scheme,ae.user,ae.host,ae.port),delete ae.scheme,delete ae.user,delete ae.host,delete ae.host_type,delete ae.port}catch{ae=-1}}()),l===null&&(t=z),l}function Dt(){var l,T,A,B,z,Q,ne,he;return ne=t,he=t,(l=St())!==null?(p.charCodeAt(t)===58?(T=":",t++):(T=null,o('":"')),T!==null&&(A=(A=Tn())!==null?A:"")!==null&&(B=at())!==null&&(z=ft())!==null&&(Q=(Q=Ra())!==null?Q:"")!==null?l=[l,T,A,B,z,Q]:(l=null,t=he)):(l=null,t=he),l!==null&&(l=function(ke){try{ae.uri=new Ja(ae.scheme,ae.user,ae.host,ae.port,ae.uri_params,ae.uri_headers),delete ae.scheme,delete ae.user,delete ae.host,delete ae.host_type,delete ae.port,delete ae.uri_params,b==="SIP_URI"&&(ae=ae.uri)}catch{ae=-1}}()),l===null&&(t=ne),l}function St(){var l;return(l=_i())===null&&(l=bn()),l}function _i(){var l,T,A;return T=t,p.substr(t,4).toLowerCase()==="sips"?(l=p.substr(t,4),t+=4):(l=null,o('"sips"')),l!==null&&(A=l,l=void(ae.scheme=A.toLowerCase())),l===null&&(t=T),l}function bn(){var l,T,A;return T=t,p.substr(t,3).toLowerCase()==="sip"?(l=p.substr(t,3),t+=3):(l=null,o('"sip"')),l!==null&&(A=l,l=void(ae.scheme=A.toLowerCase())),l===null&&(t=T),l}function Tn(){var l,T,A,B,z,Q,ne;return B=t,z=t,(l=gn())!==null?(Q=t,p.charCodeAt(t)===58?(T=":",t++):(T=null,o('":"')),T!==null&&(A=nr())!==null?T=[T,A]:(T=null,t=Q),(T=T!==null?T:"")!==null?(p.charCodeAt(t)===64?(A="@",t++):(A=null,o('"@"')),A!==null?l=[l,T,A]:(l=null,t=z)):(l=null,t=z)):(l=null,t=z),l!==null&&(ne=B,l=void(ae.user=decodeURIComponent(p.substring(t-1,ne)))),l===null&&(t=B),l}function gn(){var l,T;if((T=w())===null&&(T=L())===null&&(T=$r()),T!==null)for(l=[];T!==null;)l.push(T),(T=w())===null&&(T=L())===null&&(T=$r());else l=null;return l}function $r(){var l;return p.charCodeAt(t)===38?(l="&",t++):(l=null,o('"&"')),l===null&&(p.charCodeAt(t)===61?(l="=",t++):(l=null,o('"="')),l===null&&(p.charCodeAt(t)===43?(l="+",t++):(l=null,o('"+"')),l===null&&(p.charCodeAt(t)===36?(l="$",t++):(l=null,o('"$"')),l===null&&(p.charCodeAt(t)===44?(l=",",t++):(l=null,o('","')),l===null&&(p.charCodeAt(t)===59?(l=";",t++):(l=null,o('";"')),l===null&&(p.charCodeAt(t)===63?(l="?",t++):(l=null,o('"?"')),l===null&&(p.charCodeAt(t)===47?(l="/",t++):(l=null,o('"/"'))))))))),l}function nr(){var l,T,A,B;for(A=t,l=[],(T=w())===null&&(T=L())===null&&(p.charCodeAt(t)===38?(T="&",t++):(T=null,o('"&"')),T===null&&(p.charCodeAt(t)===61?(T="=",t++):(T=null,o('"="')),T===null&&(p.charCodeAt(t)===43?(T="+",t++):(T=null,o('"+"')),T===null&&(p.charCodeAt(t)===36?(T="$",t++):(T=null,o('"$"')),T===null&&(p.charCodeAt(t)===44?(T=",",t++):(T=null,o('","')))))));T!==null;)l.push(T),(T=w())===null&&(T=L())===null&&(p.charCodeAt(t)===38?(T="&",t++):(T=null,o('"&"')),T===null&&(p.charCodeAt(t)===61?(T="=",t++):(T=null,o('"="')),T===null&&(p.charCodeAt(t)===43?(T="+",t++):(T=null,o('"+"')),T===null&&(p.charCodeAt(t)===36?(T="$",t++):(T=null,o('"$"')),T===null&&(p.charCodeAt(t)===44?(T=",",t++):(T=null,o('","')))))));return l!==null&&(B=A,l=void(ae.password=p.substring(t,B))),l===null&&(t=A),l}function at(){var l,T,A,B,z;return B=t,(l=fe())!==null?(z=t,p.charCodeAt(t)===58?(T=":",t++):(T=null,o('":"')),T!==null&&(A=Gt())!==null?T=[T,A]:(T=null,t=z),(T=T!==null?T:"")!==null?l=[l,T]:(l=null,t=B)):(l=null,t=B),l}function fe(){var l,T,A;return T=t,(l=ge())===null&&(l=rt())===null&&(l=Ne()),l!==null&&(A=T,ae.host=p.substring(t,A).toLowerCase(),l=ae.host),l===null&&(t=T),l}function ge(){var l,T,A,B,z,Q,ne;for(B=t,z=t,l=[],Q=t,(T=Ae())!==null?(p.charCodeAt(t)===46?(A=".",t++):(A=null,o('"."')),A!==null?T=[T,A]:(T=null,t=Q)):(T=null,t=Q);T!==null;)l.push(T),Q=t,(T=Ae())!==null?(p.charCodeAt(t)===46?(A=".",t++):(A=null,o('"."')),A!==null?T=[T,A]:(T=null,t=Q)):(T=null,t=Q);return l!==null&&(T=Ie())!==null?(p.charCodeAt(t)===46?(A=".",t++):(A=null,o('"."')),(A=A!==null?A:"")!==null?l=[l,T,A]:(l=null,t=z)):(l=null,t=z),l!==null&&(ne=B,ae.host_type="domain",l=p.substring(t,ne)),l===null&&(t=B),l}function Ae(){var l,T,A,B;if(B=t,(l=E())!==null){for(T=[],(A=E())===null&&(p.charCodeAt(t)===45?(A="-",t++):(A=null,o('"-"')),A===null&&(p.charCodeAt(t)===95?(A="_",t++):(A=null,o('"_"'))));A!==null;)T.push(A),(A=E())===null&&(p.charCodeAt(t)===45?(A="-",t++):(A=null,o('"-"')),A===null&&(p.charCodeAt(t)===95?(A="_",t++):(A=null,o('"_"'))));T!==null?l=[l,T]:(l=null,t=B)}else l=null,t=B;return l}function Ie(){var l,T,A,B;if(B=t,(l=i())!==null){for(T=[],(A=E())===null&&(p.charCodeAt(t)===45?(A="-",t++):(A=null,o('"-"')),A===null&&(p.charCodeAt(t)===95?(A="_",t++):(A=null,o('"_"'))));A!==null;)T.push(A),(A=E())===null&&(p.charCodeAt(t)===45?(A="-",t++):(A=null,o('"-"')),A===null&&(p.charCodeAt(t)===95?(A="_",t++):(A=null,o('"_"'))));T!==null?l=[l,T]:(l=null,t=B)}else l=null,t=B;return l}function Ne(){var l,T,A,B,z,Q;return B=t,z=t,p.charCodeAt(t)===91?(l="[",t++):(l=null,o('"["')),l!==null&&(T=Pe())!==null?(p.charCodeAt(t)===93?(A="]",t++):(A=null,o('"]"')),A!==null?l=[l,T,A]:(l=null,t=z)):(l=null,t=z),l!==null&&(Q=B,ae.host_type="IPv6",l=p.substring(t,Q)),l===null&&(t=B),l}function Pe(){var l,T,A,B,z,Q,ne,he,ke,Ge,kt,rn,Za,xs,be,Be,js;return xs=t,be=t,(l=me())!==null?(p.charCodeAt(t)===58?(T=":",t++):(T=null,o('":"')),T!==null&&(A=me())!==null?(p.charCodeAt(t)===58?(B=":",t++):(B=null,o('":"')),B!==null&&(z=me())!==null?(p.charCodeAt(t)===58?(Q=":",t++):(Q=null,o('":"')),Q!==null&&(ne=me())!==null?(p.charCodeAt(t)===58?(he=":",t++):(he=null,o('":"')),he!==null&&(ke=me())!==null?(p.charCodeAt(t)===58?(Ge=":",t++):(Ge=null,o('":"')),Ge!==null&&(kt=me())!==null?(p.charCodeAt(t)===58?(rn=":",t++):(rn=null,o('":"')),rn!==null&&(Za=$e())!==null?l=[l,T,A,B,z,Q,ne,he,ke,Ge,kt,rn,Za]:(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be),l===null&&(be=t,p.substr(t,2)==="::"?(l="::",t+=2):(l=null,o('"::"')),l!==null&&(T=me())!==null?(p.charCodeAt(t)===58?(A=":",t++):(A=null,o('":"')),A!==null&&(B=me())!==null?(p.charCodeAt(t)===58?(z=":",t++):(z=null,o('":"')),z!==null&&(Q=me())!==null?(p.charCodeAt(t)===58?(ne=":",t++):(ne=null,o('":"')),ne!==null&&(he=me())!==null?(p.charCodeAt(t)===58?(ke=":",t++):(ke=null,o('":"')),ke!==null&&(Ge=me())!==null?(p.charCodeAt(t)===58?(kt=":",t++):(kt=null,o('":"')),kt!==null&&(rn=$e())!==null?l=[l,T,A,B,z,Q,ne,he,ke,Ge,kt,rn]:(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be),l===null&&(be=t,p.substr(t,2)==="::"?(l="::",t+=2):(l=null,o('"::"')),l!==null&&(T=me())!==null?(p.charCodeAt(t)===58?(A=":",t++):(A=null,o('":"')),A!==null&&(B=me())!==null?(p.charCodeAt(t)===58?(z=":",t++):(z=null,o('":"')),z!==null&&(Q=me())!==null?(p.charCodeAt(t)===58?(ne=":",t++):(ne=null,o('":"')),ne!==null&&(he=me())!==null?(p.charCodeAt(t)===58?(ke=":",t++):(ke=null,o('":"')),ke!==null&&(Ge=$e())!==null?l=[l,T,A,B,z,Q,ne,he,ke,Ge]:(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be),l===null&&(be=t,p.substr(t,2)==="::"?(l="::",t+=2):(l=null,o('"::"')),l!==null&&(T=me())!==null?(p.charCodeAt(t)===58?(A=":",t++):(A=null,o('":"')),A!==null&&(B=me())!==null?(p.charCodeAt(t)===58?(z=":",t++):(z=null,o('":"')),z!==null&&(Q=me())!==null?(p.charCodeAt(t)===58?(ne=":",t++):(ne=null,o('":"')),ne!==null&&(he=$e())!==null?l=[l,T,A,B,z,Q,ne,he]:(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be),l===null&&(be=t,p.substr(t,2)==="::"?(l="::",t+=2):(l=null,o('"::"')),l!==null&&(T=me())!==null?(p.charCodeAt(t)===58?(A=":",t++):(A=null,o('":"')),A!==null&&(B=me())!==null?(p.charCodeAt(t)===58?(z=":",t++):(z=null,o('":"')),z!==null&&(Q=$e())!==null?l=[l,T,A,B,z,Q]:(l=null,t=be)):(l=null,t=be)):(l=null,t=be),l===null&&(be=t,p.substr(t,2)==="::"?(l="::",t+=2):(l=null,o('"::"')),l!==null&&(T=me())!==null?(p.charCodeAt(t)===58?(A=":",t++):(A=null,o('":"')),A!==null&&(B=$e())!==null?l=[l,T,A,B]:(l=null,t=be)):(l=null,t=be),l===null&&(be=t,p.substr(t,2)==="::"?(l="::",t+=2):(l=null,o('"::"')),l!==null&&(T=$e())!==null?l=[l,T]:(l=null,t=be),l===null&&(be=t,p.substr(t,2)==="::"?(l="::",t+=2):(l=null,o('"::"')),l!==null&&(T=me())!==null?l=[l,T]:(l=null,t=be),l===null&&(be=t,(l=me())!==null?(p.substr(t,2)==="::"?(T="::",t+=2):(T=null,o('"::"')),T!==null&&(A=me())!==null?(p.charCodeAt(t)===58?(B=":",t++):(B=null,o('":"')),B!==null&&(z=me())!==null?(p.charCodeAt(t)===58?(Q=":",t++):(Q=null,o('":"')),Q!==null&&(ne=me())!==null?(p.charCodeAt(t)===58?(he=":",t++):(he=null,o('":"')),he!==null&&(ke=me())!==null?(p.charCodeAt(t)===58?(Ge=":",t++):(Ge=null,o('":"')),Ge!==null&&(kt=$e())!==null?l=[l,T,A,B,z,Q,ne,he,ke,Ge,kt]:(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be),l===null&&(be=t,(l=me())!==null?(Be=t,p.charCodeAt(t)===58?(T=":",t++):(T=null,o('":"')),T!==null&&(A=me())!==null?T=[T,A]:(T=null,t=Be),(T=T!==null?T:"")!==null?(p.substr(t,2)==="::"?(A="::",t+=2):(A=null,o('"::"')),A!==null&&(B=me())!==null?(p.charCodeAt(t)===58?(z=":",t++):(z=null,o('":"')),z!==null&&(Q=me())!==null?(p.charCodeAt(t)===58?(ne=":",t++):(ne=null,o('":"')),ne!==null&&(he=me())!==null?(p.charCodeAt(t)===58?(ke=":",t++):(ke=null,o('":"')),ke!==null&&(Ge=$e())!==null?l=[l,T,A,B,z,Q,ne,he,ke,Ge]:(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be),l===null&&(be=t,(l=me())!==null?(Be=t,p.charCodeAt(t)===58?(T=":",t++):(T=null,o('":"')),T!==null&&(A=me())!==null?T=[T,A]:(T=null,t=Be),(T=T!==null?T:"")!==null?(Be=t,p.charCodeAt(t)===58?(A=":",t++):(A=null,o('":"')),A!==null&&(B=me())!==null?A=[A,B]:(A=null,t=Be),(A=A!==null?A:"")!==null?(p.substr(t,2)==="::"?(B="::",t+=2):(B=null,o('"::"')),B!==null&&(z=me())!==null?(p.charCodeAt(t)===58?(Q=":",t++):(Q=null,o('":"')),Q!==null&&(ne=me())!==null?(p.charCodeAt(t)===58?(he=":",t++):(he=null,o('":"')),he!==null&&(ke=$e())!==null?l=[l,T,A,B,z,Q,ne,he,ke]:(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be),l===null&&(be=t,(l=me())!==null?(Be=t,p.charCodeAt(t)===58?(T=":",t++):(T=null,o('":"')),T!==null&&(A=me())!==null?T=[T,A]:(T=null,t=Be),(T=T!==null?T:"")!==null?(Be=t,p.charCodeAt(t)===58?(A=":",t++):(A=null,o('":"')),A!==null&&(B=me())!==null?A=[A,B]:(A=null,t=Be),(A=A!==null?A:"")!==null?(Be=t,p.charCodeAt(t)===58?(B=":",t++):(B=null,o('":"')),B!==null&&(z=me())!==null?B=[B,z]:(B=null,t=Be),(B=B!==null?B:"")!==null?(p.substr(t,2)==="::"?(z="::",t+=2):(z=null,o('"::"')),z!==null&&(Q=me())!==null?(p.charCodeAt(t)===58?(ne=":",t++):(ne=null,o('":"')),ne!==null&&(he=$e())!==null?l=[l,T,A,B,z,Q,ne,he]:(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be),l===null&&(be=t,(l=me())!==null?(Be=t,p.charCodeAt(t)===58?(T=":",t++):(T=null,o('":"')),T!==null&&(A=me())!==null?T=[T,A]:(T=null,t=Be),(T=T!==null?T:"")!==null?(Be=t,p.charCodeAt(t)===58?(A=":",t++):(A=null,o('":"')),A!==null&&(B=me())!==null?A=[A,B]:(A=null,t=Be),(A=A!==null?A:"")!==null?(Be=t,p.charCodeAt(t)===58?(B=":",t++):(B=null,o('":"')),B!==null&&(z=me())!==null?B=[B,z]:(B=null,t=Be),(B=B!==null?B:"")!==null?(Be=t,p.charCodeAt(t)===58?(z=":",t++):(z=null,o('":"')),z!==null&&(Q=me())!==null?z=[z,Q]:(z=null,t=Be),(z=z!==null?z:"")!==null?(p.substr(t,2)==="::"?(Q="::",t+=2):(Q=null,o('"::"')),Q!==null&&(ne=$e())!==null?l=[l,T,A,B,z,Q,ne]:(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be),l===null&&(be=t,(l=me())!==null?(Be=t,p.charCodeAt(t)===58?(T=":",t++):(T=null,o('":"')),T!==null&&(A=me())!==null?T=[T,A]:(T=null,t=Be),(T=T!==null?T:"")!==null?(Be=t,p.charCodeAt(t)===58?(A=":",t++):(A=null,o('":"')),A!==null&&(B=me())!==null?A=[A,B]:(A=null,t=Be),(A=A!==null?A:"")!==null?(Be=t,p.charCodeAt(t)===58?(B=":",t++):(B=null,o('":"')),B!==null&&(z=me())!==null?B=[B,z]:(B=null,t=Be),(B=B!==null?B:"")!==null?(Be=t,p.charCodeAt(t)===58?(z=":",t++):(z=null,o('":"')),z!==null&&(Q=me())!==null?z=[z,Q]:(z=null,t=Be),(z=z!==null?z:"")!==null?(Be=t,p.charCodeAt(t)===58?(Q=":",t++):(Q=null,o('":"')),Q!==null&&(ne=me())!==null?Q=[Q,ne]:(Q=null,t=Be),(Q=Q!==null?Q:"")!==null?(p.substr(t,2)==="::"?(ne="::",t+=2):(ne=null,o('"::"')),ne!==null&&(he=me())!==null?l=[l,T,A,B,z,Q,ne,he]:(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be),l===null&&(be=t,(l=me())!==null?(Be=t,p.charCodeAt(t)===58?(T=":",t++):(T=null,o('":"')),T!==null&&(A=me())!==null?T=[T,A]:(T=null,t=Be),(T=T!==null?T:"")!==null?(Be=t,p.charCodeAt(t)===58?(A=":",t++):(A=null,o('":"')),A!==null&&(B=me())!==null?A=[A,B]:(A=null,t=Be),(A=A!==null?A:"")!==null?(Be=t,p.charCodeAt(t)===58?(B=":",t++):(B=null,o('":"')),B!==null&&(z=me())!==null?B=[B,z]:(B=null,t=Be),(B=B!==null?B:"")!==null?(Be=t,p.charCodeAt(t)===58?(z=":",t++):(z=null,o('":"')),z!==null&&(Q=me())!==null?z=[z,Q]:(z=null,t=Be),(z=z!==null?z:"")!==null?(Be=t,p.charCodeAt(t)===58?(Q=":",t++):(Q=null,o('":"')),Q!==null&&(ne=me())!==null?Q=[Q,ne]:(Q=null,t=Be),(Q=Q!==null?Q:"")!==null?(Be=t,p.charCodeAt(t)===58?(ne=":",t++):(ne=null,o('":"')),ne!==null&&(he=me())!==null?ne=[ne,he]:(ne=null,t=Be),(ne=ne!==null?ne:"")!==null?(p.substr(t,2)==="::"?(he="::",t+=2):(he=null,o('"::"')),he!==null?l=[l,T,A,B,z,Q,ne,he]:(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be)):(l=null,t=be))))))))))))))),l!==null&&(js=xs,ae.host_type="IPv6",l=p.substring(t,js)),l===null&&(t=xs),l}function me(){var l,T,A,B,z;return z=t,(l=a())!==null&&(T=(T=a())!==null?T:"")!==null&&(A=(A=a())!==null?A:"")!==null&&(B=(B=a())!==null?B:"")!==null?l=[l,T,A,B]:(l=null,t=z),l}function $e(){var l,T,A,B;return B=t,(l=me())!==null?(p.charCodeAt(t)===58?(T=":",t++):(T=null,o('":"')),T!==null&&(A=me())!==null?l=[l,T,A]:(l=null,t=B)):(l=null,t=B),l===null&&(l=rt()),l}function rt(){var l,T,A,B,z,Q,ne,he,ke,Ge;return he=t,ke=t,(l=Qe())!==null?(p.charCodeAt(t)===46?(T=".",t++):(T=null,o('"."')),T!==null&&(A=Qe())!==null?(p.charCodeAt(t)===46?(B=".",t++):(B=null,o('"."')),B!==null&&(z=Qe())!==null?(p.charCodeAt(t)===46?(Q=".",t++):(Q=null,o('"."')),Q!==null&&(ne=Qe())!==null?l=[l,T,A,B,z,Q,ne]:(l=null,t=ke)):(l=null,t=ke)):(l=null,t=ke)):(l=null,t=ke),l!==null&&(Ge=he,ae.host_type="IPv4",l=p.substring(t,Ge)),l===null&&(t=he),l}function Qe(){var l,T,A,B;return B=t,p.substr(t,2)==="25"?(l="25",t+=2):(l=null,o('"25"')),l!==null?(/^[0-5]/.test(p.charAt(t))?(T=p.charAt(t),t++):(T=null,o("[0-5]")),T!==null?l=[l,T]:(l=null,t=B)):(l=null,t=B),l===null&&(B=t,p.charCodeAt(t)===50?(l="2",t++):(l=null,o('"2"')),l!==null?(/^[0-4]/.test(p.charAt(t))?(T=p.charAt(t),t++):(T=null,o("[0-4]")),T!==null&&(A=n())!==null?l=[l,T,A]:(l=null,t=B)):(l=null,t=B),l===null&&(B=t,p.charCodeAt(t)===49?(l="1",t++):(l=null,o('"1"')),l!==null&&(T=n())!==null&&(A=n())!==null?l=[l,T,A]:(l=null,t=B),l===null&&(B=t,/^[1-9]/.test(p.charAt(t))?(l=p.charAt(t),t++):(l=null,o("[1-9]")),l!==null&&(T=n())!==null?l=[l,T]:(l=null,t=B),l===null&&(l=n())))),l}function Gt(){var l,T,A,B,z,Q,ne,he;return Q=t,ne=t,(l=(l=n())!==null?l:"")!==null&&(T=(T=n())!==null?T:"")!==null&&(A=(A=n())!==null?A:"")!==null&&(B=(B=n())!==null?B:"")!==null&&(z=(z=n())!==null?z:"")!==null?l=[l,T,A,B,z]:(l=null,t=ne),l!==null&&(he=l,he=parseInt(he.join("")),ae.port=he,l=he),l===null&&(t=Q),l}function ft(){var l,T,A,B;for(l=[],B=t,p.charCodeAt(t)===59?(T=";",t++):(T=null,o('";"')),T!==null&&(A=Et())!==null?T=[T,A]:(T=null,t=B);T!==null;)l.push(T),B=t,p.charCodeAt(t)===59?(T=";",t++):(T=null,o('";"')),T!==null&&(A=Et())!==null?T=[T,A]:(T=null,t=B);return l}function Et(){var l;return(l=Jt())===null&&(l=Ea())===null&&(l=hs())===null&&(l=ps())===null&&(l=Si())===null&&(l=rr())===null&&(l=wa()),l}function Jt(){var l,T,A,B,z;return A=t,B=t,p.substr(t,10).toLowerCase()==="transport="?(l=p.substr(t,10),t+=10):(l=null,o('"transport="')),l!==null?(p.substr(t,3).toLowerCase()==="udp"?(T=p.substr(t,3),t+=3):(T=null,o('"udp"')),T===null&&(p.substr(t,3).toLowerCase()==="tcp"?(T=p.substr(t,3),t+=3):(T=null,o('"tcp"')),T===null&&(p.substr(t,4).toLowerCase()==="sctp"?(T=p.substr(t,4),t+=4):(T=null,o('"sctp"')),T===null&&(p.substr(t,3).toLowerCase()==="tls"?(T=p.substr(t,3),t+=3):(T=null,o('"tls"')),T===null&&(T=j())))),T!==null?l=[l,T]:(l=null,t=B)):(l=null,t=B),l!==null&&(z=l[1],ae.uri_params||(ae.uri_params={}),l=void(ae.uri_params.transport=z.toLowerCase())),l===null&&(t=A),l}function Ea(){var l,T,A,B,z;return A=t,B=t,p.substr(t,5).toLowerCase()==="user="?(l=p.substr(t,5),t+=5):(l=null,o('"user="')),l!==null?(p.substr(t,5).toLowerCase()==="phone"?(T=p.substr(t,5),t+=5):(T=null,o('"phone"')),T===null&&(p.substr(t,2).toLowerCase()==="ip"?(T=p.substr(t,2),t+=2):(T=null,o('"ip"')),T===null&&(T=j())),T!==null?l=[l,T]:(l=null,t=B)):(l=null,t=B),l!==null&&(z=l[1],ae.uri_params||(ae.uri_params={}),l=void(ae.uri_params.user=z.toLowerCase())),l===null&&(t=A),l}function hs(){var l,T,A,B,z;return A=t,B=t,p.substr(t,7).toLowerCase()==="method="?(l=p.substr(t,7),t+=7):(l=null,o('"method="')),l!==null&&(T=Nn())!==null?l=[l,T]:(l=null,t=B),l!==null&&(z=l[1],ae.uri_params||(ae.uri_params={}),l=void(ae.uri_params.method=z)),l===null&&(t=A),l}function ps(){var l,T,A,B,z;return A=t,B=t,p.substr(t,4).toLowerCase()==="ttl="?(l=p.substr(t,4),t+=4):(l=null,o('"ttl="')),l!==null&&(T=Ls())!==null?l=[l,T]:(l=null,t=B),l!==null&&(z=l[1],ae.params||(ae.params={}),l=void(ae.params.ttl=z)),l===null&&(t=A),l}function Si(){var l,T,A,B,z;return A=t,B=t,p.substr(t,6).toLowerCase()==="maddr="?(l=p.substr(t,6),t+=6):(l=null,o('"maddr="')),l!==null&&(T=fe())!==null?l=[l,T]:(l=null,t=B),l!==null&&(z=l[1],ae.uri_params||(ae.uri_params={}),l=void(ae.uri_params.maddr=z)),l===null&&(t=A),l}function rr(){var l,T,A,B,z,Q;return B=t,z=t,p.substr(t,2).toLowerCase()==="lr"?(l=p.substr(t,2),t+=2):(l=null,o('"lr"')),l!==null?(Q=t,p.charCodeAt(t)===61?(T="=",t++):(T=null,o('"="')),T!==null&&(A=j())!==null?T=[T,A]:(T=null,t=Q),(T=T!==null?T:"")!==null?l=[l,T]:(l=null,t=z)):(l=null,t=z),l!==null&&(ae.uri_params||(ae.uri_params={}),l=void(ae.uri_params.lr=void 0)),l===null&&(t=B),l}function wa(){var l,T,A,B,z,Q,ne,he;return B=t,z=t,(l=gs())!==null?(Q=t,p.charCodeAt(t)===61?(T="=",t++):(T=null,o('"="')),T!==null&&(A=ms())!==null?T=[T,A]:(T=null,t=Q),(T=T!==null?T:"")!==null?l=[l,T]:(l=null,t=z)):(l=null,t=z),l!==null&&(ne=l[0],he=l[1],ae.uri_params||(ae.uri_params={}),he=he===void 0?void 0:he[1],l=void(ae.uri_params[ne.toLowerCase()]=he)),l===null&&(t=B),l}function gs(){var l,T,A;if(A=t,(T=ir())!==null)for(l=[];T!==null;)l.push(T),T=ir();else l=null;return l!==null&&(l=l.join("")),l===null&&(t=A),l}function ms(){var l,T,A;if(A=t,(T=ir())!==null)for(l=[];T!==null;)l.push(T),T=ir();else l=null;return l!==null&&(l=l.join("")),l===null&&(t=A),l}function ir(){var l;return(l=vs())===null&&(l=w())===null&&(l=L()),l}function vs(){var l;return p.charCodeAt(t)===91?(l="[",t++):(l=null,o('"["')),l===null&&(p.charCodeAt(t)===93?(l="]",t++):(l=null,o('"]"')),l===null&&(p.charCodeAt(t)===47?(l="/",t++):(l=null,o('"/"')),l===null&&(p.charCodeAt(t)===58?(l=":",t++):(l=null,o('":"')),l===null&&(p.charCodeAt(t)===38?(l="&",t++):(l=null,o('"&"')),l===null&&(p.charCodeAt(t)===43?(l="+",t++):(l=null,o('"+"')),l===null&&(p.charCodeAt(t)===36?(l="$",t++):(l=null,o('"$"')))))))),l}function Ra(){var l,T,A,B,z,Q,ne;if(Q=t,p.charCodeAt(t)===63?(l="?",t++):(l=null,o('"?"')),l!==null)if((T=Wt())!==null){for(A=[],ne=t,p.charCodeAt(t)===38?(B="&",t++):(B=null,o('"&"')),B!==null&&(z=Wt())!==null?B=[B,z]:(B=null,t=ne);B!==null;)A.push(B),ne=t,p.charCodeAt(t)===38?(B="&",t++):(B=null,o('"&"')),B!==null&&(z=Wt())!==null?B=[B,z]:(B=null,t=ne);A!==null?l=[l,T,A]:(l=null,t=Q)}else l=null,t=Q;else l=null,t=Q;return l}function Wt(){var l,T,A,B,z,Q,ne;return B=t,z=t,(l=wt())!==null?(p.charCodeAt(t)===61?(T="=",t++):(T=null,o('"="')),T!==null&&(A=Mt())!==null?l=[l,T,A]:(l=null,t=z)):(l=null,t=z),l!==null&&(Q=l[0],ne=l[2],Q=Q.join("").toLowerCase(),ne=ne.join(""),ae.uri_headers||(ae.uri_headers={}),l=void(ae.uri_headers[Q]?ae.uri_headers[Q].push(ne):ae.uri_headers[Q]=[ne])),l===null&&(t=B),l}function wt(){var l,T;if((T=Zt())===null&&(T=w())===null&&(T=L()),T!==null)for(l=[];T!==null;)l.push(T),(T=Zt())===null&&(T=w())===null&&(T=L());else l=null;return l}function Mt(){var l,T;for(l=[],(T=Zt())===null&&(T=w())===null&&(T=L());T!==null;)l.push(T),(T=Zt())===null&&(T=w())===null&&(T=L());return l}function Zt(){var l;return p.charCodeAt(t)===91?(l="[",t++):(l=null,o('"["')),l===null&&(p.charCodeAt(t)===93?(l="]",t++):(l=null,o('"]"')),l===null&&(p.charCodeAt(t)===47?(l="/",t++):(l=null,o('"/"')),l===null&&(p.charCodeAt(t)===63?(l="?",t++):(l=null,o('"?"')),l===null&&(p.charCodeAt(t)===58?(l=":",t++):(l=null,o('":"')),l===null&&(p.charCodeAt(t)===43?(l="+",t++):(l=null,o('"+"')),l===null&&(p.charCodeAt(t)===36?(l="$",t++):(l=null,o('"$"')))))))),l}function Ci(){var l,T,A,B,z,Q;return Q=t,(l=Nn())!==null&&(T=h())!==null&&(A=Aa())!==null&&(B=h())!==null&&(z=Ti())!==null?l=[l,T,A,B,z]:(l=null,t=Q),l}function Aa(){var l;return(l=Dt())===null&&(l=ys()),l}function ys(){var l,T,A,B;return B=t,(l=wn())!==null?(p.charCodeAt(t)===58?(T=":",t++):(T=null,o('":"')),T!==null?((A=_s())===null&&(A=En()),A!==null?l=[l,T,A]:(l=null,t=B)):(l=null,t=B)):(l=null,t=B),l}function _s(){var l,T,A,B,z;return B=t,(l=sr())===null&&(l=ar()),l!==null?(z=t,p.charCodeAt(t)===63?(T="?",t++):(T=null,o('"?"')),T!==null&&(A=Ss())!==null?T=[T,A]:(T=null,t=z),(T=T!==null?T:"")!==null?l=[l,T]:(l=null,t=B)):(l=null,t=B),l}function sr(){var l,T,A,B;return B=t,p.substr(t,2)==="//"?(l="//",t+=2):(l=null,o('"//"')),l!==null&&(T=Mn())!==null&&(A=(A=ar())!==null?A:"")!==null?l=[l,T,A]:(l=null,t=B),l}function ar(){var l,T,A;return A=t,p.charCodeAt(t)===47?(l="/",t++):(l=null,o('"/"')),l!==null&&(T=Dn())!==null?l=[l,T]:(l=null,t=A),l}function En(){var l,T,A,B;if(B=t,(l=or())!==null){for(T=[],A=en();A!==null;)T.push(A),A=en();T!==null?l=[l,T]:(l=null,t=B)}else l=null,t=B;return l}function en(){var l;return(l=y())===null&&(l=w())===null&&(l=L()),l}function or(){var l;return(l=w())===null&&(l=L())===null&&(p.charCodeAt(t)===59?(l=";",t++):(l=null,o('";"')),l===null&&(p.charCodeAt(t)===63?(l="?",t++):(l=null,o('"?"')),l===null&&(p.charCodeAt(t)===58?(l=":",t++):(l=null,o('":"')),l===null&&(p.charCodeAt(t)===64?(l="@",t++):(l=null,o('"@"')),l===null&&(p.charCodeAt(t)===38?(l="&",t++):(l=null,o('"&"')),l===null&&(p.charCodeAt(t)===61?(l="=",t++):(l=null,o('"="')),l===null&&(p.charCodeAt(t)===43?(l="+",t++):(l=null,o('"+"')),l===null&&(p.charCodeAt(t)===36?(l="$",t++):(l=null,o('"$"')),l===null&&(p.charCodeAt(t)===44?(l=",",t++):(l=null,o('","'))))))))))),l}function Dn(){var l,T,A,B,z,Q;if(z=t,(l=ht())!==null){for(T=[],Q=t,p.charCodeAt(t)===47?(A="/",t++):(A=null,o('"/"')),A!==null&&(B=ht())!==null?A=[A,B]:(A=null,t=Q);A!==null;)T.push(A),Q=t,p.charCodeAt(t)===47?(A="/",t++):(A=null,o('"/"')),A!==null&&(B=ht())!==null?A=[A,B]:(A=null,t=Q);T!==null?l=[l,T]:(l=null,t=z)}else l=null,t=z;return l}function ht(){var l,T,A,B,z,Q;for(z=t,l=[],T=lr();T!==null;)l.push(T),T=lr();if(l!==null){for(T=[],Q=t,p.charCodeAt(t)===59?(A=";",t++):(A=null,o('";"')),A!==null&&(B=bi())!==null?A=[A,B]:(A=null,t=Q);A!==null;)T.push(A),Q=t,p.charCodeAt(t)===59?(A=";",t++):(A=null,o('";"')),A!==null&&(B=bi())!==null?A=[A,B]:(A=null,t=Q);T!==null?l=[l,T]:(l=null,t=z)}else l=null,t=z;return l}function bi(){var l,T;for(l=[],T=lr();T!==null;)l.push(T),T=lr();return l}function lr(){var l;return(l=w())===null&&(l=L())===null&&(p.charCodeAt(t)===58?(l=":",t++):(l=null,o('":"')),l===null&&(p.charCodeAt(t)===64?(l="@",t++):(l=null,o('"@"')),l===null&&(p.charCodeAt(t)===38?(l="&",t++):(l=null,o('"&"')),l===null&&(p.charCodeAt(t)===61?(l="=",t++):(l=null,o('"="')),l===null&&(p.charCodeAt(t)===43?(l="+",t++):(l=null,o('"+"')),l===null&&(p.charCodeAt(t)===36?(l="$",t++):(l=null,o('"$"')),l===null&&(p.charCodeAt(t)===44?(l=",",t++):(l=null,o('","'))))))))),l}function wn(){var l,T,A,B,z,Q;if(B=t,z=t,(l=i())!==null){for(T=[],(A=i())===null&&(A=n())===null&&(p.charCodeAt(t)===43?(A="+",t++):(A=null,o('"+"')),A===null&&(p.charCodeAt(t)===45?(A="-",t++):(A=null,o('"-"')),A===null&&(p.charCodeAt(t)===46?(A=".",t++):(A=null,o('"."')))));A!==null;)T.push(A),(A=i())===null&&(A=n())===null&&(p.charCodeAt(t)===43?(A="+",t++):(A=null,o('"+"')),A===null&&(p.charCodeAt(t)===45?(A="-",t++):(A=null,o('"-"')),A===null&&(p.charCodeAt(t)===46?(A=".",t++):(A=null,o('"."')))));T!==null?l=[l,T]:(l=null,t=z)}else l=null,t=z;return l!==null&&(Q=B,l=void(ae.scheme=p.substring(t,Q))),l===null&&(t=B),l}function Mn(){var l;return(l=tn())===null&&(l=Oa()),l}function tn(){var l,T,A,B;return A=t,B=t,(l=Tn())!==null?(p.charCodeAt(t)===64?(T="@",t++):(T=null,o('"@"')),T!==null?l=[l,T]:(l=null,t=B)):(l=null,t=B),(l=l!==null?l:"")!==null&&(T=at())!==null?l=[l,T]:(l=null,t=A),l!==null?l:""}function Oa(){var l,T;if((T=w())===null&&(T=L())===null&&(p.charCodeAt(t)===36?(T="$",t++):(T=null,o('"$"')),T===null&&(p.charCodeAt(t)===44?(T=",",t++):(T=null,o('","')),T===null&&(p.charCodeAt(t)===59?(T=";",t++):(T=null,o('";"')),T===null&&(p.charCodeAt(t)===58?(T=":",t++):(T=null,o('":"')),T===null&&(p.charCodeAt(t)===64?(T="@",t++):(T=null,o('"@"')),T===null&&(p.charCodeAt(t)===38?(T="&",t++):(T=null,o('"&"')),T===null&&(p.charCodeAt(t)===61?(T="=",t++):(T=null,o('"="')),T===null&&(p.charCodeAt(t)===43?(T="+",t++):(T=null,o('"+"')))))))))),T!==null)for(l=[];T!==null;)l.push(T),(T=w())===null&&(T=L())===null&&(p.charCodeAt(t)===36?(T="$",t++):(T=null,o('"$"')),T===null&&(p.charCodeAt(t)===44?(T=",",t++):(T=null,o('","')),T===null&&(p.charCodeAt(t)===59?(T=";",t++):(T=null,o('";"')),T===null&&(p.charCodeAt(t)===58?(T=":",t++):(T=null,o('":"')),T===null&&(p.charCodeAt(t)===64?(T="@",t++):(T=null,o('"@"')),T===null&&(p.charCodeAt(t)===38?(T="&",t++):(T=null,o('"&"')),T===null&&(p.charCodeAt(t)===61?(T="=",t++):(T=null,o('"="')),T===null&&(p.charCodeAt(t)===43?(T="+",t++):(T=null,o('"+"'))))))))));else l=null;return l}function Ss(){var l,T;for(l=[],T=en();T!==null;)l.push(T),T=en();return l}function Ti(){var l,T,A,B,z,Q,ne,he,ke;if(ne=t,he=t,p.substr(t,3).toLowerCase()==="sip"?(l=p.substr(t,3),t+=3):(l=null,o('"SIP"')),l!==null)if(p.charCodeAt(t)===47?(T="/",t++):(T=null,o('"/"')),T!==null){if((B=n())!==null)for(A=[];B!==null;)A.push(B),B=n();else A=null;if(A!==null)if(p.charCodeAt(t)===46?(B=".",t++):(B=null,o('"."')),B!==null){if((Q=n())!==null)for(z=[];Q!==null;)z.push(Q),Q=n();else z=null;z!==null?l=[l,T,A,B,z]:(l=null,t=he)}else l=null,t=he;else l=null,t=he}else l=null,t=he;else l=null,t=he;return l!==null&&(ke=ne,l=void(ae.sip_version=p.substring(t,ke))),l===null&&(t=ne),l}function ka(){var l;return p.substr(t,6)==="INVITE"?(l="INVITE",t+=6):(l=null,o('"INVITE"')),l}function qr(){var l;return p.substr(t,3)==="ACK"?(l="ACK",t+=3):(l=null,o('"ACK"')),l}function Vr(){var l;return p.substr(t,7)==="OPTIONS"?(l="OPTIONS",t+=7):(l=null,o('"OPTIONS"')),l}function nn(){var l;return p.substr(t,3)==="BYE"?(l="BYE",t+=3):(l=null,o('"BYE"')),l}function Ht(){var l;return p.substr(t,6)==="CANCEL"?(l="CANCEL",t+=6):(l=null,o('"CANCEL"')),l}function Cs(){var l;return p.substr(t,8)==="REGISTER"?(l="REGISTER",t+=8):(l=null,o('"REGISTER"')),l}function Ia(){var l;return p.substr(t,9)==="SUBSCRIBE"?(l="SUBSCRIBE",t+=9):(l=null,o('"SUBSCRIBE"')),l}function zr(){var l;return p.substr(t,6)==="NOTIFY"?(l="NOTIFY",t+=6):(l=null,o('"NOTIFY"')),l}function bs(){var l;return p.substr(t,5)==="REFER"?(l="REFER",t+=5):(l=null,o('"REFER"')),l}function Nn(){var l,T,A;return T=t,(l=ka())===null&&(l=qr())===null&&(l=Vr())===null&&(l=nn())===null&&(l=Ht())===null&&(l=Cs())===null&&(l=Ia())===null&&(l=zr())===null&&(l=bs())===null&&(l=j()),l!==null&&(A=T,ae.method=p.substring(t,A),l=ae.method),l===null&&(t=T),l}function La(){var l,T,A,B,z,Q;return Q=t,(l=Ti())!==null&&(T=h())!==null&&(A=Bt())!==null&&(B=h())!==null&&(z=Ts())!==null?l=[l,T,A,B,z]:(l=null,t=Q),l}function Bt(){var l,T,A;return T=t,(l=Ei())!==null&&(A=l,l=void(ae.status_code=parseInt(A.join("")))),l===null&&(t=T),l}function Ei(){var l,T,A,B;return B=t,(l=n())!==null&&(T=n())!==null&&(A=n())!==null?l=[l,T,A]:(l=null,t=B),l}function Ts(){var l,T,A,B;for(A=t,l=[],(T=y())===null&&(T=w())===null&&(T=L())===null&&(T=D())===null&&(T=$())===null&&(T=h())===null&&(T=C());T!==null;)l.push(T),(T=y())===null&&(T=w())===null&&(T=L())===null&&(T=D())===null&&(T=$())===null&&(T=h())===null&&(T=C());return l!==null&&(B=A,l=void(ae.reason_phrase=p.substring(t,B))),l===null&&(t=A),l}function cr(){var l,T,A,B,z,Q,ne;if(z=t,Q=t,(l=nt())===null&&(l=Vt()),l!==null){for(T=[],ne=t,(A=oe())!==null&&(B=wi())!==null?A=[A,B]:(A=null,t=ne);A!==null;)T.push(A),ne=t,(A=oe())!==null&&(B=wi())!==null?A=[A,B]:(A=null,t=ne);T!==null?l=[l,T]:(l=null,t=Q)}else l=null,t=Q;return l!==null&&(l=function(he){var ke;ae.multi_header||(ae.multi_header=[]);try{ke=new Sr(ae.uri,ae.display_name,ae.params),delete ae.uri,delete ae.display_name,delete ae.params}catch{ke=null}ae.multi_header.push({possition:t,offset:he,parsed:ke})}(z)),l===null&&(t=z),l}function Vt(){var l,T,A,B,z;return z=t,(l=(l=Wr())!==null?l:"")!==null&&(T=Oe())!==null&&(A=Dt())!==null&&(B=pe())!==null?l=[l,T,A,B]:(l=null,t=z),l}function Wr(){var l,T,A,B,z,Q,ne,he;if(z=t,Q=t,(l=j())!==null){for(T=[],ne=t,(A=I())!==null&&(B=j())!==null?A=[A,B]:(A=null,t=ne);A!==null;)T.push(A),ne=t,(A=I())!==null&&(B=j())!==null?A=[A,B]:(A=null,t=ne);T!==null?l=[l,T]:(l=null,t=Q)}else l=null,t=Q;return l===null&&(l=xe()),l!==null&&(he=l,l=void(ae.display_name=typeof he=="string"?he:he[1].reduce(function(ke,Ge){return ke+Ge[0]+Ge[1]},he[0]))),l===null&&(t=z),l}function wi(){var l;return(l=Un())===null&&(l=Pa())===null&&(l=dt()),l}function Un(){var l,T,A,B,z,Q;return B=t,z=t,p.substr(t,1).toLowerCase()==="q"?(l=p.substr(t,1),t++):(l=null,o('"q"')),l!==null&&(T=re())!==null&&(A=Es())!==null?l=[l,T,A]:(l=null,t=z),l!==null&&(Q=l[2],ae.params||(ae.params={}),l=void(ae.params.q=Q)),l===null&&(t=B),l}function Pa(){var l,T,A,B,z,Q;return B=t,z=t,p.substr(t,7).toLowerCase()==="expires"?(l=p.substr(t,7),t+=7):(l=null,o('"expires"')),l!==null&&(T=re())!==null&&(A=Rn())!==null?l=[l,T,A]:(l=null,t=z),l!==null&&(Q=l[2],ae.params||(ae.params={}),l=void(ae.params.expires=Q)),l===null&&(t=B),l}function Rn(){var l,T,A;if(A=t,(T=n())!==null)for(l=[];T!==null;)l.push(T),T=n();else l=null;return l!==null&&(l=parseInt(l.join(""))),l===null&&(t=A),l}function Es(){var l,T,A,B,z,Q,ne,he,ke;return Q=t,ne=t,p.charCodeAt(t)===48?(l="0",t++):(l=null,o('"0"')),l!==null?(he=t,p.charCodeAt(t)===46?(T=".",t++):(T=null,o('"."')),T!==null&&(A=(A=n())!==null?A:"")!==null&&(B=(B=n())!==null?B:"")!==null&&(z=(z=n())!==null?z:"")!==null?T=[T,A,B,z]:(T=null,t=he),(T=T!==null?T:"")!==null?l=[l,T]:(l=null,t=ne)):(l=null,t=ne),l!==null&&(ke=Q,l=parseFloat(p.substring(t,ke))),l===null&&(t=Q),l}function dt(){var l,T,A,B,z,Q,ne,he;return B=t,z=t,(l=j())!==null?(Q=t,(T=re())!==null&&(A=Da())!==null?T=[T,A]:(T=null,t=Q),(T=T!==null?T:"")!==null?l=[l,T]:(l=null,t=z)):(l=null,t=z),l!==null&&(ne=l[0],he=l[1],ae.params||(ae.params={}),he=he===void 0?void 0:he[1],l=void(ae.params[ne.toLowerCase()]=he)),l===null&&(t=B),l}function Da(){var l;return(l=j())===null&&(l=fe())===null&&(l=Fe()),l}function Ma(){var l;return p.substr(t,6).toLowerCase()==="render"?(l=p.substr(t,6),t+=6):(l=null,o('"render"')),l===null&&(p.substr(t,7).toLowerCase()==="session"?(l=p.substr(t,7),t+=7):(l=null,o('"session"')),l===null&&(p.substr(t,4).toLowerCase()==="icon"?(l=p.substr(t,4),t+=4):(l=null,o('"icon"')),l===null&&(p.substr(t,5).toLowerCase()==="alert"?(l=p.substr(t,5),t+=5):(l=null,o('"alert"')),l===null&&(l=j())))),l}function ur(){var l;return(l=Ri())===null&&(l=dt()),l}function Ri(){var l,T,A,B;return B=t,p.substr(t,8).toLowerCase()==="handling"?(l=p.substr(t,8),t+=8):(l=null,o('"handling"')),l!==null&&(T=re())!==null?(p.substr(t,8).toLowerCase()==="optional"?(A=p.substr(t,8),t+=8):(A=null,o('"optional"')),A===null&&(p.substr(t,8).toLowerCase()==="required"?(A=p.substr(t,8),t+=8):(A=null,o('"required"')),A===null&&(A=j())),A!==null?l=[l,T,A]:(l=null,t=B)):(l=null,t=B),l}function Ai(){var l,T,A,B,z,Q,ne,he;if(ne=t,(l=xn())!==null)if((T=J())!==null)if((A=fr())!==null){for(B=[],he=t,(z=oe())!==null&&(Q=Yr())!==null?z=[z,Q]:(z=null,t=he);z!==null;)B.push(z),he=t,(z=oe())!==null&&(Q=Yr())!==null?z=[z,Q]:(z=null,t=he);B!==null?l=[l,T,A,B]:(l=null,t=ne)}else l=null,t=ne;else l=null,t=ne;else l=null,t=ne;return l}function xn(){var l;return(l=jn())===null&&(l=ws()),l}function jn(){var l;return p.substr(t,4).toLowerCase()==="text"?(l=p.substr(t,4),t+=4):(l=null,o('"text"')),l===null&&(p.substr(t,5).toLowerCase()==="image"?(l=p.substr(t,5),t+=5):(l=null,o('"image"')),l===null&&(p.substr(t,5).toLowerCase()==="audio"?(l=p.substr(t,5),t+=5):(l=null,o('"audio"')),l===null&&(p.substr(t,5).toLowerCase()==="video"?(l=p.substr(t,5),t+=5):(l=null,o('"video"')),l===null&&(p.substr(t,11).toLowerCase()==="application"?(l=p.substr(t,11),t+=11):(l=null,o('"application"')),l===null&&(l=dr()))))),l}function ws(){var l;return p.substr(t,7).toLowerCase()==="message"?(l=p.substr(t,7),t+=7):(l=null,o('"message"')),l===null&&(p.substr(t,9).toLowerCase()==="multipart"?(l=p.substr(t,9),t+=9):(l=null,o('"multipart"')),l===null&&(l=dr())),l}function dr(){var l;return(l=j())===null&&(l=Rs()),l}function Rs(){var l,T,A;return A=t,p.substr(t,2).toLowerCase()==="x-"?(l=p.substr(t,2),t+=2):(l=null,o('"x-"')),l!==null&&(T=j())!==null?l=[l,T]:(l=null,t=A),l}function fr(){var l;return(l=dr())===null&&(l=j()),l}function Yr(){var l,T,A,B;return B=t,(l=j())!==null&&(T=re())!==null&&(A=hr())!==null?l=[l,T,A]:(l=null,t=B),l}function hr(){var l;return(l=j())===null&&(l=Fe()),l}function mn(){var l,T,A,B;if(A=t,(T=n())!==null)for(l=[];T!==null;)l.push(T),T=n();else l=null;return l!==null&&(B=l,l=void(ae.value=parseInt(B.join("")))),l===null&&(t=A),l}function Fn(){var l,T,A,B,z,Q;if(z=t,(l=V())!==null){for(T=[],Q=t,p.charCodeAt(t)===46?(A=".",t++):(A=null,o('"."')),A!==null&&(B=V())!==null?A=[A,B]:(A=null,t=Q);A!==null;)T.push(A),Q=t,p.charCodeAt(t)===46?(A=".",t++):(A=null,o('"."')),A!==null&&(B=V())!==null?A=[A,B]:(A=null,t=Q);T!==null?l=[l,T]:(l=null,t=z)}else l=null,t=z;return l}function pr(){var l;return(l=Oi())===null&&(l=dt()),l}function Oi(){var l,T,A,B,z,Q;return B=t,z=t,p.substr(t,3).toLowerCase()==="tag"?(l=p.substr(t,3),t+=3):(l=null,o('"tag"')),l!==null&&(T=re())!==null&&(A=j())!==null?l=[l,T,A]:(l=null,t=z),l!==null&&(Q=l[2],l=void(ae.tag=Q)),l===null&&(t=B),l}function gr(){var l,T,A,B,z,Q,ne,he;if(ne=t,p.substr(t,6).toLowerCase()==="digest"?(l=p.substr(t,6),t+=6):(l=null,o('"Digest"')),l!==null)if((T=I())!==null)if((A=Rt())!==null){for(B=[],he=t,(z=te())!==null&&(Q=Rt())!==null?z=[z,Q]:(z=null,t=he);z!==null;)B.push(z),he=t,(z=te())!==null&&(Q=Rt())!==null?z=[z,Q]:(z=null,t=he);B!==null?l=[l,T,A,B]:(l=null,t=ne)}else l=null,t=ne;else l=null,t=ne;else l=null,t=ne;return l===null&&(l=Qr()),l}function Qr(){var l,T,A,B,z,Q,ne,he;if(ne=t,(l=j())!==null)if((T=I())!==null)if((A=mr())!==null){for(B=[],he=t,(z=te())!==null&&(Q=mr())!==null?z=[z,Q]:(z=null,t=he);z!==null;)B.push(z),he=t,(z=te())!==null&&(Q=mr())!==null?z=[z,Q]:(z=null,t=he);B!==null?l=[l,T,A,B]:(l=null,t=ne)}else l=null,t=ne;else l=null,t=ne;else l=null,t=ne;return l}function mr(){var l,T,A,B;return B=t,(l=j())!==null&&(T=re())!==null?((A=j())===null&&(A=Fe()),A!==null?l=[l,T,A]:(l=null,t=B)):(l=null,t=B),l}function Rt(){var l;return(l=An())===null&&(l=vr())===null&&(l=Ii())===null&&(l=yr())===null&&(l=Xr())===null&&(l=As())===null&&(l=Na())===null&&(l=mr()),l}function An(){var l,T,A,B;return B=t,p.substr(t,5).toLowerCase()==="realm"?(l=p.substr(t,5),t+=5):(l=null,o('"realm"')),l!==null&&(T=re())!==null&&(A=Kr())!==null?l=[l,T,A]:(l=null,t=B),l}function Kr(){var l,T,A;return T=t,(l=xe())!==null&&(A=l,l=void(ae.realm=A)),l===null&&(t=T),l}function vr(){var l,T,A,B,z,Q,ne,he,ke;if(he=t,p.substr(t,6).toLowerCase()==="domain"?(l=p.substr(t,6),t+=6):(l=null,o('"domain"')),l!==null)if((T=re())!==null)if((A=we())!==null)if((B=ki())!==null){if(z=[],ke=t,(ne=h())!==null)for(Q=[];ne!==null;)Q.push(ne),ne=h();else Q=null;for(Q!==null&&(ne=ki())!==null?Q=[Q,ne]:(Q=null,t=ke);Q!==null;){if(z.push(Q),ke=t,(ne=h())!==null)for(Q=[];ne!==null;)Q.push(ne),ne=h();else Q=null;Q!==null&&(ne=ki())!==null?Q=[Q,ne]:(Q=null,t=ke)}z!==null&&(Q=Ee())!==null?l=[l,T,A,B,z,Q]:(l=null,t=he)}else l=null,t=he;else l=null,t=he;else l=null,t=he;else l=null,t=he;return l}function ki(){var l;return(l=ys())===null&&(l=ar()),l}function Ii(){var l,T,A,B;return B=t,p.substr(t,5).toLowerCase()==="nonce"?(l=p.substr(t,5),t+=5):(l=null,o('"nonce"')),l!==null&&(T=re())!==null&&(A=Li())!==null?l=[l,T,A]:(l=null,t=B),l}function Li(){var l,T,A;return T=t,(l=xe())!==null&&(A=l,l=void(ae.nonce=A)),l===null&&(t=T),l}function yr(){var l,T,A,B,z,Q;return B=t,z=t,p.substr(t,6).toLowerCase()==="opaque"?(l=p.substr(t,6),t+=6):(l=null,o('"opaque"')),l!==null&&(T=re())!==null&&(A=xe())!==null?l=[l,T,A]:(l=null,t=z),l!==null&&(Q=l[2],l=void(ae.opaque=Q)),l===null&&(t=B),l}function Xr(){var l,T,A,B,z;return B=t,p.substr(t,5).toLowerCase()==="stale"?(l=p.substr(t,5),t+=5):(l=null,o('"stale"')),l!==null&&(T=re())!==null?(z=t,p.substr(t,4).toLowerCase()==="true"?(A=p.substr(t,4),t+=4):(A=null,o('"true"')),A!==null&&(A=void(ae.stale=!0)),A===null&&(t=z),A===null&&(z=t,p.substr(t,5).toLowerCase()==="false"?(A=p.substr(t,5),t+=5):(A=null,o('"false"')),A!==null&&(A=void(ae.stale=!1)),A===null&&(t=z)),A!==null?l=[l,T,A]:(l=null,t=B)):(l=null,t=B),l}function As(){var l,T,A,B,z,Q;return B=t,z=t,p.substr(t,9).toLowerCase()==="algorithm"?(l=p.substr(t,9),t+=9):(l=null,o('"algorithm"')),l!==null&&(T=re())!==null?(p.substr(t,3).toLowerCase()==="md5"?(A=p.substr(t,3),t+=3):(A=null,o('"MD5"')),A===null&&(p.substr(t,8).toLowerCase()==="md5-sess"?(A=p.substr(t,8),t+=8):(A=null,o('"MD5-sess"')),A===null&&(A=j())),A!==null?l=[l,T,A]:(l=null,t=z)):(l=null,t=z),l!==null&&(Q=l[2],l=void(ae.algorithm=Q.toUpperCase())),l===null&&(t=B),l}function Na(){var l,T,A,B,z,Q,ne,he,ke,Ge;if(he=t,p.substr(t,3).toLowerCase()==="qop"?(l=p.substr(t,3),t+=3):(l=null,o('"qop"')),l!==null)if((T=re())!==null)if((A=we())!==null){if(ke=t,(B=Pi())!==null){for(z=[],Ge=t,p.charCodeAt(t)===44?(Q=",",t++):(Q=null,o('","')),Q!==null&&(ne=Pi())!==null?Q=[Q,ne]:(Q=null,t=Ge);Q!==null;)z.push(Q),Ge=t,p.charCodeAt(t)===44?(Q=",",t++):(Q=null,o('","')),Q!==null&&(ne=Pi())!==null?Q=[Q,ne]:(Q=null,t=Ge);z!==null?B=[B,z]:(B=null,t=ke)}else B=null,t=ke;B!==null&&(z=Ee())!==null?l=[l,T,A,B,z]:(l=null,t=he)}else l=null,t=he;else l=null,t=he;else l=null,t=he;return l}function Pi(){var l,T,A;return T=t,p.substr(t,8).toLowerCase()==="auth-int"?(l=p.substr(t,8),t+=8):(l=null,o('"auth-int"')),l===null&&(p.substr(t,4).toLowerCase()==="auth"?(l=p.substr(t,4),t+=4):(l=null,o('"auth"')),l===null&&(l=j())),l!==null&&(A=l,ae.qop||(ae.qop=[]),l=void ae.qop.push(A.toLowerCase())),l===null&&(t=T),l}function Di(){var l,T,A,B,z,Q,ne;if(z=t,Q=t,(l=Vt())!==null){for(T=[],ne=t,(A=oe())!==null&&(B=dt())!==null?A=[A,B]:(A=null,t=ne);A!==null;)T.push(A),ne=t,(A=oe())!==null&&(B=dt())!==null?A=[A,B]:(A=null,t=ne);T!==null?l=[l,T]:(l=null,t=Q)}else l=null,t=Q;return l!==null&&(l=function(he){var ke;ae.multi_header||(ae.multi_header=[]);try{ke=new Sr(ae.uri,ae.display_name,ae.params),delete ae.uri,delete ae.display_name,delete ae.params}catch{ke=null}ae.multi_header.push({possition:t,offset:he,parsed:ke})}(z)),l===null&&(t=z),l}function Jr(){var l;return(l=Ua())===null&&(l=dt()),l}function Ua(){var l,T,A,B,z,Q,ne;if(z=t,Q=t,p.substr(t,5).toLowerCase()==="cause"?(l=p.substr(t,5),t+=5):(l=null,o('"cause"')),l!==null)if((T=re())!==null){if((B=n())!==null)for(A=[];B!==null;)A.push(B),B=n();else A=null;A!==null?l=[l,T,A]:(l=null,t=Q)}else l=null,t=Q;else l=null,t=Q;return l!==null&&(ne=l[2],l=void(ae.cause=parseInt(ne.join("")))),l===null&&(t=z),l}function Mi(){var l,T,A,B,z,Q;if(z=t,(l=Vt())!==null){for(T=[],Q=t,(A=oe())!==null&&(B=dt())!==null?A=[A,B]:(A=null,t=Q);A!==null;)T.push(A),Q=t,(A=oe())!==null&&(B=dt())!==null?A=[A,B]:(A=null,t=Q);T!==null?l=[l,T]:(l=null,t=z)}else l=null,t=z;return l}function xa(){var l,T,A;return T=t,p.substr(t,6).toLowerCase()==="active"?(l=p.substr(t,6),t+=6):(l=null,o('"active"')),l===null&&(p.substr(t,7).toLowerCase()==="pending"?(l=p.substr(t,7),t+=7):(l=null,o('"pending"')),l===null&&(p.substr(t,10).toLowerCase()==="terminated"?(l=p.substr(t,10),t+=10):(l=null,o('"terminated"')),l===null&&(l=j()))),l!==null&&(A=T,l=void(ae.state=p.substring(t,A))),l===null&&(t=T),l}function Os(){var l,T,A,B,z,Q,ne,he;return B=t,z=t,p.substr(t,6).toLowerCase()==="reason"?(l=p.substr(t,6),t+=6):(l=null,o('"reason"')),l!==null&&(T=re())!==null&&(A=ja())!==null?l=[l,T,A]:(l=null,t=z),l!==null&&(l=void((Q=l[2])!==void 0&&(ae.reason=Q))),l===null&&(t=B),l===null&&(B=t,z=t,p.substr(t,7).toLowerCase()==="expires"?(l=p.substr(t,7),t+=7):(l=null,o('"expires"')),l!==null&&(T=re())!==null&&(A=Rn())!==null?l=[l,T,A]:(l=null,t=z),l!==null&&(l=void((he=l[2])!==void 0&&(ae.expires=he))),l===null&&(t=B),l===null&&(B=t,z=t,p.substr(t,11).toLowerCase()==="retry_after"?(l=p.substr(t,11),t+=11):(l=null,o('"retry_after"')),l!==null&&(T=re())!==null&&(A=Rn())!==null?l=[l,T,A]:(l=null,t=z),l!==null&&(l=void((ne=l[2])!==void 0&&(ae.retry_after=ne))),l===null&&(t=B),l===null&&(l=dt()))),l}function ja(){var l;return p.substr(t,11).toLowerCase()==="deactivated"?(l=p.substr(t,11),t+=11):(l=null,o('"deactivated"')),l===null&&(p.substr(t,9).toLowerCase()==="probation"?(l=p.substr(t,9),t+=9):(l=null,o('"probation"')),l===null&&(p.substr(t,8).toLowerCase()==="rejected"?(l=p.substr(t,8),t+=8):(l=null,o('"rejected"')),l===null&&(p.substr(t,7).toLowerCase()==="timeout"?(l=p.substr(t,7),t+=7):(l=null,o('"timeout"')),l===null&&(p.substr(t,6).toLowerCase()==="giveup"?(l=p.substr(t,6),t+=6):(l=null,o('"giveup"')),l===null&&(p.substr(t,10).toLowerCase()==="noresource"?(l=p.substr(t,10),t+=10):(l=null,o('"noresource"')),l===null&&(p.substr(t,9).toLowerCase()==="invariant"?(l=p.substr(t,9),t+=9):(l=null,o('"invariant"')),l===null&&(l=j()))))))),l}function Ni(){var l;return(l=Oi())===null&&(l=dt()),l}function Ui(){var l,T,A,B,z,Q,ne,he;if(ne=t,(l=Is())!==null)if((T=I())!==null)if((A=za())!==null){for(B=[],he=t,(z=oe())!==null&&(Q=ks())!==null?z=[z,Q]:(z=null,t=he);z!==null;)B.push(z),he=t,(z=oe())!==null&&(Q=ks())!==null?z=[z,Q]:(z=null,t=he);B!==null?l=[l,T,A,B]:(l=null,t=ne)}else l=null,t=ne;else l=null,t=ne;else l=null,t=ne;return l}function ks(){var l;return(l=Fa())===null&&(l=Ga())===null&&(l=xi())===null&&(l=Ha())===null&&(l=Ba())===null&&(l=dt()),l}function Fa(){var l,T,A,B,z,Q;return B=t,z=t,p.substr(t,3).toLowerCase()==="ttl"?(l=p.substr(t,3),t+=3):(l=null,o('"ttl"')),l!==null&&(T=re())!==null&&(A=Ls())!==null?l=[l,T,A]:(l=null,t=z),l!==null&&(Q=l[2],l=void(ae.ttl=Q)),l===null&&(t=B),l}function Ga(){var l,T,A,B,z,Q;return B=t,z=t,p.substr(t,5).toLowerCase()==="maddr"?(l=p.substr(t,5),t+=5):(l=null,o('"maddr"')),l!==null&&(T=re())!==null&&(A=fe())!==null?l=[l,T,A]:(l=null,t=z),l!==null&&(Q=l[2],l=void(ae.maddr=Q)),l===null&&(t=B),l}function xi(){var l,T,A,B,z,Q;return B=t,z=t,p.substr(t,8).toLowerCase()==="received"?(l=p.substr(t,8),t+=8):(l=null,o('"received"')),l!==null&&(T=re())!==null?((A=rt())===null&&(A=Pe()),A!==null?l=[l,T,A]:(l=null,t=z)):(l=null,t=z),l!==null&&(Q=l[2],l=void(ae.received=Q)),l===null&&(t=B),l}function Ha(){var l,T,A,B,z,Q;return B=t,z=t,p.substr(t,6).toLowerCase()==="branch"?(l=p.substr(t,6),t+=6):(l=null,o('"branch"')),l!==null&&(T=re())!==null&&(A=j())!==null?l=[l,T,A]:(l=null,t=z),l!==null&&(Q=l[2],l=void(ae.branch=Q)),l===null&&(t=B),l}function Ba(){var l,T,A,B,z;return B=t,p.substr(t,5).toLowerCase()==="rport"?(l=p.substr(t,5),t+=5):(l=null,o('"rport"')),l!==null?(z=t,(T=re())!==null&&(A=$a())!==null?T=[T,A]:(T=null,t=z),(T=T!==null?T:"")!==null?l=[l,T]:(l=null,t=B)):(l=null,t=B),l}function $a(){var l,T,A,B,z,Q,ne,he;return Q=t,ne=t,(l=(l=n())!==null?l:"")!==null&&(T=(T=n())!==null?T:"")!==null&&(A=(A=n())!==null?A:"")!==null&&(B=(B=n())!==null?B:"")!==null&&(z=(z=n())!==null?z:"")!==null?l=[l,T,A,B,z]:(l=null,t=ne),l!==null&&(he=l,l=void(ae.rport=parseInt(he.join("")))),l===null&&(t=Q),l}function Is(){var l,T,A,B,z,Q;return Q=t,(l=qa())!==null&&(T=J())!==null&&(A=j())!==null&&(B=J())!==null&&(z=Va())!==null?l=[l,T,A,B,z]:(l=null,t=Q),l}function qa(){var l,T,A;return T=t,p.substr(t,3).toLowerCase()==="sip"?(l=p.substr(t,3),t+=3):(l=null,o('"SIP"')),l===null&&(l=j()),l!==null&&(A=l,l=void(ae.protocol=A)),l===null&&(t=T),l}function Va(){var l,T,A;return T=t,p.substr(t,3).toLowerCase()==="udp"?(l=p.substr(t,3),t+=3):(l=null,o('"UDP"')),l===null&&(p.substr(t,3).toLowerCase()==="tcp"?(l=p.substr(t,3),t+=3):(l=null,o('"TCP"')),l===null&&(p.substr(t,3).toLowerCase()==="tls"?(l=p.substr(t,3),t+=3):(l=null,o('"TLS"')),l===null&&(p.substr(t,4).toLowerCase()==="sctp"?(l=p.substr(t,4),t+=4):(l=null,o('"SCTP"')),l===null&&(l=j())))),l!==null&&(A=l,l=void(ae.transport=A)),l===null&&(t=T),l}function za(){var l,T,A,B,z;return B=t,(l=Wa())!==null?(z=t,(T=_e())!==null&&(A=Ya())!==null?T=[T,A]:(T=null,t=z),(T=T!==null?T:"")!==null?l=[l,T]:(l=null,t=B)):(l=null,t=B),l}function Wa(){var l,T,A;return T=t,(l=rt())===null&&(l=Ne())===null&&(l=ge()),l!==null&&(A=T,l=void(ae.host=p.substring(t,A))),l===null&&(t=T),l}function Ya(){var l,T,A,B,z,Q,ne,he;return Q=t,ne=t,(l=(l=n())!==null?l:"")!==null&&(T=(T=n())!==null?T:"")!==null&&(A=(A=n())!==null?A:"")!==null&&(B=(B=n())!==null?B:"")!==null&&(z=(z=n())!==null?z:"")!==null?l=[l,T,A,B,z]:(l=null,t=ne),l!==null&&(he=l,l=void(ae.port=parseInt(he.join("")))),l===null&&(t=Q),l}function Ls(){var l,T,A,B,z;return B=t,z=t,(l=n())!==null&&(T=(T=n())!==null?T:"")!==null&&(A=(A=n())!==null?A:"")!==null?l=[l,T,A]:(l=null,t=z),l!==null&&(l=parseInt(l.join(""))),l===null&&(t=B),l}function Qa(){var l,T,A;return T=t,(l=Rn())!==null&&(A=l,l=void(ae.expires=A)),l===null&&(t=T),l}function Ps(){var l;return(l=Ka())===null&&(l=dt()),l}function Ka(){var l,T,A,B,z,Q;return B=t,z=t,p.substr(t,9).toLowerCase()==="refresher"?(l=p.substr(t,9),t+=9):(l=null,o('"refresher"')),l!==null&&(T=re())!==null?(p.substr(t,3).toLowerCase()==="uac"?(A=p.substr(t,3),t+=3):(A=null,o('"uac"')),A===null&&(p.substr(t,3).toLowerCase()==="uas"?(A=p.substr(t,3),t+=3):(A=null,o('"uas"'))),A!==null?l=[l,T,A]:(l=null,t=z)):(l=null,t=z),l!==null&&(Q=l[2],l=void(ae.refresher=Q.toLowerCase())),l===null&&(t=B),l}function ji(){var l,T;for(l=[],(T=H())===null&&(T=$())===null&&(T=I());T!==null;)l.push(T),(T=H())===null&&(T=$())===null&&(T=I());return l}function _r(){var l,T,A,B,z,Q,ne,he,ke,Ge,kt,rn;return Ge=t,kt=t,(l=Ds())!==null?(p.charCodeAt(t)===45?(T="-",t++):(T=null,o('"-"')),T!==null&&(A=vn())!==null?(p.charCodeAt(t)===45?(B="-",t++):(B=null,o('"-"')),B!==null&&(z=vn())!==null?(p.charCodeAt(t)===45?(Q="-",t++):(Q=null,o('"-"')),Q!==null&&(ne=vn())!==null?(p.charCodeAt(t)===45?(he="-",t++):(he=null,o('"-"')),he!==null&&(ke=Ms())!==null?l=[l,T,A,B,z,Q,ne,he,ke]:(l=null,t=kt)):(l=null,t=kt)):(l=null,t=kt)):(l=null,t=kt)):(l=null,t=kt),l!==null&&(rn=Ge,l[0],l=void(ae=p.substring(t+5,rn))),l===null&&(t=Ge),l}function vn(){var l,T,A,B,z;return z=t,(l=a())!==null&&(T=a())!==null&&(A=a())!==null&&(B=a())!==null?l=[l,T,A,B]:(l=null,t=z),l}function Ds(){var l,T,A;return A=t,(l=vn())!==null&&(T=vn())!==null?l=[l,T]:(l=null,t=A),l}function Ms(){var l,T,A,B;return B=t,(l=vn())!==null&&(T=vn())!==null&&(A=vn())!==null?l=[l,T,A]:(l=null,t=B),l}function Ns(){var l,T,A,B,z,Q,ne;return B=t,z=t,(l=Y())!==null?(Q=t,p.charCodeAt(t)===64?(T="@",t++):(T=null,o('"@"')),T!==null&&(A=Y())!==null?T=[T,A]:(T=null,t=Q),(T=T!==null?T:"")!==null?l=[l,T]:(l=null,t=z)):(l=null,t=z),l!==null&&(ne=B,l=void(ae.call_id=p.substring(t,ne))),l===null&&(t=B),l}function Fi(){var l;return(l=Us())===null&&(l=Gn())===null&&(l=Xa())===null&&(l=dt()),l}function Us(){var l,T,A,B,z,Q;return B=t,z=t,p.substr(t,6)==="to-tag"?(l="to-tag",t+=6):(l=null,o('"to-tag"')),l!==null&&(T=re())!==null&&(A=j())!==null?l=[l,T,A]:(l=null,t=z),l!==null&&(Q=l[2],l=void(ae.to_tag=Q)),l===null&&(t=B),l}function Gn(){var l,T,A,B,z,Q;return B=t,z=t,p.substr(t,8)==="from-tag"?(l="from-tag",t+=8):(l=null,o('"from-tag"')),l!==null&&(T=re())!==null&&(A=j())!==null?l=[l,T,A]:(l=null,t=z),l!==null&&(Q=l[2],l=void(ae.from_tag=Q)),l===null&&(t=B),l}function Xa(){var l,T;return T=t,p.substr(t,10)==="early-only"?(l="early-only",t+=10):(l=null,o('"early-only"')),l!==null&&(l=void(ae.early_only=!0)),l===null&&(t=T),l}var Ja=G("./URI"),Sr=G("./NameAddrHeader"),ae={};if(_[b]()===null||t!==p.length){var Gi=Math.max(t,m),Zr=Gi<p.length?p.charAt(Gi):null,Cr=function(){for(var l=1,T=1,A=!1,B=0;B<Math.max(t,m);B++){var z=p.charAt(B);z===`
`?(A||l++,T=1,A=!1):z==="\r"||z==="\u2028"||z==="\u2029"?(l++,T=1,A=!0):(T++,A=!1)}return{line:l,column:T}}();return new this.SyntaxError(function(l){l.sort();for(var T=null,A=[],B=0;B<l.length;B++)l[B]!==T&&(A.push(l[B]),T=l[B]);return A}(f),Zr,Gi,Cr.line,Cr.column),-1}return ae},toSource:function(){return this._source},SyntaxError:function(p,b,_,t,m){this.name="SyntaxError",this.expected=p,this.found=b,this.message=function(f,o){var s;switch(f.length){case 0:s="end of input";break;case 1:s=f[0];break;default:s=f.slice(0,f.length-1).join(", ")+" or "+f[f.length-1]}return"Expected "+s+" but "+(o?N(o):"end of input")+" found."}(p,b),this.offset=_,this.line=t,this.column=m}};return S.SyntaxError.prototype=Error.prototype,S}()},{"./NameAddrHeader":10,"./URI":25}],8:[function(G,q,x){const N=G("webrtc-adapter"),S=G("../package.json"),p=G("./Constants"),b=G("./Exceptions"),_=G("./Utils"),t=G("./UA"),m=G("./URI"),f=G("./NameAddrHeader"),o=G("./Grammar"),s=G("./WebSocketInterface"),n=G("debug")("JsSIP"),i=G("./Message");n("version %s",S.version),q.exports={C:p,Exceptions:b,Utils:_,UA:t,URI:m,NameAddrHeader:f,WebSocketInterface:s,Message:i,Grammar:o,debug:G("debug"),adapter:N,get name(){return S.title},get version(){return S.version}}},{"../package.json":55,"./Constants":2,"./Exceptions":6,"./Grammar":7,"./Message":9,"./NameAddrHeader":10,"./UA":24,"./URI":25,"./Utils":26,"./WebSocketInterface":27,debug:30,"webrtc-adapter":40}],9:[function(G,q,x){const N=G("events").EventEmitter,S=G("./Constants"),p=G("./SIPMessage"),b=G("./Utils"),_=G("./RequestSender"),t=G("./Exceptions"),m=G("debug")("JsSIP:Message");q.exports=class extends N{constructor(f){super(),this._ua=f,this._request=null,this._closed=!1,this._direction=null,this._local_identity=null,this._remote_identity=null,this._is_replied=!1,this._data={}}get direction(){return this._direction}get local_identity(){return this._local_identity}get remote_identity(){return this._remote_identity}send(f,o,s,n={}){const i=f;if(f===void 0||o===void 0)throw new TypeError("Not enough arguments");if(!(f=this._ua.normalizeTarget(f)))throw new TypeError(`Invalid target: ${i}`);const a=b.cloneArray(n.extraHeaders),c=b.cloneObject(n.eventHandlers),u=n.contentType||"text/plain";for(const h in c)Object.prototype.hasOwnProperty.call(c,h)&&this.on(h,c[h]);a.push(`Content-Type: ${u}`),this._request=new p.OutgoingRequest(s||S.MESSAGE,f,this._ua,null,a),o&&(this._request.body=o),n.identifier&&n.identifier!==""&&this._request.setHeader("call-id",`${this._request.call_id}_${n.identifier}`);const g=new _(this._ua,this._request,{onRequestTimeout:()=>{this._onRequestTimeout()},onTransportError:()=>{this._onTransportError()},onReceiveResponse:h=>{this._receiveResponse(h)}});this._newMessage("local",this._request),g.send()}init_incoming(f){this._request=f,this._newMessage("remote",f),this._is_replied||(this._is_replied=!0,f.reply(200)),this._close()}accept(f={}){const o=b.cloneArray(f.extraHeaders),s=f.body;if(this._direction!=="incoming")throw new t.NotSupportedError('"accept" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");this._is_replied=!0,this._request.reply(200,null,o,s)}reject(f={}){const o=f.status_code||480,s=f.reason_phrase,n=b.cloneArray(f.extraHeaders),i=f.body;if(this._direction!=="incoming")throw new t.NotSupportedError('"reject" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");if(o<300||o>=700)throw new TypeError(`Invalid status_code: ${o}`);this._is_replied=!0,this._request.reply(o,s,n,i)}_receiveResponse(f){if(!this._closed)switch(!0){case/^1[0-9]{2}$/.test(f.status_code):break;case/^2[0-9]{2}$/.test(f.status_code):this._succeeded("remote",f);break;default:{const o=b.sipErrorCause(f.status_code);this._failed("remote",f,o);break}}}_onRequestTimeout(){this._closed||this._failed("system",null,S.causes.REQUEST_TIMEOUT)}_onTransportError(){this._closed||this._failed("system",null,S.causes.CONNECTION_ERROR)}_close(){this._closed=!0,this._ua.destroyMessage(this)}_newMessage(f,o){f==="remote"?(this._direction="incoming",this._local_identity=o.to,this._remote_identity=o.from):f==="local"&&(this._direction="outgoing",this._local_identity=o.from,this._remote_identity=o.to),this._ua.newMessage(this,{originator:f,message:this,request:o})}_failed(f,o,s){this._close(),o&&o.method!==S.OPTIONS&&m('emit "failed"'),this.emit("failed",{originator:f,response:o||null,cause:s})}_succeeded(f,o){m("MESSAGE succeeded"),this._close(),m('emit "succeeded"'),this.emit("succeeded",{originator:f,response:o})}}},{"./Constants":2,"./Exceptions":6,"./RequestSender":18,"./SIPMessage":19,"./Utils":26,debug:30,events:29}],10:[function(G,q,x){const N=G("./URI"),S=G("./Grammar");q.exports=class eh{static parse(b){return(b=S.parse(b,"Name_Addr_Header"))!==-1?b:void 0}constructor(b,_,t){if(!(b&&b instanceof N))throw new TypeError('missing or invalid "uri" parameter');this._uri=b,this._parameters={},this.display_name=_;for(const m in t)Object.prototype.hasOwnProperty.call(t,m)&&this.setParam(m,t[m])}get uri(){return this._uri}get display_name(){return this._display_name}set display_name(b){this._display_name=b===0?"0":b}setParam(b,_){b&&(this._parameters[b.toLowerCase()]=_==null?null:_.toString())}getParam(b){if(b)return this._parameters[b.toLowerCase()]}hasParam(b){if(b)return!!this._parameters.hasOwnProperty(b.toLowerCase())}deleteParam(b){if(b=b.toLowerCase(),this._parameters.hasOwnProperty(b)){const _=this._parameters[b];return delete this._parameters[b],_}}clearParams(){this._parameters={}}clone(){return new eh(this._uri.clone(),this._display_name,JSON.parse(JSON.stringify(this._parameters)))}_quote(b){return b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}toString(){let b=this._display_name?`"${this._quote(this._display_name)}" `:"";b+=`<${this._uri.toString()}>`;for(const _ in this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,_)&&(b+=`;${_}`,this._parameters[_]!==null&&(b+=`=${this._parameters[_]}`));return b}}},{"./Grammar":7,"./URI":25}],11:[function(G,q,x){const N=G("./Grammar"),S=G("./SIPMessage"),p=G("debug")("JsSIP:ERROR:Parser");function b(t,m){let f=m,o=0,s=0;if(t.substring(f,f+2).match(/(^\r\n)/))return-2;for(;o===0;){if((s=t.indexOf(`\r
`,f))===-1)return s;!t.substring(s+2,s+4).match(/(^\r\n)/)&&t.charAt(s+2).match(/(^\s+)/)?f=s+2:o=s}return o}function _(t,m,f,o){let s;const n=m.indexOf(":",f),i=m.substring(f,n).trim(),a=m.substring(n+1,o).trim();switch(i.toLowerCase()){case"via":case"v":t.addHeader("via",a),t.getHeaders("via").length===1?(s=t.parseHeader("Via"))&&(t.via=s,t.via_branch=s.branch):s=0;break;case"from":case"f":t.setHeader("from",a),(s=t.parseHeader("from"))&&(t.from=s,t.from_tag=s.getParam("tag"));break;case"to":case"t":t.setHeader("to",a),(s=t.parseHeader("to"))&&(t.to=s,t.to_tag=s.getParam("tag"));break;case"record-route":if((s=N.parse(a,"Record_Route"))===-1)s=void 0;else for(const c of s)t.addHeader("record-route",a.substring(c.possition,c.offset)),t.headers["Record-Route"][t.getHeaders("record-route").length-1].parsed=c.parsed;break;case"call-id":case"i":t.setHeader("call-id",a),(s=t.parseHeader("call-id"))&&(t.call_id=a);break;case"contact":case"m":if((s=N.parse(a,"Contact"))===-1)s=void 0;else for(const c of s)t.addHeader("contact",a.substring(c.possition,c.offset)),t.headers.Contact[t.getHeaders("contact").length-1].parsed=c.parsed;break;case"content-length":case"l":t.setHeader("content-length",a),s=t.parseHeader("content-length");break;case"content-type":case"c":t.setHeader("content-type",a),s=t.parseHeader("content-type");break;case"cseq":t.setHeader("cseq",a),(s=t.parseHeader("cseq"))&&(t.cseq=s.value),t instanceof S.IncomingResponse&&(t.method=s.method);break;case"max-forwards":t.setHeader("max-forwards",a),s=t.parseHeader("max-forwards");break;case"www-authenticate":t.setHeader("www-authenticate",a),s=t.parseHeader("www-authenticate");break;case"proxy-authenticate":t.setHeader("proxy-authenticate",a),s=t.parseHeader("proxy-authenticate");break;case"session-expires":case"x":t.setHeader("session-expires",a),(s=t.parseHeader("session-expires"))&&(t.session_expires=s.expires,t.session_expires_refresher=s.refresher);break;case"refer-to":case"r":t.setHeader("refer-to",a),(s=t.parseHeader("refer-to"))&&(t.refer_to=s);break;case"replaces":t.setHeader("replaces",a),(s=t.parseHeader("replaces"))&&(t.replaces=s);break;case"event":case"o":t.setHeader("event",a),(s=t.parseHeader("event"))&&(t.event=s);break;default:t.addHeader(i,a),s=0}return s!==void 0||{error:`error parsing header "${i}"`}}p.log=console.warn.bind(console),x.parseMessage=(t,m)=>{let f,o,s=t.indexOf(`\r
`);if(s===-1)return void p("parseMessage() | no CRLF found, not a SIP message");const n=t.substring(0,s);let i=N.parse(n,"Request_Response");if(i===-1)return void p(`parseMessage() | error parsing first line of SIP message: "${n}"`);i.status_code?((f=new S.IncomingResponse).status_code=i.status_code,f.reason_phrase=i.reason_phrase):((f=new S.IncomingRequest(m)).method=i.method,f.ruri=i.uri),f.data=t;let a=s+2;for(;;){if((s=b(t,a))===-2){o=a+2;break}if(s===-1)return void p("parseMessage() | malformed message");if((i=_(f,t,a,s))!==!0)return void p("parseMessage() |",i.error);a=s+2}if(f.hasHeader("content-length")){const c=f.getHeader("content-length");f.body=t.substr(o,c)}else f.body=t.substring(o);return f}},{"./Grammar":7,"./SIPMessage":19,debug:30}],12:[function(G,q,x){const{EventEmitter:N}=G("events"),S=G("sdp-transform"),p=G("debug")("JsSIP:RTCSession"),b=G("debug")("JsSIP:ERROR:RTCSession"),_=G("./Constants"),t=G("./Exceptions"),m=G("./Transactions"),f=G("./Utils"),o=G("./Timers"),s=G("./SIPMessage"),n=G("./Dialog"),i=G("./RequestSender"),a=G("./RTCSession/DTMF"),c=G("./RTCSession/Info"),u=G("./RTCSession/ReferNotifier"),g=G("./RTCSession/ReferSubscriber");b.log=console.warn.bind(console);const h=_.SESSION_CONSTANTS,C=["audio","video"];q.exports=class Vc extends N{static get C(){return h}constructor(y){p("new"),super(),this._id=null,this._ua=y,this._transport=y._transport,this.inviteInterval=null,this._status=h.STATUS_NULL,this._dialog=null,this._earlyDialogs={},this._contact=null,this._from_tag=null,this._to_tag=null,this._connection=null,this._connectionPromiseQueue=Promise.resolve(),this._request=null,this._is_canceled=!1,this._cancel_reason="",this._is_confirmed=!1,this._late_sdp=!1,this._rtcOfferConstraints=null,this._rtcAnswerConstraints=null,this._localMediaStream=null,this._localMediaStreamLocallyGenerated=!1,this._rtcReady=!0,this._timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},this._direction=null,this._local_identity=null,this._remote_identity=null,this._start_time=null,this._end_time=null,this._tones=null,this._audioMuted=!1,this._videoMuted=!1,this._localHold=!1,this._remoteHold=!1,this._sessionTimers={enabled:this._ua.configuration.session_timers,refreshMethod:this._ua.configuration.session_timers_refresh_method,defaultExpires:_.SESSION_EXPIRES,currentExpires:null,running:!1,refresher:!1,timer:null},this._referSubscribers={},this._data={}}get C(){return h}get causes(){return _.causes}get id(){return this._id}get connection(){return this._connection}get contact(){return this._contact}get direction(){return this._direction}get local_identity(){return this._local_identity}get remote_identity(){return this._remote_identity}get start_time(){return this._start_time}get end_time(){return this._end_time}get data(){return this._data}set data(y){this._data=y}get status(){return this._status}isInProgress(){switch(this._status){case h.STATUS_NULL:case h.STATUS_INVITE_SENT:case h.STATUS_1XX_RECEIVED:case h.STATUS_INVITE_RECEIVED:case h.STATUS_WAITING_FOR_ANSWER:return!0;default:return!1}}replaceUA(y){this._ua=y,this._transport=y._transport,this._dialog&&(this._dialog._owner._ua=y,this._dialog._ua=y,this._dialog._owner._transport=y._transport)}isEstablished(){switch(this._status){case h.STATUS_ANSWERED:case h.STATUS_WAITING_FOR_ACK:case h.STATUS_CONFIRMED:return!0;default:return!1}}isEnded(){switch(this._status){case h.STATUS_CANCELED:case h.STATUS_TERMINATED:return!0;default:return!1}}isMuted(){return{audio:this._audioMuted,video:this._videoMuted}}isOnHold(){return{local:this._localHold,remote:this._remoteHold}}emitNoCallExists(y){this.emit("noCall",{originator:"local",message:y.data,cause:y.reason_phrase})}connect(y,w={},O){p("connect()");const L=y,I=w.eventHandlers||{},k=f.cloneArray(w.extraHeaders),P=w.mediaConstraints||{audio:!0,video:!0},F=w.mediaStream||null,H=w.pcConfig||{iceServers:[]},D=w.rtcConstraints||null,$=w.rtcOfferConstraints||null;if(this._rtcOfferConstraints=$,this._rtcAnswerConstraints=w.rtcAnswerConstraints||null,this._data=w.data||this._data,y===void 0)throw new TypeError("Not enough arguments");if(this._status!==h.STATUS_NULL)throw new t.InvalidStateError(this._status);if(!window.RTCPeerConnection)throw new t.NotSupportedError("WebRTC not supported");if(!(y=this._ua.normalizeTarget(y)))throw new TypeError(`Invalid target: ${L}`);this._sessionTimers.enabled&&f.isDecimal(w.sessionTimersExpires)&&(w.sessionTimersExpires>=_.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=w.sessionTimersExpires:this._sessionTimers.defaultExpires=_.SESSION_EXPIRES);for(const Y in I)Object.prototype.hasOwnProperty.call(I,Y)&&this.on(Y,I[Y]);this._from_tag=f.newTag();const j=w.anonymous||!1,V={from_tag:this._from_tag};this._contact=this._ua.contact.toString({anonymous:j,outbound:!0}),j&&(V.from_display_name="Anonymous",V.from_uri="sip:anonymous@anonymous.invalid",k.push(`P-Preferred-Identity: ${this._ua.configuration.uri.toString()}`),k.push("Privacy: id")),k.push(`Contact: ${this._contact}`),k.push("Content-Type: application/sdp"),this._sessionTimers.enabled&&k.push(`Session-Expires: ${this._sessionTimers.defaultExpires}`),this._request=new s.InitialOutgoingInviteRequest(y,this._ua,V,k),this._id=this._request.call_id+this._from_tag,this._createRTCConnection(H,D),this._direction="outgoing",this._local_identity=this._request.from,this._remote_identity=this._request.to,O&&O(this),this._newRTCSession("local",this._request),this._sendInitialRequest(P,$,F)}init_incoming(y,w){let O;p("init_incoming()");const L=y.getHeader("Content-Type");y.body&&L!=="application/sdp"?y.reply(415):(this._status=h.STATUS_INVITE_RECEIVED,this._from_tag=y.from_tag,this._id=y.call_id+this._from_tag,this._request=y,this._contact=this._ua.contact.toString(),y.hasHeader("expires")&&(O=1e3*y.getHeader("expires")),y.to_tag=f.newTag(),this._createDialog(y,"UAS",!0)?(y.body?this._late_sdp=!1:this._late_sdp=!0,this._status=h.STATUS_WAITING_FOR_ANSWER,this._timers.userNoAnswerTimer=setTimeout(()=>{y.reply(408),this._failed("local",null,_.causes.NO_ANSWER)},this._ua.configuration.no_answer_timeout),O&&(this._timers.expiresTimer=setTimeout(()=>{this._status===h.STATUS_WAITING_FOR_ANSWER&&(y.reply(487),this._failed("system",null,_.causes.EXPIRES))},O)),this._direction="incoming",this._local_identity=y.to,this._remote_identity=y.from,w&&w(this),this._newRTCSession("remote",y),this._status!==h.STATUS_TERMINATED&&(y.reply(180,null,[`Contact: ${this._contact}`]),this._progress("local",null))):y.reply(500,"Missing Contact header field"))}answer(y={}){p("answer()");const w=this._request,O=f.cloneArray(y.extraHeaders),L=y.mediaConstraints||{},I=y.mediaStream||null,k=y.pcConfig||{iceServers:[]},P=y.rtcConstraints||null,F=y.rtcAnswerConstraints||null;let H,D=!1,$=!1,j=!1,V=!1;if(this._rtcAnswerConstraints=F,this._rtcOfferConstraints=y.rtcOfferConstraints||null,this._data=y.data||this._data,this._direction!=="incoming")throw new t.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this._status!==h.STATUS_WAITING_FOR_ANSWER)throw new t.InvalidStateError(this._status);if(this._sessionTimers.enabled&&f.isDecimal(y.sessionTimersExpires)&&(y.sessionTimersExpires>=_.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=y.sessionTimersExpires:this._sessionTimers.defaultExpires=_.SESSION_EXPIRES),this._status=h.STATUS_ANSWERED,!this._createDialog(w,"UAS"))return void w.reply(500,"Error creating dialog");clearTimeout(this._timers.userNoAnswerTimer),O.unshift(`Contact: ${this._contact}`);const Y=w.parseSDP();Array.isArray(Y.media)||(Y.media=[Y.media]);for(const Z of Y.media)Z.type==="audio"&&(D=!0,Z.direction&&Z.direction!=="sendrecv"||(j=!0)),Z.type==="video"&&($=!0,Z.direction&&Z.direction!=="sendrecv"||(V=!0));if(I&&L.audio===!1){H=I.getAudioTracks();for(const Z of H)I.removeTrack(Z)}if(I&&L.video===!1){H=I.getVideoTracks();for(const Z of H)I.removeTrack(Z)}I||L.audio!==void 0||(L.audio=j),I||L.video!==void 0||(L.video=V),I||D||(L.audio=!1),I||$||(L.video=!1),this._createRTCConnection(k,P),Promise.resolve().then(()=>I||(L.audio||L.video?(this._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(L).catch(Z=>{throw this._status===h.STATUS_TERMINATED?new Error("terminated"):(w.reply(480),this._failed("local",null,_.causes.USER_DENIED_MEDIA_ACCESS),b('emit "getusermediafailed" [error:%o]',Z),this.emit("getusermediafailed",Z),new Error("getUserMedia() failed"))})):void 0)).then(Z=>{if(this._status===h.STATUS_TERMINATED)throw new Error("terminated");this._localMediaStream=Z,Z&&this._connection.addStream(Z)}).then(()=>{if(this._late_sdp)return;const Z={originator:"remote",type:"offer",sdp:w.body};p('emit "sdp"'),this.emit("sdp",Z);const J=new RTCSessionDescription({type:"offer",sdp:Z.sdp});return this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._connection.setRemoteDescription(J)).catch(re=>{throw w.reply(488),this._failed("system",null,_.causes.WEBRTC_ERROR),b('emit "peerconnection:setremotedescriptionfailed" [error:%o]',re),this.emit("peerconnection:setremotedescriptionfailed",re),new Error("peerconnection.setRemoteDescription() failed")}),this._connectionPromiseQueue}).then(()=>{if(this._status===h.STATUS_TERMINATED)throw new Error("terminated");return this._connecting(w),this._late_sdp?this._createLocalDescription("offer",this._rtcOfferConstraints).catch(()=>{throw w.reply(500),new Error("_createLocalDescription() failed")}):this._createLocalDescription("answer",F).catch(()=>{throw w.reply(500),new Error("_createLocalDescription() failed")})}).then(Z=>{if(this._status===h.STATUS_TERMINATED)throw new Error("terminated");this._handleSessionTimersInIncomingRequest(w,O),w.reply(200,null,O,Z,()=>{this._status=h.STATUS_WAITING_FOR_ACK,this._setInvite2xxTimer(w,Z),this._setACKTimer(),this._accepted("local")},()=>{this._failed("system",null,_.causes.CONNECTION_ERROR)})}).catch(Z=>{this._status!==h.STATUS_TERMINATED&&b(Z)})}terminate(y={}){p("terminate()");const w=y.cause||_.causes.BYE,O=f.cloneArray(y.extraHeaders),{body:L}=y;let I,{status_code:k}=y,{reason_phrase:P}=y;if(this._status===h.STATUS_TERMINATED)throw new t.InvalidStateError(this._status);switch(this._status){case h.STATUS_NULL:case h.STATUS_INVITE_SENT:case h.STATUS_1XX_RECEIVED:if(p("canceling session"),k&&(k<200||k>=700))throw new TypeError(`Invalid status_code: ${k}`);k&&(I=`SIP ;cause=${k} ;text="${P=P||_.REASON_PHRASE[k]||""}"`),this._status===h.STATUS_NULL||this._status===h.STATUS_INVITE_SENT?(this._is_canceled=!0,this._cancel_reason=I):this._status===h.STATUS_1XX_RECEIVED&&this._request.cancel(I),this._status=h.STATUS_CANCELED,this._failed("local",null,_.causes.CANCELED);break;case h.STATUS_WAITING_FOR_ANSWER:case h.STATUS_ANSWERED:if(p("rejecting session"),(k=k||480)<300||k>=700)throw new TypeError(`Invalid status_code: ${k}`);this._request.reply(k,P,O,L),this._failed("local",null,_.causes.REJECTED);break;case h.STATUS_WAITING_FOR_ACK:case h.STATUS_CONFIRMED:if(p("terminating session"),P=y.reason_phrase||_.REASON_PHRASE[k]||"",k&&(k<200||k>=700))throw new TypeError(`Invalid status_code: ${k}`);if(k&&O.push(`Reason: SIP ;cause=${k}; text="${P}"`),this._status===h.STATUS_WAITING_FOR_ACK&&this._direction==="incoming"&&this._request.server_transaction.state!==m.C.STATUS_TERMINATED){const F=this._dialog;this.receiveRequest=({method:H})=>{H===_.ACK&&(this.sendRequest(_.BYE,{extraHeaders:O,body:L}),F.terminate())},this._request.server_transaction.on("stateChanged",()=>{this._request.server_transaction.state===m.C.STATUS_TERMINATED&&(this.sendRequest(_.BYE,{extraHeaders:O,body:L}),F.terminate())}),this._ended("local",null,w),this._dialog=F,this._ua.newDialog(F)}else this.sendRequest(_.BYE,{extraHeaders:O,body:L}),this._ended("local",null,w)}}sendDTMF(y,w={}){p("sendDTMF() | tones: %s",y);let O=0,L=w.duration||null,I=w.interToneGap||null;if(y===void 0)throw new TypeError("Not enough arguments");if(this._status!==h.STATUS_CONFIRMED&&this._status!==h.STATUS_WAITING_FOR_ACK)throw new t.InvalidStateError(this._status);if(typeof y=="number"&&(y=y.toString()),!y||typeof y!="string"||!y.match(/^[0-9A-DR#*,]+$/i))throw new TypeError(`Invalid tones: ${y}`);if(L&&!f.isDecimal(L))throw new TypeError(`Invalid tone duration: ${L}`);if(L?L<a.C.MIN_DURATION?(p(`"duration" value is lower than the minimum allowed, setting it to ${a.C.MIN_DURATION} milliseconds`),L=a.C.MIN_DURATION):L>a.C.MAX_DURATION?(p(`"duration" value is greater than the maximum allowed, setting it to ${a.C.MAX_DURATION} milliseconds`),L=a.C.MAX_DURATION):L=Math.abs(L):L=a.C.DEFAULT_DURATION,w.duration=L,I&&!f.isDecimal(I))throw new TypeError(`Invalid interToneGap: ${I}`);I?I<a.C.MIN_INTER_TONE_GAP?(p(`"interToneGap" value is lower than the minimum allowed, setting it to ${a.C.MIN_INTER_TONE_GAP} milliseconds`),I=a.C.MIN_INTER_TONE_GAP):I=Math.abs(I):I=a.C.DEFAULT_INTER_TONE_GAP,this._tones?this._tones+=y:(this._tones=y,(function k(){let P;if(this._status===h.STATUS_TERMINATED||!this._tones||O>=this._tones.length)return void(this._tones=null);const F=this._tones[O];if(O+=1,F===",")P=2e3;else{const H=new a(this);w.eventHandlers={onFailed:()=>{this._tones=null}},H.send(F,w),P=L+I}setTimeout(k.bind(this),P)}).call(this))}sendInfo(y,w,O={}){if(p("sendInfo()"),this._status!==h.STATUS_CONFIRMED&&this._status!==h.STATUS_WAITING_FOR_ACK)throw new t.InvalidStateError(this._status);new c(this).send(y,w,O)}mute(y={audio:!0,video:!1}){p("mute()");let w=!1,O=!1;this._audioMuted===!1&&y.audio&&(w=!0,this._audioMuted=!0,this._toogleMuteAudio(!0)),this._videoMuted===!1&&y.video&&(O=!0,this._videoMuted=!0,this._toogleMuteVideo(!0)),w!==!0&&O!==!0||this._onmute({audio:w,video:O})}unmute(y={audio:!0,video:!0}){p("unmute()");let w=!1,O=!1;this._audioMuted===!0&&y.audio&&(w=!0,this._audioMuted=!1,this._localHold===!1&&this._toogleMuteAudio(!1)),this._videoMuted===!0&&y.video&&(O=!0,this._videoMuted=!1,this._localHold===!1&&this._toogleMuteVideo(!1)),w!==!0&&O!==!0||this._onunmute({audio:w,video:O})}hold(y={},w){if(p("hold()"),this._status!==h.STATUS_WAITING_FOR_ACK&&this._status!==h.STATUS_CONFIRMED||this._localHold===!0||!this._isReadyToReOffer())return!1;this._localHold=!0,this._onhold("local");const O={succeeded:()=>{w&&w()},failed:()=>{this.terminate({cause:_.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Hold Failed"})}};return y.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:O,extraHeaders:y.extraHeaders}):this._sendReinvite({eventHandlers:O,extraHeaders:y.extraHeaders}),!0}unhold(y={},w){if(p("unhold()"),this._status!==h.STATUS_WAITING_FOR_ACK&&this._status!==h.STATUS_CONFIRMED||this._localHold===!1||!this._isReadyToReOffer())return!1;this._localHold=!1,this._onunhold("local");const O={succeeded:()=>{w&&w()},failed:()=>{this.terminate({cause:_.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Unhold Failed"})}};return y.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:O,extraHeaders:y.extraHeaders}):this._sendReinvite({eventHandlers:O,extraHeaders:y.extraHeaders}),!0}setReInviteIceGathering(y){}renegotiate(y={},w){p("renegotiate()");const O=y.rtcOfferConstraints||null;if(this._status!==h.STATUS_WAITING_FOR_ACK&&this._status!==h.STATUS_CONFIRMED||!this._isReadyToReOffer())return!1;const L={succeeded:()=>{w&&w()},failed:()=>{}};return this._setLocalMediaStatus(),y.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:L,rtcOfferConstraints:O,extraHeaders:y.extraHeaders}):(this._transport.isConnecting()||this._ua.isRegistering()||y.sendReinviteOnly||(this._transport.disconnect(!0),this._transport.connect()),this._sendReinvite({eventHandlers:L,rtcOfferConstraints:O,extraHeaders:y.extraHeaders})),!0}refer(y,w){p("refer()");const O=y;if(!(y=this._ua.normalizeTarget(y)))throw new TypeError(`Invalid target: ${O}`);const L=new g(this);L.sendRefer(y,w);const{id:I}=L;return this._referSubscribers[I]=L,L.on("requestFailed",()=>{delete this._referSubscribers[I]}),L.on("accepted",()=>{delete this._referSubscribers[I]}),L.on("failed",()=>{delete this._referSubscribers[I]}),L}sendRequest(y,w){return p("sendRequest()"),this._dialog.sendRequest(y,w)}receiveRequest(y){if(p("receiveRequest()"),y.method===_.CANCEL)this._status!==h.STATUS_WAITING_FOR_ANSWER&&this._status!==h.STATUS_ANSWERED||(this._status=h.STATUS_CANCELED,this._request.reply(487),this._failed("remote",y,_.causes.CANCELED));else switch(y.method){case _.ACK:if(this._status!==h.STATUS_WAITING_FOR_ACK)return;if(this._status=h.STATUS_CONFIRMED,clearTimeout(this._timers.ackTimer),clearTimeout(this._timers.invite2xxTimer),this._late_sdp){if(!y.body){this.terminate({cause:_.causes.MISSING_SDP,status_code:400});break}const w={originator:"remote",type:"answer",sdp:y.body};p('emit "sdp"'),this.emit("sdp",w);const O=new RTCSessionDescription({type:"answer",sdp:w.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._connection.setRemoteDescription(O)).then(()=>{this._is_confirmed||this._confirmed("remote",y)}).catch(L=>{this.terminate({cause:_.causes.BAD_MEDIA_DESCRIPTION,status_code:488}),b('emit "peerconnection:setremotedescriptionfailed" [error:%o]',L),this.emit("peerconnection:setremotedescriptionfailed",L)})}else this._is_confirmed||this._confirmed("remote",y);break;case _.BYE:this._status===h.STATUS_CONFIRMED?(y.reply(200),this._ended("remote",y,_.causes.BYE)):this._status===h.STATUS_INVITE_RECEIVED?(y.reply(200),this._request.reply(487,"BYE Received"),this._ended("remote",y,_.causes.BYE)):y.reply(403,"Wrong Status");break;case _.INVITE:this._status===h.STATUS_CONFIRMED?y.hasHeader("replaces")?this._receiveReplaces(y):this._receiveReinvite(y):y.reply(403,"Wrong Status");break;case _.INFO:if(this._status===h.STATUS_1XX_RECEIVED||this._status===h.STATUS_WAITING_FOR_ANSWER||this._status===h.STATUS_ANSWERED||this._status===h.STATUS_WAITING_FOR_ACK||this._status===h.STATUS_CONFIRMED){const w=y.getHeader("content-type");w&&w.match(/^application\/dtmf-relay/i)?new a(this).init_incoming(y):w!==void 0?new c(this).init_incoming(y):y.reply(415)}else y.reply(403,"Wrong Status");break;case _.UPDATE:this._status===h.STATUS_CONFIRMED?this._receiveUpdate(y):y.reply(403,"Wrong Status");break;case _.REFER:this._status===h.STATUS_CONFIRMED?this._receiveRefer(y):y.reply(403,"Wrong Status");break;case _.NOTIFY:this._status===h.STATUS_CONFIRMED?this._receiveNotify(y):y.reply(403,"Wrong Status");break;default:y.reply(501)}}onTransportError(){b("onTransportError()"),this._status!==h.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:_.causes.CONNECTION_ERROR,cause:_.causes.CONNECTION_ERROR})}onRequestTimeout(){b("onRequestTimeout()"),this._status!==h.STATUS_TERMINATED&&this.terminate({status_code:408,reason_phrase:_.causes.REQUEST_TIMEOUT,cause:_.causes.REQUEST_TIMEOUT})}onDialogError(){b("onDialogError()"),this._status!==h.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:_.causes.DIALOG_ERROR,cause:_.causes.DIALOG_ERROR})}newDTMF(y){p("newDTMF()"),this.emit("newDTMF",y)}newInfo(y){p("newInfo()"),this.emit("newInfo",y)}_isReadyToReOffer(){return this._rtcReady?this._dialog?this._dialog.uac_pending_reply!==!0&&this._dialog.uas_pending_reply!==!0||(p("_isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"),!1):(p("_isReadyToReOffer() | session not established yet"),!1):(p("_isReadyToReOffer() | internal WebRTC status not ready"),!1)}_close(){if(p("close()"),this._status!==h.STATUS_TERMINATED){if(this._status=h.STATUS_TERMINATED,this._connection)try{this._connection.close()}catch(y){b("close() | error closing the RTCPeerConnection: %o",y)}this._localMediaStream&&this._localMediaStreamLocallyGenerated&&(p("close() | closing local MediaStream"),f.closeMediaStream(this._localMediaStream));for(const y in this._timers)Object.prototype.hasOwnProperty.call(this._timers,y)&&clearTimeout(this._timers[y]);clearTimeout(this._sessionTimers.timer),this._dialog&&(this._dialog.terminate(),delete this._dialog);for(const y in this._earlyDialogs)Object.prototype.hasOwnProperty.call(this._earlyDialogs,y)&&(this._earlyDialogs[y].terminate(),delete this._earlyDialogs[y]);for(const y in this._referSubscribers)Object.prototype.hasOwnProperty.call(this._referSubscribers,y)&&delete this._referSubscribers[y];this._ua.destroyRTCSession(this)}}_setInvite2xxTimer(y,w){let O=o.T1;this._timers.invite2xxTimer=setTimeout((function L(){this._status===h.STATUS_WAITING_FOR_ACK&&(y.reply(200,null,[`Contact: ${this._contact}`],w),O<o.T2&&(O*=2)>o.T2&&(O=o.T2),this._timers.invite2xxTimer=setTimeout(L.bind(this),O))}).bind(this),O)}_setACKTimer(){this._timers.ackTimer=setTimeout(()=>{this._status===h.STATUS_WAITING_FOR_ACK&&(p("no ACK received, terminating the session"),clearTimeout(this._timers.invite2xxTimer),this.sendRequest(_.BYE),this._ended("remote",null,_.causes.NO_ACK))},o.TIMER_H)}_createRTCConnection(y,w){this._connection=new RTCPeerConnection(y,w),this._connection.addEventListener("iceconnectionstatechange",()=>{this._connection.iceConnectionState}),p('emit "peerconnection"'),this.emit("peerconnection",{peerconnection:this._connection})}_createLocalDescription(y,w,O=!1){if(p("createLocalDescription()"),y!=="offer"&&y!=="answer")throw new Error(`createLocalDescription() | invalid type "${y}"`);const L=this._connection;return this._rtcReady=!1,Promise.resolve().then(()=>y==="offer"?L.createOffer(w).catch(I=>(b('emit "peerconnection:createofferfailed" [error:%o]',I),this.emit("peerconnection:createofferfailed",I),Promise.reject(I))):L.createAnswer(w).catch(I=>(b('emit "peerconnection:createanswerfailed" [error:%o]',I),this.emit("peerconnection:createanswerfailed",I),Promise.reject(I)))).then(I=>L.setLocalDescription(I).catch(k=>(this._rtcReady=!0,b('emit "peerconnection:setlocaldescriptionfailed" [error:%o]',k),this.emit("peerconnection:setlocaldescriptionfailed",k),Promise.reject(k)))).then(()=>{if(L.iceGatheringState==="complete"&&!O){this._rtcReady=!0;const I={originator:"local",type:y,sdp:L.localDescription.sdp};return p('emit "sdp"'),this.emit("sdp",I),Promise.resolve(I.sdp)}return new Promise(I=>{let k,P=!1;const F=()=>{L.removeEventListener("icecandidate",k),P=!0,this._rtcReady=!0;const H={originator:"local",type:y,sdp:L.localDescription.sdp};p('emit "sdp"'),this.emit("sdp",H),I(H.sdp)};L.addEventListener("icecandidate",k=H=>{const{candidate:D}=H;D?this.emit("icecandidate",{candidate:D,ready:F}):P||F()})})})}_createDialog(y,w,O){const L=w==="UAS"?y.to_tag:y.from_tag,I=w==="UAS"?y.from_tag:y.to_tag,k=y.call_id+L+I;let P=this._earlyDialogs[k];if(O)return!!P||((P=new n(this,y,w,n.C.STATUS_EARLY)).error?(p(P.error),this._failed("remote",y,_.causes.INTERNAL_ERROR),!1):(this._earlyDialogs[k]=P,!0));if(this._from_tag=y.from_tag,this._to_tag=y.to_tag,P)return P.update(y,w),this._dialog=P,delete this._earlyDialogs[k],!0;const F=new n(this,y,w);return F.error?(p(F.error),this._failed("remote",y,_.causes.INTERNAL_ERROR),!1):(this._dialog=F,!0)}_receiveReinvite(y){p("receiveReinvite()");const w=y.getHeader("Content-Type"),O={request:y,callback:void 0,reject:(function(k={}){L=!0;const P=k.status_code||403,F=k.reason_phrase||"",H=f.cloneArray(k.extraHeaders);if(this._status!==h.STATUS_CONFIRMED)return!1;if(P<300||P>=700)throw new TypeError(`Invalid status_code: ${P}`);y.reply(P,F,H)}).bind(this)};let L=!1;if(this.emit("reinvite",O),!L){if(this._late_sdp=!1,!y.body)return this._late_sdp=!0,void(this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._createLocalDescription("offer",this._rtcOfferConstraints)).then(k=>{I.call(this,k)}).catch(()=>{y.reply(500)}));if(w!=="application/sdp")return p("invalid Content-Type"),void y.reply(415);this._processInDialogSdpOffer(y).then(k=>{this._status!==h.STATUS_TERMINATED&&I.call(this,k)}).catch(k=>{b(k)})}function I(k){const P=[`Contact: ${this._contact}`];this._handleSessionTimersInIncomingRequest(y,P),this._late_sdp&&(k=this._mangleOffer(k)),y.reply(200,null,P,k,()=>{this._status=h.STATUS_WAITING_FOR_ACK,this._setInvite2xxTimer(y,k),this._setACKTimer()}),typeof O.callback=="function"&&O.callback()}}_receiveUpdate(y){p("receiveUpdate()");const w=y.getHeader("Content-Type"),O={request:y,callback:void 0,reject:(function(k={}){L=!0;const P=k.status_code||403,F=k.reason_phrase||"",H=f.cloneArray(k.extraHeaders);if(this._status!==h.STATUS_CONFIRMED)return!1;if(P<300||P>=700)throw new TypeError(`Invalid status_code: ${P}`);y.reply(P,F,H)}).bind(this)};let L=!1;if(this.emit("update",O),!L)if(y.body){if(w!=="application/sdp")return p("invalid Content-Type"),void y.reply(415);this._processInDialogSdpOffer(y).then(k=>{this._status!==h.STATUS_TERMINATED&&I.call(this,k)}).catch(k=>{b(k)})}else I.call(this,null);function I(k){const P=[`Contact: ${this._contact}`];this._handleSessionTimersInIncomingRequest(y,P),y.reply(200,null,P,k),typeof O.callback=="function"&&O.callback()}}_processInDialogSdpOffer(y){p("_processInDialogSdpOffer()");const w=y.parseSDP();let O=!1;for(const k of w.media){if(C.indexOf(k.type)===-1)continue;const P=k.direction||w.direction||"sendrecv";if(P!=="sendonly"&&P!=="inactive"){O=!1;break}O=!0}const L={originator:"remote",type:"offer",sdp:y.body};p('emit "sdp"'),this.emit("sdp",L);const I=new RTCSessionDescription({type:"offer",sdp:L.sdp});return this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>{if(this._status===h.STATUS_TERMINATED)throw new Error("terminated");return this._connection.setRemoteDescription(I).catch(k=>{throw y.reply(488),b('emit "peerconnection:setremotedescriptionfailed" [error:%o]',k),this.emit("peerconnection:setremotedescriptionfailed",k),new Error("peerconnection.setRemoteDescription() failed")})}).then(()=>{if(this._status===h.STATUS_TERMINATED)throw new Error("terminated");this._remoteHold===!0&&O===!1?(this._remoteHold=!1,this._onunhold("remote")):this._remoteHold===!1&&O===!0&&(this._remoteHold=!0,this._onhold("remote"))}).then(()=>{if(this._status===h.STATUS_TERMINATED)throw new Error("terminated");return this._createLocalDescription("answer",this._rtcAnswerConstraints).catch(()=>{throw y.reply(500),new Error("_createLocalDescription() failed")})}),this._connectionPromiseQueue}_receiveRefer(y){if(p("receiveRefer()"),typeof y.refer_to===void 0)return p("no Refer-To header field present in REFER"),void y.reply(400);if(y.refer_to.uri.scheme!==_.SIP)return p("Refer-To header field points to a non-SIP URI scheme"),void y.reply(416);y.reply(202);const w=new u(this,y.cseq);p('emit "refer"'),this.emit("refer",{request:y,accept:(O,L)=>{(function(I,k={}){if(I=typeof I=="function"?I:null,this._status!==h.STATUS_WAITING_FOR_ACK&&this._status!==h.STATUS_CONFIRMED)return!1;const P=new Vc(this._ua);if(P.on("progress",({response:F})=>{w.notify(F.status_code,F.reason_phrase)}),P.on("accepted",({response:F})=>{w.notify(F.status_code,F.reason_phrase)}),P.on("failed",({message:F,cause:H})=>{F?w.notify(F.status_code,F.reason_phrase):w.notify(487,H)}),y.refer_to.uri.hasHeader("replaces")){const F=decodeURIComponent(y.refer_to.uri.getHeader("replaces"));k.extraHeaders=f.cloneArray(k.extraHeaders),k.extraHeaders.push(`Replaces: ${F}`)}P.connect(y.refer_to.uri.toAor(),k,I)}).call(this,O,L)},reject:()=>{(function(){w.notify(603)}).call(this)}})}_receiveNotify(y){switch(p("receiveNotify()"),typeof y.event===void 0&&y.reply(400),y.event.event){case"refer":{let w,O;if(y.event.params&&y.event.params.id)w=y.event.params.id,O=this._referSubscribers[w];else{if(Object.keys(this._referSubscribers).length!==1)return void y.reply(400,"Missing event id parameter");O=this._referSubscribers[Object.keys(this._referSubscribers)[0]]}if(!O)return void y.reply(481,"Subscription does not exist");O.receiveNotify(y),y.reply(200);break}default:y.reply(489)}}_receiveReplaces(y){p("receiveReplaces()"),this.emit("replaces",{request:y,accept:w=>{(function(O){if(this._status!==h.STATUS_WAITING_FOR_ACK&&this._status!==h.STATUS_CONFIRMED)return!1;const L=new Vc(this._ua);L.on("confirmed",()=>{this.terminate()}),L.init_incoming(y,O)}).call(this,w)},reject:()=>{(function(){p("Replaced INVITE rejected by the user"),y.reply(486)}).call(this)}})}_sendInitialRequest(y,w,O){const L=new i(this._ua,this._request,{onRequestTimeout:()=>{this.onRequestTimeout()},onTransportError:()=>{this.onTransportError()},onAuthenticated:I=>{this._request=I},onReceiveResponse:I=>{this._receiveInviteResponse(I)}});Promise.resolve().then(()=>O||(y.audio||y.video?(this._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(y).catch(I=>{throw this._status===h.STATUS_TERMINATED?new Error("terminated"):(this._failed("local",null,_.causes.USER_DENIED_MEDIA_ACCESS),b('emit "getusermediafailed" [error:%o]',I),this.emit("getusermediafailed"),I)})):void 0)).then(I=>{if(this._status===h.STATUS_TERMINATED)throw new Error("terminated");return this._localMediaStream=I,I&&this._connection.addStream(I),this._connecting(this._request),this._createLocalDescription("offer",w).catch(k=>{throw this._failed("local",null,_.causes.WEBRTC_ERROR),k})}).then(I=>{if(this._is_canceled||this._status===h.STATUS_TERMINATED)throw new Error("terminated");this._request.body=I,this._status=h.STATUS_INVITE_SENT,p('emit "sending" [request:%o]',this._request),this.emit("sending",{request:this._request}),L.send()}).catch(I=>{this._status!==h.STATUS_TERMINATED&&b(I)})}_receiveInviteResponse(y){if(p("receiveInviteResponse()"),this._dialog&&y.status_code>=200&&y.status_code<=299){if(this._dialog.id.call_id===y.call_id&&this._dialog.id.local_tag===y.from_tag&&this._dialog.id.remote_tag===y.to_tag)return void this.sendRequest(_.ACK);const w=new n(this,y,"UAC");return w.error!==void 0?void p(w.error):(this.sendRequest(_.ACK),void this.sendRequest(_.BYE))}if(this._is_canceled)y.status_code>=100&&y.status_code<200?this._request.cancel(this._cancel_reason):y.status_code>=200&&y.status_code<299&&this._acceptAndTerminate(y);else if(this._status===h.STATUS_INVITE_SENT||this._status===h.STATUS_1XX_RECEIVED)switch(!0){case/^100$/.test(y.status_code):this._status=h.STATUS_1XX_RECEIVED;break;case/^1[0-9]{2}$/.test(y.status_code):{if(!y.to_tag){p("1xx response received without to tag");break}if(y.hasHeader("contact")&&!this._createDialog(y,"UAC",!0)||(this._status=h.STATUS_1XX_RECEIVED,this._progress("remote",y),!y.body))break;const w={originator:"remote",type:"answer",sdp:y.body};p('emit "sdp"'),this.emit("sdp",w);const O=new RTCSessionDescription({type:"answer",sdp:w.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._connection.setRemoteDescription(O)).catch(L=>{b('emit "peerconnection:setremotedescriptionfailed" [error:%o]',L),this.emit("peerconnection:setremotedescriptionfailed",L)});break}case/^2[0-9]{2}$/.test(y.status_code):{if(this._status=h.STATUS_CONFIRMED,!y.body){this._acceptAndTerminate(y,400,_.causes.MISSING_SDP),this._failed("remote",y,_.causes.BAD_MEDIA_DESCRIPTION);break}if(!this._createDialog(y,"UAC"))break;const w={originator:"remote",type:"answer",sdp:y.body};p('emit "sdp"'),this.emit("sdp",w);const O=new RTCSessionDescription({type:"answer",sdp:w.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>{if(this._connection.signalingState==="stable")return this._connection.createOffer().then(L=>this._connection.setLocalDescription(L)).catch(L=>{this._acceptAndTerminate(y,500,L.toString()),this._failed("local",y,_.causes.WEBRTC_ERROR)})}).then(()=>{this._connection.setRemoteDescription(O).then(()=>{this._handleSessionTimersInIncomingResponse(y),this._accepted("remote",y),this.sendRequest(_.ACK),this._confirmed("local",null)}).catch(L=>{this._acceptAndTerminate(y,488,"Not Acceptable Here"),this._failed("remote",y,_.causes.BAD_MEDIA_DESCRIPTION),b('emit "peerconnection:setremotedescriptionfailed" [error:%o]',L),this.emit("peerconnection:setremotedescriptionfailed",L)})});break}default:{const w=f.sipErrorCause(y.status_code);this._failed("remote",y,w)}}}_sendReinvite(y={}){p("sendReinvite()");const w=f.cloneArray(y.extraHeaders),O=y.eventHandlers||{},L=y.rtcOfferConstraints||this._rtcOfferConstraints||null;let I=!1;function k(F){O.failed&&O.failed(F)}function P(){clearInterval(this.inviteInterval),this.inviteInterval=null,this.reconnectTryCount=0}w.push(`Contact: ${this._contact}`),w.push("Content-Type: application/sdp"),this._sessionTimers.running&&w.push(`Session-Expires: ${this._sessionTimers.currentExpires};refresher=${this._sessionTimers.refresher?"uac":"uas"}`),this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._createLocalDescription("offer",L)).then(F=>{F=this._mangleOffer(F)}).catch(()=>{k()}),this.inviteInterval==null?(this.reconnectTryCount=0,this.inviteInterval=setInterval(()=>{this.reconnectTryCount+=1,this._transport.status===0&&(this._ua.isConnected()||this._ua.isRegistered())&&(this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._createLocalDescription("offer",L,!0)).then(F=>{(function(H){const D=H.split(`
`);let $=0;for(let j=0;j<D.length;j++)D[j].indexOf("a=candidate")!=-1&&$++;return $>0}).call(this,F)&&(F=this._mangleOffer(F),this.sendRequest(_.INVITE,{extraHeaders:w,body:F,eventHandlers:{onSuccessResponse:H=>{(function(D){if(this._status===h.STATUS_TERMINATED||(this.sendRequest(_.ACK),I))return;if(this._handleSessionTimersInIncomingResponse(D),!D.body)return void k.call(this);if(D.getHeader("Content-Type")!=="application/sdp")return void k.call(this);const $={originator:"remote",type:"answer",sdp:D.body};p('emit "sdp"'),this.emit("sdp",$);const j=new RTCSessionDescription({type:"answer",sdp:$.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._connection.setRemoteDescription(j)).then(()=>{O.succeeded&&O.succeeded(D)}).catch(V=>{k.call(this),b('emit "peerconnection:setremotedescriptionfailed" [error:%o]',V),this.emit("peerconnection:setremotedescriptionfailed",V)})}).call(this,H),I=!0},onErrorResponse:H=>{k.call(this,H)},onTransportError:()=>{},onRequestTimeout:()=>{},onDialogError:()=>{}}}),console.log("Re-Invite Sent"),P.call(this))}).catch(()=>{k(),P.call(this)})),this.reconnectTryCount>20&&P.call(this)},1e3)):this.reconnectTryCount=0}_sendUpdate(y={}){p("sendUpdate()");const w=f.cloneArray(y.extraHeaders),O=y.eventHandlers||{},L=y.rtcOfferConstraints||this._rtcOfferConstraints||null,I=y.sdpOffer||!1;let k=!1;function P(H){if(this._status!==h.STATUS_TERMINATED&&!k)if(this._handleSessionTimersInIncomingResponse(H),I){if(!H.body)return void F.call(this);if(H.getHeader("Content-Type")!=="application/sdp")return void F.call(this);const D={originator:"remote",type:"answer",sdp:H.body};p('emit "sdp"'),this.emit("sdp",D);const $=new RTCSessionDescription({type:"answer",sdp:D.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._connection.setRemoteDescription($)).then(()=>{O.succeeded&&O.succeeded(H)}).catch(j=>{F.call(this),b('emit "peerconnection:setremotedescriptionfailed" [error:%o]',j),this.emit("peerconnection:setremotedescriptionfailed",j)})}else O.succeeded&&O.succeeded(H)}function F(H){O.failed&&O.failed(H)}w.push(`Contact: ${this._contact}`),this._sessionTimers.running&&w.push(`Session-Expires: ${this._sessionTimers.currentExpires};refresher=${this._sessionTimers.refresher?"uac":"uas"}`),I?(w.push("Content-Type: application/sdp"),this._connectionPromiseQueue=this._connectionPromiseQueue.then(()=>this._createLocalDescription("offer",L)).then(H=>{H=this._mangleOffer(H),this.sendRequest(_.UPDATE,{extraHeaders:w,body:H,eventHandlers:{onSuccessResponse:D=>{P.call(this,D),k=!0},onErrorResponse:D=>{F.call(this,D)},onTransportError:()=>{this.onTransportError()},onRequestTimeout:()=>{this.onRequestTimeout()},onDialogError:()=>{this.onDialogError()}}})}).catch(()=>{F.call(this)})):this.sendRequest(_.UPDATE,{extraHeaders:w,eventHandlers:{onSuccessResponse:H=>{P.call(this,H)},onErrorResponse:H=>{F.call(this,H)},onTransportError:()=>{this.onTransportError()},onRequestTimeout:()=>{this.onRequestTimeout()},onDialogError:()=>{this.onDialogError()}}})}_acceptAndTerminate(y,w,O){p("acceptAndTerminate()");const L=[];w&&(O=O||_.REASON_PHRASE[w]||"",L.push(`Reason: SIP ;cause=${w}; text="${O}"`)),(this._dialog||this._createDialog(y,"UAC"))&&(this.sendRequest(_.ACK),this.sendRequest(_.BYE,{extraHeaders:L})),this._status=h.STATUS_TERMINATED}_mangleOffer(y){if(!this._localHold&&!this._remoteHold)return y;if(y=S.parse(y),this._localHold&&!this._remoteHold){p("mangleOffer() | me on hold, mangling offer");for(const w of y.media)C.indexOf(w.type)!==-1&&(w.direction?w.direction==="sendrecv"?w.direction="sendonly":w.direction==="recvonly"&&(w.direction="inactive"):w.direction="sendonly")}else if(this._localHold&&this._remoteHold){p("mangleOffer() | both on hold, mangling offer");for(const w of y.media)C.indexOf(w.type)!==-1&&(w.direction="inactive")}else if(this._remoteHold){p("mangleOffer() | remote on hold, mangling offer");for(const w of y.media)C.indexOf(w.type)!==-1&&(w.direction?w.direction==="sendrecv"?w.direction="recvonly":w.direction==="recvonly"&&(w.direction="inactive"):w.direction="recvonly")}return S.write(y)}_setLocalMediaStatus(){let y=!0,w=!0;(this._localHold||this._remoteHold)&&(y=!1,w=!1),this._audioMuted&&(y=!1),this._videoMuted&&(w=!1),this._toogleMuteAudio(!y),this._toogleMuteVideo(!w)}_handleSessionTimersInIncomingRequest(y,w){if(!this._sessionTimers.enabled)return;let O;y.session_expires&&y.session_expires>=_.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=y.session_expires,O=y.session_expires_refresher||"uas"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,O="uas"),w.push(`Session-Expires: ${this._sessionTimers.currentExpires};refresher=${O}`),this._sessionTimers.refresher=O==="uas",this._runSessionTimer()}_handleSessionTimersInIncomingResponse(y){if(!this._sessionTimers.enabled)return;let w;y.session_expires&&y.session_expires>=_.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=y.session_expires,w=y.session_expires_refresher||"uac"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,w="uac"),this._sessionTimers.refresher=w==="uac",this._runSessionTimer()}_runSessionTimer(){const y=this._sessionTimers.currentExpires;this._sessionTimers.running=!0,clearTimeout(this._sessionTimers.timer),this._sessionTimers.refresher?this._sessionTimers.timer=setTimeout(()=>{this._status!==h.STATUS_TERMINATED&&(p("runSessionTimer() | sending session refresh request"),this._sessionTimers.refreshMethod===_.UPDATE?this._sendUpdate():this._sendReinvite())},500*y):this._sessionTimers.timer=setTimeout(()=>{this._status!==h.STATUS_TERMINATED&&(b("runSessionTimer() | timer expired, terminating the session"),this.terminate({cause:_.causes.REQUEST_TIMEOUT,status_code:408,reason_phrase:"Session Timer Expired"}))},1100*y)}_toogleMuteAudio(y){const w=this._connection.getLocalStreams();for(const O of w){const L=O.getAudioTracks();for(const I of L)I.enabled=!y}}_toogleMuteVideo(y){const w=this._connection.getLocalStreams();for(const O of w){const L=O.getVideoTracks();for(const I of L)I.enabled=!y}}_newRTCSession(y,w){p("newRTCSession()"),this._ua.newRTCSession(this,{originator:y,session:this,request:w})}_connecting(y){p("session connecting"),p('emit "connecting"'),this.emit("connecting",{request:y})}_progress(y,w){p("session progress"),p('emit "progress"'),this.emit("progress",{originator:y,response:w||null})}_accepted(y,w){p("session accepted"),this._start_time=new Date,p('emit "accepted"'),this.emit("accepted",{originator:y,response:w||null})}_confirmed(y,w){p("session confirmed"),this._is_confirmed=!0,p('emit "confirmed"'),this.emit("confirmed",{originator:y,ack:w||null})}_ended(y,w,O){p("session ended"),this._end_time=new Date,this._close(),p('emit "ended"'),this.emit("ended",{originator:y,message:w||null,cause:O})}_failed(y,w,O){p("session failed"),this._close(),p('emit "failed"'),this.emit("failed",{originator:y,message:w||null,cause:O})}_onhold(y){p("session onhold"),this._setLocalMediaStatus(),p('emit "hold"'),this.emit("hold",{originator:y})}_onunhold(y){p("session onunhold"),this._setLocalMediaStatus(),p('emit "unhold"'),this.emit("unhold",{originator:y})}_onmute({audio:y,video:w}){p("session onmute"),this._setLocalMediaStatus(),p('emit "muted"'),this.emit("muted",{audio:y,video:w})}_onunmute({audio:y,video:w}){p("session onunmute"),this._setLocalMediaStatus(),p('emit "unmuted"'),this.emit("unmuted",{audio:y,video:w})}}},{"./Constants":2,"./Dialog":3,"./Exceptions":6,"./RTCSession/DTMF":13,"./RTCSession/Info":14,"./RTCSession/ReferNotifier":15,"./RTCSession/ReferSubscriber":16,"./RequestSender":18,"./SIPMessage":19,"./Timers":21,"./Transactions":22,"./Utils":26,debug:30,events:29,"sdp-transform":36}],13:[function(G,q,x){const N=G("events").EventEmitter,S=G("../Constants"),p=G("../Exceptions"),b=G("../Utils"),_=G("debug")("JsSIP:RTCSession:DTMF");G("debug")("JsSIP:ERROR:RTCSession:DTMF").log=console.warn.bind(console);const t={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};q.exports=class extends N{constructor(m){super(),this._session=m,this._direction=null,this._tone=null,this._duration=null,this._request=null}get tone(){return this._tone}get duration(){return this._duration}send(m,f={}){if(m===void 0)throw new TypeError("Not enough arguments");if(this._direction="outgoing",this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new p.InvalidStateError(this._session.status);const o=b.cloneArray(f.extraHeaders);if(this.eventHandlers=b.cloneObject(f.eventHandlers),typeof m=="string")m=m.toUpperCase();else{if(typeof m!="number")throw new TypeError(`Invalid tone: ${m}`);m=m.toString()}if(!m.match(/^[0-9A-DR#*]$/))throw new TypeError(`Invalid tone: ${m}`);this._tone=m,this._duration=f.duration,o.push("Content-Type: application/dtmf-relay");let s=`Signal=${this._tone}\r
`;s+=`Duration=${this._duration}`,this._session.newDTMF({originator:"local",dtmf:this,request:this._request}),this._session.sendRequest(S.INFO,{extraHeaders:o,eventHandlers:{onSuccessResponse:n=>{this.emit("succeeded",{originator:"remote",response:n})},onErrorResponse:n=>{this.eventHandlers.onFailed&&this.eventHandlers.onFailed(),this.emit("failed",{originator:"remote",response:n})},onRequestTimeout:()=>{this._session.onRequestTimeout()},onTransportError:()=>{this._session.onTransportError()},onDialogError:()=>{this._session.onDialogError()}},body:s})}init_incoming(m){const f=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,o=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;if(this._direction="incoming",this._request=m,m.reply(200),m.body){const s=m.body.split(`
`);s.length>=1&&f.test(s[0])&&(this._tone=s[0].replace(f,"$2")),s.length>=2&&o.test(s[1])&&(this._duration=parseInt(s[1].replace(o,"$2"),10))}this._duration||(this._duration=t.DEFAULT_DURATION),this._tone?this._session.newDTMF({originator:"remote",dtmf:this,request:m}):_("invalid INFO DTMF received, discarded")}},q.exports.C=t},{"../Constants":2,"../Exceptions":6,"../Utils":26,debug:30,events:29}],14:[function(G,q,x){const N=G("events").EventEmitter;G("debug")("JsSIP:ERROR:RTCSession:Info").log=console.warn.bind(console);const S=G("../Constants"),p=G("../Exceptions"),b=G("../Utils");q.exports=class extends N{constructor(_){super(),this._session=_,this._direction=null,this._contentType=null,this._body=null}get contentType(){return this._contentType}get body(){return this._body}send(_,t,m={}){if(this._direction="outgoing",_===void 0)throw new TypeError("Not enough arguments");if(this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new p.InvalidStateError(this._session.status);this._contentType=_,this._body=t;const f=b.cloneArray(m.extraHeaders);f.push(`Content-Type: ${_}`),this._session.newInfo({originator:"local",info:this,request:this.request}),this._session.sendRequest(S.INFO,{extraHeaders:f,eventHandlers:{onSuccessResponse:o=>{this.emit("succeeded",{originator:"remote",response:o})},onErrorResponse:o=>{this.emit("failed",{originator:"remote",response:o})},onTransportError:()=>{this._session.onTransportError()},onRequestTimeout:()=>{this._session.onRequestTimeout()},onDialogError:()=>{this._session.onDialogError()}},body:t})}init_incoming(_){this._direction="incoming",this.request=_,_.reply(200),this._contentType=_.hasHeader("Content-Type")?_.getHeader("Content-Type").toLowerCase():void 0,this._body=_.body,this._session.newInfo({originator:"remote",info:this,request:_})}}},{"../Constants":2,"../Exceptions":6,"../Utils":26,debug:30,events:29}],15:[function(G,q,x){const N=G("../Constants"),S=G("debug")("JsSIP:RTCSession:ReferNotifier"),p="refer",b="message/sipfrag;version=2.0",_=300;q.exports=class{constructor(t,m,f){this._session=t,this._id=m,this._expires=f||_,this._active=!0,this.notify(100)}notify(t,m){if(S("notify()"),this._active===!1)return;let f;m=m||N.REASON_PHRASE[t]||"",f=t>=200?"terminated;reason=noresource":`active;expires=${this._expires}`,this._session.sendRequest(N.NOTIFY,{extraHeaders:[`Event: ${p};id=${this._id}`,`Subscription-State: ${f}`,`Content-Type: ${b}`],body:`SIP/2.0 ${t} ${m}`,eventHandlers:{onErrorResponse(){this._active=!1}}})}}},{"../Constants":2,debug:30}],16:[function(G,q,x){const N=G("events").EventEmitter,S=G("../Constants"),p=G("../Grammar"),b=G("../Utils"),_=G("debug")("JsSIP:RTCSession:ReferSubscriber");q.exports=class extends N{constructor(t){super(),this._id=null,this._session=t}get id(){return this._id}sendRefer(t,m={}){_("sendRefer()");const f=b.cloneArray(m.extraHeaders),o=b.cloneObject(m.eventHandlers);for(const c in o)Object.prototype.hasOwnProperty.call(o,c)&&this.on(c,o[c]);let s=null;m.replaces&&(s=m.replaces._request.call_id,s+=`;to-tag=${m.replaces._to_tag}`,s+=`;from-tag=${m.replaces._from_tag}`,s=encodeURIComponent(s));const n=`Refer-To: <${t}${s?`?Replaces=${s}`:""}>`;f.push(n);const i=`Referred-By: <${this._session._ua._configuration.uri._scheme}:${this._session._ua._configuration.uri._user}@${this._session._ua._configuration.uri._host}>`;if(f.push(i),f.push(`Contact: ${this._session.contact}`),!this._session._dialog)return _("redirecting the call"),this._session._request.reply("302","redirecting",m.extraHeaders,m.body),void(this._id=this._session._request.cseq);const a=this._session.sendRequest(S.REFER,{extraHeaders:f,eventHandlers:{onSuccessResponse:c=>{this._requestSucceeded(c)},onErrorResponse:c=>{this._requestFailed(c,S.causes.REJECTED)},onTransportError:()=>{this._requestFailed(null,S.causes.CONNECTION_ERROR)},onRequestTimeout:()=>{this._requestFailed(null,S.causes.REQUEST_TIMEOUT)},onDialogError:()=>{this._requestFailed(null,S.causes.DIALOG_ERROR)}}});this._id=a.cseq}receiveNotify(t){if(_("receiveNotify()"),!t.body)return;const m=p.parse(t.body.trim(),"Status_Line");if(m!==-1)switch(!0){case/^100$/.test(m.status_code):this.emit("trying",{request:t,status_line:m});break;case/^1[0-9]{2}$/.test(m.status_code):this.emit("progress",{request:t,status_line:m});break;case/^2[0-9]{2}$/.test(m.status_code):this.emit("accepted",{request:t,status_line:m});break;default:this.emit("failed",{request:t,status_line:m})}else _(`receiveNotify() | error parsing NOTIFY body: "${t.body}"`)}_requestSucceeded(t){_("REFER succeeded"),_('emit "requestSucceeded"'),this.emit("requestSucceeded",{response:t})}_requestFailed(t,m){_("REFER failed"),_('emit "requestFailed"'),this.emit("requestFailed",{response:t||null,cause:m})}}},{"../Constants":2,"../Grammar":7,"../Utils":26,debug:30,events:29}],17:[function(G,q,x){const N=G("./Utils"),S=G("./Constants"),p=G("./SIPMessage"),b=G("./RequestSender"),_=G("debug")("JsSIP:Registrator");q.exports=class{constructor(t,m){this._ua=t,this._transport=m,this._registrar=t.configuration.registrar_server,this._expires=t.configuration.register_expires,this._call_id=N.createRandomToken(22),this._cseq=0,this._to_uri=t.configuration.uri,this._registrationTimer=null,this._registering=!1,this._registered=!1,this._contact=this._ua.contact.toString(),this._contact+=";+sip.ice",this._extraHeaders=[],this._extraContactParams="",this._contact+=";reg-id=1",this._contact+=`;+sip.instance="<urn:uuid:${this._ua.configuration.instance_id}>"`}get registered(){return this._registered}get registering(){return this._registering}setExtraHeaders(t){Array.isArray(t)||(t=[]),this._extraHeaders=t.slice()}setExtraContactParams(t){t instanceof Object||(t={}),this._extraContactParams="";for(const m in t)if(Object.prototype.hasOwnProperty.call(t,m)){const f=t[m];this._extraContactParams+=`;${m}`,f&&(this._extraContactParams+=`=${f}`)}}register(){if(this._registering)return void _("Register request in progress...");const t=this._extraHeaders.slice();t.push(`Contact: ${this._contact};expires=${this._expires}${this._extraContactParams}`),t.push(`Expires: ${this._expires}`);const m=new p.OutgoingRequest(S.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},t),f=new b(this._ua,m,{onRequestTimeout:()=>{this._registrationFailure(null,S.causes.REQUEST_TIMEOUT)},onTransportError:()=>{this._registrationFailure(null,S.causes.CONNECTION_ERROR)},onAuthenticated:()=>{this._cseq+=1},onReceiveResponse:o=>{let s,n,i=o.getHeaders("contact").length;if(o.cseq===this._cseq)switch(this._registrationTimer!==null&&(clearTimeout(this._registrationTimer),this._registrationTimer=null),!0){case/^1[0-9]{2}$/.test(o.status_code):break;case/^2[0-9]{2}$/.test(o.status_code):if(this._registering=!1,!i){_("no Contact header in response to REGISTER, response ignored");break}for(;i--;){if((s=o.parseHeader("contact",i)).uri.user===this._ua.contact.uri.user){n=s.getParam("expires");break}s=null}if(!s){_("no Contact header pointing to us, response ignored");break}!n&&o.hasHeader("expires")&&(n=o.getHeader("expires")),n||(n=this._expires),(n=Number(n))<10&&(n=10),this._registrationTimer=setTimeout(()=>{this._registrationTimer=null,this._ua.listeners("registrationExpiring").length===0?this.register():this._ua.emit("registrationExpiring")},1e3*n-5e3),s.hasParam("temp-gruu")&&(this._ua.contact.temp_gruu=s.getParam("temp-gruu").replace(/"/g,"")),s.hasParam("pub-gruu")&&(this._ua.contact.pub_gruu=s.getParam("pub-gruu").replace(/"/g,"")),this._registered||(this._registered=!0,this._ua.registered({response:o}));break;case/^423$/.test(o.status_code):o.hasHeader("min-expires")?(this._expires=Number(o.getHeader("min-expires")),this._expires<10&&(this._expires=10),this.register()):(_("423 response received for REGISTER without Min-Expires"),this._registrationFailure(o,S.causes.SIP_FAILURE_CODE));break;default:{const a=N.sipErrorCause(o.status_code);this._registrationFailure(o,a)}}}});this._registering=!0,f.send()}unregister(t={}){if(!this._registered)return void _("already unregistered");this._registered=!1,this._registrationTimer!==null&&(clearTimeout(this._registrationTimer),this._registrationTimer=null);const m=this._extraHeaders.slice();t.all?m.push(`Contact: *${this._extraContactParams}`):m.push(`Contact: ${this._contact};expires=0${this._extraContactParams}`),m.push("Expires: 0");const f=new p.OutgoingRequest(S.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},m);new b(this._ua,f,{onRequestTimeout:()=>{this._unregistered(null,S.causes.REQUEST_TIMEOUT)},onTransportError:()=>{this._unregistered(null,S.causes.CONNECTION_ERROR)},onAuthenticated:()=>{this._cseq+=1},onReceiveResponse:o=>{switch(!0){case/^1[0-9]{2}$/.test(o.status_code):break;case/^2[0-9]{2}$/.test(o.status_code):this._unregistered(o);break;default:{const s=N.sipErrorCause(o.status_code);this._unregistered(o,s)}}}}).send()}close(){this._registered&&this.unregister()}onTransportClosed(){this._registering=!1,this._registrationTimer!==null&&(clearTimeout(this._registrationTimer),this._registrationTimer=null),this._registered&&(this._registered=!1,this._ua.unregistered({}))}_registrationFailure(t,m){this._registering=!1,this._ua.registrationFailed({response:t||null,cause:m}),this._registered&&(this._registered=!1,this._ua.unregistered({response:t||null,cause:m}))}_unregistered(t,m){this._registering=!1,this._registered=!1,this._ua.unregistered({response:t||null,cause:m||null})}}},{"./Constants":2,"./RequestSender":18,"./SIPMessage":19,"./Utils":26,debug:30}],18:[function(G,q,x){const N=G("./Constants"),S=G("./DigestAuthentication"),p=G("./Transactions"),b=G("debug")("JsSIP:RequestSender"),_={onRequestTimeout:()=>{},onTransportError:()=>{},onReceiveResponse:()=>{},onAuthenticated:()=>{}};q.exports=class{constructor(t,m,f){this._ua=t,this._eventHandlers=f,this._method=m.method,this._request=m,this._auth=null,this._challenged=!1,this._staled=!1;for(const o in _)Object.prototype.hasOwnProperty.call(_,o)&&(this._eventHandlers[o]||(this._eventHandlers[o]=_[o]));t.status!==t.C.STATUS_USER_CLOSED||this._method===N.BYE&&this._method===N.ACK||this._eventHandlers.onTransportError()}send(){const t={onRequestTimeout:()=>{this._eventHandlers.onRequestTimeout()},onTransportError:()=>{this._eventHandlers.onTransportError()},onReceiveResponse:m=>{this._receiveResponse(m)}};switch(this._method){case"INVITE":this.clientTransaction=new p.InviteClientTransaction(this._ua,this._ua.transport,this._request,t);break;case"ACK":this.clientTransaction=new p.AckClientTransaction(this._ua,this._ua.transport,this._request,t);break;default:this.clientTransaction=new p.NonInviteClientTransaction(this._ua,this._ua.transport,this._request,t)}this._ua._configuration.authorization_jwt&&this._request.setHeader("Authorization",this._ua._configuration.authorization_jwt),this.clientTransaction.send()}_receiveResponse(t){let m,f;const o=t.status_code;if(o!==401&&o!==407||this._ua.configuration.password===null&&this._ua.configuration.ha1===null)this._eventHandlers.onReceiveResponse(t);else{if(t.status_code===401?(m=t.parseHeader("www-authenticate"),f="authorization"):(m=t.parseHeader("proxy-authenticate"),f="proxy-authorization"),!m)return b(`${t.status_code} with wrong or missing challenge, cannot authenticate`),void this._eventHandlers.onReceiveResponse(t);if(!this._challenged||!this._staled&&m.stale===!0){if(this._auth||(this._auth=new S({username:this._ua.configuration.authorization_user,password:this._ua.configuration.password,realm:this._ua.configuration.realm,ha1:this._ua.configuration.ha1})),!this._auth.authenticate(this._request,m))return void this._eventHandlers.onReceiveResponse(t);this._challenged=!0,this._ua.set("realm",this._auth.get("realm")),this._ua.set("ha1",this._auth.get("ha1")),m.stale&&(this._staled=!0),this._request=this._request.clone(),this._request.cseq+=1,this._request.setHeader("cseq",`${this._request.cseq} ${this._method}`),this._request.setHeader(f,this._auth.toString()),this._eventHandlers.onAuthenticated(this._request),this.send()}else this._eventHandlers.onReceiveResponse(t)}}}},{"./Constants":2,"./DigestAuthentication":5,"./Transactions":22,debug:30}],19:[function(G,q,x){const N=G("sdp-transform"),S=G("./Constants"),p=G("./Utils"),b=G("./NameAddrHeader"),_=G("./Grammar"),t=G("debug")("JsSIP:SIPMessage");class m{constructor(n,i,a,c,u,g){if(!n||!i||!a)return null;c=c||{},this.ua=a,this.headers={},this.method=n,this.ruri=i,this.body=g,this.extraHeaders=p.cloneArray(u),c.route_set?this.setHeader("route",c.route_set):a.configuration.use_preloaded_route&&this.setHeader("route",`<${a.transport.sip_uri};lr>`),this.setHeader("via",""),this.setHeader("max-forwards",S.MAX_FORWARDS);const h=c.to_uri||i,C=c.to_tag?{tag:c.to_tag}:null,E=c.to_display_name!==void 0?c.to_display_name:null;this.to=new b(h,E,C),this.setHeader("to",this.to.toString());const y=c.from_uri||a.configuration.uri,w={tag:c.from_tag||p.newTag()};let O;O=c.from_display_name!==void 0?c.from_display_name:a.configuration.display_name?a.configuration.display_name:null,this.from=new b(y,O,w),this.setHeader("from",this.from.toString());const L=c.call_id||a.configuration.jssip_id+p.createRandomToken(15);this.call_id=L,this.setHeader("call-id",L);const I=c.cseq||Math.floor(1e4*Math.random());this.cseq=I,this.setHeader("cseq",`${I} ${n}`)}setHeader(n,i){const a=new RegExp(`^\\s*${n}\\s*:`,"i");for(let c=0;c<this.extraHeaders.length;c++)a.test(this.extraHeaders[c])&&this.extraHeaders.splice(c,1);this.headers[p.headerize(n)]=Array.isArray(i)?i:[i]}getHeader(n){const i=this.headers[p.headerize(n)];if(i){if(i[0])return i[0]}else{const a=new RegExp(`^\\s*${n}\\s*:`,"i");for(const c of this.extraHeaders)if(a.test(c))return c.substring(c.indexOf(":")+1).trim()}}getHeaders(n){const i=this.headers[p.headerize(n)],a=[];if(i){for(const c of i)a.push(c);return a}{const c=new RegExp(`^\\s*${n}\\s*:`,"i");for(const u of this.extraHeaders)c.test(u)&&a.push(u.substring(u.indexOf(":")+1).trim());return a}}hasHeader(n){if(this.headers[p.headerize(n)])return!0;{const i=new RegExp(`^\\s*${n}\\s*:`,"i");for(const a of this.extraHeaders)if(i.test(a))return!0}return!1}parseSDP(n){return!n&&this.sdp||(this.sdp=N.parse(this.body||"")),this.sdp}toString(){let n=`${this.method} ${this.ruri} SIP/2.0\r
`;for(const c in this.headers)if(Object.prototype.hasOwnProperty.call(this.headers,c))for(const u of this.headers[c])n+=`${c}: ${u}\r
`;for(const c of this.extraHeaders)n+=`${c.trim()}\r
`;const i=[];switch(this.method){case S.REGISTER:i.push("path","gruu");break;case S.INVITE:this.ua.configuration.session_timers&&i.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&i.push("gruu"),i.push("ice","replaces");break;case S.UPDATE:this.ua.configuration.session_timers&&i.push("timer"),i.push("ice")}i.push("outbound");const a=this.ua.configuration.user_agent||S.USER_AGENT;return n+=`Allow: ${S.ALLOWED_METHODS}\r
`,n+=`Supported: ${i}\r
`,n+=`User-Agent: ${a}\r
`,this.body?(n+=`Content-Length: ${p.str_utf8_length(this.body)}\r
\r
`,n+=this.body):n+=`Content-Length: 0\r
\r
`,n}clone(){const n=new m(this.method,this.ruri,this.ua);return Object.keys(this.headers).forEach(function(i){n.headers[i]=this.headers[i].slice()},this),n.body=this.body,n.extraHeaders=p.cloneArray(this.extraHeaders),n.to=this.to,n.from=this.from,n.call_id=this.call_id,n.cseq=this.cseq,n}}class f extends m{constructor(n,i,a,c,u){super(S.INVITE,n,i,a,c,u),this.transaction=null}cancel(n){this.transaction.cancel(n)}clone(){const n=new f(this.ruri,this.ua);return Object.keys(this.headers).forEach(function(i){n.headers[i]=this.headers[i].slice()},this),n.body=this.body,n.extraHeaders=p.cloneArray(this.extraHeaders),n.to=this.to,n.from=this.from,n.call_id=this.call_id,n.cseq=this.cseq,n.transaction=this.transaction,n}}class o{constructor(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null,this.sdp=null}addHeader(n,i){const a={raw:i};n=p.headerize(n),this.headers[n]?this.headers[n].push(a):this.headers[n]=[a]}getHeader(n){const i=this.headers[p.headerize(n)];if(i)return i[0]?i[0].raw:void 0}getHeaders(n){const i=this.headers[p.headerize(n)],a=[];if(!i)return[];for(const c of i)a.push(c.raw);return a}hasHeader(n){return!!this.headers[p.headerize(n)]}parseHeader(n,i=0){if(n=p.headerize(n),!this.headers[n])return void t(`header "${n}" not present`);if(i>=this.headers[n].length)return void t(`not so many "${n}" headers present`);const a=this.headers[n][i],c=a.raw;if(a.parsed)return a.parsed;const u=_.parse(c,n.replace(/-/g,"_"));return u===-1?(this.headers[n].splice(i,1),void t(`error parsing "${n}" header field with value "${c}"`)):(a.parsed=u,u)}s(n,i){return this.parseHeader(n,i)}setHeader(n,i){const a={raw:i};this.headers[p.headerize(n)]=[a]}parseSDP(n){return!n&&this.sdp||(this.sdp=N.parse(this.body||"")),this.sdp}toString(){return this.data}}q.exports={OutgoingRequest:m,InitialOutgoingInviteRequest:f,IncomingRequest:class extends o{constructor(s){super(),this.ua=s,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null}reply(s,n,i,a,c,u){const g=[];let h=this.getHeader("To");if(n=n||null,!(s=s||null)||s<100||s>699)throw new TypeError(`Invalid status_code: ${s}`);if(n&&typeof n!="string"&&!(n instanceof String))throw new TypeError(`Invalid reason_phrase: ${n}`);n=n||S.REASON_PHRASE[s]||"",i=p.cloneArray(i);let C=`SIP/2.0 ${s} ${n}\r
`;if(this.method===S.INVITE&&s>100&&s<=200){const y=this.getHeaders("record-route");for(const w of y)C+=`Record-Route: ${w}\r
`}const E=this.getHeaders("via");for(const y of E)C+=`Via: ${y}\r
`;!this.to_tag&&s>100?h+=`;tag=${p.newTag()}`:this.to_tag&&!this.s("to").hasParam("tag")&&(h+=`;tag=${this.to_tag}`),C+=`To: ${h}\r
`,C+=`From: ${this.getHeader("From")}\r
`,C+=`Call-ID: ${this.call_id}\r
`,C+=`CSeq: ${this.cseq} ${this.method}\r
`;for(const y of i)C+=`${y.trim()}\r
`;switch(this.method){case S.INVITE:this.ua.configuration.session_timers&&g.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&g.push("gruu"),g.push("ice","replaces");break;case S.UPDATE:this.ua.configuration.session_timers&&g.push("timer"),a&&g.push("ice"),g.push("replaces")}g.push("outbound"),this.method===S.OPTIONS?(C+=`Allow: ${S.ALLOWED_METHODS}\r
`,C+=`Accept: ${S.ACCEPTED_BODY_TYPES}\r
`):s===405?C+=`Allow: ${S.ALLOWED_METHODS}\r
`:s===415&&(C+=`Accept: ${S.ACCEPTED_BODY_TYPES}\r
`),C+=`Supported: ${g}\r
`,a?(C+=`Content-Type: application/sdp\r
`,C+=`Content-Length: ${p.str_utf8_length(a)}\r
\r
`,C+=a):C+=`Content-Length: 0\r
\r
`,this.server_transaction.receiveResponse(s,C,c,u)}reply_sl(s=null,n=null){const i=this.getHeaders("via");if(!s||s<100||s>699)throw new TypeError(`Invalid status_code: ${s}`);if(n&&typeof n!="string"&&!(n instanceof String))throw new TypeError(`Invalid reason_phrase: ${n}`);let a=`SIP/2.0 ${s} ${n=n||S.REASON_PHRASE[s]||""}\r
`;for(const u of i)a+=`Via: ${u}\r
`;let c=this.getHeader("To");!this.to_tag&&s>100?c+=`;tag=${p.newTag()}`:this.to_tag&&!this.s("to").hasParam("tag")&&(c+=`;tag=${this.to_tag}`),a+=`To: ${c}\r
`,a+=`From: ${this.getHeader("From")}\r
`,a+=`Call-ID: ${this.call_id}\r
`,a+=`CSeq: ${this.cseq} ${this.method}\r
`,a+=`Content-Length: 0\r
\r
`,this.transport.send(a)}},IncomingResponse:class extends o{constructor(){super(),this.headers={},this.status_code=null,this.reason_phrase=null}}}},{"./Constants":2,"./Grammar":7,"./NameAddrHeader":10,"./Utils":26,debug:30,"sdp-transform":36}],20:[function(G,q,x){const N=G("./Utils"),S=G("./Grammar"),p=G("debug")("JsSIP:ERROR:Socket");p.log=console.warn.bind(console),x.isSocket=b=>{if(Array.isArray(b))return!1;if(b===void 0)return p("undefined JsSIP.Socket instance"),!1;try{if(!N.isString(b.url))throw p("missing or invalid JsSIP.Socket url property"),new Error;if(!N.isString(b.via_transport))throw p("missing or invalid JsSIP.Socket via_transport property"),new Error;if(S.parse(b.sip_uri,"SIP_URI")===-1)throw p("missing or invalid JsSIP.Socket sip_uri property"),new Error}catch{return!1}try{["connect","disconnect","send"].forEach(_=>{if(!N.isFunction(b[_]))throw p(`missing or invalid JsSIP.Socket method: ${_}`),new Error})}catch{return!1}return!0}},{"./Grammar":7,"./Utils":26,debug:30}],21:[function(G,q,x){q.exports={T1:500,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4}},{}],22:[function(G,q,x){const N=G("events").EventEmitter,S=G("./Constants"),p=G("./SIPMessage"),b=G("./Timers"),_=G("debug")("JsSIP:NonInviteClientTransaction"),t=G("debug")("JsSIP:InviteClientTransaction"),m=G("debug")("JsSIP:AckClientTransaction"),f=G("debug")("JsSIP:NonInviteServerTransaction"),o=G("debug")("JsSIP:InviteServerTransaction"),s={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"};q.exports={C:s,NonInviteClientTransaction:class extends N{constructor(n,i,a,c){super(),this.type=s.NON_INVITE_CLIENT,this.id=`z9hG4bK${Math.floor(1e7*Math.random())}`,this.ua=n,this.transport=i,this.request=a,this.eventHandlers=c;let u=`SIP/2.0/${i.via_transport}`;u+=` ${n.configuration.via_host};branch=${this.id}`,this.request.setHeader("via",u),this.ua.newTransaction(this)}get C(){return s}stateChanged(n){this.state=n,this.emit("stateChanged")}send(){this.stateChanged(s.STATUS_TRYING),this.F=setTimeout(()=>{this.timer_F()},b.TIMER_F),this.transport.send(this.request)||this.onTransportError()}onTransportError(){_(`transport error occurred, deleting transaction ${this.id}`),clearTimeout(this.F),clearTimeout(this.K),this.stateChanged(s.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onTransportError()}timer_F(){_(`Timer F expired for transaction ${this.id}`),this.stateChanged(s.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout()}timer_K(){this.stateChanged(s.STATUS_TERMINATED),this.ua.destroyTransaction(this)}receiveResponse(n){const i=n.status_code;if(i<200)switch(this.state){case s.STATUS_TRYING:case s.STATUS_PROCEEDING:this.stateChanged(s.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(n)}else switch(this.state){case s.STATUS_TRYING:case s.STATUS_PROCEEDING:this.stateChanged(s.STATUS_COMPLETED),clearTimeout(this.F),i===408?this.eventHandlers.onRequestTimeout():this.eventHandlers.onReceiveResponse(n),this.K=setTimeout(()=>{this.timer_K()},b.TIMER_K);break;case s.STATUS_COMPLETED:}}},InviteClientTransaction:class extends N{constructor(n,i,a,c){super(),this.type=s.INVITE_CLIENT,this.id=`z9hG4bK${Math.floor(1e7*Math.random())}`,this.ua=n,this.transport=i,this.request=a,this.eventHandlers=c,a.transaction=this;let u=`SIP/2.0/${i.via_transport}`;u+=` ${n.configuration.via_host};branch=${this.id}`,this.request.setHeader("via",u),this.ua.newTransaction(this)}get C(){return s}stateChanged(n){this.state=n,this.emit("stateChanged")}send(){this.stateChanged(s.STATUS_CALLING),this.B=setTimeout(()=>{this.timer_B()},b.TIMER_B),this.transport.send(this.request)||this.onTransportError()}onTransportError(){clearTimeout(this.B),clearTimeout(this.D),clearTimeout(this.M),this.state!==s.STATUS_ACCEPTED&&(t(`transport error occurred, deleting transaction ${this.id}`),this.eventHandlers.onTransportError()),this.stateChanged(s.STATUS_TERMINATED),this.ua.destroyTransaction(this)}timer_M(){t(`Timer M expired for transaction ${this.id}`),this.state===s.STATUS_ACCEPTED&&(clearTimeout(this.B),this.stateChanged(s.STATUS_TERMINATED),this.ua.destroyTransaction(this))}timer_B(){t(`Timer B expired for transaction ${this.id}`),this.state===s.STATUS_CALLING&&(this.stateChanged(s.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout())}timer_D(){t(`Timer D expired for transaction ${this.id}`),clearTimeout(this.B),this.stateChanged(s.STATUS_TERMINATED),this.ua.destroyTransaction(this)}sendACK(n){const i=new p.OutgoingRequest(S.ACK,this.request.ruri,this.ua,{route_set:this.request.getHeaders("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq});i.setHeader("from",this.request.getHeader("from")),i.setHeader("via",this.request.getHeader("via")),i.setHeader("to",n.getHeader("to")),this.D=setTimeout(()=>{this.timer_D()},b.TIMER_D),this.transport.send(i)}cancel(n){if(this.state!==s.STATUS_PROCEEDING)return;const i=new p.OutgoingRequest(S.CANCEL,this.request.ruri,this.ua,{route_set:this.request.getHeaders("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq});i.setHeader("from",this.request.getHeader("from")),i.setHeader("via",this.request.getHeader("via")),i.setHeader("to",this.request.getHeader("to")),n&&i.setHeader("reason",n),this.transport.send(i)}receiveResponse(n){const i=n.status_code;if(i>=100&&i<=199)switch(this.state){case s.STATUS_CALLING:this.stateChanged(s.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(n);break;case s.STATUS_PROCEEDING:this.eventHandlers.onReceiveResponse(n)}else if(i>=200&&i<=299)switch(this.state){case s.STATUS_CALLING:case s.STATUS_PROCEEDING:this.stateChanged(s.STATUS_ACCEPTED),this.M=setTimeout(()=>{this.timer_M()},b.TIMER_M),this.eventHandlers.onReceiveResponse(n);break;case s.STATUS_ACCEPTED:this.eventHandlers.onReceiveResponse(n)}else if(i>=300&&i<=699)switch(this.state){case s.STATUS_CALLING:case s.STATUS_PROCEEDING:this.stateChanged(s.STATUS_COMPLETED),this.sendACK(n),this.eventHandlers.onReceiveResponse(n);break;case s.STATUS_COMPLETED:this.sendACK(n)}}},AckClientTransaction:class extends N{constructor(n,i,a,c){super(),this.id=`z9hG4bK${Math.floor(1e7*Math.random())}`,this.transport=i,this.request=a,this.eventHandlers=c;let u=`SIP/2.0/${i.via_transport}`;u+=` ${n.configuration.via_host};branch=${this.id}`,this.request.setHeader("via",u)}get C(){return s}send(){this.transport.send(this.request)||this.onTransportError()}onTransportError(){m(`transport error occurred for transaction ${this.id}`),this.eventHandlers.onTransportError()}},NonInviteServerTransaction:class extends N{constructor(n,i,a){super(),this.type=s.NON_INVITE_SERVER,this.id=a.via_branch,this.ua=n,this.transport=i,this.request=a,this.last_response="",a.server_transaction=this,this.state=s.STATUS_TRYING,n.newTransaction(this)}get C(){return s}stateChanged(n){this.state=n,this.emit("stateChanged")}timer_J(){f(`Timer J expired for transaction ${this.id}`),this.stateChanged(s.STATUS_TERMINATED),this.ua.destroyTransaction(this)}onTransportError(){this.transportError||(this.transportError=!0,f(`transport error occurred, deleting transaction ${this.id}`),clearTimeout(this.J),this.stateChanged(s.STATUS_TERMINATED),this.ua.destroyTransaction(this))}receiveResponse(n,i,a,c){if(n===100)switch(this.state){case s.STATUS_TRYING:this.stateChanged(s.STATUS_PROCEEDING),this.transport.send(i)||this.onTransportError();break;case s.STATUS_PROCEEDING:this.last_response=i,this.transport.send(i)?a&&a():(this.onTransportError(),c&&c())}else if(n>=200&&n<=699)switch(this.state){case s.STATUS_TRYING:case s.STATUS_PROCEEDING:this.stateChanged(s.STATUS_COMPLETED),this.last_response=i,this.J=setTimeout(()=>{this.timer_J()},b.TIMER_J),this.transport.send(i)?a&&a():(this.onTransportError(),c&&c());break;case s.STATUS_COMPLETED:}}},InviteServerTransaction:class extends N{constructor(n,i,a){super(),this.type=s.INVITE_SERVER,this.id=a.via_branch,this.ua=n,this.transport=i,this.request=a,this.last_response="",a.server_transaction=this,this.state=s.STATUS_PROCEEDING,n.newTransaction(this),this.resendProvisionalTimer=null,a.reply(100)}get C(){return s}stateChanged(n){this.state=n,this.emit("stateChanged")}timer_H(){o(`Timer H expired for transaction ${this.id}`),this.state===s.STATUS_COMPLETED&&o("ACK not received, dialog will be terminated"),this.stateChanged(s.STATUS_TERMINATED),this.ua.destroyTransaction(this)}timer_I(){this.stateChanged(s.STATUS_TERMINATED),this.ua.destroyTransaction(this)}timer_L(){o(`Timer L expired for transaction ${this.id}`),this.state===s.STATUS_ACCEPTED&&(this.stateChanged(s.STATUS_TERMINATED),this.ua.destroyTransaction(this))}onTransportError(){this.transportError||(this.transportError=!0,o(`transport error occurred, deleting transaction ${this.id}`),this.resendProvisionalTimer!==null&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),clearTimeout(this.L),clearTimeout(this.H),clearTimeout(this.I),this.stateChanged(s.STATUS_TERMINATED),this.ua.destroyTransaction(this))}resend_provisional(){this.transport.send(this.last_response)||this.onTransportError()}receiveResponse(n,i,a,c){if(n>=100&&n<=199)switch(this.state){case s.STATUS_PROCEEDING:this.transport.send(i)||this.onTransportError(),this.last_response=i}if(n>100&&n<=199&&this.state===s.STATUS_PROCEEDING)this.resendProvisionalTimer===null&&(this.resendProvisionalTimer=setInterval(()=>{this.resend_provisional()},b.PROVISIONAL_RESPONSE_INTERVAL));else if(n>=200&&n<=299)switch(this.state){case s.STATUS_PROCEEDING:this.stateChanged(s.STATUS_ACCEPTED),this.last_response=i,this.L=setTimeout(()=>{this.timer_L()},b.TIMER_L),this.resendProvisionalTimer!==null&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case s.STATUS_ACCEPTED:this.transport.send(i)?a&&a():(this.onTransportError(),c&&c())}else if(n>=300&&n<=699)switch(this.state){case s.STATUS_PROCEEDING:this.resendProvisionalTimer!==null&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(i)?(this.stateChanged(s.STATUS_COMPLETED),this.H=setTimeout(()=>{this.timer_H()},b.TIMER_H),a&&a()):(this.onTransportError(),c&&c())}}},checkTransaction:function({_transactions:n},i){let a;switch(i.method){case S.INVITE:if(a=n.ist[i.via_branch]){switch(a.state){case s.STATUS_PROCEEDING:a.transport.send(a.last_response);break;case s.STATUS_ACCEPTED:}return!0}break;case S.ACK:if(!(a=n.ist[i.via_branch])||a.state===s.STATUS_ACCEPTED)return!1;if(a.state===s.STATUS_COMPLETED)return a.state=s.STATUS_CONFIRMED,a.I=setTimeout(()=>{a.timer_I()},b.TIMER_I),!0;break;case S.CANCEL:return(a=n.ist[i.via_branch])?(i.reply_sl(200),a.state!==s.STATUS_PROCEEDING):(i.reply_sl(481),!0);default:if(a=n.nist[i.via_branch]){switch(a.state){case s.STATUS_TRYING:break;case s.STATUS_PROCEEDING:case s.STATUS_COMPLETED:a.transport.send(a.last_response)}return!0}}}}},{"./Constants":2,"./SIPMessage":19,"./Timers":21,debug:30,events:29}],23:[function(G,q,x){const N=G("./Socket"),S=G("debug")("JsSIP:Transport"),p=G("debug")("JsSIP:ERROR:Transport"),b=G("./Constants");p.log=console.warn.bind(console);const _=0,t=1,m=2,f=0,o=1,s={min_interval:2,max_interval:30},n=.5;q.exports=class{constructor(i,a=s){if(S("new()"),this.status=m,this.socket=null,this.sockets=[],this.recovery_options=a,this.recover_attempts=0,this.recovery_timer=null,this.close_requested=!1,i===void 0)throw new TypeError("Invalid argument. undefined 'sockets' argument");i instanceof Array||(i=[i]),i.forEach(function(c){if(!N.isSocket(c.socket))throw new TypeError("Invalid argument. invalid 'JsSIP.Socket' instance");if(c.weight&&!Number(c.weight))throw new TypeError("Invalid argument. 'weight' attribute is not a number");this.sockets.push({socket:c.socket,weight:c.weight||0,status:f})},this),this._getSocket()}get via_transport(){return this.socket.via_transport}get url(){return this.socket.url}get sip_uri(){return this.socket.sip_uri}connect(){S("connect()"),this.isConnected()?S("Transport is already connected"):this.isConnecting()?S("Transport is connecting"):(this.close_requested=!1,this.status=t,this.onconnecting({socket:this.socket,attempts:this.recover_attempts}),this.close_requested||(this.socket.onconnect=this._onConnect.bind(this),this.socket.ondisconnect=this._onDisconnect.bind(this),this.socket.ondata=this._onData.bind(this),this.socket.connect()))}disconnect(i){S("close()"),this.close_requested=!0,this.recover_attempts=0,this.status=m,this.recovery_timer!==null&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.socket.onconnect=()=>{},this.socket.ondisconnect=()=>{},this.socket.ondata=()=>{},this.socket.disconnect(),this.ondisconnect({socket:this.socket,error:!1,ignoreReconnection:i})}send(i){if(S("send()"),!this.isConnected())return p("unable to send message, transport is not connected"),!1;const a=i.toString();return i.method!=b.OPTIONS&&S(`sending message:

${a}
`),this.socket.send(a)}isConnected(){return this.status===_}isConnecting(){return this.status===t}_reconnect(i,a,c,u,g){this.recover_attempts+=n;let h=Math.floor(Math.random()*Math.pow(2,this.recover_attempts)+1);h<this.recovery_options.min_interval?h=this.recovery_options.min_interval:h>this.recovery_options.max_interval&&(h=this.recovery_options.max_interval),this.recover_attempts>2?u({socket:g,error:i,code:a,reason:c}):(S(`reconnection attempt in ${1e3*n} milli seconds`),this.recovery_timer=setTimeout(()=>{this.close_requested||this.isConnected()||this.isConnecting()||(this._getSocket(),this.connect())},500))}_getSocket(){let i=[];if(this.sockets.forEach(c=>{c.status!==o&&(i.length===0?i.push(c):c.weight>i[0].weight?i=[c]:c.weight===i[0].weight&&i.push(c))}),i.length===0)return this.sockets.forEach(c=>{c.status=f}),void this._getSocket();const a=Math.floor(Math.random()*i.length);this.socket=i[a].socket}_onConnect(){this.recover_attempts=0,this.status=_,this.recovery_timer!==null&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.onconnect({socket:this})}_onDisconnect({error:i,code:a,reason:c}){this.status=m,this.close_requested||(this.sockets.forEach(function(u){this.socket===u.socket&&(u.status=o)},this),this._reconnect(i,a,c,this.ondisconnect,this.socket))}_onData(i){if(i!==`\r
`){if(typeof i!="string"){try{i=String.fromCharCode.apply(null,new Uint8Array(i))}catch{return void S("received binary message failed to be converted into string, message discarded")}S(`received binary message:

${i}
`)}else new RegExp("admin@phone.plivo.com").test(i)||S(`received text message:

${i}
`);this.ondata({transport:this,message:i})}else S("received message with CRLF Keep Alive response")}}},{"./Constants":2,"./Socket":20,debug:30}],24:[function(G,q,x){const N=G("events").EventEmitter,S=G("./Constants"),p=G("./Registrator"),b=G("./RTCSession"),_=G("./Message"),t=G("./Transactions"),m=G("./Transport"),f=G("./Utils"),o=G("./Exceptions"),s=G("./URI"),n=G("./Grammar"),i=G("./Parser"),a=G("./SIPMessage"),c=G("./sanityCheck"),u=G("./Config"),g=G("debug")("JsSIP:UA"),h=G("debug")("JsSIP:ERROR:UA");h.log=console.warn.bind(console);const C={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};q.exports=class extends N{static get C(){return C}constructor(E){if(super(),this._cache={credentials:{}},this._configuration=Object.assign({},u.settings),this._dynConfiguration={},this._dialogs={},this._applicants={},this._sessions={},this._transport=null,this._contact=null,this._status=C.STATUS_INIT,this._error=null,this._transactions={nist:{},nict:{},ist:{},ict:{}},this._data={},this._closeTimer=null,this.sendReInviteOnTransportConnect=!0,this.sendRegisterOnTransportConnect=!0,E===void 0)throw new TypeError("Not enough arguments");try{this._loadConfig(E)}catch(y){throw this._status=C.STATUS_NOT_READY,this._error=C.CONFIGURATION_ERROR,y}this._registrator=new p(this)}get C(){return C}get status(){return this._status}get contact(){return this._contact}get configuration(){return this._configuration}get transport(){return this._transport}start(){g("start()"),this._status===C.STATUS_INIT?this._transport.connect():this._status===C.STATUS_USER_CLOSED?(g("restarting UA"),this._closeTimer!==null&&(clearTimeout(this._closeTimer),this._closeTimer=null,this._transport.disconnect(!0)),this._status=C.STATUS_INIT,this._transport.connect()):this._status===C.STATUS_READY?g("UA is in READY status, not restarted"):g("ERROR: connection is down, Auto-Recovery system is trying to reconnect"),this._dynConfiguration.register=this._configuration.register}register(){g("register()"),this._dynConfiguration.register=!0,this._registrator.register()}unregister(E){g("unregister()"),this._dynConfiguration.register=!1,this._registrator.unregister(E)}registrator(){return this._registrator}isRegistered(){return this._registrator.registered}isRegistering(){return this._registrator.registering}isConnected(){return this._transport.isConnected()}call(E,y){g("call()");const w=new b(this);return w.connect(E,y),w}sendMessage(E,y,w){g("sendMessage()");const O=new _(this);return O.send(E,y,w),O}terminateSessions(E){g("terminateSessions()");for(const y in this._sessions)this._sessions[y].isEnded()||this._sessions[y].terminate(E)}stop(){if(g("stop()"),this._dynConfiguration={},this._status===C.STATUS_USER_CLOSED)return void g("UA already closed");this._registrator.close();const E=Object.keys(this._sessions).length;for(const y in this._sessions)if(Object.prototype.hasOwnProperty.call(this._sessions,y)){g(`closing session ${y}`);try{this._sessions[y].terminate()}catch{}}for(const y in this._applicants)if(Object.prototype.hasOwnProperty.call(this._applicants,y))try{this._applicants[y].close()}catch{}this._status=C.STATUS_USER_CLOSED,Object.keys(this._transactions.nict).length+Object.keys(this._transactions.nist).length+Object.keys(this._transactions.ict).length+Object.keys(this._transactions.ist).length===0&&E===0?this._transport.disconnect(!0):this._closeTimer=setTimeout(()=>{this._closeTimer=null,this._transport.disconnect(!0)},2e3)}normalizeTarget(E){return f.normalizeTarget(E,this._configuration.hostport_params)}get(E){switch(E){case"realm":return this._configuration.realm;case"ha1":return this._configuration.ha1;default:return void h('get() | cannot get "%s" parameter in runtime',E)}}set(E,y){switch(E){case"password":this._configuration.password=String(y);break;case"realm":this._configuration.realm=String(y);break;case"ha1":this._configuration.ha1=String(y),this._configuration.password=null;break;case"display_name":if(n.parse(`"${y}"`,"display_name")===-1)return h('set() | wrong "display_name"'),!1;this._configuration.display_name=y;break;default:return h('set() | cannot set "%s" parameter in runtime',E),!1}return!0}newTransaction(E){this._transactions[E.type][E.id]=E,this.emit("newTransaction",{transaction:E})}destroyTransaction(E){delete this._transactions[E.type][E.id],this.emit("transactionDestroyed",{transaction:E})}newDialog(E){this._dialogs[E.id]=E}destroyDialog(E){delete this._dialogs[E.id]}newMessage(E,y){this._applicants[E]=E,this.emit("newMessage",y)}destroyMessage(E){delete this._applicants[E]}newRTCSession(E,y){this._sessions[E.id]=E,this.emit("newRTCSession",y)}destroyRTCSession(E){delete this._sessions[E.id]}registered(E){this.emit("registered",E)}unregistered(E){this.emit("unregistered",E)}registrationFailed(E){this.emit("registrationFailed",E)}receiveRequest(E){const y=E.method;if(E.ruri.user!==this._configuration.uri.user&&E.ruri.user!==this._contact.uri.user)return g("Request-URI does not point to us"),void(E.method!==S.ACK&&E.reply_sl(404));if(E.ruri.scheme===S.SIPS)return void E.reply_sl(416);if(t.checkTransaction(this,E))return;if(y===S.INVITE?new t.InviteServerTransaction(this,this._transport,E):y!==S.ACK&&y!==S.CANCEL&&new t.NonInviteServerTransaction(this,this._transport,E),y===S.OPTIONS)E.reply(200);else if(y===S.MESSAGE){if(this.listeners("newMessage").length===0)return void E.reply(405);new _(this).init_incoming(E)}else if(y===S.INVITE&&!E.to_tag&&this.listeners("newRTCSession").length===0)return void E.reply(405);let w,O;if(E.to_tag)(w=this._findDialog(E.call_id,E.from_tag,E.to_tag))?w.receiveRequest(E):y===S.NOTIFY?(O=this._findSession(E))?O.receiveRequest(E):(g("received NOTIFY request for a non existent subscription"),E.reply(481,"Subscription does not exist")):y!==S.ACK&&E.reply(481);else switch(y){case S.INVITE:if(window.RTCPeerConnection)if(E.hasHeader("replaces")){const L=E.replaces;(w=this._findDialog(L.call_id,L.from_tag,L.to_tag))?(O=w.owner).isEnded()?E.reply(603):O.receiveRequest(E):E.reply(481)}else(O=new b(this)).init_incoming(E);else h("INVITE received but WebRTC is not supported"),E.reply(488);break;case S.BYE:E.reply(481);break;case S.CANCEL:(O=this._findSession(E))?O.receiveRequest(E):g("received CANCEL request for a non existent session");break;case S.ACK:break;default:E.reply(405)}}_findSession({call_id:E,from_tag:y,to_tag:w}){const O=E+y,L=this._sessions[O],I=E+w,k=this._sessions[I];return L||k||null}_findDialog(E,y,w){let O=E+y+w,L=this._dialogs[O];return L||(O=E+w+y,(L=this._dialogs[O])||null)}createNewUATransport(E){u.load(this._configuration,E),this._transport=new m(this._configuration.sockets,{max_interval:this._configuration.connection_recovery_max_interval,min_interval:this._configuration.connection_recovery_min_interval}),this._transport.onconnecting=(function(y){this.emit("connecting",y)}).bind(this),this._transport.onconnect=(function(y){if(this._status!==C.STATUS_USER_CLOSED&&(this._status=C.STATUS_READY,this._error=null,this.emit("connected",y),this._dynConfiguration.register&&(this.sendRegisterOnTransportConnect&&this._registrator.register(),this.sendReInviteOnTransportConnect))){for(const w in this._sessions)if(this._sessions[w].status===9){const O={succeeded:()=>{},failed:()=>{}};return void this._sessions[w]._sendReinvite({eventHandlers:O,rtcOfferConstraints:{iceRestart:!0}},this._sessions[w])}}}).bind(this),this._transport.ondisconnect=(function(y){const w=["nict","ict","nist","ist"];for(const O of w)for(const L in this._transactions[O])Object.prototype.hasOwnProperty.call(this._transactions[O],L)&&this._transactions[O][L].onTransportError();this.emit("disconnected",y),this._registrator.onTransportClosed(),this._status!==C.STATUS_USER_CLOSED&&(this._status=C.STATUS_NOT_READY,this._error=C.NETWORK_ERROR)}).bind(this),this._transport.ondata=(function(y){const w=y.transport;let O=y.message;if((O=i.parseMessage(O,this))&&!(this._status===C.STATUS_USER_CLOSED&&O instanceof a.IncomingRequest)&&c(O,this,w)){if(O instanceof a.IncomingRequest)O.transport=w,this.receiveRequest(O);else if(O instanceof a.IncomingResponse){let L;switch(O.method){case S.INVITE:(L=this._transactions.ict[O.via_branch])&&L.receiveResponse(O);break;case S.ACK:break;default:(L=this._transactions.nict[O.via_branch])&&L.receiveResponse(O)}}}}).bind(this),this._status=C.STATUS_INIT}_loadConfig(E){try{u.load(this._configuration,E)}catch(O){throw O}this._configuration.display_name===0&&(this._configuration.display_name="0"),this._configuration.instance_id||(this._configuration.instance_id=f.newUUID()),this._configuration.jssip_id=f.createRandomToken(5);const y=this._configuration.uri.clone();y.user=null,this._configuration.hostport_params=y.toString().replace(/^sip:/i,"");try{this.createNewUATransport(E)}catch(O){throw h(O),new o.ConfigurationError("sockets",this._configuration.sockets)}if(delete this._configuration.sockets,this._configuration.authorization_user||(this._configuration.authorization_user=this._configuration.uri.user),!this._configuration.registrar_server){const O=this._configuration.uri.clone();O.user=null,O.clearParams(),O.clearHeaders(),this._configuration.registrar_server=O}this._configuration.no_answer_timeout*=1e3,this._configuration.contact_uri?this._configuration.via_host=this._configuration.contact_uri.host:this._configuration.contact_uri=new s("sip",f.createRandomToken(8),this._configuration.via_host,null,{transport:"ws"}),this._contact={pub_gruu:null,temp_gruu:null,uri:this._configuration.contact_uri,toString(O={}){const L=O.anonymous||null,I=O.outbound||null;let k="<";return k+=L?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),!I||(L?this.temp_gruu:this.pub_gruu)||(k+=";ob"),k+">"}};const w=["password","realm","ha1","display_name","register","uri","user_agent","connection_recovery_max_interval","connection_recovery_min_interval","session_timers","register_expires","sockets","token","googIPv6"];for(const O in this._configuration)Object.prototype.hasOwnProperty.call(this._configuration,O)&&(w.indexOf(O)!==-1?Object.defineProperty(this._configuration,O,{writable:!0,configurable:!1}):Object.defineProperty(this._configuration,O,{writable:!1,configurable:!1}));g("configuration parameters after validation:");for(const O in this._configuration)if(Object.prototype.hasOwnProperty.call(u.settings,O))switch(O){case"uri":case"registrar_server":g(`- ${O}: ${this._configuration[O]}`);break;case"password":case"ha1":g(`- ${O}: NOT SHOWN`);break;default:g(`- ${O}: ${JSON.stringify(this._configuration[O])}`)}}}},{"./Config":1,"./Constants":2,"./Exceptions":6,"./Grammar":7,"./Message":9,"./Parser":11,"./RTCSession":12,"./Registrator":17,"./SIPMessage":19,"./Transactions":22,"./Transport":23,"./URI":25,"./Utils":26,"./sanityCheck":28,debug:30,events:29}],25:[function(G,q,x){const N=G("./Constants"),S=G("./Utils"),p=G("./Grammar");q.exports=class th{static parse(_){return(_=p.parse(_,"SIP_URI"))!==-1?_:void 0}constructor(_,t,m,f,o={},s={}){if(!m)throw new TypeError('missing or invalid "host" parameter');this._parameters={},this._headers={},this._scheme=_||N.SIP,this._user=t,this._host=m,this._port=f;for(const n in o)Object.prototype.hasOwnProperty.call(o,n)&&this.setParam(n,o[n]);for(const n in s)Object.prototype.hasOwnProperty.call(s,n)&&this.setHeader(n,s[n])}get scheme(){return this._scheme}set scheme(_){this._scheme=_.toLowerCase()}get user(){return this._user}set user(_){this._user=_}get host(){return this._host}set host(_){this._host=_.toLowerCase()}get port(){return this._port}set port(_){this._port=_===0?_:parseInt(_,10)||null}setParam(_,t){_&&(this._parameters[_.toLowerCase()]=t==null?null:t.toString())}getParam(_){if(_)return this._parameters[_.toLowerCase()]}hasParam(_){if(_)return!!this._parameters.hasOwnProperty(_.toLowerCase())}deleteParam(_){if(_=_.toLowerCase(),this._parameters.hasOwnProperty(_)){const t=this._parameters[_];return delete this._parameters[_],t}}clearParams(){this._parameters={}}setHeader(_,t){this._headers[S.headerize(_)]=Array.isArray(t)?t:[t]}getHeader(_){if(_)return this._headers[S.headerize(_)]}hasHeader(_){if(_)return!!this._headers.hasOwnProperty(S.headerize(_))}deleteHeader(_){if(_=S.headerize(_),this._headers.hasOwnProperty(_)){const t=this._headers[_];return delete this._headers[_],t}}clearHeaders(){this._headers={}}clone(){return new th(this._scheme,this._user,this._host,this._port,JSON.parse(JSON.stringify(this._parameters)),JSON.parse(JSON.stringify(this._headers)))}toString(){const _=[];let t=`${this._scheme}:`;this._user&&(t+=`${S.escapeUser(this._user)}@`),t+=this._host,(this._port||this._port===0)&&(t+=`:${this._port}`);for(const m in this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,m)&&(t+=`;${m}`,this._parameters[m]!==null&&(t+=`=${this._parameters[m]}`));for(const m in this._headers)if(Object.prototype.hasOwnProperty.call(this._headers,m))for(const f of this._headers[m])_.push(`${m}=${f}`);return _.length>0&&(t+=`?${_.join("&")}`),t}toAor(_){let t=`${this._scheme}:`;return this._user&&(t+=`${S.escapeUser(this._user)}@`),t+=this._host,_&&(this._port||this._port===0)&&(t+=`:${this._port}`),t}}},{"./Constants":2,"./Grammar":7,"./Utils":26}],26:[function(G,q,x){const N=G("./Constants"),S=G("./URI"),p=G("./Grammar");x.str_utf8_length=m=>unescape(encodeURIComponent(m)).length;const b=x.isFunction=m=>m!==void 0&&Object.prototype.toString.call(m)==="[object Function]";x.isString=m=>m!==void 0&&Object.prototype.toString.call(m)==="[object String]",x.isDecimal=m=>!isNaN(m)&&parseFloat(m)===parseInt(m,10),x.isEmpty=m=>m===null||m===""||m===void 0||Array.isArray(m)&&m.length===0||typeof m=="number"&&isNaN(m),x.hasMethods=function(m,...f){for(const o of f)if(b(m[o]))return!1;return!0};const _=x.createRandomToken=(m,f=32)=>{let o,s="";for(o=0;o<m;o++)s+=(Math.random()*f|0).toString(f);return s};x.newTag=()=>_(10),x.newUUID=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,m=>{const f=16*Math.random()|0;return(m==="x"?f:3&f|8).toString(16)}),x.hostType=m=>{if(m)return(m=p.parse(m,"host"))!==-1?m.host_type:void 0};const t=x.escapeUser=m=>encodeURIComponent(decodeURIComponent(m)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/");x.normalizeTarget=(m,f)=>{if(m){if(m instanceof S)return m;if(typeof m=="string"){const o=m.split("@");let s,n,i;switch(o.length){case 1:if(!f)return;s=m,n=f;break;case 2:s=o[0],n=o[1];break;default:s=o.slice(0,o.length-1).join("@"),n=o[o.length-1]}return s=s.replace(/^(sips?|tel):/i,""),/^[-.()]*\+?[0-9\-.()]+$/.test(s)&&(s=s.replace(/[-.()]/g,"")),m=`${N.SIP}:${t(s)}@${n}`,(i=S.parse(m))?i:void 0}}},x.headerize=m=>{const f={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},o=m.toLowerCase().replace(/_/g,"-").split("-");let s="";const n=o.length;let i;for(i=0;i<n;i++)i!==0&&(s+="-"),s+=o[i].charAt(0).toUpperCase()+o[i].substring(1);return f[s]&&(s=f[s]),s},x.sipErrorCause=m=>{for(const f in N.SIP_ERROR_CAUSES)if(N.SIP_ERROR_CAUSES[f].indexOf(m)!==-1)return N.causes[f];return N.causes.SIP_FAILURE_CODE},x.getRandomTestNetIP=()=>`192.0.2.${function(m,f){return Math.floor(Math.random()*(f-m+1)+m)}(1,254)}`,x.calculateMD5=m=>{function f(k,P){return k<<P|k>>>32-P}function o(k,P){const F=2147483648&k,H=2147483648&P,D=1073741824&k,$=1073741824&P,j=(1073741823&k)+(1073741823&P);return D&$?2147483648^j^F^H:D|$?1073741824&j?3221225472^j^F^H:1073741824^j^F^H:j^F^H}function s(k,P,F,H,D,$,j){return k=o(k,o(o(function(V,Y,Z){return V&Y|~V&Z}(P,F,H),D),j)),o(f(k,$),P)}function n(k,P,F,H,D,$,j){return k=o(k,o(o(function(V,Y,Z){return V&Z|Y&~Z}(P,F,H),D),j)),o(f(k,$),P)}function i(k,P,F,H,D,$,j){return k=o(k,o(o(function(V,Y,Z){return V^Y^Z}(P,F,H),D),j)),o(f(k,$),P)}function a(k,P,F,H,D,$,j){return k=o(k,o(o(function(V,Y,Z){return Y^(V|~Z)}(P,F,H),D),j)),o(f(k,$),P)}function c(k){let P,F="",H="";for(P=0;P<=3;P++)F+=(H=`0${(k>>>8*P&255).toString(16)}`).substr(H.length-2,2);return F}let u,g,h,C,E,y,w,O,L,I=[];for(I=function(k){let P;const F=k.length,H=F+8,D=16*((H-H%64)/64+1),$=new Array(D-1);let j=0,V=0;for(;V<F;)j=V%4*8,$[P=(V-V%4)/4]=$[P]|k.charCodeAt(V)<<j,V++;return j=V%4*8,$[P=(V-V%4)/4]=$[P]|128<<j,$[D-2]=F<<3,$[D-1]=F>>>29,$}(m=function(k){k=k.replace(/\r\n/g,`
`);let P="";for(let F=0;F<k.length;F++){const H=k.charCodeAt(F);H<128?P+=String.fromCharCode(H):H>127&&H<2048?(P+=String.fromCharCode(H>>6|192),P+=String.fromCharCode(63&H|128)):(P+=String.fromCharCode(H>>12|224),P+=String.fromCharCode(H>>6&63|128),P+=String.fromCharCode(63&H|128))}return P}(m)),y=1732584193,w=4023233417,O=2562383102,L=271733878,u=0;u<I.length;u+=16)g=y,h=w,C=O,E=L,y=s(y,w,O,L,I[u+0],7,3614090360),L=s(L,y,w,O,I[u+1],12,3905402710),O=s(O,L,y,w,I[u+2],17,606105819),w=s(w,O,L,y,I[u+3],22,3250441966),y=s(y,w,O,L,I[u+4],7,4118548399),L=s(L,y,w,O,I[u+5],12,1200080426),O=s(O,L,y,w,I[u+6],17,2821735955),w=s(w,O,L,y,I[u+7],22,4249261313),y=s(y,w,O,L,I[u+8],7,1770035416),L=s(L,y,w,O,I[u+9],12,2336552879),O=s(O,L,y,w,I[u+10],17,4294925233),w=s(w,O,L,y,I[u+11],22,2304563134),y=s(y,w,O,L,I[u+12],7,1804603682),L=s(L,y,w,O,I[u+13],12,4254626195),O=s(O,L,y,w,I[u+14],17,2792965006),y=n(y,w=s(w,O,L,y,I[u+15],22,1236535329),O,L,I[u+1],5,4129170786),L=n(L,y,w,O,I[u+6],9,3225465664),O=n(O,L,y,w,I[u+11],14,643717713),w=n(w,O,L,y,I[u+0],20,3921069994),y=n(y,w,O,L,I[u+5],5,3593408605),L=n(L,y,w,O,I[u+10],9,38016083),O=n(O,L,y,w,I[u+15],14,3634488961),w=n(w,O,L,y,I[u+4],20,3889429448),y=n(y,w,O,L,I[u+9],5,568446438),L=n(L,y,w,O,I[u+14],9,3275163606),O=n(O,L,y,w,I[u+3],14,4107603335),w=n(w,O,L,y,I[u+8],20,1163531501),y=n(y,w,O,L,I[u+13],5,2850285829),L=n(L,y,w,O,I[u+2],9,4243563512),O=n(O,L,y,w,I[u+7],14,1735328473),y=i(y,w=n(w,O,L,y,I[u+12],20,2368359562),O,L,I[u+5],4,4294588738),L=i(L,y,w,O,I[u+8],11,2272392833),O=i(O,L,y,w,I[u+11],16,1839030562),w=i(w,O,L,y,I[u+14],23,4259657740),y=i(y,w,O,L,I[u+1],4,2763975236),L=i(L,y,w,O,I[u+4],11,1272893353),O=i(O,L,y,w,I[u+7],16,4139469664),w=i(w,O,L,y,I[u+10],23,3200236656),y=i(y,w,O,L,I[u+13],4,681279174),L=i(L,y,w,O,I[u+0],11,3936430074),O=i(O,L,y,w,I[u+3],16,3572445317),w=i(w,O,L,y,I[u+6],23,76029189),y=i(y,w,O,L,I[u+9],4,3654602809),L=i(L,y,w,O,I[u+12],11,3873151461),O=i(O,L,y,w,I[u+15],16,530742520),y=a(y,w=i(w,O,L,y,I[u+2],23,3299628645),O,L,I[u+0],6,4096336452),L=a(L,y,w,O,I[u+7],10,1126891415),O=a(O,L,y,w,I[u+14],15,2878612391),w=a(w,O,L,y,I[u+5],21,4237533241),y=a(y,w,O,L,I[u+12],6,1700485571),L=a(L,y,w,O,I[u+3],10,2399980690),O=a(O,L,y,w,I[u+10],15,4293915773),w=a(w,O,L,y,I[u+1],21,2240044497),y=a(y,w,O,L,I[u+8],6,1873313359),L=a(L,y,w,O,I[u+15],10,4264355552),O=a(O,L,y,w,I[u+6],15,2734768916),w=a(w,O,L,y,I[u+13],21,1309151649),y=a(y,w,O,L,I[u+4],6,4149444226),L=a(L,y,w,O,I[u+11],10,3174756917),O=a(O,L,y,w,I[u+2],15,718787259),w=a(w,O,L,y,I[u+9],21,3951481745),y=o(y,g),w=o(w,h),O=o(O,C),L=o(L,E);return(c(y)+c(w)+c(O)+c(L)).toLowerCase()},x.closeMediaStream=m=>{if(m)try{let f;if(m.getTracks){f=m.getTracks();for(const o of f)o.stop()}else{f=m.getAudioTracks();for(const o of f)o.stop();f=m.getVideoTracks();for(const o of f)o.stop()}}catch{typeof m.stop!="function"&&typeof m.stop!="object"||m.stop()}},x.cloneArray=m=>m&&m.slice()||[],x.cloneObject=(m,f={})=>m&&Object.assign({},m)||f},{"./Constants":2,"./Grammar":7,"./URI":25}],27:[function(G,q,x){const N=G("./Grammar"),S=G("debug")("JsSIP:WebSocketInterface"),p=G("debug")("JsSIP:ERROR:WebSocketInterface");p.log=console.warn.bind(console),q.exports=class{constructor(b){S('new() [url:"%s"]',b),this._url=b,this._sip_uri=null,this._via_transport=null,this._ws=null;const _=N.parse(b,"absoluteURI");if(_===-1)throw p(`invalid WebSocket URI: ${b}`),new TypeError(`Invalid argument: ${b}`);if(_.scheme!=="wss"&&_.scheme!=="ws")throw p(`invalid WebSocket URI scheme: ${_.scheme}`),new TypeError(`Invalid argument: ${b}`);this._sip_uri=`sip:${_.host}${_.port?`:${_.port}`:""};transport=ws`,this._via_transport=_.scheme.toUpperCase()}get via_transport(){return this._via_transport}set via_transport(b){this._via_transport=b.toUpperCase()}get sip_uri(){return this._sip_uri}get url(){return this._url}connect(){if(S("connect()"),this.isConnected())S(`WebSocket ${this._url} is already connected`);else if(this.isConnecting())S(`WebSocket ${this._url} is connecting`);else{this._ws&&this.disconnect(),S(`connecting to WebSocket ${this._url}`);try{this._ws=new WebSocket(this._url,"sip"),this._ws.binaryType="arraybuffer",this._ws.onopen=this._onOpen.bind(this),this._ws.onclose=this._onClose.bind(this),this._ws.onmessage=this._onMessage.bind(this),this._ws.onerror=this._onError.bind(this)}catch(b){this._onError(b)}}}disconnect(){S("disconnect()"),this._ws&&(this._ws.onopen=()=>{},this._ws.onclose=()=>{},this._ws.onmessage=()=>{},this._ws.onerror=()=>{},this._ws.close(),this._ws=null)}send(b){return S("send()"),this.isConnected()?(this._ws.send(b),!0):(p("unable to send message, WebSocket is not open"),!1)}isConnected(){return this._ws&&this._ws.readyState===this._ws.OPEN}isConnecting(){return this._ws&&this._ws.readyState===this._ws.CONNECTING}_onOpen(){S(`WebSocket ${this._url} connected`),this.onconnect()}_onClose({wasClean:b,code:_,reason:t}){S(`WebSocket ${this._url} closed`),b===!1&&S("WebSocket abrupt disconnection");const m={socket:this,error:!b,code:_,reason:t};this.ondisconnect(m)}_onMessage({data:b}){S("received WebSocket message"),this.ondata(b)}_onError(b){p(`WebSocket ${this._url} error: ${b}`)}}},{"./Grammar":7,debug:30}],28:[function(G,q,x){const N=G("./Constants"),S=G("./SIPMessage"),p=G("./Utils"),b=G("debug")("JsSIP:sanityCheck"),_=[function(){const i=["from","to","call_id","cseq","via"];for(const a of i)if(!f.hasHeader(a))return b(`missing mandatory header field : ${a}, dropping the response`),!1}],t=[function(){if(f.s("to").uri.scheme!=="sip")return n(416),!1},function(){if(!f.to_tag&&f.call_id.substr(0,5)===o.configuration.jssip_id)return n(482),!1},function(){if(p.str_utf8_length(f.body)<f.getHeader("content-length"))return n(400),!1},function(){const i=f.from_tag,a=f.call_id,c=f.cseq;let u;if(!f.to_tag)if(f.method===N.INVITE){if(o._transactions.ist[f.via_branch])return!1;for(const g in o._transactions.ist)if(Object.prototype.hasOwnProperty.call(o._transactions.ist,g)&&(u=o._transactions.ist[g]).request.from_tag===i&&u.request.call_id===a&&u.request.cseq===c)return n(482),!1}else{if(o._transactions.nist[f.via_branch])return!1;for(const g in o._transactions.nist)if(Object.prototype.hasOwnProperty.call(o._transactions.nist,g)&&(u=o._transactions.nist[g]).request.from_tag===i&&u.request.call_id===a&&u.request.cseq===c)return n(482),!1}}],m=[function(){if(f.getHeaders("via").length>1)return b("more than one Via header field present in the response, dropping the response"),!1},function(){if(p.str_utf8_length(f.body)<f.getHeader("content-length"))return b("message body length is lower than the value in Content-Length header field, dropping the response"),!1}];let f,o,s;function n(i){const a=f.getHeaders("via");let c,u=`SIP/2.0 ${i} ${N.REASON_PHRASE[i]}\r
`;for(const g of a)u+=`Via: ${g}\r
`;c=f.getHeader("To"),f.to_tag||(c+=`;tag=${p.newTag()}`),u+=`To: ${c}\r
`,u+=`From: ${f.getHeader("From")}\r
`,u+=`Call-ID: ${f.call_id}\r
`,u+=`CSeq: ${f.cseq} ${f.method}\r
`,u+=`\r
`,s.send(u)}q.exports=(i,a,c)=>{f=i,o=a,s=c;for(const u of _)if(u()===!1)return!1;if(f instanceof S.IncomingRequest){for(const u of t)if(u()===!1)return!1}else if(f instanceof S.IncomingResponse){for(const u of m)if(u()===!1)return!1}return!0}},{"./Constants":2,"./SIPMessage":19,"./Utils":26,debug:30}],29:[function(G,q,x){var N=Object.create||function(u){var g=function(){};return g.prototype=u,new g},S=Object.keys||function(u){var g=[];for(var h in u)Object.prototype.hasOwnProperty.call(u,h)&&g.push(h);return h},p=Function.prototype.bind||function(u){var g=this;return function(){return g.apply(u,arguments)}};function b(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=N(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}q.exports=b,b.EventEmitter=b,b.prototype._events=void 0,b.prototype._maxListeners=void 0;var _,t=10;try{var m={};Object.defineProperty&&Object.defineProperty(m,"x",{value:0}),_=m.x===0}catch{_=!1}function f(u){return u._maxListeners===void 0?b.defaultMaxListeners:u._maxListeners}function o(u,g,h,C){var E,y,w;if(typeof h!="function")throw new TypeError('"listener" argument must be a function');if((y=u._events)?(y.newListener&&(u.emit("newListener",g,h.listener?h.listener:h),y=u._events),w=y[g]):(y=u._events=N(null),u._eventsCount=0),w){if(typeof w=="function"?w=y[g]=C?[h,w]:[w,h]:C?w.unshift(h):w.push(h),!w.warned&&(E=f(u))&&E>0&&w.length>E){w.warned=!0;var O=new Error("Possible EventEmitter memory leak detected. "+w.length+' "'+String(g)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');O.name="MaxListenersExceededWarning",O.emitter=u,O.type=g,O.count=w.length,typeof console=="object"&&console.warn&&console.warn("%s: %s",O.name,O.message)}}else w=y[g]=h,++u._eventsCount;return u}function s(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var u=new Array(arguments.length),g=0;g<u.length;++g)u[g]=arguments[g];this.listener.apply(this.target,u)}}function n(u,g,h){var C={fired:!1,wrapFn:void 0,target:u,type:g,listener:h},E=p.call(s,C);return E.listener=h,C.wrapFn=E,E}function i(u,g,h){var C=u._events;if(!C)return[];var E=C[g];return E?typeof E=="function"?h?[E.listener||E]:[E]:h?function(y){for(var w=new Array(y.length),O=0;O<w.length;++O)w[O]=y[O].listener||y[O];return w}(E):c(E,E.length):[]}function a(u){var g=this._events;if(g){var h=g[u];if(typeof h=="function")return 1;if(h)return h.length}return 0}function c(u,g){for(var h=new Array(g),C=0;C<g;++C)h[C]=u[C];return h}_?Object.defineProperty(b,"defaultMaxListeners",{enumerable:!0,get:function(){return t},set:function(u){if(typeof u!="number"||u<0||u!=u)throw new TypeError('"defaultMaxListeners" must be a positive number');t=u}}):b.defaultMaxListeners=t,b.prototype.setMaxListeners=function(u){if(typeof u!="number"||u<0||isNaN(u))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=u,this},b.prototype.getMaxListeners=function(){return f(this)},b.prototype.emit=function(u){var g,h,C,E,y,w,O=u==="error";if(w=this._events)O=O&&w.error==null;else if(!O)return!1;if(O){if(arguments.length>1&&(g=arguments[1]),g instanceof Error)throw g;var L=new Error('Unhandled "error" event. ('+g+")");throw L.context=g,L}if(!(h=w[u]))return!1;var I=typeof h=="function";switch(C=arguments.length){case 1:(function(k,P,F){if(P)k.call(F);else for(var H=k.length,D=c(k,H),$=0;$<H;++$)D[$].call(F)})(h,I,this);break;case 2:(function(k,P,F,H){if(P)k.call(F,H);else for(var D=k.length,$=c(k,D),j=0;j<D;++j)$[j].call(F,H)})(h,I,this,arguments[1]);break;case 3:(function(k,P,F,H,D){if(P)k.call(F,H,D);else for(var $=k.length,j=c(k,$),V=0;V<$;++V)j[V].call(F,H,D)})(h,I,this,arguments[1],arguments[2]);break;case 4:(function(k,P,F,H,D,$){if(P)k.call(F,H,D,$);else for(var j=k.length,V=c(k,j),Y=0;Y<j;++Y)V[Y].call(F,H,D,$)})(h,I,this,arguments[1],arguments[2],arguments[3]);break;default:for(E=new Array(C-1),y=1;y<C;y++)E[y-1]=arguments[y];(function(k,P,F,H){if(P)k.apply(F,H);else for(var D=k.length,$=c(k,D),j=0;j<D;++j)$[j].apply(F,H)})(h,I,this,E)}return!0},b.prototype.addListener=function(u,g){return o(this,u,g,!1)},b.prototype.on=b.prototype.addListener,b.prototype.prependListener=function(u,g){return o(this,u,g,!0)},b.prototype.once=function(u,g){if(typeof g!="function")throw new TypeError('"listener" argument must be a function');return this.on(u,n(this,u,g)),this},b.prototype.prependOnceListener=function(u,g){if(typeof g!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(u,n(this,u,g)),this},b.prototype.removeListener=function(u,g){var h,C,E,y,w;if(typeof g!="function")throw new TypeError('"listener" argument must be a function');if(!(C=this._events))return this;if(!(h=C[u]))return this;if(h===g||h.listener===g)--this._eventsCount==0?this._events=N(null):(delete C[u],C.removeListener&&this.emit("removeListener",u,h.listener||g));else if(typeof h!="function"){for(E=-1,y=h.length-1;y>=0;y--)if(h[y]===g||h[y].listener===g){w=h[y].listener,E=y;break}if(E<0)return this;E===0?h.shift():function(O,L){for(var I=L,k=I+1,P=O.length;k<P;I+=1,k+=1)O[I]=O[k];O.pop()}(h,E),h.length===1&&(C[u]=h[0]),C.removeListener&&this.emit("removeListener",u,w||g)}return this},b.prototype.removeAllListeners=function(u){var g,h,C;if(!(h=this._events))return this;if(!h.removeListener)return arguments.length===0?(this._events=N(null),this._eventsCount=0):h[u]&&(--this._eventsCount==0?this._events=N(null):delete h[u]),this;if(arguments.length===0){var E,y=S(h);for(C=0;C<y.length;++C)(E=y[C])!=="removeListener"&&this.removeAllListeners(E);return this.removeAllListeners("removeListener"),this._events=N(null),this._eventsCount=0,this}if(typeof(g=h[u])=="function")this.removeListener(u,g);else if(g)for(C=g.length-1;C>=0;C--)this.removeListener(u,g[C]);return this},b.prototype.listeners=function(u){return i(this,u,!0)},b.prototype.rawListeners=function(u){return i(this,u,!1)},b.listenerCount=function(u,g){return typeof u.listenerCount=="function"?u.listenerCount(g):a.call(u,g)},b.prototype.listenerCount=a,b.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],30:[function(G,q,x){(function(N){(function(){x.formatArgs=function(p){if(p[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+p[0]+(this.useColors?"%c ":" ")+"+"+q.exports.humanize(this.diff),!this.useColors)return;const b="color: "+this.color;p.splice(1,0,b,"color: inherit");let _=0,t=0;p[0].replace(/%[a-zA-Z%]/g,m=>{m!=="%%"&&(_++,m==="%c"&&(t=_))}),p.splice(t,0,b)},x.save=function(p){try{p?x.storage.setItem("debug",p):x.storage.removeItem("debug")}catch{}},x.load=function(){let p;try{p=x.storage.getItem("debug")}catch{}return!p&&N!==void 0&&"env"in N&&(p=N.env.DEBUG),p},x.useColors=function(){return!(typeof window>"u"||!window.process||window.process.type!=="renderer"&&!window.process.__nwjs)||(typeof navigator>"u"||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},x.storage=function(){try{return localStorage}catch{}}(),x.destroy=(()=>{let p=!1;return()=>{p||(p=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),x.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],x.log=console.debug||console.log||(()=>{}),q.exports=G("./common")(x);const{formatters:S}=q.exports;S.j=function(p){try{return JSON.stringify(p)}catch(b){return"[UnexpectedJSONParseError]: "+b.message}}}).call(this)}).call(this,G("_process"))},{"./common":31,_process:33}],31:[function(G,q,x){q.exports=function(N){function S(_){let t,m,f,o=null;function s(...n){if(!s.enabled)return;const i=s,a=Number(new Date),c=a-(t||a);i.diff=c,i.prev=t,i.curr=a,t=a,n[0]=S.coerce(n[0]),typeof n[0]!="string"&&n.unshift("%O");let u=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(g,h)=>{if(g==="%%")return"%";u++;const C=S.formatters[h];if(typeof C=="function"){const E=n[u];g=C.call(i,E),n.splice(u,1),u--}return g}),S.formatArgs.call(i,n),(i.log||S.log).apply(i,n)}return s.namespace=_,s.useColors=S.useColors(),s.color=S.selectColor(_),s.extend=p,s.destroy=S.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>o!==null?o:(m!==S.namespaces&&(m=S.namespaces,f=S.enabled(_)),f),set:n=>{o=n}}),typeof S.init=="function"&&S.init(s),s}function p(_,t){const m=S(this.namespace+(t===void 0?":":t)+_);return m.log=this.log,m}function b(_){return _.toString().substring(2,_.toString().length-2).replace(/\.\*\?$/,"*")}return S.debug=S,S.default=S,S.coerce=function(_){return _ instanceof Error?_.stack||_.message:_},S.disable=function(){const _=[...S.names.map(b),...S.skips.map(b).map(t=>"-"+t)].join(",");return S.enable(""),_},S.enable=function(_){let t;S.save(_),S.namespaces=_,S.names=[],S.skips=[];const m=(typeof _=="string"?_:"").split(/[\s,]+/),f=m.length;for(t=0;t<f;t++)m[t]&&((_=m[t].replace(/\*/g,".*?"))[0]==="-"?S.skips.push(new RegExp("^"+_.slice(1)+"$")):S.names.push(new RegExp("^"+_+"$")))},S.enabled=function(_){if(_[_.length-1]==="*")return!0;let t,m;for(t=0,m=S.skips.length;t<m;t++)if(S.skips[t].test(_))return!1;for(t=0,m=S.names.length;t<m;t++)if(S.names[t].test(_))return!0;return!1},S.humanize=G("ms"),S.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(N).forEach(_=>{S[_]=N[_]}),S.names=[],S.skips=[],S.formatters={},S.selectColor=function(_){let t=0;for(let m=0;m<_.length;m++)t=(t<<5)-t+_.charCodeAt(m),t|=0;return S.colors[Math.abs(t)%S.colors.length]},S.enable(S.load()),S}},{ms:32}],32:[function(G,q,x){var N=1e3,S=60*N,p=60*S,b=24*p,_=7*b,t=365.25*b;function m(f,o,s,n){var i=o>=1.5*s;return Math.round(f/s)+" "+n+(i?"s":"")}q.exports=function(f,o){o=o||{};var s=typeof f;if(s==="string"&&f.length>0)return function(n){if(!((n=String(n)).length>100)){var i=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(i){var a=parseFloat(i[1]);switch((i[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*t;case"weeks":case"week":case"w":return a*_;case"days":case"day":case"d":return a*b;case"hours":case"hour":case"hrs":case"hr":case"h":return a*p;case"minutes":case"minute":case"mins":case"min":case"m":return a*S;case"seconds":case"second":case"secs":case"sec":case"s":return a*N;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(f);if(s==="number"&&isFinite(f))return o.long?function(n){var i=Math.abs(n);return i>=b?m(n,i,b,"day"):i>=p?m(n,i,p,"hour"):i>=S?m(n,i,S,"minute"):i>=N?m(n,i,N,"second"):n+" ms"}(f):function(n){var i=Math.abs(n);return i>=b?Math.round(n/b)+"d":i>=p?Math.round(n/p)+"h":i>=S?Math.round(n/S)+"m":i>=N?Math.round(n/N)+"s":n+"ms"}(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))}},{}],33:[function(G,q,x){var N,S,p=q.exports={};function b(){throw new Error("setTimeout has not been defined")}function _(){throw new Error("clearTimeout has not been defined")}function t(u){if(N===setTimeout)return setTimeout(u,0);if((N===b||!N)&&setTimeout)return N=setTimeout,setTimeout(u,0);try{return N(u,0)}catch{try{return N.call(null,u,0)}catch{return N.call(this,u,0)}}}(function(){try{N=typeof setTimeout=="function"?setTimeout:b}catch{N=b}try{S=typeof clearTimeout=="function"?clearTimeout:_}catch{S=_}})();var m,f=[],o=!1,s=-1;function n(){o&&m&&(o=!1,m.length?f=m.concat(f):s=-1,f.length&&i())}function i(){if(!o){var u=t(n);o=!0;for(var g=f.length;g;){for(m=f,f=[];++s<g;)m&&m[s].run();s=-1,g=f.length}m=null,o=!1,function(h){if(S===clearTimeout)return clearTimeout(h);if((S===_||!S)&&clearTimeout)return S=clearTimeout,clearTimeout(h);try{S(h)}catch{try{return S.call(null,h)}catch{return S.call(this,h)}}}(u)}}function a(u,g){this.fun=u,this.array=g}function c(){}p.nextTick=function(u){var g=new Array(arguments.length-1);if(arguments.length>1)for(var h=1;h<arguments.length;h++)g[h-1]=arguments[h];f.push(new a(u,g)),f.length!==1||o||t(i)},a.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=c,p.addListener=c,p.once=c,p.off=c,p.removeListener=c,p.removeAllListeners=c,p.emit=c,p.prependListener=c,p.prependOnceListener=c,p.listeners=function(u){return[]},p.binding=function(u){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(u){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],34:[function(G,q,x){var N=G("sdp");function S(m,f,o,s,n){var i=N.writeRtpDescription(m.kind,f);if(i+=N.writeIceParameters(m.iceGatherer.getLocalParameters()),i+=N.writeDtlsParameters(m.dtlsTransport.getLocalParameters(),o==="offer"?"actpass":n||"active"),i+="a=mid:"+m.mid+`\r
`,m.rtpSender&&m.rtpReceiver?i+=`a=sendrecv\r
`:m.rtpSender?i+=`a=sendonly\r
`:m.rtpReceiver?i+=`a=recvonly\r
`:i+=`a=inactive\r
`,m.rtpSender){var a=m.rtpSender._initialTrackId||m.rtpSender.track.id;m.rtpSender._initialTrackId=a;var c="msid:"+(s?s.id:"-")+" "+a+`\r
`;i+="a="+c,i+="a=ssrc:"+m.sendEncodingParameters[0].ssrc+" "+c,m.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+m.sendEncodingParameters[0].rtx.ssrc+" "+c,i+="a=ssrc-group:FID "+m.sendEncodingParameters[0].ssrc+" "+m.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return i+="a=ssrc:"+m.sendEncodingParameters[0].ssrc+" cname:"+N.localCName+`\r
`,m.rtpSender&&m.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+m.sendEncodingParameters[0].rtx.ssrc+" cname:"+N.localCName+`\r
`),i}function p(m,f){var o={codecs:[],headerExtensions:[],fecMechanisms:[]},s=function(i,a){i=parseInt(i,10);for(var c=0;c<a.length;c++)if(a[c].payloadType===i||a[c].preferredPayloadType===i)return a[c]},n=function(i,a,c,u){var g=s(i.parameters.apt,c),h=s(a.parameters.apt,u);return g&&h&&g.name.toLowerCase()===h.name.toLowerCase()};return m.codecs.forEach(function(i){for(var a=0;a<f.codecs.length;a++){var c=f.codecs[a];if(i.name.toLowerCase()===c.name.toLowerCase()&&i.clockRate===c.clockRate){if(i.name.toLowerCase()==="rtx"&&i.parameters&&c.parameters.apt&&!n(i,c,m.codecs,f.codecs))continue;(c=JSON.parse(JSON.stringify(c))).numChannels=Math.min(i.numChannels,c.numChannels),o.codecs.push(c),c.rtcpFeedback=c.rtcpFeedback.filter(function(u){for(var g=0;g<i.rtcpFeedback.length;g++)if(i.rtcpFeedback[g].type===u.type&&i.rtcpFeedback[g].parameter===u.parameter)return!0;return!1});break}}}),m.headerExtensions.forEach(function(i){for(var a=0;a<f.headerExtensions.length;a++){var c=f.headerExtensions[a];if(i.uri===c.uri){o.headerExtensions.push(c);break}}}),o}function b(m,f,o){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[f][m].indexOf(o)!==-1}function _(m,f){var o=m.getRemoteCandidates().find(function(s){return f.foundation===s.foundation&&f.ip===s.ip&&f.port===s.port&&f.priority===s.priority&&f.protocol===s.protocol&&f.type===s.type});return o||m.addRemoteCandidate(f),!o}function t(m,f){var o=new Error(f);return o.name=m,o.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[m],o}q.exports=function(m,f){function o(a,c){c.addTrack(a),c.dispatchEvent(new m.MediaStreamTrackEvent("addtrack",{track:a}))}function s(a,c,u,g){var h=new Event("track");h.track=c,h.receiver=u,h.transceiver={receiver:u},h.streams=g,m.setTimeout(function(){a._dispatchEvent("track",h)})}var n=function(a){var c=this,u=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(h){c[h]=u[h].bind(u)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",a=JSON.parse(JSON.stringify(a||{})),this.usingBundle=a.bundlePolicy==="max-bundle",a.rtcpMuxPolicy==="negotiate")throw t("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(a.rtcpMuxPolicy||(a.rtcpMuxPolicy="require"),a.iceTransportPolicy){case"all":case"relay":break;default:a.iceTransportPolicy="all"}switch(a.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:a.bundlePolicy="balanced"}if(a.iceServers=function(h,C){var E=!1;return(h=JSON.parse(JSON.stringify(h))).filter(function(y){if(y&&(y.urls||y.url)){var w=y.urls||y.url;y.url&&!y.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var O=typeof w=="string";return O&&(w=[w]),w=w.filter(function(L){return L.indexOf("turn:")!==0||L.indexOf("transport=udp")===-1||L.indexOf("turn:[")!==-1||E?L.indexOf("stun:")===0&&C>=14393&&L.indexOf("?transport=udp")===-1:(E=!0,!0)}),delete y.url,y.urls=O?w[0]:w,!!w.length}})}(a.iceServers||[],f),this._iceGatherers=[],a.iceCandidatePoolSize)for(var g=a.iceCandidatePoolSize;g>0;g--)this._iceGatherers.push(new m.RTCIceGatherer({iceServers:a.iceServers,gatherPolicy:a.iceTransportPolicy}));else a.iceCandidatePoolSize=0;this._config=a,this.transceivers=[],this._sdpSessionId=N.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(n.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(n.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),n.prototype.onicecandidate=null,n.prototype.onaddstream=null,n.prototype.ontrack=null,n.prototype.onremovestream=null,n.prototype.onsignalingstatechange=null,n.prototype.oniceconnectionstatechange=null,n.prototype.onconnectionstatechange=null,n.prototype.onicegatheringstatechange=null,n.prototype.onnegotiationneeded=null,n.prototype.ondatachannel=null,n.prototype._dispatchEvent=function(a,c){this._isClosed||(this.dispatchEvent(c),typeof this["on"+a]=="function"&&this["on"+a](c))},n.prototype._emitGatheringStateChange=function(){var a=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",a)},n.prototype.getConfiguration=function(){return this._config},n.prototype.getLocalStreams=function(){return this.localStreams},n.prototype.getRemoteStreams=function(){return this.remoteStreams},n.prototype._createTransceiver=function(a,c){var u=this.transceivers.length>0,g={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:a,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&u)g.iceTransport=this.transceivers[0].iceTransport,g.dtlsTransport=this.transceivers[0].dtlsTransport;else{var h=this._createIceAndDtlsTransports();g.iceTransport=h.iceTransport,g.dtlsTransport=h.dtlsTransport}return c||this.transceivers.push(g),g},n.prototype.addTrack=function(a,c){if(this._isClosed)throw t("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var u;if(this.transceivers.find(function(h){return h.track===a}))throw t("InvalidAccessError","Track already exists.");for(var g=0;g<this.transceivers.length;g++)this.transceivers[g].track||this.transceivers[g].kind!==a.kind||(u=this.transceivers[g]);return u||(u=this._createTransceiver(a.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(c)===-1&&this.localStreams.push(c),u.track=a,u.stream=c,u.rtpSender=new m.RTCRtpSender(a,u.dtlsTransport),u.rtpSender},n.prototype.addStream=function(a){var c=this;if(f>=15025)a.getTracks().forEach(function(g){c.addTrack(g,a)});else{var u=a.clone();a.getTracks().forEach(function(g,h){var C=u.getTracks()[h];g.addEventListener("enabled",function(E){C.enabled=E.enabled})}),u.getTracks().forEach(function(g){c.addTrack(g,u)})}},n.prototype.removeTrack=function(a){if(this._isClosed)throw t("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(a instanceof m.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var c=this.transceivers.find(function(g){return g.rtpSender===a});if(!c)throw t("InvalidAccessError","Sender was not created by this connection.");var u=c.stream;c.rtpSender.stop(),c.rtpSender=null,c.track=null,c.stream=null,this.transceivers.map(function(g){return g.stream}).indexOf(u)===-1&&this.localStreams.indexOf(u)>-1&&this.localStreams.splice(this.localStreams.indexOf(u),1),this._maybeFireNegotiationNeeded()},n.prototype.removeStream=function(a){var c=this;a.getTracks().forEach(function(u){var g=c.getSenders().find(function(h){return h.track===u});g&&c.removeTrack(g)})},n.prototype.getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})},n.prototype.getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})},n.prototype._createIceGatherer=function(a,c){var u=this;if(c&&a>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var g=new m.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(g,"state",{value:"new",writable:!0}),this.transceivers[a].bufferedCandidateEvents=[],this.transceivers[a].bufferCandidates=function(h){var C=!h.candidate||Object.keys(h.candidate).length===0;g.state=C?"completed":"gathering",u.transceivers[a].bufferedCandidateEvents!==null&&u.transceivers[a].bufferedCandidateEvents.push(h)},g.addEventListener("localcandidate",this.transceivers[a].bufferCandidates),g},n.prototype._gather=function(a,c){var u=this,g=this.transceivers[c].iceGatherer;if(!g.onlocalcandidate){var h=this.transceivers[c].bufferedCandidateEvents;this.transceivers[c].bufferedCandidateEvents=null,g.removeEventListener("localcandidate",this.transceivers[c].bufferCandidates),g.onlocalcandidate=function(C){if(!(u.usingBundle&&c>0)){var E=new Event("icecandidate");E.candidate={sdpMid:a,sdpMLineIndex:c};var y=C.candidate,w=!y||Object.keys(y).length===0;if(w)g.state!=="new"&&g.state!=="gathering"||(g.state="completed");else{g.state==="new"&&(g.state="gathering"),y.component=1,y.ufrag=g.getLocalParameters().usernameFragment;var O=N.writeCandidate(y);E.candidate=Object.assign(E.candidate,N.parseCandidate(O)),E.candidate.candidate=O,E.candidate.toJSON=function(){return{candidate:E.candidate.candidate,sdpMid:E.candidate.sdpMid,sdpMLineIndex:E.candidate.sdpMLineIndex,usernameFragment:E.candidate.usernameFragment}}}var L=N.getMediaSections(u._localDescription.sdp);L[E.candidate.sdpMLineIndex]+=w?`a=end-of-candidates\r
`:"a="+E.candidate.candidate+`\r
`,u._localDescription.sdp=N.getDescription(u._localDescription.sdp)+L.join("");var I=u.transceivers.every(function(k){return k.iceGatherer&&k.iceGatherer.state==="completed"});u.iceGatheringState!=="gathering"&&(u.iceGatheringState="gathering",u._emitGatheringStateChange()),w||u._dispatchEvent("icecandidate",E),I&&(u._dispatchEvent("icecandidate",new Event("icecandidate")),u.iceGatheringState="complete",u._emitGatheringStateChange())}},m.setTimeout(function(){h.forEach(function(C){g.onlocalcandidate(C)})},0)}},n.prototype._createIceAndDtlsTransports=function(){var a=this,c=new m.RTCIceTransport(null);c.onicestatechange=function(){a._updateIceConnectionState(),a._updateConnectionState()};var u=new m.RTCDtlsTransport(c);return u.ondtlsstatechange=function(){a._updateConnectionState()},u.onerror=function(){Object.defineProperty(u,"state",{value:"failed",writable:!0}),a._updateConnectionState()},{iceTransport:c,dtlsTransport:u}},n.prototype._disposeIceAndDtlsTransports=function(a){var c=this.transceivers[a].iceGatherer;c&&(delete c.onlocalcandidate,delete this.transceivers[a].iceGatherer);var u=this.transceivers[a].iceTransport;u&&(delete u.onicestatechange,delete this.transceivers[a].iceTransport);var g=this.transceivers[a].dtlsTransport;g&&(delete g.ondtlsstatechange,delete g.onerror,delete this.transceivers[a].dtlsTransport)},n.prototype._transceive=function(a,c,u){var g=p(a.localCapabilities,a.remoteCapabilities);c&&a.rtpSender&&(g.encodings=a.sendEncodingParameters,g.rtcp={cname:N.localCName,compound:a.rtcpParameters.compound},a.recvEncodingParameters.length&&(g.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(g)),u&&a.rtpReceiver&&g.codecs.length>0&&(a.kind==="video"&&a.recvEncodingParameters&&f<15019&&a.recvEncodingParameters.forEach(function(h){delete h.rtx}),a.recvEncodingParameters.length?g.encodings=a.recvEncodingParameters:g.encodings=[{}],g.rtcp={compound:a.rtcpParameters.compound},a.rtcpParameters.cname&&(g.rtcp.cname=a.rtcpParameters.cname),a.sendEncodingParameters.length&&(g.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),a.rtpReceiver.receive(g))},n.prototype.setLocalDescription=function(a){var c,u,g=this;if(["offer","answer"].indexOf(a.type)===-1)return Promise.reject(t("TypeError",'Unsupported type "'+a.type+'"'));if(!b("setLocalDescription",a.type,g.signalingState)||g._isClosed)return Promise.reject(t("InvalidStateError","Can not set local "+a.type+" in state "+g.signalingState));if(a.type==="offer")c=N.splitSections(a.sdp),u=c.shift(),c.forEach(function(C,E){var y=N.parseRtpParameters(C);g.transceivers[E].localCapabilities=y}),g.transceivers.forEach(function(C,E){g._gather(C.mid,E)});else if(a.type==="answer"){c=N.splitSections(g._remoteDescription.sdp),u=c.shift();var h=N.matchPrefix(u,"a=ice-lite").length>0;c.forEach(function(C,E){var y=g.transceivers[E],w=y.iceGatherer,O=y.iceTransport,L=y.dtlsTransport,I=y.localCapabilities,k=y.remoteCapabilities;if((!N.isRejected(C)||N.matchPrefix(C,"a=bundle-only").length!==0)&&!y.rejected){var P=N.getIceParameters(C,u),F=N.getDtlsParameters(C,u);h&&(F.role="server"),g.usingBundle&&E!==0||(g._gather(y.mid,E),O.state==="new"&&O.start(w,P,h?"controlling":"controlled"),L.state==="new"&&L.start(F));var H=p(I,k);g._transceive(y,H.codecs.length>0,!1)}})}return g._localDescription={type:a.type,sdp:a.sdp},a.type==="offer"?g._updateSignalingState("have-local-offer"):g._updateSignalingState("stable"),Promise.resolve()},n.prototype.setRemoteDescription=function(a){var c=this;if(["offer","answer"].indexOf(a.type)===-1)return Promise.reject(t("TypeError",'Unsupported type "'+a.type+'"'));if(!b("setRemoteDescription",a.type,c.signalingState)||c._isClosed)return Promise.reject(t("InvalidStateError","Can not set remote "+a.type+" in state "+c.signalingState));var u={};c.remoteStreams.forEach(function(O){u[O.id]=O});var g=[],h=N.splitSections(a.sdp),C=h.shift(),E=N.matchPrefix(C,"a=ice-lite").length>0,y=N.matchPrefix(C,"a=group:BUNDLE ").length>0;c.usingBundle=y;var w=N.matchPrefix(C,"a=ice-options:")[0];return c.canTrickleIceCandidates=!!w&&w.substr(14).split(" ").indexOf("trickle")>=0,h.forEach(function(O,L){var I=N.splitLines(O),k=N.getKind(O),P=N.isRejected(O)&&N.matchPrefix(O,"a=bundle-only").length===0,F=I[0].substr(2).split(" ")[2],H=N.getDirection(O,C),D=N.parseMsid(O),$=N.getMid(O)||N.generateIdentifier();if(P||k==="application"&&(F==="DTLS/SCTP"||F==="UDP/DTLS/SCTP"))c.transceivers[L]={mid:$,kind:k,protocol:F,rejected:!0};else{var j,V,Y,Z,J,re,ce,Re,pe;!P&&c.transceivers[L]&&c.transceivers[L].rejected&&(c.transceivers[L]=c._createTransceiver(k,!0));var Oe,te,oe=N.parseRtpParameters(O);P||(Oe=N.getIceParameters(O,C),(te=N.getDtlsParameters(O,C)).role="client"),ce=N.parseRtpEncodingParameters(O);var _e=N.parseRtcpParameters(O),we=N.matchPrefix(O,"a=end-of-candidates",C).length>0,Ee=N.matchPrefix(O,"a=candidate:").map(function(xe){return N.parseCandidate(xe)}).filter(function(xe){return xe.component===1});if((a.type==="offer"||a.type==="answer")&&!P&&y&&L>0&&c.transceivers[L]&&(c._disposeIceAndDtlsTransports(L),c.transceivers[L].iceGatherer=c.transceivers[0].iceGatherer,c.transceivers[L].iceTransport=c.transceivers[0].iceTransport,c.transceivers[L].dtlsTransport=c.transceivers[0].dtlsTransport,c.transceivers[L].rtpSender&&c.transceivers[L].rtpSender.setTransport(c.transceivers[0].dtlsTransport),c.transceivers[L].rtpReceiver&&c.transceivers[L].rtpReceiver.setTransport(c.transceivers[0].dtlsTransport)),a.type!=="offer"||P)a.type!=="answer"||P||(V=(j=c.transceivers[L]).iceGatherer,Y=j.iceTransport,Z=j.dtlsTransport,J=j.rtpReceiver,re=j.sendEncodingParameters,Re=j.localCapabilities,c.transceivers[L].recvEncodingParameters=ce,c.transceivers[L].remoteCapabilities=oe,c.transceivers[L].rtcpParameters=_e,Ee.length&&Y.state==="new"&&(!E&&!we||y&&L!==0?Ee.forEach(function(xe){_(j.iceTransport,xe)}):Y.setRemoteCandidates(Ee)),y&&L!==0||(Y.state==="new"&&Y.start(V,Oe,"controlling"),Z.state==="new"&&Z.start(te)),!p(j.localCapabilities,j.remoteCapabilities).codecs.filter(function(xe){return xe.name.toLowerCase()==="rtx"}).length&&j.sendEncodingParameters[0].rtx&&delete j.sendEncodingParameters[0].rtx,c._transceive(j,H==="sendrecv"||H==="recvonly",H==="sendrecv"||H==="sendonly"),!J||H!=="sendrecv"&&H!=="sendonly"?delete j.rtpReceiver:(pe=J.track,D?(u[D.stream]||(u[D.stream]=new m.MediaStream),o(pe,u[D.stream]),g.push([pe,J,u[D.stream]])):(u.default||(u.default=new m.MediaStream),o(pe,u.default),g.push([pe,J,u.default]))));else{(j=c.transceivers[L]||c._createTransceiver(k)).mid=$,j.iceGatherer||(j.iceGatherer=c._createIceGatherer(L,y)),Ee.length&&j.iceTransport.state==="new"&&(!we||y&&L!==0?Ee.forEach(function(xe){_(j.iceTransport,xe)}):j.iceTransport.setRemoteCandidates(Ee)),Re=m.RTCRtpReceiver.getCapabilities(k),f<15019&&(Re.codecs=Re.codecs.filter(function(xe){return xe.name!=="rtx"})),re=j.sendEncodingParameters||[{ssrc:1001*(2*L+2)}];var De,Fe=!1;H==="sendrecv"||H==="sendonly"?(Fe=!j.rtpReceiver,J=j.rtpReceiver||new m.RTCRtpReceiver(j.dtlsTransport,k),Fe&&(pe=J.track,D&&D.stream==="-"||(D?(u[D.stream]||(u[D.stream]=new m.MediaStream,Object.defineProperty(u[D.stream],"id",{get:function(){return D.stream}})),Object.defineProperty(pe,"id",{get:function(){return D.track}}),De=u[D.stream]):(u.default||(u.default=new m.MediaStream),De=u.default)),De&&(o(pe,De),j.associatedRemoteMediaStreams.push(De)),g.push([pe,J,De]))):j.rtpReceiver&&j.rtpReceiver.track&&(j.associatedRemoteMediaStreams.forEach(function(xe){var et,tt,nt=xe.getTracks().find(function(Dt){return Dt.id===j.rtpReceiver.track.id});nt&&(et=nt,(tt=xe).removeTrack(et),tt.dispatchEvent(new m.MediaStreamTrackEvent("removetrack",{track:et})))}),j.associatedRemoteMediaStreams=[]),j.localCapabilities=Re,j.remoteCapabilities=oe,j.rtpReceiver=J,j.rtcpParameters=_e,j.sendEncodingParameters=re,j.recvEncodingParameters=ce,c._transceive(c.transceivers[L],!1,Fe)}}}),c._dtlsRole===void 0&&(c._dtlsRole=a.type==="offer"?"active":"passive"),c._remoteDescription={type:a.type,sdp:a.sdp},a.type==="offer"?c._updateSignalingState("have-remote-offer"):c._updateSignalingState("stable"),Object.keys(u).forEach(function(O){var L=u[O];if(L.getTracks().length){if(c.remoteStreams.indexOf(L)===-1){c.remoteStreams.push(L);var I=new Event("addstream");I.stream=L,m.setTimeout(function(){c._dispatchEvent("addstream",I)})}g.forEach(function(k){var P=k[0],F=k[1];L.id===k[2].id&&s(c,P,F,[L])})}}),g.forEach(function(O){O[2]||s(c,O[0],O[1],[])}),m.setTimeout(function(){c&&c.transceivers&&c.transceivers.forEach(function(O){O.iceTransport&&O.iceTransport.state==="new"&&O.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),O.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},n.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop(),a.dtlsTransport&&a.dtlsTransport.stop(),a.rtpSender&&a.rtpSender.stop(),a.rtpReceiver&&a.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},n.prototype._updateSignalingState=function(a){this.signalingState=a;var c=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",c)},n.prototype._maybeFireNegotiationNeeded=function(){var a=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,m.setTimeout(function(){if(a.needNegotiation){a.needNegotiation=!1;var c=new Event("negotiationneeded");a._dispatchEvent("negotiationneeded",c)}},0))},n.prototype._updateIceConnectionState=function(){var a,c={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(g){g.iceTransport&&!g.rejected&&c[g.iceTransport.state]++}),a="new",c.failed>0?a="failed":c.checking>0?a="checking":c.disconnected>0?a="disconnected":c.new>0?a="new":c.connected>0?a="connected":c.completed>0&&(a="completed"),a!==this.iceConnectionState){this.iceConnectionState=a;var u=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",u)}},n.prototype._updateConnectionState=function(){var a,c={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(g){g.iceTransport&&g.dtlsTransport&&!g.rejected&&(c[g.iceTransport.state]++,c[g.dtlsTransport.state]++)}),c.connected+=c.completed,a="new",c.failed>0?a="failed":c.connecting>0?a="connecting":c.disconnected>0?a="disconnected":c.new>0?a="new":c.connected>0&&(a="connected"),a!==this.connectionState){this.connectionState=a;var u=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",u)}},n.prototype.createOffer=function(){var a=this;if(a._isClosed)return Promise.reject(t("InvalidStateError","Can not call createOffer after close"));var c=a.transceivers.filter(function(E){return E.kind==="audio"}).length,u=a.transceivers.filter(function(E){return E.kind==="video"}).length,g=arguments[0];if(g){if(g.mandatory||g.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");g.offerToReceiveAudio!==void 0&&(c=g.offerToReceiveAudio===!0?1:g.offerToReceiveAudio===!1?0:g.offerToReceiveAudio),g.offerToReceiveVideo!==void 0&&(u=g.offerToReceiveVideo===!0?1:g.offerToReceiveVideo===!1?0:g.offerToReceiveVideo)}for(a.transceivers.forEach(function(E){E.kind==="audio"?--c<0&&(E.wantReceive=!1):E.kind==="video"&&--u<0&&(E.wantReceive=!1)});c>0||u>0;)c>0&&(a._createTransceiver("audio"),c--),u>0&&(a._createTransceiver("video"),u--);var h=N.writeSessionBoilerplate(a._sdpSessionId,a._sdpSessionVersion++);a.transceivers.forEach(function(E,y){var w=E.track,O=E.kind,L=E.mid||N.generateIdentifier();E.mid=L,E.iceGatherer||(E.iceGatherer=a._createIceGatherer(y,a.usingBundle));var I=m.RTCRtpSender.getCapabilities(O);f<15019&&(I.codecs=I.codecs.filter(function(P){return P.name!=="rtx"})),I.codecs.forEach(function(P){P.name==="H264"&&P.parameters["level-asymmetry-allowed"]===void 0&&(P.parameters["level-asymmetry-allowed"]="1"),E.remoteCapabilities&&E.remoteCapabilities.codecs&&E.remoteCapabilities.codecs.forEach(function(F){P.name.toLowerCase()===F.name.toLowerCase()&&P.clockRate===F.clockRate&&(P.preferredPayloadType=F.payloadType)})}),I.headerExtensions.forEach(function(P){(E.remoteCapabilities&&E.remoteCapabilities.headerExtensions||[]).forEach(function(F){P.uri===F.uri&&(P.id=F.id)})});var k=E.sendEncodingParameters||[{ssrc:1001*(2*y+1)}];w&&f>=15019&&O==="video"&&!k[0].rtx&&(k[0].rtx={ssrc:k[0].ssrc+1}),E.wantReceive&&(E.rtpReceiver=new m.RTCRtpReceiver(E.dtlsTransport,O)),E.localCapabilities=I,E.sendEncodingParameters=k}),a._config.bundlePolicy!=="max-compat"&&(h+="a=group:BUNDLE "+a.transceivers.map(function(E){return E.mid}).join(" ")+`\r
`),h+=`a=ice-options:trickle\r
`,a.transceivers.forEach(function(E,y){h+=S(E,E.localCapabilities,"offer",E.stream,a._dtlsRole),h+=`a=rtcp-rsize\r
`,!E.iceGatherer||a.iceGatheringState==="new"||y!==0&&a.usingBundle||(E.iceGatherer.getLocalCandidates().forEach(function(w){w.component=1,h+="a="+N.writeCandidate(w)+`\r
`}),E.iceGatherer.state==="completed"&&(h+=`a=end-of-candidates\r
`))});var C=new m.RTCSessionDescription({type:"offer",sdp:h});return Promise.resolve(C)},n.prototype.createAnswer=function(){var a=this;if(a._isClosed)return Promise.reject(t("InvalidStateError","Can not call createAnswer after close"));if(a.signalingState!=="have-remote-offer"&&a.signalingState!=="have-local-pranswer")return Promise.reject(t("InvalidStateError","Can not call createAnswer in signalingState "+a.signalingState));var c=N.writeSessionBoilerplate(a._sdpSessionId,a._sdpSessionVersion++);a.usingBundle&&(c+="a=group:BUNDLE "+a.transceivers.map(function(h){return h.mid}).join(" ")+`\r
`),c+=`a=ice-options:trickle\r
`;var u=N.getMediaSections(a._remoteDescription.sdp).length;a.transceivers.forEach(function(h,C){if(!(C+1>u)){if(h.rejected)return h.kind==="application"?h.protocol==="DTLS/SCTP"?c+=`m=application 0 DTLS/SCTP 5000\r
`:c+="m=application 0 "+h.protocol+` webrtc-datachannel\r
`:h.kind==="audio"?c+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:h.kind==="video"&&(c+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(c+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+h.mid+`\r
`);var E;h.stream&&(h.kind==="audio"?E=h.stream.getAudioTracks()[0]:h.kind==="video"&&(E=h.stream.getVideoTracks()[0]),E&&f>=15019&&h.kind==="video"&&!h.sendEncodingParameters[0].rtx&&(h.sendEncodingParameters[0].rtx={ssrc:h.sendEncodingParameters[0].ssrc+1}));var y=p(h.localCapabilities,h.remoteCapabilities);!y.codecs.filter(function(w){return w.name.toLowerCase()==="rtx"}).length&&h.sendEncodingParameters[0].rtx&&delete h.sendEncodingParameters[0].rtx,c+=S(h,y,"answer",h.stream,a._dtlsRole),h.rtcpParameters&&h.rtcpParameters.reducedSize&&(c+=`a=rtcp-rsize\r
`)}});var g=new m.RTCSessionDescription({type:"answer",sdp:c});return Promise.resolve(g)},n.prototype.addIceCandidate=function(a){var c,u=this;return a&&a.sdpMLineIndex===void 0&&!a.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(g,h){if(!u._remoteDescription)return h(t("InvalidStateError","Can not add ICE candidate without a remote description"));if(a&&a.candidate!==""){var C=a.sdpMLineIndex;if(a.sdpMid){for(var E=0;E<u.transceivers.length;E++)if(u.transceivers[E].mid===a.sdpMid){C=E;break}}var y=u.transceivers[C];if(!y)return h(t("OperationError","Can not add ICE candidate"));if(y.rejected)return g();var w=Object.keys(a.candidate).length>0?N.parseCandidate(a.candidate):{};if(w.protocol==="tcp"&&(w.port===0||w.port===9)||w.component&&w.component!==1)return g();if((C===0||C>0&&y.iceTransport!==u.transceivers[0].iceTransport)&&!_(y.iceTransport,w))return h(t("OperationError","Can not add ICE candidate"));var O=a.candidate.trim();O.indexOf("a=")===0&&(O=O.substr(2)),(c=N.getMediaSections(u._remoteDescription.sdp))[C]+="a="+(w.type?O:"end-of-candidates")+`\r
`,u._remoteDescription.sdp=N.getDescription(u._remoteDescription.sdp)+c.join("")}else for(var L=0;L<u.transceivers.length&&(u.transceivers[L].rejected||(u.transceivers[L].iceTransport.addRemoteCandidate({}),(c=N.getMediaSections(u._remoteDescription.sdp))[L]+=`a=end-of-candidates\r
`,u._remoteDescription.sdp=N.getDescription(u._remoteDescription.sdp)+c.join(""),!u.usingBundle));L++);g()})},n.prototype.getStats=function(a){if(a&&a instanceof m.MediaStreamTrack){var c=null;if(this.transceivers.forEach(function(g){g.rtpSender&&g.rtpSender.track===a?c=g.rtpSender:g.rtpReceiver&&g.rtpReceiver.track===a&&(c=g.rtpReceiver)}),!c)throw t("InvalidAccessError","Invalid selector.");return c.getStats()}var u=[];return this.transceivers.forEach(function(g){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(h){g[h]&&u.push(g[h].getStats())})}),Promise.all(u).then(function(g){var h=new Map;return g.forEach(function(C){C.forEach(function(E){h.set(E.id,E)})}),h})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(a){var c=m[a];if(c&&c.prototype&&c.prototype.getStats){var u=c.prototype.getStats;c.prototype.getStats=function(){return u.apply(this).then(function(g){var h=new Map;return Object.keys(g).forEach(function(C){var E;g[C].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(E=g[C]).type]||E.type,h.set(C,g[C])}),h})}}});var i=["createOffer","createAnswer"];return i.forEach(function(a){var c=n.prototype[a];n.prototype[a]=function(){var u=arguments;return typeof u[0]=="function"||typeof u[1]=="function"?c.apply(this,[arguments[2]]).then(function(g){typeof u[0]=="function"&&u[0].apply(null,[g])},function(g){typeof u[1]=="function"&&u[1].apply(null,[g])}):c.apply(this,arguments)}}),(i=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(a){var c=n.prototype[a];n.prototype[a]=function(){var u=arguments;return typeof u[1]=="function"||typeof u[2]=="function"?c.apply(this,arguments).then(function(){typeof u[1]=="function"&&u[1].apply(null)},function(g){typeof u[2]=="function"&&u[2].apply(null,[g])}):c.apply(this,arguments)}}),["getStats"].forEach(function(a){var c=n.prototype[a];n.prototype[a]=function(){var u=arguments;return typeof u[1]=="function"?c.apply(this,arguments).then(function(){typeof u[1]=="function"&&u[1].apply(null)}):c.apply(this,arguments)}}),n}},{sdp:39}],35:[function(G,q,x){var N=q.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(S){return S.encoding?"rtpmap:%d %s/%s/%s":S.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(S){return S.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(S){return S.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(S){return"extmap:%d"+(S.direction?"/%s":"%v")+(S["encrypt-uri"]?" %s":"%v")+" %s"+(S.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(S){return S.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(S){var p="candidate:%s %d %s %d %s %d typ %s";return p+=S.raddr!=null?" raddr %s rport %d":"%v%v",p+=S.tcptype!=null?" tcptype %s":"%v",S.generation!=null&&(p+=" generation %d"),(p+=S["network-id"]!=null?" network-id %d":"%v")+(S["network-cost"]!=null?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(S){var p="ssrc:%d";return S.attribute!=null&&(p+=" %s",S.value!=null&&(p+=":%s")),p}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(S){return S.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(S){return S.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(S){return"imageattr:%s %s %s"+(S.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(S){return"simulcast:%s %s"+(S.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(S){return"ts-refclk:%s"+(S.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(S){var p="mediaclk:";return p+=S.id!=null?"id=%s %s":"%v%s",p+=S.mediaClockValue!=null?"=%s":"",(p+=S.rateNumerator!=null?" rate=%s":"")+(S.rateDenominator!=null?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(N).forEach(function(S){N[S].forEach(function(p){p.reg||(p.reg=/(.*)/),p.format||(p.format="%s")})})},{}],36:[function(G,q,x){var N=G("./parser"),S=G("./writer");x.write=S,x.parse=N.parse,x.parseParams=N.parseParams,x.parseFmtpConfig=N.parseFmtpConfig,x.parsePayloads=N.parsePayloads,x.parseRemoteCandidates=N.parseRemoteCandidates,x.parseImageAttributes=N.parseImageAttributes,x.parseSimulcastStreamList=N.parseSimulcastStreamList},{"./parser":37,"./writer":38}],37:[function(G,q,x){var N=function(t){return String(Number(t))===t?Number(t):t},S=function(t,m,f){var o=t.name&&t.names;t.push&&!m[t.push]?m[t.push]=[]:o&&!m[t.name]&&(m[t.name]={});var s=t.push?{}:o?m[t.name]:m;(function(n,i,a,c){if(c&&!a)i[c]=N(n[1]);else for(var u=0;u<a.length;u+=1)n[u+1]!=null&&(i[a[u]]=N(n[u+1]))})(f.match(t.reg),s,t.names,t.name),t.push&&m[t.push].push(s)},p=G("./grammar"),b=RegExp.prototype.test.bind(/^([a-z])=(.*)/);x.parse=function(t){var m={},f=[],o=m;return t.split(/(\r\n|\r|\n)/).filter(b).forEach(function(s){var n=s[0],i=s.slice(2);n==="m"&&(f.push({rtp:[],fmtp:[]}),o=f[f.length-1]);for(var a=0;a<(p[n]||[]).length;a+=1){var c=p[n][a];if(c.reg.test(i))return S(c,o,i)}}),m.media=f,m};var _=function(t,m){var f=m.split(/=(.+)/,2);return f.length===2?t[f[0]]=N(f[1]):f.length===1&&m.length>1&&(t[f[0]]=void 0),t};x.parseParams=function(t){return t.split(/;\s?/).reduce(_,{})},x.parseFmtpConfig=x.parseParams,x.parsePayloads=function(t){return t.toString().split(" ").map(Number)},x.parseRemoteCandidates=function(t){for(var m=[],f=t.split(" ").map(N),o=0;o<f.length;o+=3)m.push({component:f[o],ip:f[o+1],port:f[o+2]});return m},x.parseImageAttributes=function(t){return t.split(" ").map(function(m){return m.substring(1,m.length-1).split(",").reduce(_,{})})},x.parseSimulcastStreamList=function(t){return t.split(";").map(function(m){return m.split(",").map(function(f){var o,s=!1;return f[0]!=="~"?o=N(f):(o=N(f.substring(1,f.length)),s=!0),{scid:o,paused:s}})})}},{"./grammar":35}],38:[function(G,q,x){var N=G("./grammar"),S=/%[sdv%]/g,p=function(t,m,f){var o=[t+"="+(m.format instanceof Function?m.format(m.push?f:f[m.name]):m.format)];if(m.names)for(var s=0;s<m.names.length;s+=1){var n=m.names[s];m.name?o.push(f[m.name][n]):o.push(f[m.names[s]])}else o.push(f[m.name]);return(function(i){var a=1,c=arguments,u=c.length;return i.replace(S,function(g){if(a>=u)return g;var h=c[a];switch(a+=1,g){case"%%":return"%";case"%s":return String(h);case"%d":return Number(h);case"%v":return""}})}).apply(null,o)},b=["v","o","s","i","u","e","p","c","b","t","r","z","a"],_=["i","c","b","a"];q.exports=function(t,m){m=m||{},t.version==null&&(t.version=0),t.name==null&&(t.name=" "),t.media.forEach(function(n){n.payloads==null&&(n.payloads="")});var f=m.outerOrder||b,o=m.innerOrder||_,s=[];return f.forEach(function(n){N[n].forEach(function(i){i.name in t&&t[i.name]!=null?s.push(p(n,i,t)):i.push in t&&t[i.push]!=null&&t[i.push].forEach(function(a){s.push(p(n,i,a))})})}),t.media.forEach(function(n){s.push(p("m",N.m[0],n)),o.forEach(function(i){N[i].forEach(function(a){a.name in n&&n[a.name]!=null?s.push(p(i,a,n)):a.push in n&&n[a.push]!=null&&n[a.push].forEach(function(c){s.push(p(i,a,c))})})})}),s.join(`\r
`)+`\r
`}},{"./grammar":35}],39:[function(G,q,x){var N={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};N.localCName=N.generateIdentifier(),N.splitLines=function(S){return S.trim().split(`
`).map(function(p){return p.trim()})},N.splitSections=function(S){return S.split(`
m=`).map(function(p,b){return(b>0?"m="+p:p).trim()+`\r
`})},N.getDescription=function(S){var p=N.splitSections(S);return p&&p[0]},N.getMediaSections=function(S){var p=N.splitSections(S);return p.shift(),p},N.matchPrefix=function(S,p){return N.splitLines(S).filter(function(b){return b.indexOf(p)===0})},N.parseCandidate=function(S){for(var p,b={foundation:(p=S.indexOf("a=candidate:")===0?S.substring(12).split(" "):S.substring(10).split(" "))[0],component:parseInt(p[1],10),protocol:p[2].toLowerCase(),priority:parseInt(p[3],10),ip:p[4],address:p[4],port:parseInt(p[5],10),type:p[7]},_=8;_<p.length;_+=2)switch(p[_]){case"raddr":b.relatedAddress=p[_+1];break;case"rport":b.relatedPort=parseInt(p[_+1],10);break;case"tcptype":b.tcpType=p[_+1];break;case"ufrag":b.ufrag=p[_+1],b.usernameFragment=p[_+1];break;default:b[p[_]]=p[_+1]}return b},N.writeCandidate=function(S){var p=[];p.push(S.foundation),p.push(S.component),p.push(S.protocol.toUpperCase()),p.push(S.priority),p.push(S.address||S.ip),p.push(S.port);var b=S.type;return p.push("typ"),p.push(b),b!=="host"&&S.relatedAddress&&S.relatedPort&&(p.push("raddr"),p.push(S.relatedAddress),p.push("rport"),p.push(S.relatedPort)),S.tcpType&&S.protocol.toLowerCase()==="tcp"&&(p.push("tcptype"),p.push(S.tcpType)),(S.usernameFragment||S.ufrag)&&(p.push("ufrag"),p.push(S.usernameFragment||S.ufrag)),"candidate:"+p.join(" ")},N.parseIceOptions=function(S){return S.substr(14).split(" ")},N.parseRtpMap=function(S){var p=S.substr(9).split(" "),b={payloadType:parseInt(p.shift(),10)};return p=p[0].split("/"),b.name=p[0],b.clockRate=parseInt(p[1],10),b.channels=p.length===3?parseInt(p[2],10):1,b.numChannels=b.channels,b},N.writeRtpMap=function(S){var p=S.payloadType;S.preferredPayloadType!==void 0&&(p=S.preferredPayloadType);var b=S.channels||S.numChannels||1;return"a=rtpmap:"+p+" "+S.name+"/"+S.clockRate+(b!==1?"/"+b:"")+`\r
`},N.parseExtmap=function(S){var p=S.substr(9).split(" ");return{id:parseInt(p[0],10),direction:p[0].indexOf("/")>0?p[0].split("/")[1]:"sendrecv",uri:p[1]}},N.writeExtmap=function(S){return"a=extmap:"+(S.id||S.preferredId)+(S.direction&&S.direction!=="sendrecv"?"/"+S.direction:"")+" "+S.uri+`\r
`},N.parseFmtp=function(S){for(var p,b={},_=S.substr(S.indexOf(" ")+1).split(";"),t=0;t<_.length;t++)b[(p=_[t].trim().split("="))[0].trim()]=p[1];return b},N.writeFmtp=function(S){var p="",b=S.payloadType;if(S.preferredPayloadType!==void 0&&(b=S.preferredPayloadType),S.parameters&&Object.keys(S.parameters).length){var _=[];Object.keys(S.parameters).forEach(function(t){S.parameters[t]?_.push(t+"="+S.parameters[t]):_.push(t)}),p+="a=fmtp:"+b+" "+_.join(";")+`\r
`}return p},N.parseRtcpFb=function(S){var p=S.substr(S.indexOf(" ")+1).split(" ");return{type:p.shift(),parameter:p.join(" ")}},N.writeRtcpFb=function(S){var p="",b=S.payloadType;return S.preferredPayloadType!==void 0&&(b=S.preferredPayloadType),S.rtcpFeedback&&S.rtcpFeedback.length&&S.rtcpFeedback.forEach(function(_){p+="a=rtcp-fb:"+b+" "+_.type+(_.parameter&&_.parameter.length?" "+_.parameter:"")+`\r
`}),p},N.parseSsrcMedia=function(S){var p=S.indexOf(" "),b={ssrc:parseInt(S.substr(7,p-7),10)},_=S.indexOf(":",p);return _>-1?(b.attribute=S.substr(p+1,_-p-1),b.value=S.substr(_+1)):b.attribute=S.substr(p+1),b},N.parseSsrcGroup=function(S){var p=S.substr(13).split(" ");return{semantics:p.shift(),ssrcs:p.map(function(b){return parseInt(b,10)})}},N.getMid=function(S){var p=N.matchPrefix(S,"a=mid:")[0];if(p)return p.substr(6)},N.parseFingerprint=function(S){var p=S.substr(14).split(" ");return{algorithm:p[0].toLowerCase(),value:p[1]}},N.getDtlsParameters=function(S,p){return{role:"auto",fingerprints:N.matchPrefix(S+p,"a=fingerprint:").map(N.parseFingerprint)}},N.writeDtlsParameters=function(S,p){var b="a=setup:"+p+`\r
`;return S.fingerprints.forEach(function(_){b+="a=fingerprint:"+_.algorithm+" "+_.value+`\r
`}),b},N.parseCryptoLine=function(S){var p=S.substr(9).split(" ");return{tag:parseInt(p[0],10),cryptoSuite:p[1],keyParams:p[2],sessionParams:p.slice(3)}},N.writeCryptoLine=function(S){return"a=crypto:"+S.tag+" "+S.cryptoSuite+" "+(typeof S.keyParams=="object"?N.writeCryptoKeyParams(S.keyParams):S.keyParams)+(S.sessionParams?" "+S.sessionParams.join(" "):"")+`\r
`},N.parseCryptoKeyParams=function(S){if(S.indexOf("inline:")!==0)return null;var p=S.substr(7).split("|");return{keyMethod:"inline",keySalt:p[0],lifeTime:p[1],mkiValue:p[2]?p[2].split(":")[0]:void 0,mkiLength:p[2]?p[2].split(":")[1]:void 0}},N.writeCryptoKeyParams=function(S){return S.keyMethod+":"+S.keySalt+(S.lifeTime?"|"+S.lifeTime:"")+(S.mkiValue&&S.mkiLength?"|"+S.mkiValue+":"+S.mkiLength:"")},N.getCryptoParameters=function(S,p){return N.matchPrefix(S+p,"a=crypto:").map(N.parseCryptoLine)},N.getIceParameters=function(S,p){var b=N.matchPrefix(S+p,"a=ice-ufrag:")[0],_=N.matchPrefix(S+p,"a=ice-pwd:")[0];return b&&_?{usernameFragment:b.substr(12),password:_.substr(10)}:null},N.writeIceParameters=function(S){return"a=ice-ufrag:"+S.usernameFragment+`\r
a=ice-pwd:`+S.password+`\r
`},N.parseRtpParameters=function(S){for(var p={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},b=N.splitLines(S)[0].split(" "),_=3;_<b.length;_++){var t=b[_],m=N.matchPrefix(S,"a=rtpmap:"+t+" ")[0];if(m){var f=N.parseRtpMap(m),o=N.matchPrefix(S,"a=fmtp:"+t+" ");switch(f.parameters=o.length?N.parseFmtp(o[0]):{},f.rtcpFeedback=N.matchPrefix(S,"a=rtcp-fb:"+t+" ").map(N.parseRtcpFb),p.codecs.push(f),f.name.toUpperCase()){case"RED":case"ULPFEC":p.fecMechanisms.push(f.name.toUpperCase())}}}return N.matchPrefix(S,"a=extmap:").forEach(function(s){p.headerExtensions.push(N.parseExtmap(s))}),p},N.writeRtpDescription=function(S,p){var b="";b+="m="+S+" ",b+=p.codecs.length>0?"9":"0",b+=" UDP/TLS/RTP/SAVPF ",b+=p.codecs.map(function(t){return t.preferredPayloadType!==void 0?t.preferredPayloadType:t.payloadType}).join(" ")+`\r
`,b+=`c=IN IP4 0.0.0.0\r
`,b+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,p.codecs.forEach(function(t){b+=N.writeRtpMap(t),b+=N.writeFmtp(t),b+=N.writeRtcpFb(t)});var _=0;return p.codecs.forEach(function(t){t.maxptime>_&&(_=t.maxptime)}),_>0&&(b+="a=maxptime:"+_+`\r
`),b+=`a=rtcp-mux\r
`,p.headerExtensions&&p.headerExtensions.forEach(function(t){b+=N.writeExtmap(t)}),b},N.parseRtpEncodingParameters=function(S){var p,b=[],_=N.parseRtpParameters(S),t=_.fecMechanisms.indexOf("RED")!==-1,m=_.fecMechanisms.indexOf("ULPFEC")!==-1,f=N.matchPrefix(S,"a=ssrc:").map(function(i){return N.parseSsrcMedia(i)}).filter(function(i){return i.attribute==="cname"}),o=f.length>0&&f[0].ssrc,s=N.matchPrefix(S,"a=ssrc-group:FID").map(function(i){return i.substr(17).split(" ").map(function(a){return parseInt(a,10)})});s.length>0&&s[0].length>1&&s[0][0]===o&&(p=s[0][1]),_.codecs.forEach(function(i){if(i.name.toUpperCase()==="RTX"&&i.parameters.apt){var a={ssrc:o,codecPayloadType:parseInt(i.parameters.apt,10)};o&&p&&(a.rtx={ssrc:p}),b.push(a),t&&((a=JSON.parse(JSON.stringify(a))).fec={ssrc:o,mechanism:m?"red+ulpfec":"red"},b.push(a))}}),b.length===0&&o&&b.push({ssrc:o});var n=N.matchPrefix(S,"b=");return n.length&&(n=n[0].indexOf("b=TIAS:")===0?parseInt(n[0].substr(7),10):n[0].indexOf("b=AS:")===0?1e3*parseInt(n[0].substr(5),10)*.95-16e3:void 0,b.forEach(function(i){i.maxBitrate=n})),b},N.parseRtcpParameters=function(S){var p={},b=N.matchPrefix(S,"a=ssrc:").map(function(m){return N.parseSsrcMedia(m)}).filter(function(m){return m.attribute==="cname"})[0];b&&(p.cname=b.value,p.ssrc=b.ssrc);var _=N.matchPrefix(S,"a=rtcp-rsize");p.reducedSize=_.length>0,p.compound=_.length===0;var t=N.matchPrefix(S,"a=rtcp-mux");return p.mux=t.length>0,p},N.parseMsid=function(S){var p,b=N.matchPrefix(S,"a=msid:");if(b.length===1)return{stream:(p=b[0].substr(7).split(" "))[0],track:p[1]};var _=N.matchPrefix(S,"a=ssrc:").map(function(t){return N.parseSsrcMedia(t)}).filter(function(t){return t.attribute==="msid"});return _.length>0?{stream:(p=_[0].value.split(" "))[0],track:p[1]}:void 0},N.parseSctpDescription=function(S){var p,b=N.parseMLine(S),_=N.matchPrefix(S,"a=max-message-size:");_.length>0&&(p=parseInt(_[0].substr(19),10)),isNaN(p)&&(p=65536);var t=N.matchPrefix(S,"a=sctp-port:");if(t.length>0)return{port:parseInt(t[0].substr(12),10),protocol:b.fmt,maxMessageSize:p};if(N.matchPrefix(S,"a=sctpmap:").length>0){var m=N.matchPrefix(S,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:p}}},N.writeSctpDescription=function(S,p){var b=[];return b=S.protocol!=="DTLS/SCTP"?["m="+S.kind+" 9 "+S.protocol+" "+p.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+p.port+`\r
`]:["m="+S.kind+" 9 "+S.protocol+" "+p.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+p.port+" "+p.protocol+` 65535\r
`],p.maxMessageSize!==void 0&&b.push("a=max-message-size:"+p.maxMessageSize+`\r
`),b.join("")},N.generateSessionId=function(){return Math.random().toString().substr(2,21)},N.writeSessionBoilerplate=function(S,p,b){var _=p!==void 0?p:2;return`v=0\r
o=`+(b||"thisisadapterortc")+" "+(S||N.generateSessionId())+" "+_+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},N.writeMediaSection=function(S,p,b,_){var t=N.writeRtpDescription(S.kind,p);if(t+=N.writeIceParameters(S.iceGatherer.getLocalParameters()),t+=N.writeDtlsParameters(S.dtlsTransport.getLocalParameters(),b==="offer"?"actpass":"active"),t+="a=mid:"+S.mid+`\r
`,S.direction?t+="a="+S.direction+`\r
`:S.rtpSender&&S.rtpReceiver?t+=`a=sendrecv\r
`:S.rtpSender?t+=`a=sendonly\r
`:S.rtpReceiver?t+=`a=recvonly\r
`:t+=`a=inactive\r
`,S.rtpSender){var m="msid:"+_.id+" "+S.rtpSender.track.id+`\r
`;t+="a="+m,t+="a=ssrc:"+S.sendEncodingParameters[0].ssrc+" "+m,S.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+S.sendEncodingParameters[0].rtx.ssrc+" "+m,t+="a=ssrc-group:FID "+S.sendEncodingParameters[0].ssrc+" "+S.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return t+="a=ssrc:"+S.sendEncodingParameters[0].ssrc+" cname:"+N.localCName+`\r
`,S.rtpSender&&S.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+S.sendEncodingParameters[0].rtx.ssrc+" cname:"+N.localCName+`\r
`),t},N.getDirection=function(S,p){for(var b=N.splitLines(S),_=0;_<b.length;_++)switch(b[_]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return b[_].substr(2)}return p?N.getDirection(p):"sendrecv"},N.getKind=function(S){return N.splitLines(S)[0].split(" ")[0].substr(2)},N.isRejected=function(S){return S.split(" ",2)[1]==="0"},N.parseMLine=function(S){var p=N.splitLines(S)[0].substr(2).split(" ");return{kind:p[0],port:parseInt(p[1],10),protocol:p[2],fmt:p.slice(3).join(" ")}},N.parseOLine=function(S){var p=N.matchPrefix(S,"o=")[0].substr(2).split(" ");return{username:p[0],sessionId:p[1],sessionVersion:parseInt(p[2],10),netType:p[3],addressType:p[4],address:p[5]}},N.isValidSDP=function(S){if(typeof S!="string"||S.length===0)return!1;for(var p=N.splitLines(S),b=0;b<p.length;b++)if(p[b].length<2||p[b].charAt(1)!=="=")return!1;return!0},typeof q=="object"&&(q.exports=N)},{}],40:[function(G,q,x){Object.defineProperty(x,"__esModule",{value:!0});var N=(0,G("./adapter_factory.js").adapterFactory)({window:typeof window>"u"?void 0:window});x.default=N},{"./adapter_factory.js":41}],41:[function(G,q,x){Object.defineProperty(x,"__esModule",{value:!0}),x.adapterFactory=function(){var f=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).window,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},s=N.log,n=N.detectBrowser(f),i={browserDetails:n,commonShim:t,extractVersion:N.extractVersion,disableLog:N.disableLog,disableWarnings:N.disableWarnings};switch(n.browser){case"chrome":if(!S||!S.shimPeerConnection||!o.shimChrome)return s("Chrome shim is not included in this adapter release."),i;if(n.version===null)return s("Chrome shim can not determine version, not shimming."),i;s("adapter.js shimming chrome."),i.browserShim=S,t.shimAddIceCandidateNullOrEmpty(f,n),S.shimGetUserMedia(f,n),S.shimMediaStream(f,n),S.shimPeerConnection(f,n),S.shimOnTrack(f,n),S.shimAddTrackRemoveTrack(f,n),S.shimGetSendersWithDtmf(f,n),S.shimGetStats(f,n),S.shimSenderReceiverGetStats(f,n),S.fixNegotiationNeeded(f,n),t.shimRTCIceCandidate(f,n),t.shimConnectionState(f,n),t.shimMaxMessageSize(f,n),t.shimSendThrowTypeError(f,n),t.removeExtmapAllowMixed(f,n);break;case"firefox":if(!b||!b.shimPeerConnection||!o.shimFirefox)return s("Firefox shim is not included in this adapter release."),i;s("adapter.js shimming firefox."),i.browserShim=b,t.shimAddIceCandidateNullOrEmpty(f,n),b.shimGetUserMedia(f,n),b.shimPeerConnection(f,n),b.shimOnTrack(f,n),b.shimRemoveStream(f,n),b.shimSenderGetStats(f,n),b.shimReceiverGetStats(f,n),b.shimRTCDataChannel(f,n),b.shimAddTransceiver(f,n),b.shimGetParameters(f,n),b.shimCreateOffer(f,n),b.shimCreateAnswer(f,n),t.shimRTCIceCandidate(f,n),t.shimConnectionState(f,n),t.shimMaxMessageSize(f,n),t.shimSendThrowTypeError(f,n);break;case"edge":if(!p||!p.shimPeerConnection||!o.shimEdge)return s("MS edge shim is not included in this adapter release."),i;s("adapter.js shimming edge."),i.browserShim=p,p.shimGetUserMedia(f,n),p.shimGetDisplayMedia(f,n),p.shimPeerConnection(f,n),p.shimReplaceTrack(f,n),t.shimMaxMessageSize(f,n),t.shimSendThrowTypeError(f,n);break;case"safari":if(!_||!o.shimSafari)return s("Safari shim is not included in this adapter release."),i;s("adapter.js shimming safari."),i.browserShim=_,t.shimAddIceCandidateNullOrEmpty(f,n),_.shimRTCIceServerUrls(f,n),_.shimCreateOfferLegacy(f,n),_.shimCallbacksAPI(f,n),_.shimLocalStreamsAPI(f,n),_.shimRemoteStreamsAPI(f,n),_.shimTrackEventTransceiver(f,n),_.shimGetUserMedia(f,n),_.shimAudioContext(f,n),t.shimRTCIceCandidate(f,n),t.shimMaxMessageSize(f,n),t.shimSendThrowTypeError(f,n),t.removeExtmapAllowMixed(f,n);break;default:s("Unsupported browser!")}return i};var N=m(G("./utils")),S=m(G("./chrome/chrome_shim")),p=m(G("./edge/edge_shim")),b=m(G("./firefox/firefox_shim")),_=m(G("./safari/safari_shim")),t=m(G("./common_shim"));function m(f){if(f&&f.__esModule)return f;var o={};if(f!=null)for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(o[s]=f[s]);return o.default=f,o}},{"./chrome/chrome_shim":42,"./common_shim":45,"./edge/edge_shim":46,"./firefox/firefox_shim":50,"./safari/safari_shim":53,"./utils":54}],42:[function(G,q,x){Object.defineProperty(x,"__esModule",{value:!0}),x.shimGetDisplayMedia=x.shimGetUserMedia=void 0;var N=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},S=G("./getusermedia");Object.defineProperty(x,"shimGetUserMedia",{enumerable:!0,get:function(){return S.shimGetUserMedia}});var p=G("./getdisplaymedia");Object.defineProperty(x,"shimGetDisplayMedia",{enumerable:!0,get:function(){return p.shimGetDisplayMedia}}),x.shimMediaStream=function(m){m.MediaStream=m.MediaStream||m.webkitMediaStream},x.shimOnTrack=function(m){if((m===void 0?"undefined":N(m))!=="object"||!m.RTCPeerConnection||"ontrack"in m.RTCPeerConnection.prototype)b.wrapPeerConnectionEvent(m,"track",function(o){return o.transceiver||Object.defineProperty(o,"transceiver",{value:{receiver:o.receiver}}),o});else{Object.defineProperty(m.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(o){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=o)},enumerable:!0,configurable:!0});var f=m.RTCPeerConnection.prototype.setRemoteDescription;m.RTCPeerConnection.prototype.setRemoteDescription=function(){var o=this;return this._ontrackpoly||(this._ontrackpoly=function(s){s.stream.addEventListener("addtrack",function(n){var i=void 0;i=m.RTCPeerConnection.prototype.getReceivers?o.getReceivers().find(function(c){return c.track&&c.track.id===n.track.id}):{track:n.track};var a=new Event("track");a.track=n.track,a.receiver=i,a.transceiver={receiver:i},a.streams=[s.stream],o.dispatchEvent(a)}),s.stream.getTracks().forEach(function(n){var i=void 0;i=m.RTCPeerConnection.prototype.getReceivers?o.getReceivers().find(function(c){return c.track&&c.track.id===n.id}):{track:n};var a=new Event("track");a.track=n,a.receiver=i,a.transceiver={receiver:i},a.streams=[s.stream],o.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),f.apply(this,arguments)}}},x.shimGetSendersWithDtmf=function(m){if((m===void 0?"undefined":N(m))==="object"&&m.RTCPeerConnection&&!("getSenders"in m.RTCPeerConnection.prototype)&&"createDTMFSender"in m.RTCPeerConnection.prototype){var f=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!m.RTCPeerConnection.prototype.getSenders){m.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var o=m.RTCPeerConnection.prototype.addTrack;m.RTCPeerConnection.prototype.addTrack=function(c,u){var g=o.apply(this,arguments);return g||(g=f(this,c),this._senders.push(g)),g};var s=m.RTCPeerConnection.prototype.removeTrack;m.RTCPeerConnection.prototype.removeTrack=function(c){s.apply(this,arguments);var u=this._senders.indexOf(c);u!==-1&&this._senders.splice(u,1)}}var n=m.RTCPeerConnection.prototype.addStream;m.RTCPeerConnection.prototype.addStream=function(c){var u=this;this._senders=this._senders||[],n.apply(this,[c]),c.getTracks().forEach(function(g){u._senders.push(f(u,g))})};var i=m.RTCPeerConnection.prototype.removeStream;m.RTCPeerConnection.prototype.removeStream=function(c){var u=this;this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(function(g){var h=u._senders.find(function(C){return C.track===g});h&&u._senders.splice(u._senders.indexOf(h),1)})}}else if((m===void 0?"undefined":N(m))==="object"&&m.RTCPeerConnection&&"getSenders"in m.RTCPeerConnection.prototype&&"createDTMFSender"in m.RTCPeerConnection.prototype&&m.RTCRtpSender&&!("dtmf"in m.RTCRtpSender.prototype)){var a=m.RTCPeerConnection.prototype.getSenders;m.RTCPeerConnection.prototype.getSenders=function(){var c=this,u=a.apply(this,[]);return u.forEach(function(g){return g._pc=c}),u},Object.defineProperty(m.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},x.shimGetStats=function(m){if(m.RTCPeerConnection){var f=m.RTCPeerConnection.prototype.getStats;m.RTCPeerConnection.prototype.getStats=function(){var o=this,s=Array.prototype.slice.call(arguments),n=s[0],i=s[1],a=s[2];if(arguments.length>0&&typeof n=="function")return f.apply(this,arguments);if(f.length===0&&(arguments.length===0||typeof n!="function"))return f.apply(this,[]);var c=function(g){var h={};return g.result().forEach(function(C){var E={id:C.id,timestamp:C.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[C.type]||C.type};C.names().forEach(function(y){E[y]=C.stat(y)}),h[E.id]=E}),h},u=function(g){return new Map(Object.keys(g).map(function(h){return[h,g[h]]}))};return arguments.length>=2?f.apply(this,[function(g){i(u(c(g)))},n]):new Promise(function(g,h){f.apply(o,[function(C){g(u(c(C)))},h])}).then(i,a)}}},x.shimSenderReceiverGetStats=function(m){if((m===void 0?"undefined":N(m))==="object"&&m.RTCPeerConnection&&m.RTCRtpSender&&m.RTCRtpReceiver){if(!("getStats"in m.RTCRtpSender.prototype)){var f=m.RTCPeerConnection.prototype.getSenders;f&&(m.RTCPeerConnection.prototype.getSenders=function(){var i=this,a=f.apply(this,[]);return a.forEach(function(c){return c._pc=i}),a});var o=m.RTCPeerConnection.prototype.addTrack;o&&(m.RTCPeerConnection.prototype.addTrack=function(){var i=o.apply(this,arguments);return i._pc=this,i}),m.RTCRtpSender.prototype.getStats=function(){var i=this;return this._pc.getStats().then(function(a){return b.filterStats(a,i.track,!0)})}}if(!("getStats"in m.RTCRtpReceiver.prototype)){var s=m.RTCPeerConnection.prototype.getReceivers;s&&(m.RTCPeerConnection.prototype.getReceivers=function(){var i=this,a=s.apply(this,[]);return a.forEach(function(c){return c._pc=i}),a}),b.wrapPeerConnectionEvent(m,"track",function(i){return i.receiver._pc=i.srcElement,i}),m.RTCRtpReceiver.prototype.getStats=function(){var i=this;return this._pc.getStats().then(function(a){return b.filterStats(a,i.track,!1)})}}if("getStats"in m.RTCRtpSender.prototype&&"getStats"in m.RTCRtpReceiver.prototype){var n=m.RTCPeerConnection.prototype.getStats;m.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof m.MediaStreamTrack){var i=arguments[0],a=void 0,c=void 0,u=void 0;return this.getSenders().forEach(function(g){g.track===i&&(a?u=!0:a=g)}),this.getReceivers().forEach(function(g){return g.track===i&&(c?u=!0:c=g),g.track===i}),u||a&&c?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():c?c.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}}},x.shimAddTrackRemoveTrackWithNative=t,x.shimAddTrackRemoveTrack=function(m,f){if(m.RTCPeerConnection){if(m.RTCPeerConnection.prototype.addTrack&&f.version>=65)return t(m);var o=m.RTCPeerConnection.prototype.getLocalStreams;m.RTCPeerConnection.prototype.getLocalStreams=function(){var u=this,g=o.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map(function(h){return u._reverseStreams[h.id]})};var s=m.RTCPeerConnection.prototype.addStream;m.RTCPeerConnection.prototype.addStream=function(u){var g=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(function(C){if(g.getSenders().find(function(E){return E.track===C}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){var h=new m.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}s.apply(this,[u])};var n=m.RTCPeerConnection.prototype.removeStream;m.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},m.RTCPeerConnection.prototype.addTrack=function(u,g){var h=this;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var C=[].slice.call(arguments,1);if(C.length!==1||!C[0].getTracks().find(function(w){return w===u}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(w){return w.track===u}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var E=this._streams[g.id];if(E)E.addTrack(u),Promise.resolve().then(function(){h.dispatchEvent(new Event("negotiationneeded"))});else{var y=new m.MediaStream([u]);this._streams[g.id]=y,this._reverseStreams[y.id]=g,this.addStream(y)}return this.getSenders().find(function(w){return w.track===u})},["createOffer","createAnswer"].forEach(function(u){var g=m.RTCPeerConnection.prototype[u],h=_({},u,function(){var C=this,E=arguments;return arguments.length&&typeof arguments[0]=="function"?g.apply(this,[function(y){var w=c(C,y);E[0].apply(null,[w])},function(y){E[1]&&E[1].apply(null,y)},arguments[2]]):g.apply(this,arguments).then(function(y){return c(C,y)})});m.RTCPeerConnection.prototype[u]=h[u]});var i=m.RTCPeerConnection.prototype.setLocalDescription;m.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(u=this,h=(g=arguments[0]).sdp,Object.keys(u._reverseStreams||[]).forEach(function(C){var E=u._reverseStreams[C],y=u._streams[E.id];h=h.replace(new RegExp(E.id,"g"),y.id)}),new RTCSessionDescription({type:g.type,sdp:h})),i.apply(this,arguments)):i.apply(this,arguments);var u,g,h};var a=Object.getOwnPropertyDescriptor(m.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(m.RTCPeerConnection.prototype,"localDescription",{get:function(){var u=a.get.apply(this);return u.type===""?u:c(this,u)}}),m.RTCPeerConnection.prototype.removeTrack=function(u){var g=this;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(u._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var h=void 0;Object.keys(this._streams).forEach(function(C){g._streams[C].getTracks().find(function(E){return u.track===E})&&(h=g._streams[C])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function c(u,g){var h=g.sdp;return Object.keys(u._reverseStreams||[]).forEach(function(C){var E=u._reverseStreams[C],y=u._streams[E.id];h=h.replace(new RegExp(y.id,"g"),E.id)}),new RTCSessionDescription({type:g.type,sdp:h})}},x.shimPeerConnection=function(m,f){!m.RTCPeerConnection&&m.webkitRTCPeerConnection&&(m.RTCPeerConnection=m.webkitRTCPeerConnection),m.RTCPeerConnection&&f.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){var s=m.RTCPeerConnection.prototype[o],n=_({},o,function(){return arguments[0]=new(o==="addIceCandidate"?m.RTCIceCandidate:m.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)});m.RTCPeerConnection.prototype[o]=n[o]})},x.fixNegotiationNeeded=function(m,f){b.wrapPeerConnectionEvent(m,"negotiationneeded",function(o){var s=o.target;if(!(f.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")||s.signalingState==="stable")return o})};var b=function(m){if(m&&m.__esModule)return m;var f={};if(m!=null)for(var o in m)Object.prototype.hasOwnProperty.call(m,o)&&(f[o]=m[o]);return f.default=m,f}(G("../utils.js"));function _(m,f,o){return f in m?Object.defineProperty(m,f,{value:o,enumerable:!0,configurable:!0,writable:!0}):m[f]=o,m}function t(m){m.RTCPeerConnection.prototype.getLocalStreams=function(){var i=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(a){return i._shimmedLocalStreams[a][0]})};var f=m.RTCPeerConnection.prototype.addTrack;m.RTCPeerConnection.prototype.addTrack=function(i,a){if(!a)return f.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var c=f.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};var o=m.RTCPeerConnection.prototype.addStream;m.RTCPeerConnection.prototype.addStream=function(i){var a=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},i.getTracks().forEach(function(g){if(a.getSenders().find(function(h){return h.track===g}))throw new DOMException("Track already exists.","InvalidAccessError")});var c=this.getSenders();o.apply(this,arguments);var u=this.getSenders().filter(function(g){return c.indexOf(g)===-1});this._shimmedLocalStreams[i.id]=[i].concat(u)};var s=m.RTCPeerConnection.prototype.removeStream;m.RTCPeerConnection.prototype.removeStream=function(i){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[i.id],s.apply(this,arguments)};var n=m.RTCPeerConnection.prototype.removeTrack;m.RTCPeerConnection.prototype.removeTrack=function(i){var a=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},i&&Object.keys(this._shimmedLocalStreams).forEach(function(c){var u=a._shimmedLocalStreams[c].indexOf(i);u!==-1&&a._shimmedLocalStreams[c].splice(u,1),a._shimmedLocalStreams[c].length===1&&delete a._shimmedLocalStreams[c]}),n.apply(this,arguments)}}},{"../utils.js":54,"./getdisplaymedia":43,"./getusermedia":44}],43:[function(G,q,x){Object.defineProperty(x,"__esModule",{value:!0}),x.shimGetDisplayMedia=function(N,S){N.navigator.mediaDevices&&"getDisplayMedia"in N.navigator.mediaDevices||N.navigator.mediaDevices&&(typeof S=="function"?N.navigator.mediaDevices.getDisplayMedia=function(p){return S(p).then(function(b){var _=p.video&&p.video.width,t=p.video&&p.video.height,m=p.video&&p.video.frameRate;return p.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:b,maxFrameRate:m||3}},_&&(p.video.mandatory.maxWidth=_),t&&(p.video.mandatory.maxHeight=t),N.navigator.mediaDevices.getUserMedia(p)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},{}],44:[function(G,q,x){Object.defineProperty(x,"__esModule",{value:!0});var N=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p};x.shimGetUserMedia=function(p,b){var _=p&&p.navigator;if(_.mediaDevices){var t=function(s){if((s===void 0?"undefined":N(s))!=="object"||s.mandatory||s.optional)return s;var n={};return Object.keys(s).forEach(function(i){if(i!=="require"&&i!=="advanced"&&i!=="mediaSource"){var a=N(s[i])==="object"?s[i]:{ideal:s[i]};a.exact!==void 0&&typeof a.exact=="number"&&(a.min=a.max=a.exact);var c=function(g,h){return g?g+h.charAt(0).toUpperCase()+h.slice(1):h==="deviceId"?"sourceId":h};if(a.ideal!==void 0){n.optional=n.optional||[];var u={};typeof a.ideal=="number"?(u[c("min",i)]=a.ideal,n.optional.push(u),(u={})[c("max",i)]=a.ideal,n.optional.push(u)):(u[c("",i)]=a.ideal,n.optional.push(u))}a.exact!==void 0&&typeof a.exact!="number"?(n.mandatory=n.mandatory||{},n.mandatory[c("",i)]=a.exact):["min","max"].forEach(function(g){a[g]!==void 0&&(n.mandatory=n.mandatory||{},n.mandatory[c(g,i)]=a[g])})}}),s.advanced&&(n.optional=(n.optional||[]).concat(s.advanced)),n},m=function(s,n){if(b.version>=61)return n(s);if((s=JSON.parse(JSON.stringify(s)))&&N(s.audio)==="object"){var i=function(g,h,C){h in g&&!(C in g)&&(g[C]=g[h],delete g[h])};i((s=JSON.parse(JSON.stringify(s))).audio,"autoGainControl","googAutoGainControl"),i(s.audio,"noiseSuppression","googNoiseSuppression"),s.audio=t(s.audio)}if(s&&N(s.video)==="object"){var a=s.video.facingMode;a=a&&((a===void 0?"undefined":N(a))==="object"?a:{ideal:a});var c=b.version<66;if(a&&(a.exact==="user"||a.exact==="environment"||a.ideal==="user"||a.ideal==="environment")&&(!_.mediaDevices.getSupportedConstraints||!_.mediaDevices.getSupportedConstraints().facingMode||c)){delete s.video.facingMode;var u=void 0;if(a.exact==="environment"||a.ideal==="environment"?u=["back","rear"]:a.exact!=="user"&&a.ideal!=="user"||(u=["front"]),u)return _.mediaDevices.enumerateDevices().then(function(g){var h=(g=g.filter(function(C){return C.kind==="videoinput"})).find(function(C){return u.some(function(E){return C.label.toLowerCase().includes(E)})});return!h&&g.length&&u.includes("back")&&(h=g[g.length-1]),h&&(s.video.deviceId=a.exact?{exact:h.deviceId}:{ideal:h.deviceId}),s.video=t(s.video),S("chrome: "+JSON.stringify(s)),n(s)})}s.video=t(s.video)}return S("chrome: "+JSON.stringify(s)),n(s)},f=function(s){return b.version>=64?s:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[s.name]||s.name,message:s.message,constraint:s.constraint||s.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(_.getUserMedia=(function(s,n,i){m(s,function(a){_.webkitGetUserMedia(a,n,function(c){i&&i(f(c))})})}).bind(_),_.mediaDevices.getUserMedia){var o=_.mediaDevices.getUserMedia.bind(_.mediaDevices);_.mediaDevices.getUserMedia=function(s){return m(s,function(n){return o(n).then(function(i){if(n.audio&&!i.getAudioTracks().length||n.video&&!i.getVideoTracks().length)throw i.getTracks().forEach(function(a){a.stop()}),new DOMException("","NotFoundError");return i},function(i){return Promise.reject(f(i))})})}}}};var S=function(p){if(p&&p.__esModule)return p;var b={};if(p!=null)for(var _ in p)Object.prototype.hasOwnProperty.call(p,_)&&(b[_]=p[_]);return b.default=p,b}(G("../utils.js")).log},{"../utils.js":54}],45:[function(G,q,x){Object.defineProperty(x,"__esModule",{value:!0});var N=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _};x.shimRTCIceCandidate=function(_){if(!(!_.RTCIceCandidate||_.RTCIceCandidate&&"foundation"in _.RTCIceCandidate.prototype)){var t=_.RTCIceCandidate;_.RTCIceCandidate=function(m){if((m===void 0?"undefined":N(m))==="object"&&m.candidate&&m.candidate.indexOf("a=")===0&&((m=JSON.parse(JSON.stringify(m))).candidate=m.candidate.substr(2)),m.candidate&&m.candidate.length){var f=new t(m),o=p.default.parseCandidate(m.candidate),s=Object.assign(f,o);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(m)},_.RTCIceCandidate.prototype=t.prototype,b.wrapPeerConnectionEvent(_,"icecandidate",function(m){return m.candidate&&Object.defineProperty(m,"candidate",{value:new _.RTCIceCandidate(m.candidate),writable:"false"}),m})}},x.shimMaxMessageSize=function(_,t){if(_.RTCPeerConnection){"sctp"in _.RTCPeerConnection.prototype||Object.defineProperty(_.RTCPeerConnection.prototype,"sctp",{get:function(){return this._sctp===void 0?null:this._sctp}});var m=_.RTCPeerConnection.prototype.setRemoteDescription;_.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76&&this.getConfiguration().sdpSemantics==="plan-b"&&Object.defineProperty(this,"sctp",{get:function(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0}),function(a){if(!a||!a.sdp)return!1;var c=p.default.splitSections(a.sdp);return c.shift(),c.some(function(u){var g=p.default.parseMLine(u);return g&&g.kind==="application"&&g.protocol.indexOf("SCTP")!==-1})}(arguments[0])){var f=function(a){var c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;var u=parseInt(c[1],10);return u!=u?-1:u}(arguments[0]),o=function(a){var c=65536;return t.browser==="firefox"&&(c=t.version<57?a===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),c}(f),s=function(a,c){var u=65536;t.browser==="firefox"&&t.version===57&&(u=65535);var g=p.default.matchPrefix(a.sdp,"a=max-message-size:");return g.length>0?u=parseInt(g[0].substr(19),10):t.browser==="firefox"&&c!==-1&&(u=2147483637),u}(arguments[0],f),n=void 0;n=o===0&&s===0?Number.POSITIVE_INFINITY:o===0||s===0?Math.max(o,s):Math.min(o,s);var i={};Object.defineProperty(i,"maxMessageSize",{get:function(){return n}}),this._sctp=i}return m.apply(this,arguments)}}},x.shimSendThrowTypeError=function(_){if(_.RTCPeerConnection&&"createDataChannel"in _.RTCPeerConnection.prototype){var t=_.RTCPeerConnection.prototype.createDataChannel;_.RTCPeerConnection.prototype.createDataChannel=function(){var f=t.apply(this,arguments);return m(f,this),f},b.wrapPeerConnectionEvent(_,"datachannel",function(f){return m(f.channel,f.target),f})}function m(f,o){var s=f.send;f.send=function(){var n=arguments[0],i=n.length||n.size||n.byteLength;if(f.readyState==="open"&&o.sctp&&i>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return s.apply(f,arguments)}}},x.shimConnectionState=function(_){if(_.RTCPeerConnection&&!("connectionState"in _.RTCPeerConnection.prototype)){var t=_.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(m){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),m&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=m)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(m){var f=t[m];t[m]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(o){var s=o.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;var n=new Event("connectionstatechange",o);s.dispatchEvent(n)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),f.apply(this,arguments)}})}},x.removeExtmapAllowMixed=function(_,t){if(_.RTCPeerConnection&&!(t.browser==="chrome"&&t.version>=71)&&!(t.browser==="safari"&&t.version>=605)){var m=_.RTCPeerConnection.prototype.setRemoteDescription;_.RTCPeerConnection.prototype.setRemoteDescription=function(f){if(f&&f.sdp&&f.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){var o=f.sdp.split(`
`).filter(function(s){return s.trim()!=="a=extmap-allow-mixed"}).join(`
`);_.RTCSessionDescription&&f instanceof _.RTCSessionDescription?arguments[0]=new _.RTCSessionDescription({type:f.type,sdp:o}):f.sdp=o}return m.apply(this,arguments)}}},x.shimAddIceCandidateNullOrEmpty=function(_,t){if(_.RTCPeerConnection&&_.RTCPeerConnection.prototype){var m=_.RTCPeerConnection.prototype.addIceCandidate;m&&m.length!==0&&(_.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():m.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}};var S,p=(S=G("sdp"))&&S.__esModule?S:{default:S},b=function(_){if(_&&_.__esModule)return _;var t={};if(_!=null)for(var m in _)Object.prototype.hasOwnProperty.call(_,m)&&(t[m]=_[m]);return t.default=_,t}(G("./utils"))},{"./utils":54,sdp:39}],46:[function(G,q,x){Object.defineProperty(x,"__esModule",{value:!0}),x.shimGetDisplayMedia=x.shimGetUserMedia=void 0;var N=G("./getusermedia");Object.defineProperty(x,"shimGetUserMedia",{enumerable:!0,get:function(){return N.shimGetUserMedia}});var S=G("./getdisplaymedia");Object.defineProperty(x,"shimGetDisplayMedia",{enumerable:!0,get:function(){return S.shimGetDisplayMedia}}),x.shimPeerConnection=function(m,f){if(m.RTCIceGatherer&&(m.RTCIceCandidate||(m.RTCIceCandidate=function(n){return n}),m.RTCSessionDescription||(m.RTCSessionDescription=function(n){return n}),f.version<15025)){var o=Object.getOwnPropertyDescriptor(m.MediaStreamTrack.prototype,"enabled");Object.defineProperty(m.MediaStreamTrack.prototype,"enabled",{set:function(n){o.set.call(this,n);var i=new Event("enabled");i.enabled=n,this.dispatchEvent(i)}})}!m.RTCRtpSender||"dtmf"in m.RTCRtpSender.prototype||Object.defineProperty(m.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new m.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),m.RTCDtmfSender&&!m.RTCDTMFSender&&(m.RTCDTMFSender=m.RTCDtmfSender);var s=(0,t.default)(m,f.version);m.RTCPeerConnection=function(n){return n&&n.iceServers&&(n.iceServers=(0,_.filterIceServers)(n.iceServers,f.version),b.log("ICE servers after filtering:",n.iceServers)),new s(n)},m.RTCPeerConnection.prototype=s.prototype},x.shimReplaceTrack=function(m){!m.RTCRtpSender||"replaceTrack"in m.RTCRtpSender.prototype||(m.RTCRtpSender.prototype.replaceTrack=m.RTCRtpSender.prototype.setTrack)};var p,b=function(m){if(m&&m.__esModule)return m;var f={};if(m!=null)for(var o in m)Object.prototype.hasOwnProperty.call(m,o)&&(f[o]=m[o]);return f.default=m,f}(G("../utils")),_=G("./filtericeservers"),t=(p=G("rtcpeerconnection-shim"))&&p.__esModule?p:{default:p}},{"../utils":54,"./filtericeservers":47,"./getdisplaymedia":48,"./getusermedia":49,"rtcpeerconnection-shim":34}],47:[function(G,q,x){Object.defineProperty(x,"__esModule",{value:!0}),x.filterIceServers=function(S,p){var b=!1;return(S=JSON.parse(JSON.stringify(S))).filter(function(_){if(_&&(_.urls||_.url)){var t=_.urls||_.url;_.url&&!_.urls&&N.deprecated("RTCIceServer.url","RTCIceServer.urls");var m=typeof t=="string";return m&&(t=[t]),t=t.filter(function(f){if(f.indexOf("stun:")===0)return!1;var o=f.startsWith("turn")&&!f.startsWith("turn:[")&&f.includes("transport=udp");return o&&!b?(b=!0,!0):o&&!b}),delete _.url,_.urls=m?t[0]:t,!!t.length}})};var N=function(S){if(S&&S.__esModule)return S;var p={};if(S!=null)for(var b in S)Object.prototype.hasOwnProperty.call(S,b)&&(p[b]=S[b]);return p.default=S,p}(G("../utils"))},{"../utils":54}],48:[function(G,q,x){Object.defineProperty(x,"__esModule",{value:!0}),x.shimGetDisplayMedia=function(N){"getDisplayMedia"in N.navigator&&N.navigator.mediaDevices&&(N.navigator.mediaDevices&&"getDisplayMedia"in N.navigator.mediaDevices||(N.navigator.mediaDevices.getDisplayMedia=N.navigator.getDisplayMedia.bind(N.navigator)))}},{}],49:[function(G,q,x){Object.defineProperty(x,"__esModule",{value:!0}),x.shimGetUserMedia=function(N){var S=N&&N.navigator,p=S.mediaDevices.getUserMedia.bind(S.mediaDevices);S.mediaDevices.getUserMedia=function(b){return p(b).catch(function(_){return Promise.reject(function(t){return{name:{PermissionDeniedError:"NotAllowedError"}[t.name]||t.name,message:t.message,constraint:t.constraint,toString:function(){return this.name}}}(_))})}}},{}],50:[function(G,q,x){Object.defineProperty(x,"__esModule",{value:!0}),x.shimGetDisplayMedia=x.shimGetUserMedia=void 0;var N=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},S=G("./getusermedia");Object.defineProperty(x,"shimGetUserMedia",{enumerable:!0,get:function(){return S.shimGetUserMedia}});var p=G("./getdisplaymedia");Object.defineProperty(x,"shimGetDisplayMedia",{enumerable:!0,get:function(){return p.shimGetDisplayMedia}}),x.shimOnTrack=function(_){(_===void 0?"undefined":N(_))==="object"&&_.RTCTrackEvent&&"receiver"in _.RTCTrackEvent.prototype&&!("transceiver"in _.RTCTrackEvent.prototype)&&Object.defineProperty(_.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},x.shimPeerConnection=function(_,t){if((_===void 0?"undefined":N(_))==="object"&&(_.RTCPeerConnection||_.mozRTCPeerConnection)){!_.RTCPeerConnection&&_.mozRTCPeerConnection&&(_.RTCPeerConnection=_.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){var s=_.RTCPeerConnection.prototype[o],n=function(i,a,c){return a in i?Object.defineProperty(i,a,{value:c,enumerable:!0,configurable:!0,writable:!0}):i[a]=c,i}({},o,function(){return arguments[0]=new(o==="addIceCandidate"?_.RTCIceCandidate:_.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)});_.RTCPeerConnection.prototype[o]=n[o]});var m={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},f=_.RTCPeerConnection.prototype.getStats;_.RTCPeerConnection.prototype.getStats=function(){var o=Array.prototype.slice.call(arguments),s=o[0],n=o[1],i=o[2];return f.apply(this,[s||null]).then(function(a){if(t.version<53&&!n)try{a.forEach(function(c){c.type=m[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;a.forEach(function(u,g){a.set(g,Object.assign({},u,{type:m[u.type]||u.type}))})}return a}).then(n,i)}}},x.shimSenderGetStats=function(_){if((_===void 0?"undefined":N(_))==="object"&&_.RTCPeerConnection&&_.RTCRtpSender&&(!_.RTCRtpSender||!("getStats"in _.RTCRtpSender.prototype))){var t=_.RTCPeerConnection.prototype.getSenders;t&&(_.RTCPeerConnection.prototype.getSenders=function(){var f=this,o=t.apply(this,[]);return o.forEach(function(s){return s._pc=f}),o});var m=_.RTCPeerConnection.prototype.addTrack;m&&(_.RTCPeerConnection.prototype.addTrack=function(){var f=m.apply(this,arguments);return f._pc=this,f}),_.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},x.shimReceiverGetStats=function(_){if((_===void 0?"undefined":N(_))==="object"&&_.RTCPeerConnection&&_.RTCRtpSender&&(!_.RTCRtpSender||!("getStats"in _.RTCRtpReceiver.prototype))){var t=_.RTCPeerConnection.prototype.getReceivers;t&&(_.RTCPeerConnection.prototype.getReceivers=function(){var m=this,f=t.apply(this,[]);return f.forEach(function(o){return o._pc=m}),f}),b.wrapPeerConnectionEvent(_,"track",function(m){return m.receiver._pc=m.srcElement,m}),_.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},x.shimRemoveStream=function(_){_.RTCPeerConnection&&!("removeStream"in _.RTCPeerConnection.prototype)&&(_.RTCPeerConnection.prototype.removeStream=function(t){var m=this;b.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(f){f.track&&t.getTracks().includes(f.track)&&m.removeTrack(f)})})},x.shimRTCDataChannel=function(_){_.DataChannel&&!_.RTCDataChannel&&(_.RTCDataChannel=_.DataChannel)},x.shimAddTransceiver=function(_){if((_===void 0?"undefined":N(_))==="object"&&_.RTCPeerConnection){var t=_.RTCPeerConnection.prototype.addTransceiver;t&&(_.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var m=arguments[1],f=m&&"sendEncodings"in m;f&&m.sendEncodings.forEach(function(i){if("rid"in i&&!/^[a-z0-9]{0,16}$/i.test(i.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in i&&!(parseFloat(i.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in i&&!(parseFloat(i.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var o=t.apply(this,arguments);if(f){var s=o.sender,n=s.getParameters();"encodings"in n&&(n.encodings.length!==1||Object.keys(n.encodings[0]).length!==0)||(n.encodings=m.sendEncodings,s.sendEncodings=m.sendEncodings,this.setParametersPromises.push(s.setParameters(n).then(function(){delete s.sendEncodings}).catch(function(){delete s.sendEncodings})))}return o})}},x.shimGetParameters=function(_){if((_===void 0?"undefined":N(_))==="object"&&_.RTCRtpSender){var t=_.RTCRtpSender.prototype.getParameters;t&&(_.RTCRtpSender.prototype.getParameters=function(){var m=t.apply(this,arguments);return"encodings"in m||(m.encodings=[].concat(this.sendEncodings||[{}])),m})}},x.shimCreateOffer=function(_){if((_===void 0?"undefined":N(_))==="object"&&_.RTCPeerConnection){var t=_.RTCPeerConnection.prototype.createOffer;_.RTCPeerConnection.prototype.createOffer=function(){var m=this,f=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(m,f)}).finally(function(){m.setParametersPromises=[]}):t.apply(this,arguments)}}},x.shimCreateAnswer=function(_){if((_===void 0?"undefined":N(_))==="object"&&_.RTCPeerConnection){var t=_.RTCPeerConnection.prototype.createAnswer;_.RTCPeerConnection.prototype.createAnswer=function(){var m=this,f=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(m,f)}).finally(function(){m.setParametersPromises=[]}):t.apply(this,arguments)}}};var b=function(_){if(_&&_.__esModule)return _;var t={};if(_!=null)for(var m in _)Object.prototype.hasOwnProperty.call(_,m)&&(t[m]=_[m]);return t.default=_,t}(G("../utils"))},{"../utils":54,"./getdisplaymedia":51,"./getusermedia":52}],51:[function(G,q,x){Object.defineProperty(x,"__esModule",{value:!0}),x.shimGetDisplayMedia=function(N,S){N.navigator.mediaDevices&&"getDisplayMedia"in N.navigator.mediaDevices||N.navigator.mediaDevices&&(N.navigator.mediaDevices.getDisplayMedia=function(p){if(!p||!p.video){var b=new DOMException("getDisplayMedia without video constraints is undefined");return b.name="NotFoundError",b.code=8,Promise.reject(b)}return p.video===!0?p.video={mediaSource:S}:p.video.mediaSource=S,N.navigator.mediaDevices.getUserMedia(p)})}},{}],52:[function(G,q,x){Object.defineProperty(x,"__esModule",{value:!0});var N=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p};x.shimGetUserMedia=function(p,b){var _=p&&p.navigator,t=p&&p.MediaStreamTrack;if(_.getUserMedia=function(n,i,a){S.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),_.mediaDevices.getUserMedia(n).then(i,a)},!(b.version>55&&"autoGainControl"in _.mediaDevices.getSupportedConstraints())){var m=function(n,i,a){i in n&&!(a in n)&&(n[a]=n[i],delete n[i])},f=_.mediaDevices.getUserMedia.bind(_.mediaDevices);if(_.mediaDevices.getUserMedia=function(n){return(n===void 0?"undefined":N(n))==="object"&&N(n.audio)==="object"&&(n=JSON.parse(JSON.stringify(n)),m(n.audio,"autoGainControl","mozAutoGainControl"),m(n.audio,"noiseSuppression","mozNoiseSuppression")),f(n)},t&&t.prototype.getSettings){var o=t.prototype.getSettings;t.prototype.getSettings=function(){var n=o.apply(this,arguments);return m(n,"mozAutoGainControl","autoGainControl"),m(n,"mozNoiseSuppression","noiseSuppression"),n}}if(t&&t.prototype.applyConstraints){var s=t.prototype.applyConstraints;t.prototype.applyConstraints=function(n){return this.kind==="audio"&&(n===void 0?"undefined":N(n))==="object"&&(n=JSON.parse(JSON.stringify(n)),m(n,"autoGainControl","mozAutoGainControl"),m(n,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[n])}}}};var S=function(p){if(p&&p.__esModule)return p;var b={};if(p!=null)for(var _ in p)Object.prototype.hasOwnProperty.call(p,_)&&(b[_]=p[_]);return b.default=p,b}(G("../utils"))},{"../utils":54}],53:[function(G,q,x){Object.defineProperty(x,"__esModule",{value:!0});var N=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(b){return typeof b}:function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b};x.shimLocalStreamsAPI=function(b){if((b===void 0?"undefined":N(b))==="object"&&b.RTCPeerConnection){if("getLocalStreams"in b.RTCPeerConnection.prototype||(b.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in b.RTCPeerConnection.prototype)){var _=b.RTCPeerConnection.prototype.addTrack;b.RTCPeerConnection.prototype.addStream=function(t){var m=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach(function(f){return _.call(m,f,t)}),t.getVideoTracks().forEach(function(f){return _.call(m,f,t)})},b.RTCPeerConnection.prototype.addTrack=function(t){for(var m=this,f=arguments.length,o=Array(f>1?f-1:0),s=1;s<f;s++)o[s-1]=arguments[s];return o&&o.forEach(function(n){m._localStreams?m._localStreams.includes(n)||m._localStreams.push(n):m._localStreams=[n]}),_.apply(this,arguments)}}"removeStream"in b.RTCPeerConnection.prototype||(b.RTCPeerConnection.prototype.removeStream=function(t){var m=this;this._localStreams||(this._localStreams=[]);var f=this._localStreams.indexOf(t);if(f!==-1){this._localStreams.splice(f,1);var o=t.getTracks();this.getSenders().forEach(function(s){o.includes(s.track)&&m.removeTrack(s)})}})}},x.shimRemoteStreamsAPI=function(b){if((b===void 0?"undefined":N(b))==="object"&&b.RTCPeerConnection&&("getRemoteStreams"in b.RTCPeerConnection.prototype||(b.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in b.RTCPeerConnection.prototype))){Object.defineProperty(b.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(t){var m=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=function(f){f.streams.forEach(function(o){if(m._remoteStreams||(m._remoteStreams=[]),!m._remoteStreams.includes(o)){m._remoteStreams.push(o);var s=new Event("addstream");s.stream=o,m.dispatchEvent(s)}})})}});var _=b.RTCPeerConnection.prototype.setRemoteDescription;b.RTCPeerConnection.prototype.setRemoteDescription=function(){var t=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(m){m.streams.forEach(function(f){if(t._remoteStreams||(t._remoteStreams=[]),!(t._remoteStreams.indexOf(f)>=0)){t._remoteStreams.push(f);var o=new Event("addstream");o.stream=f,t.dispatchEvent(o)}})}),_.apply(t,arguments)}}},x.shimCallbacksAPI=function(b){if((b===void 0?"undefined":N(b))==="object"&&b.RTCPeerConnection){var _=b.RTCPeerConnection.prototype,t=_.createOffer,m=_.createAnswer,f=_.setLocalDescription,o=_.setRemoteDescription,s=_.addIceCandidate;_.createOffer=function(i,a){var c=arguments.length>=2?arguments[2]:arguments[0],u=t.apply(this,[c]);return a?(u.then(i,a),Promise.resolve()):u},_.createAnswer=function(i,a){var c=arguments.length>=2?arguments[2]:arguments[0],u=m.apply(this,[c]);return a?(u.then(i,a),Promise.resolve()):u};var n=function(i,a,c){var u=f.apply(this,[i]);return c?(u.then(a,c),Promise.resolve()):u};_.setLocalDescription=n,n=function(i,a,c){var u=o.apply(this,[i]);return c?(u.then(a,c),Promise.resolve()):u},_.setRemoteDescription=n,n=function(i,a,c){var u=s.apply(this,[i]);return c?(u.then(a,c),Promise.resolve()):u},_.addIceCandidate=n}},x.shimGetUserMedia=function(b){var _=b&&b.navigator;if(_.mediaDevices&&_.mediaDevices.getUserMedia){var t=_.mediaDevices,m=t.getUserMedia.bind(t);_.mediaDevices.getUserMedia=function(f){return m(p(f))}}!_.getUserMedia&&_.mediaDevices&&_.mediaDevices.getUserMedia&&(_.getUserMedia=(function(f,o,s){_.mediaDevices.getUserMedia(f).then(o,s)}).bind(_))},x.shimConstraints=p,x.shimRTCIceServerUrls=function(b){if(b.RTCPeerConnection){var _=b.RTCPeerConnection;b.RTCPeerConnection=function(t,m){if(t&&t.iceServers){for(var f=[],o=0;o<t.iceServers.length;o++){var s=t.iceServers[o];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(S.deprecated("RTCIceServer.url","RTCIceServer.urls"),(s=JSON.parse(JSON.stringify(s))).urls=s.url,delete s.url,f.push(s)):f.push(t.iceServers[o])}t.iceServers=f}return new _(t,m)},b.RTCPeerConnection.prototype=_.prototype,"generateCertificate"in _&&Object.defineProperty(b.RTCPeerConnection,"generateCertificate",{get:function(){return _.generateCertificate}})}},x.shimTrackEventTransceiver=function(b){(b===void 0?"undefined":N(b))==="object"&&b.RTCTrackEvent&&"receiver"in b.RTCTrackEvent.prototype&&!("transceiver"in b.RTCTrackEvent.prototype)&&Object.defineProperty(b.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},x.shimCreateOfferLegacy=function(b){var _=b.RTCPeerConnection.prototype.createOffer;b.RTCPeerConnection.prototype.createOffer=function(t){if(t){t.offerToReceiveAudio!==void 0&&(t.offerToReceiveAudio=!!t.offerToReceiveAudio);var m=this.getTransceivers().find(function(o){return o.receiver.track.kind==="audio"});t.offerToReceiveAudio===!1&&m?m.direction==="sendrecv"?m.setDirection?m.setDirection("sendonly"):m.direction="sendonly":m.direction==="recvonly"&&(m.setDirection?m.setDirection("inactive"):m.direction="inactive"):t.offerToReceiveAudio!==!0||m||this.addTransceiver("audio"),t.offerToReceiveVideo!==void 0&&(t.offerToReceiveVideo=!!t.offerToReceiveVideo);var f=this.getTransceivers().find(function(o){return o.receiver.track.kind==="video"});t.offerToReceiveVideo===!1&&f?f.direction==="sendrecv"?f.setDirection?f.setDirection("sendonly"):f.direction="sendonly":f.direction==="recvonly"&&(f.setDirection?f.setDirection("inactive"):f.direction="inactive"):t.offerToReceiveVideo!==!0||f||this.addTransceiver("video")}return _.apply(this,arguments)}},x.shimAudioContext=function(b){(b===void 0?"undefined":N(b))!=="object"||b.AudioContext||(b.AudioContext=b.webkitAudioContext)};var S=function(b){if(b&&b.__esModule)return b;var _={};if(b!=null)for(var t in b)Object.prototype.hasOwnProperty.call(b,t)&&(_[t]=b[t]);return _.default=b,_}(G("../utils"));function p(b){return b&&b.video!==void 0?Object.assign({},b,{video:S.compactObject(b.video)}):b}},{"../utils":54}],54:[function(G,q,x){Object.defineProperty(x,"__esModule",{value:!0});var N=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m};x.extractVersion=b,x.wrapPeerConnectionEvent=function(m,f,o){if(m.RTCPeerConnection){var s=m.RTCPeerConnection.prototype,n=s.addEventListener;s.addEventListener=function(a,c){if(a!==f)return n.apply(this,arguments);var u=function(g){var h=o(g);h&&(c.handleEvent?c.handleEvent(h):c(h))};return this._eventMap=this._eventMap||{},this._eventMap[f]||(this._eventMap[f]=new Map),this._eventMap[f].set(c,u),n.apply(this,[a,u])};var i=s.removeEventListener;s.removeEventListener=function(a,c){if(a!==f||!this._eventMap||!this._eventMap[f])return i.apply(this,arguments);if(!this._eventMap[f].has(c))return i.apply(this,arguments);var u=this._eventMap[f].get(c);return this._eventMap[f].delete(c),this._eventMap[f].size===0&&delete this._eventMap[f],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[a,u])},Object.defineProperty(s,"on"+f,{get:function(){return this["_on"+f]},set:function(a){this["_on"+f]&&(this.removeEventListener(f,this["_on"+f]),delete this["_on"+f]),a&&this.addEventListener(f,this["_on"+f]=a)},enumerable:!0,configurable:!0})}},x.disableLog=function(m){return typeof m!="boolean"?new Error("Argument type: "+(m===void 0?"undefined":N(m))+". Please use a boolean."):(S=m,m?"adapter.js logging disabled":"adapter.js logging enabled")},x.disableWarnings=function(m){return typeof m!="boolean"?new Error("Argument type: "+(m===void 0?"undefined":N(m))+". Please use a boolean."):(p=!m,"adapter.js deprecation warnings "+(m?"disabled":"enabled"))},x.log=function(){if((typeof window>"u"?"undefined":N(window))==="object"){if(S)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}},x.deprecated=function(m,f){p&&console.warn(m+" is deprecated, please use "+f+" instead.")},x.detectBrowser=function(m){var f={browser:null,version:null};if(m===void 0||!m.navigator)return f.browser="Not a browser.",f;var o=m.navigator;if(o.mozGetUserMedia)f.browser="firefox",f.version=b(o.userAgent,/Firefox\/(\d+)\./,1);else if(o.webkitGetUserMedia||m.isSecureContext===!1&&m.webkitRTCPeerConnection&&!m.RTCIceGatherer)f.browser="chrome",f.version=b(o.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(o.mediaDevices&&o.userAgent.match(/Edge\/(\d+).(\d+)$/))f.browser="edge",f.version=b(o.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!m.RTCPeerConnection||!o.userAgent.match(/AppleWebKit\/(\d+)\./))return f.browser="Not a supported browser.",f;f.browser="safari",f.version=b(o.userAgent,/AppleWebKit\/(\d+)\./,1),f.supportsUnifiedPlan=m.RTCRtpTransceiver&&"currentDirection"in m.RTCRtpTransceiver.prototype}return f},x.compactObject=function m(f){return _(f)?Object.keys(f).reduce(function(o,s){var n=_(f[s]),i=n?m(f[s]):f[s],a=n&&!Object.keys(i).length;return i===void 0||a?o:Object.assign(o,function(c,u,g){return u in c?Object.defineProperty(c,u,{value:g,enumerable:!0,configurable:!0,writable:!0}):c[u]=g,c}({},s,i))},{}):f},x.walkStats=t,x.filterStats=function(m,f,o){var s=o?"outbound-rtp":"inbound-rtp",n=new Map;if(f===null)return n;var i=[];return m.forEach(function(a){a.type==="track"&&a.trackIdentifier===f.id&&i.push(a)}),i.forEach(function(a){m.forEach(function(c){c.type===s&&c.trackId===a.id&&t(m,c,n)})}),n};var S=!0,p=!0;function b(m,f,o){var s=m.match(f);return s&&s.length>=o&&parseInt(s[o],10)}function _(m){return Object.prototype.toString.call(m)==="[object Object]"}function t(m,f,o){f&&!o.has(f.id)&&(o.set(f.id,f),Object.keys(f).forEach(function(s){s.endsWith("Id")?t(m,m.get(f[s]),o):s.endsWith("Ids")&&f[s].forEach(function(n){t(m,m.get(n),o)})}))}},{}],55:[function(G,q,x){q.exports={name:"plivo-jssip",title:"plivo-jssip",description:"Plivo's Javascript SIP library",version:"1.0.5",homepage:"https://jssip.net",author:"Jos Luis Milln <jmillan@aliax.net> (https://github.com/jmillan)",contributors:["Iaki Baz Castillo <ibc@aliax.net> (https://github.com/ibc)"],types:"index.d.ts",main:"dist/plivo-jssip.min.js",keywords:["sip","websocket","webrtc","node","browser","library"],license:"MIT",repository:{type:"git",url:"git+https://github.com/versatica/JsSIP.git"},bugs:{url:"https://github.com/versatica/JsSIP/issues"},dependencies:{"@types/debug":"^4.1.5","@types/node":"^14.0.6",debug:"^4.1.1",events:"^3.1.0","sdp-transform":"^2.14.0","webrtc-adapter":"^7.7.0"},devDependencies:{"@babel/core":"^7.9.6","@babel/preset-env":"^7.9.6","ansi-colors":"^3.2.4",browserify:"^16.5.1",eslint:"^5.16.0","fancy-log":"^1.3.3",gulp:"^4.0.2","gulp-babel":"^8.0.0","gulp-eslint":"^5.0.0","gulp-expect-file":"^1.0.2","gulp-header":"^2.0.9","gulp-nodeunit-runner":"^0.2.2","gulp-plumber":"^1.2.1","gulp-rename":"^1.4.0","gulp-uglify-es":"^1.0.4",pegjs:"^0.7.0","pre-commit":"^1.2.2",typescript:"^4.0.3","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"},peerDependencies:{"webrtc-adapter":"^7.7.0"},scripts:{lint:"gulp lint",test:"gulp test",build:"gulp","build:js":"gulp browserify"},"pre-commit":["build"],directories:{lib:"lib",test:"test"}}},{}]},{},[8])(8)},"./node_modules/process/browser.js":function(Se,U){var K,G,q=Se.exports={};function x(){throw new Error("setTimeout has not been defined")}function N(){throw new Error("clearTimeout has not been defined")}function S(n){if(K===setTimeout)return setTimeout(n,0);if((K===x||!K)&&setTimeout)return K=setTimeout,setTimeout(n,0);try{return K(n,0)}catch{try{return K.call(null,n,0)}catch{return K.call(this,n,0)}}}(function(){try{K=typeof setTimeout=="function"?setTimeout:x}catch{K=x}try{G=typeof clearTimeout=="function"?clearTimeout:N}catch{G=N}})();var p,b=[],_=!1,t=-1;function m(){_&&p&&(_=!1,p.length?b=p.concat(b):t=-1,b.length&&f())}function f(){if(!_){var n=S(m);_=!0;for(var i=b.length;i;){for(p=b,b=[];++t<i;)p&&p[t].run();t=-1,i=b.length}p=null,_=!1,function(a){if(G===clearTimeout)return clearTimeout(a);if((G===N||!G)&&clearTimeout)return G=clearTimeout,clearTimeout(a);try{G(a)}catch{try{return G.call(null,a)}catch{return G.call(this,a)}}}(n)}}function o(n,i){this.fun=n,this.array=i}function s(){}q.nextTick=function(n){var i=new Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)i[a-1]=arguments[a];b.push(new o(n,i)),b.length!==1||_||S(f)},o.prototype.run=function(){this.fun.apply(null,this.array)},q.title="browser",q.browser=!0,q.env={},q.argv=[],q.version="",q.versions={},q.on=s,q.addListener=s,q.once=s,q.off=s,q.removeListener=s,q.removeAllListeners=s,q.emit=s,q.prependListener=s,q.prependOnceListener=s,q.listeners=function(n){return[]},q.binding=function(n){throw new Error("process.binding is not supported")},q.cwd=function(){return"/"},q.chdir=function(n){throw new Error("process.chdir is not supported")},q.umask=function(){return 0}},"./node_modules/rtcpeerconnection-shim/rtcpeerconnection.js":function(Se,U,K){var G=K("./node_modules/sdp/sdp.js");function q(b,_,t,m,f){var o=G.writeRtpDescription(b.kind,_);if(o+=G.writeIceParameters(b.iceGatherer.getLocalParameters()),o+=G.writeDtlsParameters(b.dtlsTransport.getLocalParameters(),t==="offer"?"actpass":f||"active"),o+="a=mid:"+b.mid+`\r
`,b.rtpSender&&b.rtpReceiver?o+=`a=sendrecv\r
`:b.rtpSender?o+=`a=sendonly\r
`:b.rtpReceiver?o+=`a=recvonly\r
`:o+=`a=inactive\r
`,b.rtpSender){var s=b.rtpSender._initialTrackId||b.rtpSender.track.id;b.rtpSender._initialTrackId=s;var n="msid:"+(m?m.id:"-")+" "+s+`\r
`;o+="a="+n,o+="a=ssrc:"+b.sendEncodingParameters[0].ssrc+" "+n,b.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+b.sendEncodingParameters[0].rtx.ssrc+" "+n,o+="a=ssrc-group:FID "+b.sendEncodingParameters[0].ssrc+" "+b.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return o+="a=ssrc:"+b.sendEncodingParameters[0].ssrc+" cname:"+G.localCName+`\r
`,b.rtpSender&&b.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+b.sendEncodingParameters[0].rtx.ssrc+" cname:"+G.localCName+`\r
`),o}function x(b,_){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},m=function(o,s){o=parseInt(o,10);for(var n=0;n<s.length;n++)if(s[n].payloadType===o||s[n].preferredPayloadType===o)return s[n]},f=function(o,s,n,i){var a=m(o.parameters.apt,n),c=m(s.parameters.apt,i);return a&&c&&a.name.toLowerCase()===c.name.toLowerCase()};return b.codecs.forEach(function(o){for(var s=0;s<_.codecs.length;s++){var n=_.codecs[s];if(o.name.toLowerCase()===n.name.toLowerCase()&&o.clockRate===n.clockRate){if(o.name.toLowerCase()==="rtx"&&o.parameters&&n.parameters.apt&&!f(o,n,b.codecs,_.codecs))continue;(n=JSON.parse(JSON.stringify(n))).numChannels=Math.min(o.numChannels,n.numChannels),t.codecs.push(n),n.rtcpFeedback=n.rtcpFeedback.filter(function(i){for(var a=0;a<o.rtcpFeedback.length;a++)if(o.rtcpFeedback[a].type===i.type&&o.rtcpFeedback[a].parameter===i.parameter)return!0;return!1});break}}}),b.headerExtensions.forEach(function(o){for(var s=0;s<_.headerExtensions.length;s++){var n=_.headerExtensions[s];if(o.uri===n.uri){t.headerExtensions.push(n);break}}}),t}function N(b,_,t){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[_][b].indexOf(t)!==-1}function S(b,_){var t=b.getRemoteCandidates().find(function(m){return _.foundation===m.foundation&&_.ip===m.ip&&_.port===m.port&&_.priority===m.priority&&_.protocol===m.protocol&&_.type===m.type});return t||b.addRemoteCandidate(_),!t}function p(b,_){var t=new Error(_);return t.name=b,t.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[b],t}Se.exports=function(b,_){function t(s,n){n.addTrack(s),n.dispatchEvent(new b.MediaStreamTrackEvent("addtrack",{track:s}))}function m(s,n,i,a){var c=new Event("track");c.track=n,c.receiver=i,c.transceiver={receiver:i},c.streams=a,b.setTimeout(function(){s._dispatchEvent("track",c)})}var f=function(s){var n=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(c){n[c]=i[c].bind(i)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",s=JSON.parse(JSON.stringify(s||{})),this.usingBundle=s.bundlePolicy==="max-bundle",s.rtcpMuxPolicy==="negotiate")throw p("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(s.rtcpMuxPolicy||(s.rtcpMuxPolicy="require"),s.iceTransportPolicy){case"all":case"relay":break;default:s.iceTransportPolicy="all"}switch(s.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:s.bundlePolicy="balanced"}if(s.iceServers=function(c,u){var g=!1;return(c=JSON.parse(JSON.stringify(c))).filter(function(h){if(h&&(h.urls||h.url)){var C=h.urls||h.url;h.url&&!h.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var E=typeof C=="string";return E&&(C=[C]),C=C.filter(function(y){return y.indexOf("turn:")!==0||y.indexOf("transport=udp")===-1||y.indexOf("turn:[")!==-1||g?y.indexOf("stun:")===0&&u>=14393&&y.indexOf("?transport=udp")===-1:(g=!0,!0)}),delete h.url,h.urls=E?C[0]:C,!!C.length}})}(s.iceServers||[],_),this._iceGatherers=[],s.iceCandidatePoolSize)for(var a=s.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new b.RTCIceGatherer({iceServers:s.iceServers,gatherPolicy:s.iceTransportPolicy}));else s.iceCandidatePoolSize=0;this._config=s,this.transceivers=[],this._sdpSessionId=G.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(f.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(f.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),f.prototype.onicecandidate=null,f.prototype.onaddstream=null,f.prototype.ontrack=null,f.prototype.onremovestream=null,f.prototype.onsignalingstatechange=null,f.prototype.oniceconnectionstatechange=null,f.prototype.onconnectionstatechange=null,f.prototype.onicegatheringstatechange=null,f.prototype.onnegotiationneeded=null,f.prototype.ondatachannel=null,f.prototype._dispatchEvent=function(s,n){this._isClosed||(this.dispatchEvent(n),typeof this["on"+s]=="function"&&this["on"+s](n))},f.prototype._emitGatheringStateChange=function(){var s=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",s)},f.prototype.getConfiguration=function(){return this._config},f.prototype.getLocalStreams=function(){return this.localStreams},f.prototype.getRemoteStreams=function(){return this.remoteStreams},f.prototype._createTransceiver=function(s,n){var i=this.transceivers.length>0,a={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:s,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&i)a.iceTransport=this.transceivers[0].iceTransport,a.dtlsTransport=this.transceivers[0].dtlsTransport;else{var c=this._createIceAndDtlsTransports();a.iceTransport=c.iceTransport,a.dtlsTransport=c.dtlsTransport}return n||this.transceivers.push(a),a},f.prototype.addTrack=function(s,n){if(this._isClosed)throw p("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var i;if(this.transceivers.find(function(c){return c.track===s}))throw p("InvalidAccessError","Track already exists.");for(var a=0;a<this.transceivers.length;a++)this.transceivers[a].track||this.transceivers[a].kind!==s.kind||(i=this.transceivers[a]);return i||(i=this._createTransceiver(s.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(n)===-1&&this.localStreams.push(n),i.track=s,i.stream=n,i.rtpSender=new b.RTCRtpSender(s,i.dtlsTransport),i.rtpSender},f.prototype.addStream=function(s){var n=this;if(_>=15025)s.getTracks().forEach(function(a){n.addTrack(a,s)});else{var i=s.clone();s.getTracks().forEach(function(a,c){var u=i.getTracks()[c];a.addEventListener("enabled",function(g){u.enabled=g.enabled})}),i.getTracks().forEach(function(a){n.addTrack(a,i)})}},f.prototype.removeTrack=function(s){if(this._isClosed)throw p("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(s instanceof b.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find(function(a){return a.rtpSender===s});if(!n)throw p("InvalidAccessError","Sender was not created by this connection.");var i=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,this.transceivers.map(function(a){return a.stream}).indexOf(i)===-1&&this.localStreams.indexOf(i)>-1&&this.localStreams.splice(this.localStreams.indexOf(i),1),this._maybeFireNegotiationNeeded()},f.prototype.removeStream=function(s){var n=this;s.getTracks().forEach(function(i){var a=n.getSenders().find(function(c){return c.track===i});a&&n.removeTrack(a)})},f.prototype.getSenders=function(){return this.transceivers.filter(function(s){return!!s.rtpSender}).map(function(s){return s.rtpSender})},f.prototype.getReceivers=function(){return this.transceivers.filter(function(s){return!!s.rtpReceiver}).map(function(s){return s.rtpReceiver})},f.prototype._createIceGatherer=function(s,n){var i=this;if(n&&s>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var a=new b.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(a,"state",{value:"new",writable:!0}),this.transceivers[s].bufferedCandidateEvents=[],this.transceivers[s].bufferCandidates=function(c){var u=!c.candidate||Object.keys(c.candidate).length===0;a.state=u?"completed":"gathering",i.transceivers[s].bufferedCandidateEvents!==null&&i.transceivers[s].bufferedCandidateEvents.push(c)},a.addEventListener("localcandidate",this.transceivers[s].bufferCandidates),a},f.prototype._gather=function(s,n){var i=this,a=this.transceivers[n].iceGatherer;if(!a.onlocalcandidate){var c=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,a.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),a.onlocalcandidate=function(u){if(!(i.usingBundle&&n>0)){var g=new Event("icecandidate");g.candidate={sdpMid:s,sdpMLineIndex:n};var h=u.candidate,C=!h||Object.keys(h).length===0;if(C)a.state!=="new"&&a.state!=="gathering"||(a.state="completed");else{a.state==="new"&&(a.state="gathering"),h.component=1,h.ufrag=a.getLocalParameters().usernameFragment;var E=G.writeCandidate(h);g.candidate=Object.assign(g.candidate,G.parseCandidate(E)),g.candidate.candidate=E,g.candidate.toJSON=function(){return{candidate:g.candidate.candidate,sdpMid:g.candidate.sdpMid,sdpMLineIndex:g.candidate.sdpMLineIndex,usernameFragment:g.candidate.usernameFragment}}}var y=G.getMediaSections(i._localDescription.sdp);y[g.candidate.sdpMLineIndex]+=C?`a=end-of-candidates\r
`:"a="+g.candidate.candidate+`\r
`,i._localDescription.sdp=G.getDescription(i._localDescription.sdp)+y.join("");var w=i.transceivers.every(function(O){return O.iceGatherer&&O.iceGatherer.state==="completed"});i.iceGatheringState!=="gathering"&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),C||i._dispatchEvent("icecandidate",g),w&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},b.setTimeout(function(){c.forEach(function(u){a.onlocalcandidate(u)})},0)}},f.prototype._createIceAndDtlsTransports=function(){var s=this,n=new b.RTCIceTransport(null);n.onicestatechange=function(){s._updateIceConnectionState(),s._updateConnectionState()};var i=new b.RTCDtlsTransport(n);return i.ondtlsstatechange=function(){s._updateConnectionState()},i.onerror=function(){Object.defineProperty(i,"state",{value:"failed",writable:!0}),s._updateConnectionState()},{iceTransport:n,dtlsTransport:i}},f.prototype._disposeIceAndDtlsTransports=function(s){var n=this.transceivers[s].iceGatherer;n&&(delete n.onlocalcandidate,delete this.transceivers[s].iceGatherer);var i=this.transceivers[s].iceTransport;i&&(delete i.onicestatechange,delete this.transceivers[s].iceTransport);var a=this.transceivers[s].dtlsTransport;a&&(delete a.ondtlsstatechange,delete a.onerror,delete this.transceivers[s].dtlsTransport)},f.prototype._transceive=function(s,n,i){var a=x(s.localCapabilities,s.remoteCapabilities);n&&s.rtpSender&&(a.encodings=s.sendEncodingParameters,a.rtcp={cname:G.localCName,compound:s.rtcpParameters.compound},s.recvEncodingParameters.length&&(a.rtcp.ssrc=s.recvEncodingParameters[0].ssrc),s.rtpSender.send(a)),i&&s.rtpReceiver&&a.codecs.length>0&&(s.kind==="video"&&s.recvEncodingParameters&&_<15019&&s.recvEncodingParameters.forEach(function(c){delete c.rtx}),s.recvEncodingParameters.length?a.encodings=s.recvEncodingParameters:a.encodings=[{}],a.rtcp={compound:s.rtcpParameters.compound},s.rtcpParameters.cname&&(a.rtcp.cname=s.rtcpParameters.cname),s.sendEncodingParameters.length&&(a.rtcp.ssrc=s.sendEncodingParameters[0].ssrc),s.rtpReceiver.receive(a))},f.prototype.setLocalDescription=function(s){var n,i,a=this;if(["offer","answer"].indexOf(s.type)===-1)return Promise.reject(p("TypeError",'Unsupported type "'+s.type+'"'));if(!N("setLocalDescription",s.type,a.signalingState)||a._isClosed)return Promise.reject(p("InvalidStateError","Can not set local "+s.type+" in state "+a.signalingState));if(s.type==="offer")n=G.splitSections(s.sdp),i=n.shift(),n.forEach(function(u,g){var h=G.parseRtpParameters(u);a.transceivers[g].localCapabilities=h}),a.transceivers.forEach(function(u,g){a._gather(u.mid,g)});else if(s.type==="answer"){n=G.splitSections(a._remoteDescription.sdp),i=n.shift();var c=G.matchPrefix(i,"a=ice-lite").length>0;n.forEach(function(u,g){var h=a.transceivers[g],C=h.iceGatherer,E=h.iceTransport,y=h.dtlsTransport,w=h.localCapabilities,O=h.remoteCapabilities;if(!(G.isRejected(u)&&G.matchPrefix(u,"a=bundle-only").length===0)&&!h.rejected){var L=G.getIceParameters(u,i),I=G.getDtlsParameters(u,i);c&&(I.role="server"),a.usingBundle&&g!==0||(a._gather(h.mid,g),E.state==="new"&&E.start(C,L,c?"controlling":"controlled"),y.state==="new"&&y.start(I));var k=x(w,O);a._transceive(h,k.codecs.length>0,!1)}})}return a._localDescription={type:s.type,sdp:s.sdp},s.type==="offer"?a._updateSignalingState("have-local-offer"):a._updateSignalingState("stable"),Promise.resolve()},f.prototype.setRemoteDescription=function(s){var n=this;if(["offer","answer"].indexOf(s.type)===-1)return Promise.reject(p("TypeError",'Unsupported type "'+s.type+'"'));if(!N("setRemoteDescription",s.type,n.signalingState)||n._isClosed)return Promise.reject(p("InvalidStateError","Can not set remote "+s.type+" in state "+n.signalingState));var i={};n.remoteStreams.forEach(function(E){i[E.id]=E});var a=[],c=G.splitSections(s.sdp),u=c.shift(),g=G.matchPrefix(u,"a=ice-lite").length>0,h=G.matchPrefix(u,"a=group:BUNDLE ").length>0;n.usingBundle=h;var C=G.matchPrefix(u,"a=ice-options:")[0];return n.canTrickleIceCandidates=!!C&&C.substr(14).split(" ").indexOf("trickle")>=0,c.forEach(function(E,y){var w=G.splitLines(E),O=G.getKind(E),L=G.isRejected(E)&&G.matchPrefix(E,"a=bundle-only").length===0,I=w[0].substr(2).split(" ")[2],k=G.getDirection(E,u),P=G.parseMsid(E),F=G.getMid(E)||G.generateIdentifier();if(L||O==="application"&&(I==="DTLS/SCTP"||I==="UDP/DTLS/SCTP"))n.transceivers[y]={mid:F,kind:O,protocol:I,rejected:!0};else{var H,D,$,j,V,Y,Z,J,re;!L&&n.transceivers[y]&&n.transceivers[y].rejected&&(n.transceivers[y]=n._createTransceiver(O,!0));var ce,Re,pe=G.parseRtpParameters(E);L||(ce=G.getIceParameters(E,u),(Re=G.getDtlsParameters(E,u)).role="client"),Z=G.parseRtpEncodingParameters(E);var Oe=G.parseRtcpParameters(E),te=G.matchPrefix(E,"a=end-of-candidates",u).length>0,oe=G.matchPrefix(E,"a=candidate:").map(function(Ee){return G.parseCandidate(Ee)}).filter(function(Ee){return Ee.component===1});if((s.type==="offer"||s.type==="answer")&&!L&&h&&y>0&&n.transceivers[y]&&(n._disposeIceAndDtlsTransports(y),n.transceivers[y].iceGatherer=n.transceivers[0].iceGatherer,n.transceivers[y].iceTransport=n.transceivers[0].iceTransport,n.transceivers[y].dtlsTransport=n.transceivers[0].dtlsTransport,n.transceivers[y].rtpSender&&n.transceivers[y].rtpSender.setTransport(n.transceivers[0].dtlsTransport),n.transceivers[y].rtpReceiver&&n.transceivers[y].rtpReceiver.setTransport(n.transceivers[0].dtlsTransport)),s.type!=="offer"||L)s.type==="answer"&&!L&&(D=(H=n.transceivers[y]).iceGatherer,$=H.iceTransport,j=H.dtlsTransport,V=H.rtpReceiver,Y=H.sendEncodingParameters,J=H.localCapabilities,n.transceivers[y].recvEncodingParameters=Z,n.transceivers[y].remoteCapabilities=pe,n.transceivers[y].rtcpParameters=Oe,oe.length&&$.state==="new"&&(!g&&!te||h&&y!==0?oe.forEach(function(Ee){S(H.iceTransport,Ee)}):$.setRemoteCandidates(oe)),h&&y!==0||($.state==="new"&&$.start(D,ce,"controlling"),j.state==="new"&&j.start(Re)),!x(H.localCapabilities,H.remoteCapabilities).codecs.filter(function(Ee){return Ee.name.toLowerCase()==="rtx"}).length&&H.sendEncodingParameters[0].rtx&&delete H.sendEncodingParameters[0].rtx,n._transceive(H,k==="sendrecv"||k==="recvonly",k==="sendrecv"||k==="sendonly"),!V||k!=="sendrecv"&&k!=="sendonly"?delete H.rtpReceiver:(re=V.track,P?(i[P.stream]||(i[P.stream]=new b.MediaStream),t(re,i[P.stream]),a.push([re,V,i[P.stream]])):(i.default||(i.default=new b.MediaStream),t(re,i.default),a.push([re,V,i.default]))));else{(H=n.transceivers[y]||n._createTransceiver(O)).mid=F,H.iceGatherer||(H.iceGatherer=n._createIceGatherer(y,h)),oe.length&&H.iceTransport.state==="new"&&(!te||h&&y!==0?oe.forEach(function(Ee){S(H.iceTransport,Ee)}):H.iceTransport.setRemoteCandidates(oe)),J=b.RTCRtpReceiver.getCapabilities(O),_<15019&&(J.codecs=J.codecs.filter(function(Ee){return Ee.name!=="rtx"})),Y=H.sendEncodingParameters||[{ssrc:1001*(2*y+2)}];var _e,we=!1;k==="sendrecv"||k==="sendonly"?(we=!H.rtpReceiver,V=H.rtpReceiver||new b.RTCRtpReceiver(H.dtlsTransport,O),we&&(re=V.track,P&&P.stream==="-"||(P?(i[P.stream]||(i[P.stream]=new b.MediaStream,Object.defineProperty(i[P.stream],"id",{get:function(){return P.stream}})),Object.defineProperty(re,"id",{get:function(){return P.track}}),_e=i[P.stream]):(i.default||(i.default=new b.MediaStream),_e=i.default)),_e&&(t(re,_e),H.associatedRemoteMediaStreams.push(_e)),a.push([re,V,_e]))):H.rtpReceiver&&H.rtpReceiver.track&&(H.associatedRemoteMediaStreams.forEach(function(Ee){var De=Ee.getTracks().find(function(Fe){return Fe.id===H.rtpReceiver.track.id});De&&function(Fe,xe){xe.removeTrack(Fe),xe.dispatchEvent(new b.MediaStreamTrackEvent("removetrack",{track:Fe}))}(De,Ee)}),H.associatedRemoteMediaStreams=[]),H.localCapabilities=J,H.remoteCapabilities=pe,H.rtpReceiver=V,H.rtcpParameters=Oe,H.sendEncodingParameters=Y,H.recvEncodingParameters=Z,n._transceive(n.transceivers[y],!1,we)}}}),n._dtlsRole===void 0&&(n._dtlsRole=s.type==="offer"?"active":"passive"),n._remoteDescription={type:s.type,sdp:s.sdp},s.type==="offer"?n._updateSignalingState("have-remote-offer"):n._updateSignalingState("stable"),Object.keys(i).forEach(function(E){var y=i[E];if(y.getTracks().length){if(n.remoteStreams.indexOf(y)===-1){n.remoteStreams.push(y);var w=new Event("addstream");w.stream=y,b.setTimeout(function(){n._dispatchEvent("addstream",w)})}a.forEach(function(O){var L=O[0],I=O[1];y.id===O[2].id&&m(n,L,I,[y])})}}),a.forEach(function(E){E[2]||m(n,E[0],E[1],[])}),b.setTimeout(function(){n&&n.transceivers&&n.transceivers.forEach(function(E){E.iceTransport&&E.iceTransport.state==="new"&&E.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),E.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},f.prototype.close=function(){this.transceivers.forEach(function(s){s.iceTransport&&s.iceTransport.stop(),s.dtlsTransport&&s.dtlsTransport.stop(),s.rtpSender&&s.rtpSender.stop(),s.rtpReceiver&&s.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},f.prototype._updateSignalingState=function(s){this.signalingState=s;var n=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",n)},f.prototype._maybeFireNegotiationNeeded=function(){var s=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,b.setTimeout(function(){if(s.needNegotiation){s.needNegotiation=!1;var n=new Event("negotiationneeded");s._dispatchEvent("negotiationneeded",n)}},0))},f.prototype._updateIceConnectionState=function(){var s,n={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(a){a.iceTransport&&!a.rejected&&n[a.iceTransport.state]++}),s="new",n.failed>0?s="failed":n.checking>0?s="checking":n.disconnected>0?s="disconnected":n.new>0?s="new":n.connected>0?s="connected":n.completed>0&&(s="completed"),s!==this.iceConnectionState){this.iceConnectionState=s;var i=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",i)}},f.prototype._updateConnectionState=function(){var s,n={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(a){a.iceTransport&&a.dtlsTransport&&!a.rejected&&(n[a.iceTransport.state]++,n[a.dtlsTransport.state]++)}),n.connected+=n.completed,s="new",n.failed>0?s="failed":n.connecting>0?s="connecting":n.disconnected>0?s="disconnected":n.new>0?s="new":n.connected>0&&(s="connected"),s!==this.connectionState){this.connectionState=s;var i=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",i)}},f.prototype.createOffer=function(){var s=this;if(s._isClosed)return Promise.reject(p("InvalidStateError","Can not call createOffer after close"));var n=s.transceivers.filter(function(g){return g.kind==="audio"}).length,i=s.transceivers.filter(function(g){return g.kind==="video"}).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");a.offerToReceiveAudio!==void 0&&(n=a.offerToReceiveAudio===!0?1:a.offerToReceiveAudio===!1?0:a.offerToReceiveAudio),a.offerToReceiveVideo!==void 0&&(i=a.offerToReceiveVideo===!0?1:a.offerToReceiveVideo===!1?0:a.offerToReceiveVideo)}for(s.transceivers.forEach(function(g){g.kind==="audio"?--n<0&&(g.wantReceive=!1):g.kind==="video"&&--i<0&&(g.wantReceive=!1)});n>0||i>0;)n>0&&(s._createTransceiver("audio"),n--),i>0&&(s._createTransceiver("video"),i--);var c=G.writeSessionBoilerplate(s._sdpSessionId,s._sdpSessionVersion++);s.transceivers.forEach(function(g,h){var C=g.track,E=g.kind,y=g.mid||G.generateIdentifier();g.mid=y,g.iceGatherer||(g.iceGatherer=s._createIceGatherer(h,s.usingBundle));var w=b.RTCRtpSender.getCapabilities(E);_<15019&&(w.codecs=w.codecs.filter(function(L){return L.name!=="rtx"})),w.codecs.forEach(function(L){L.name==="H264"&&L.parameters["level-asymmetry-allowed"]===void 0&&(L.parameters["level-asymmetry-allowed"]="1"),g.remoteCapabilities&&g.remoteCapabilities.codecs&&g.remoteCapabilities.codecs.forEach(function(I){L.name.toLowerCase()===I.name.toLowerCase()&&L.clockRate===I.clockRate&&(L.preferredPayloadType=I.payloadType)})}),w.headerExtensions.forEach(function(L){(g.remoteCapabilities&&g.remoteCapabilities.headerExtensions||[]).forEach(function(I){L.uri===I.uri&&(L.id=I.id)})});var O=g.sendEncodingParameters||[{ssrc:1001*(2*h+1)}];C&&_>=15019&&E==="video"&&!O[0].rtx&&(O[0].rtx={ssrc:O[0].ssrc+1}),g.wantReceive&&(g.rtpReceiver=new b.RTCRtpReceiver(g.dtlsTransport,E)),g.localCapabilities=w,g.sendEncodingParameters=O}),s._config.bundlePolicy!=="max-compat"&&(c+="a=group:BUNDLE "+s.transceivers.map(function(g){return g.mid}).join(" ")+`\r
`),c+=`a=ice-options:trickle\r
`,s.transceivers.forEach(function(g,h){c+=q(g,g.localCapabilities,"offer",g.stream,s._dtlsRole),c+=`a=rtcp-rsize\r
`,!g.iceGatherer||s.iceGatheringState==="new"||h!==0&&s.usingBundle||(g.iceGatherer.getLocalCandidates().forEach(function(C){C.component=1,c+="a="+G.writeCandidate(C)+`\r
`}),g.iceGatherer.state==="completed"&&(c+=`a=end-of-candidates\r
`))});var u=new b.RTCSessionDescription({type:"offer",sdp:c});return Promise.resolve(u)},f.prototype.createAnswer=function(){var s=this;if(s._isClosed)return Promise.reject(p("InvalidStateError","Can not call createAnswer after close"));if(s.signalingState!=="have-remote-offer"&&s.signalingState!=="have-local-pranswer")return Promise.reject(p("InvalidStateError","Can not call createAnswer in signalingState "+s.signalingState));var n=G.writeSessionBoilerplate(s._sdpSessionId,s._sdpSessionVersion++);s.usingBundle&&(n+="a=group:BUNDLE "+s.transceivers.map(function(c){return c.mid}).join(" ")+`\r
`),n+=`a=ice-options:trickle\r
`;var i=G.getMediaSections(s._remoteDescription.sdp).length;s.transceivers.forEach(function(c,u){if(!(u+1>i)){if(c.rejected)return c.kind==="application"?c.protocol==="DTLS/SCTP"?n+=`m=application 0 DTLS/SCTP 5000\r
`:n+="m=application 0 "+c.protocol+` webrtc-datachannel\r
`:c.kind==="audio"?n+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:c.kind==="video"&&(n+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(n+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+c.mid+`\r
`);var g;c.stream&&(c.kind==="audio"?g=c.stream.getAudioTracks()[0]:c.kind==="video"&&(g=c.stream.getVideoTracks()[0]),g&&_>=15019&&c.kind==="video"&&!c.sendEncodingParameters[0].rtx&&(c.sendEncodingParameters[0].rtx={ssrc:c.sendEncodingParameters[0].ssrc+1}));var h=x(c.localCapabilities,c.remoteCapabilities);!h.codecs.filter(function(C){return C.name.toLowerCase()==="rtx"}).length&&c.sendEncodingParameters[0].rtx&&delete c.sendEncodingParameters[0].rtx,n+=q(c,h,"answer",c.stream,s._dtlsRole),c.rtcpParameters&&c.rtcpParameters.reducedSize&&(n+=`a=rtcp-rsize\r
`)}});var a=new b.RTCSessionDescription({type:"answer",sdp:n});return Promise.resolve(a)},f.prototype.addIceCandidate=function(s){var n,i=this;return s&&s.sdpMLineIndex===void 0&&!s.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(a,c){if(!i._remoteDescription)return c(p("InvalidStateError","Can not add ICE candidate without a remote description"));if(s&&s.candidate!==""){var u=s.sdpMLineIndex;if(s.sdpMid){for(var g=0;g<i.transceivers.length;g++)if(i.transceivers[g].mid===s.sdpMid){u=g;break}}var h=i.transceivers[u];if(!h)return c(p("OperationError","Can not add ICE candidate"));if(h.rejected)return a();var C=Object.keys(s.candidate).length>0?G.parseCandidate(s.candidate):{};if(C.protocol==="tcp"&&(C.port===0||C.port===9)||C.component&&C.component!==1)return a();if((u===0||u>0&&h.iceTransport!==i.transceivers[0].iceTransport)&&!S(h.iceTransport,C))return c(p("OperationError","Can not add ICE candidate"));var E=s.candidate.trim();E.indexOf("a=")===0&&(E=E.substr(2)),(n=G.getMediaSections(i._remoteDescription.sdp))[u]+="a="+(C.type?E:"end-of-candidates")+`\r
`,i._remoteDescription.sdp=G.getDescription(i._remoteDescription.sdp)+n.join("")}else for(var y=0;y<i.transceivers.length&&(i.transceivers[y].rejected||(i.transceivers[y].iceTransport.addRemoteCandidate({}),(n=G.getMediaSections(i._remoteDescription.sdp))[y]+=`a=end-of-candidates\r
`,i._remoteDescription.sdp=G.getDescription(i._remoteDescription.sdp)+n.join(""),!i.usingBundle));y++);a()})},f.prototype.getStats=function(s){if(s&&s instanceof b.MediaStreamTrack){var n=null;if(this.transceivers.forEach(function(a){a.rtpSender&&a.rtpSender.track===s?n=a.rtpSender:a.rtpReceiver&&a.rtpReceiver.track===s&&(n=a.rtpReceiver)}),!n)throw p("InvalidAccessError","Invalid selector.");return n.getStats()}var i=[];return this.transceivers.forEach(function(a){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(c){a[c]&&i.push(a[c].getStats())})}),Promise.all(i).then(function(a){var c=new Map;return a.forEach(function(u){u.forEach(function(g){c.set(g.id,g)})}),c})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(s){var n=b[s];if(n&&n.prototype&&n.prototype.getStats){var i=n.prototype.getStats;n.prototype.getStats=function(){return i.apply(this).then(function(a){var c=new Map;return Object.keys(a).forEach(function(u){var g;a[u].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(g=a[u]).type]||g.type,c.set(u,a[u])}),c})}}});var o=["createOffer","createAnswer"];return o.forEach(function(s){var n=f.prototype[s];f.prototype[s]=function(){var i=arguments;return typeof i[0]=="function"||typeof i[1]=="function"?n.apply(this,[arguments[2]]).then(function(a){typeof i[0]=="function"&&i[0].apply(null,[a])},function(a){typeof i[1]=="function"&&i[1].apply(null,[a])}):n.apply(this,arguments)}}),(o=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(s){var n=f.prototype[s];f.prototype[s]=function(){var i=arguments;return typeof i[1]=="function"||typeof i[2]=="function"?n.apply(this,arguments).then(function(){typeof i[1]=="function"&&i[1].apply(null)},function(a){typeof i[2]=="function"&&i[2].apply(null,[a])}):n.apply(this,arguments)}}),["getStats"].forEach(function(s){var n=f.prototype[s];f.prototype[s]=function(){var i=arguments;return typeof i[1]=="function"?n.apply(this,arguments).then(function(){typeof i[1]=="function"&&i[1].apply(null)}):n.apply(this,arguments)}}),f}},"./node_modules/sdp/sdp.js":function(Se,U,K){var G={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};G.localCName=G.generateIdentifier(),G.splitLines=function(q){return q.trim().split(`
`).map(function(x){return x.trim()})},G.splitSections=function(q){return q.split(`
m=`).map(function(x,N){return(N>0?"m="+x:x).trim()+`\r
`})},G.getDescription=function(q){var x=G.splitSections(q);return x&&x[0]},G.getMediaSections=function(q){var x=G.splitSections(q);return x.shift(),x},G.matchPrefix=function(q,x){return G.splitLines(q).filter(function(N){return N.indexOf(x)===0})},G.parseCandidate=function(q){for(var x,N={foundation:(x=q.indexOf("a=candidate:")===0?q.substring(12).split(" "):q.substring(10).split(" "))[0],component:parseInt(x[1],10),protocol:x[2].toLowerCase(),priority:parseInt(x[3],10),ip:x[4],address:x[4],port:parseInt(x[5],10),type:x[7]},S=8;S<x.length;S+=2)switch(x[S]){case"raddr":N.relatedAddress=x[S+1];break;case"rport":N.relatedPort=parseInt(x[S+1],10);break;case"tcptype":N.tcpType=x[S+1];break;case"ufrag":N.ufrag=x[S+1],N.usernameFragment=x[S+1];break;default:N[x[S]]=x[S+1]}return N},G.writeCandidate=function(q){var x=[];x.push(q.foundation),x.push(q.component),x.push(q.protocol.toUpperCase()),x.push(q.priority),x.push(q.address||q.ip),x.push(q.port);var N=q.type;return x.push("typ"),x.push(N),N!=="host"&&q.relatedAddress&&q.relatedPort&&(x.push("raddr"),x.push(q.relatedAddress),x.push("rport"),x.push(q.relatedPort)),q.tcpType&&q.protocol.toLowerCase()==="tcp"&&(x.push("tcptype"),x.push(q.tcpType)),(q.usernameFragment||q.ufrag)&&(x.push("ufrag"),x.push(q.usernameFragment||q.ufrag)),"candidate:"+x.join(" ")},G.parseIceOptions=function(q){return q.substr(14).split(" ")},G.parseRtpMap=function(q){var x=q.substr(9).split(" "),N={payloadType:parseInt(x.shift(),10)};return x=x[0].split("/"),N.name=x[0],N.clockRate=parseInt(x[1],10),N.channels=x.length===3?parseInt(x[2],10):1,N.numChannels=N.channels,N},G.writeRtpMap=function(q){var x=q.payloadType;q.preferredPayloadType!==void 0&&(x=q.preferredPayloadType);var N=q.channels||q.numChannels||1;return"a=rtpmap:"+x+" "+q.name+"/"+q.clockRate+(N!==1?"/"+N:"")+`\r
`},G.parseExtmap=function(q){var x=q.substr(9).split(" ");return{id:parseInt(x[0],10),direction:x[0].indexOf("/")>0?x[0].split("/")[1]:"sendrecv",uri:x[1]}},G.writeExtmap=function(q){return"a=extmap:"+(q.id||q.preferredId)+(q.direction&&q.direction!=="sendrecv"?"/"+q.direction:"")+" "+q.uri+`\r
`},G.parseFmtp=function(q){for(var x,N={},S=q.substr(q.indexOf(" ")+1).split(";"),p=0;p<S.length;p++)N[(x=S[p].trim().split("="))[0].trim()]=x[1];return N},G.writeFmtp=function(q){var x="",N=q.payloadType;if(q.preferredPayloadType!==void 0&&(N=q.preferredPayloadType),q.parameters&&Object.keys(q.parameters).length){var S=[];Object.keys(q.parameters).forEach(function(p){q.parameters[p]?S.push(p+"="+q.parameters[p]):S.push(p)}),x+="a=fmtp:"+N+" "+S.join(";")+`\r
`}return x},G.parseRtcpFb=function(q){var x=q.substr(q.indexOf(" ")+1).split(" ");return{type:x.shift(),parameter:x.join(" ")}},G.writeRtcpFb=function(q){var x="",N=q.payloadType;return q.preferredPayloadType!==void 0&&(N=q.preferredPayloadType),q.rtcpFeedback&&q.rtcpFeedback.length&&q.rtcpFeedback.forEach(function(S){x+="a=rtcp-fb:"+N+" "+S.type+(S.parameter&&S.parameter.length?" "+S.parameter:"")+`\r
`}),x},G.parseSsrcMedia=function(q){var x=q.indexOf(" "),N={ssrc:parseInt(q.substr(7,x-7),10)},S=q.indexOf(":",x);return S>-1?(N.attribute=q.substr(x+1,S-x-1),N.value=q.substr(S+1)):N.attribute=q.substr(x+1),N},G.parseSsrcGroup=function(q){var x=q.substr(13).split(" ");return{semantics:x.shift(),ssrcs:x.map(function(N){return parseInt(N,10)})}},G.getMid=function(q){var x=G.matchPrefix(q,"a=mid:")[0];if(x)return x.substr(6)},G.parseFingerprint=function(q){var x=q.substr(14).split(" ");return{algorithm:x[0].toLowerCase(),value:x[1]}},G.getDtlsParameters=function(q,x){return{role:"auto",fingerprints:G.matchPrefix(q+x,"a=fingerprint:").map(G.parseFingerprint)}},G.writeDtlsParameters=function(q,x){var N="a=setup:"+x+`\r
`;return q.fingerprints.forEach(function(S){N+="a=fingerprint:"+S.algorithm+" "+S.value+`\r
`}),N},G.parseCryptoLine=function(q){var x=q.substr(9).split(" ");return{tag:parseInt(x[0],10),cryptoSuite:x[1],keyParams:x[2],sessionParams:x.slice(3)}},G.writeCryptoLine=function(q){return"a=crypto:"+q.tag+" "+q.cryptoSuite+" "+(typeof q.keyParams=="object"?G.writeCryptoKeyParams(q.keyParams):q.keyParams)+(q.sessionParams?" "+q.sessionParams.join(" "):"")+`\r
`},G.parseCryptoKeyParams=function(q){if(q.indexOf("inline:")!==0)return null;var x=q.substr(7).split("|");return{keyMethod:"inline",keySalt:x[0],lifeTime:x[1],mkiValue:x[2]?x[2].split(":")[0]:void 0,mkiLength:x[2]?x[2].split(":")[1]:void 0}},G.writeCryptoKeyParams=function(q){return q.keyMethod+":"+q.keySalt+(q.lifeTime?"|"+q.lifeTime:"")+(q.mkiValue&&q.mkiLength?"|"+q.mkiValue+":"+q.mkiLength:"")},G.getCryptoParameters=function(q,x){return G.matchPrefix(q+x,"a=crypto:").map(G.parseCryptoLine)},G.getIceParameters=function(q,x){var N=G.matchPrefix(q+x,"a=ice-ufrag:")[0],S=G.matchPrefix(q+x,"a=ice-pwd:")[0];return N&&S?{usernameFragment:N.substr(12),password:S.substr(10)}:null},G.writeIceParameters=function(q){return"a=ice-ufrag:"+q.usernameFragment+`\r
a=ice-pwd:`+q.password+`\r
`},G.parseRtpParameters=function(q){for(var x={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},N=G.splitLines(q)[0].split(" "),S=3;S<N.length;S++){var p=N[S],b=G.matchPrefix(q,"a=rtpmap:"+p+" ")[0];if(b){var _=G.parseRtpMap(b),t=G.matchPrefix(q,"a=fmtp:"+p+" ");switch(_.parameters=t.length?G.parseFmtp(t[0]):{},_.rtcpFeedback=G.matchPrefix(q,"a=rtcp-fb:"+p+" ").map(G.parseRtcpFb),x.codecs.push(_),_.name.toUpperCase()){case"RED":case"ULPFEC":x.fecMechanisms.push(_.name.toUpperCase())}}}return G.matchPrefix(q,"a=extmap:").forEach(function(m){x.headerExtensions.push(G.parseExtmap(m))}),x},G.writeRtpDescription=function(q,x){var N="";N+="m="+q+" ",N+=x.codecs.length>0?"9":"0",N+=" UDP/TLS/RTP/SAVPF ",N+=x.codecs.map(function(p){return p.preferredPayloadType!==void 0?p.preferredPayloadType:p.payloadType}).join(" ")+`\r
`,N+=`c=IN IP4 0.0.0.0\r
`,N+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,x.codecs.forEach(function(p){N+=G.writeRtpMap(p),N+=G.writeFmtp(p),N+=G.writeRtcpFb(p)});var S=0;return x.codecs.forEach(function(p){p.maxptime>S&&(S=p.maxptime)}),S>0&&(N+="a=maxptime:"+S+`\r
`),N+=`a=rtcp-mux\r
`,x.headerExtensions&&x.headerExtensions.forEach(function(p){N+=G.writeExtmap(p)}),N},G.parseRtpEncodingParameters=function(q){var x,N=[],S=G.parseRtpParameters(q),p=S.fecMechanisms.indexOf("RED")!==-1,b=S.fecMechanisms.indexOf("ULPFEC")!==-1,_=G.matchPrefix(q,"a=ssrc:").map(function(o){return G.parseSsrcMedia(o)}).filter(function(o){return o.attribute==="cname"}),t=_.length>0&&_[0].ssrc,m=G.matchPrefix(q,"a=ssrc-group:FID").map(function(o){return o.substr(17).split(" ").map(function(s){return parseInt(s,10)})});m.length>0&&m[0].length>1&&m[0][0]===t&&(x=m[0][1]),S.codecs.forEach(function(o){if(o.name.toUpperCase()==="RTX"&&o.parameters.apt){var s={ssrc:t,codecPayloadType:parseInt(o.parameters.apt,10)};t&&x&&(s.rtx={ssrc:x}),N.push(s),p&&((s=JSON.parse(JSON.stringify(s))).fec={ssrc:t,mechanism:b?"red+ulpfec":"red"},N.push(s))}}),N.length===0&&t&&N.push({ssrc:t});var f=G.matchPrefix(q,"b=");return f.length&&(f=f[0].indexOf("b=TIAS:")===0?parseInt(f[0].substr(7),10):f[0].indexOf("b=AS:")===0?1e3*parseInt(f[0].substr(5),10)*.95-16e3:void 0,N.forEach(function(o){o.maxBitrate=f})),N},G.parseRtcpParameters=function(q){var x={},N=G.matchPrefix(q,"a=ssrc:").map(function(b){return G.parseSsrcMedia(b)}).filter(function(b){return b.attribute==="cname"})[0];N&&(x.cname=N.value,x.ssrc=N.ssrc);var S=G.matchPrefix(q,"a=rtcp-rsize");x.reducedSize=S.length>0,x.compound=S.length===0;var p=G.matchPrefix(q,"a=rtcp-mux");return x.mux=p.length>0,x},G.parseMsid=function(q){var x,N=G.matchPrefix(q,"a=msid:");if(N.length===1)return{stream:(x=N[0].substr(7).split(" "))[0],track:x[1]};var S=G.matchPrefix(q,"a=ssrc:").map(function(p){return G.parseSsrcMedia(p)}).filter(function(p){return p.attribute==="msid"});return S.length>0?{stream:(x=S[0].value.split(" "))[0],track:x[1]}:void 0},G.parseSctpDescription=function(q){var x,N=G.parseMLine(q),S=G.matchPrefix(q,"a=max-message-size:");S.length>0&&(x=parseInt(S[0].substr(19),10)),isNaN(x)&&(x=65536);var p=G.matchPrefix(q,"a=sctp-port:");if(p.length>0)return{port:parseInt(p[0].substr(12),10),protocol:N.fmt,maxMessageSize:x};if(G.matchPrefix(q,"a=sctpmap:").length>0){var b=G.matchPrefix(q,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(b[0],10),protocol:b[1],maxMessageSize:x}}},G.writeSctpDescription=function(q,x){var N=[];return N=q.protocol!=="DTLS/SCTP"?["m="+q.kind+" 9 "+q.protocol+" "+x.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+x.port+`\r
`]:["m="+q.kind+" 9 "+q.protocol+" "+x.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+x.port+" "+x.protocol+` 65535\r
`],x.maxMessageSize!==void 0&&N.push("a=max-message-size:"+x.maxMessageSize+`\r
`),N.join("")},G.generateSessionId=function(){return Math.random().toString().substr(2,21)},G.writeSessionBoilerplate=function(q,x,N){var S=x!==void 0?x:2;return`v=0\r
o=`+(N||"thisisadapterortc")+" "+(q||G.generateSessionId())+" "+S+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},G.writeMediaSection=function(q,x,N,S){var p=G.writeRtpDescription(q.kind,x);if(p+=G.writeIceParameters(q.iceGatherer.getLocalParameters()),p+=G.writeDtlsParameters(q.dtlsTransport.getLocalParameters(),N==="offer"?"actpass":"active"),p+="a=mid:"+q.mid+`\r
`,q.direction?p+="a="+q.direction+`\r
`:q.rtpSender&&q.rtpReceiver?p+=`a=sendrecv\r
`:q.rtpSender?p+=`a=sendonly\r
`:q.rtpReceiver?p+=`a=recvonly\r
`:p+=`a=inactive\r
`,q.rtpSender){var b="msid:"+S.id+" "+q.rtpSender.track.id+`\r
`;p+="a="+b,p+="a=ssrc:"+q.sendEncodingParameters[0].ssrc+" "+b,q.sendEncodingParameters[0].rtx&&(p+="a=ssrc:"+q.sendEncodingParameters[0].rtx.ssrc+" "+b,p+="a=ssrc-group:FID "+q.sendEncodingParameters[0].ssrc+" "+q.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return p+="a=ssrc:"+q.sendEncodingParameters[0].ssrc+" cname:"+G.localCName+`\r
`,q.rtpSender&&q.sendEncodingParameters[0].rtx&&(p+="a=ssrc:"+q.sendEncodingParameters[0].rtx.ssrc+" cname:"+G.localCName+`\r
`),p},G.getDirection=function(q,x){for(var N=G.splitLines(q),S=0;S<N.length;S++)switch(N[S]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return N[S].substr(2)}return x?G.getDirection(x):"sendrecv"},G.getKind=function(q){return G.splitLines(q)[0].split(" ")[0].substr(2)},G.isRejected=function(q){return q.split(" ",2)[1]==="0"},G.parseMLine=function(q){var x=G.splitLines(q)[0].substr(2).split(" ");return{kind:x[0],port:parseInt(x[1],10),protocol:x[2],fmt:x.slice(3).join(" ")}},G.parseOLine=function(q){var x=G.matchPrefix(q,"o=")[0].substr(2).split(" ");return{username:x[0],sessionId:x[1],sessionVersion:parseInt(x[2],10),netType:x[3],addressType:x[4],address:x[5]}},G.isValidSDP=function(q){if(typeof q!="string"||q.length===0)return!1;for(var x=G.splitLines(q),N=0;N<x.length;N++)if(x[N].length<2||x[N].charAt(1)!=="=")return!1;return!0},Se.exports=G},"./node_modules/semver-parser/index.js":function(Se,U,K){const{compareSemVer:G,isValidSemVer:q,parseSemVer:x,promises:N}=K("./node_modules/semver-parser/modules/semver.js");Se.exports={compareSemVer:G,isValidSemVer:q,parseSemVer:x,promises:N}},"./node_modules/semver-parser/modules/common.js":function(Se,U,K){const G=x=>Object.prototype.toString.call(x).slice(8,-1),q=x=>typeof x=="string"||x instanceof String;Se.exports={escapeChar:(x,N)=>q(x)&&N&&N.global?x.replace(N,(S,p)=>`\\${p}`):null,getType:G,isString:q,logErr:x=>(console.error(x),!1),logMsg:x=>(x&&console.log(x),x),logWarn:x=>(x&&console.warn(x),!1),parseStringifiedInt:(x,N=!1)=>{if(!q(x))throw new TypeError(`Expexted String but got ${G(x)}`);if(!N&&!/^-?(?:0|[1-9]\d*)$/.test(x))throw new Error(`${x} is not a stringified integer.`);return parseInt(x)},stringifyPositiveInt:(x,N=!1)=>Number.isSafeInteger(x)&&(N&&x>=0||x>0)?`${x}`:null,stripHtmlTags:x=>{for(;/^\n*<(?:[^>]+:)?[^>]+?>|<\/(?:[^>]+:)?[^>]+>\n*$/.test(x);)x=x.replace(/^\n*<(?:[^>]+:)?[^>]+?>/,"").replace(/<\/(?:[^>]+:)?[^>]+>\n*$/,`
`);return x.replace(/<\/(?:[^>]+:)?[^>]+>\n*<!--.*-->\n*<(?:[^>]+:)?[^>]+>/g,`

`).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},throwErr:x=>{throw x}}},"./node_modules/semver-parser/modules/semver.js":function(Se,U,K){const{getType:G,isString:q}=K("./node_modules/semver-parser/modules/common.js"),x="(?:0|[1-9]\\d*)",N="\\d*[A-z-][A-z\\d-]*",S=`(?:${N}|${x})`,p=`(?:${N}|\\d+)`,b=`(${x}(?:\\.${x}){2})(?:-(${`${S}(?:\\.${S})*`}))?(?:\\+(${`${p}(?:\\.${p})*`}))?`,_=new RegExp(`^${x}$`),t=new RegExp(`^v?${b}$`),m=new RegExp(`^${b}$`),f=(i,a=!1)=>{if(!q(i))throw new TypeError(`Expected String but got ${G(i)}.`);return(a?m:t).test(i)},o=(i,a=!1)=>{if(!q(i))throw new TypeError(`Expected String but got ${G(i)}.`);if(!a&&!_.test(i))throw new Error(`${i} is not a stringified positive integer.`);if(_.test(i)&&(i=parseInt(i,10),!Number.isSafeInteger(i)))throw new RangeError(`${i} exceeds ${Number.MAX_SAFE_INTEGER}.`);return i},s=(i,a,c=!1)=>{if(!q(i))throw new TypeError(`Expected String but got ${G(i)}.`);if(!q(a))throw new TypeError(`Expected String but got ${G(a)}.`);if(!f(i,!!c))throw new Error(`${i} is not valid version string.`);if(!f(a,!!c))throw new Error(`${a} is not valid version string.`);let u;if(i===a)u=0;else{const g=c?m:t,[,h,C]=i.match(g),[,E,y]=a.match(g),[w,O,L]=h.split(".").map(o),[I,k,P]=E.split(".").map(o);if(w>I)u=1;else if(w<I)u=-1;else if(O>k)u=1;else if(O<k)u=-1;else if(L>P)u=1;else if(L<P)u=-1;else if(C===y)u=0;else if(!C&&y)u=1;else if(C&&!y)u=-1;else{const F=C.split(".").map(j=>o(j,!0)),H=y.split(".").map(j=>o(j,!0)),D=Math.max(F.length,H.length);let $=0;for(;$<D;){const j=F[$],V=H[$];if(j&&!V||q(j)&&Number.isInteger(V)?u=1:!j&&V||Number.isInteger(j)&&q(V)?u=-1:j!==V&&q(j)&&q(V)?u=j.localeCompare(V):Number.isInteger(j)&&Number.isInteger(V)&&(j>V?u=1:j<V&&(u=-1)),Number.isInteger(u))break;$++}}}return u},n=(i,a=!1)=>{if(!q(i))throw new TypeError(`Expected String but got ${G(i)}.`);const c=f(i,!!a);let u,g,h,C,E;if(c){const y=a?m:t,[,w,O,L]=i.match(y);[u,g,h]=w.split(".").map(o),O&&(C=O.split(".").map(I=>o(I,!0))),L&&(E=L.split(".").map(I=>o(I,!0)))}return{version:i,matches:c,major:u,minor:g,patch:h,pre:C,build:E}};Se.exports={compareSemVer:s,isValidSemVer:f,parseSemVer:n,parseVersionPart:o,promises:{compareSemVer:async(i,a,c=!1)=>await s(i,a,c),isValidSemVer:async(i,a=!1)=>await f(i,a),parseSemVer:async(i,a=!1)=>await n(i,a)}}},"./node_modules/webpack/buildin/global.js":function(Se,U){var K;K=function(){return this}();try{K=K||new Function("return this")()}catch{typeof window=="object"&&(K=window)}Se.exports=K},"./node_modules/webrtc-adapter/src/js/adapter_core.js":function(Se,U,K){K.r(U);var G=K("./node_modules/webrtc-adapter/src/js/adapter_factory.js");const q=Object(G.adapterFactory)({window:typeof window>"u"?void 0:window});U.default=q},"./node_modules/webrtc-adapter/src/js/adapter_factory.js":function(Se,U,K){K.r(U),K.d(U,"adapterFactory",function(){return b});var G=K("./node_modules/webrtc-adapter/src/js/utils.js"),q=K("./node_modules/webrtc-adapter/src/js/chrome/chrome_shim.js"),x=K("./node_modules/webrtc-adapter/src/js/edge/edge_shim.js"),N=K("./node_modules/webrtc-adapter/src/js/firefox/firefox_shim.js"),S=K("./node_modules/webrtc-adapter/src/js/safari/safari_shim.js"),p=K("./node_modules/webrtc-adapter/src/js/common_shim.js");function b({window:_}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const m=G.log,f=G.detectBrowser(_),o={browserDetails:f,commonShim:p,extractVersion:G.extractVersion,disableLog:G.disableLog,disableWarnings:G.disableWarnings};switch(f.browser){case"chrome":if(!q||!q.shimPeerConnection||!t.shimChrome)return m("Chrome shim is not included in this adapter release."),o;if(f.version===null)return m("Chrome shim can not determine version, not shimming."),o;m("adapter.js shimming chrome."),o.browserShim=q,q.shimGetUserMedia(_),q.shimMediaStream(_),q.shimPeerConnection(_),q.shimOnTrack(_),q.shimAddTrackRemoveTrack(_),q.shimGetSendersWithDtmf(_),q.shimGetStats(_),q.shimSenderReceiverGetStats(_),q.fixNegotiationNeeded(_),p.shimRTCIceCandidate(_),p.shimConnectionState(_),p.shimMaxMessageSize(_),p.shimSendThrowTypeError(_),p.removeAllowExtmapMixed(_);break;case"firefox":if(!N||!N.shimPeerConnection||!t.shimFirefox)return m("Firefox shim is not included in this adapter release."),o;m("adapter.js shimming firefox."),o.browserShim=N,N.shimGetUserMedia(_),N.shimPeerConnection(_),N.shimOnTrack(_),N.shimRemoveStream(_),N.shimSenderGetStats(_),N.shimReceiverGetStats(_),N.shimRTCDataChannel(_),N.shimAddTransceiver(_),N.shimGetParameters(_),N.shimCreateOffer(_),N.shimCreateAnswer(_),p.shimRTCIceCandidate(_),p.shimConnectionState(_),p.shimMaxMessageSize(_),p.shimSendThrowTypeError(_);break;case"edge":if(!x||!x.shimPeerConnection||!t.shimEdge)return m("MS edge shim is not included in this adapter release."),o;m("adapter.js shimming edge."),o.browserShim=x,x.shimGetUserMedia(_),x.shimGetDisplayMedia(_),x.shimPeerConnection(_),x.shimReplaceTrack(_),p.shimMaxMessageSize(_),p.shimSendThrowTypeError(_);break;case"safari":if(!S||!t.shimSafari)return m("Safari shim is not included in this adapter release."),o;m("adapter.js shimming safari."),o.browserShim=S,S.shimRTCIceServerUrls(_),S.shimCreateOfferLegacy(_),S.shimCallbacksAPI(_),S.shimLocalStreamsAPI(_),S.shimRemoteStreamsAPI(_),S.shimTrackEventTransceiver(_),S.shimGetUserMedia(_),S.shimAudioContext(_),p.shimRTCIceCandidate(_),p.shimMaxMessageSize(_),p.shimSendThrowTypeError(_),p.removeAllowExtmapMixed(_);break;default:m("Unsupported browser!")}return o}},"./node_modules/webrtc-adapter/src/js/chrome/chrome_shim.js":function(Se,U,K){K.r(U),K.d(U,"shimMediaStream",function(){return N}),K.d(U,"shimOnTrack",function(){return S}),K.d(U,"shimGetSendersWithDtmf",function(){return p}),K.d(U,"shimGetStats",function(){return b}),K.d(U,"shimSenderReceiverGetStats",function(){return _}),K.d(U,"shimAddTrackRemoveTrackWithNative",function(){return t}),K.d(U,"shimAddTrackRemoveTrack",function(){return m}),K.d(U,"shimPeerConnection",function(){return f}),K.d(U,"fixNegotiationNeeded",function(){return o});var G=K("./node_modules/webrtc-adapter/src/js/utils.js"),q=K("./node_modules/webrtc-adapter/src/js/chrome/getusermedia.js");K.d(U,"shimGetUserMedia",function(){return q.shimGetUserMedia});var x=K("./node_modules/webrtc-adapter/src/js/chrome/getdisplaymedia.js");function N(s){s.MediaStream=s.MediaStream||s.webkitMediaStream}function S(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("ontrack"in s.RTCPeerConnection.prototype)){Object.defineProperty(s.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const n=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",a=>{let c;c=s.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(g=>g.track&&g.track.id===a.track.id):{track:a.track};const u=new Event("track");u.track=a.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)}),i.stream.getTracks().forEach(a=>{let c;c=s.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(g=>g.track&&g.track.id===a.id):{track:a};const u=new Event("track");u.track=a,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),n.apply(this,arguments)}}else G.wrapPeerConnectionEvent(s,"track",n=>(n.transceiver||Object.defineProperty(n,"transceiver",{value:{receiver:n.receiver}}),n))}function p(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("getSenders"in s.RTCPeerConnection.prototype)&&"createDTMFSender"in s.RTCPeerConnection.prototype){const n=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!s.RTCPeerConnection.prototype.getSenders){s.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(g,h){let C=c.apply(this,arguments);return C||(C=n(this,g),this._senders.push(C)),C};const u=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(g){u.apply(this,arguments);const h=this._senders.indexOf(g);h!==-1&&this._senders.splice(h,1)}}const i=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(n(this,u))})};const a=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],a.apply(this,[c]),c.getTracks().forEach(u=>{const g=this._senders.find(h=>h.track===u);g&&this._senders.splice(this._senders.indexOf(g),1)})}}else if(typeof s=="object"&&s.RTCPeerConnection&&"getSenders"in s.RTCPeerConnection.prototype&&"createDTMFSender"in s.RTCPeerConnection.prototype&&s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)){const n=s.RTCPeerConnection.prototype.getSenders;s.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(a=>a._pc=this),i},Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function b(s){if(!s.RTCPeerConnection)return;const n=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[i,a,c]=arguments;if(arguments.length>0&&typeof i=="function")return n.apply(this,arguments);if(n.length===0&&(arguments.length===0||typeof i!="function"))return n.apply(this,[]);const u=function(h){const C={};return h.result().forEach(E=>{const y={id:E.id,timestamp:E.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[E.type]||E.type};E.names().forEach(w=>{y[w]=E.stat(w)}),C[y.id]=y}),C},g=function(h){return new Map(Object.keys(h).map(C=>[C,h[C]]))};if(arguments.length>=2){const h=function(C){a(g(u(C)))};return n.apply(this,[h,i])}return new Promise((h,C)=>{n.apply(this,[function(E){h(g(u(E)))},C])}).then(a,c)}}function _(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender&&s.RTCRtpReceiver))return;if(!("getStats"in s.RTCRtpSender.prototype)){const i=s.RTCPeerConnection.prototype.getSenders;i&&(s.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(u=>u._pc=this),c});const a=s.RTCPeerConnection.prototype.addTrack;a&&(s.RTCPeerConnection.prototype.addTrack=function(){const c=a.apply(this,arguments);return c._pc=this,c}),s.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>G.filterStats(u,c.track,!0))}}if(!("getStats"in s.RTCRtpReceiver.prototype)){const i=s.RTCPeerConnection.prototype.getReceivers;i&&(s.RTCPeerConnection.prototype.getReceivers=function(){const a=i.apply(this,[]);return a.forEach(c=>c._pc=this),a}),G.wrapPeerConnectionEvent(s,"track",a=>(a.receiver._pc=a.srcElement,a)),s.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(c=>G.filterStats(c,a.track,!1))}}if(!("getStats"in s.RTCRtpSender.prototype)||!("getStats"in s.RTCRtpReceiver.prototype))return;const n=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof s.MediaStreamTrack){const i=arguments[0];let a,c,u;return this.getSenders().forEach(g=>{g.track===i&&(a?u=!0:a=g)}),this.getReceivers().forEach(g=>(g.track===i&&(c?u=!0:c=g),g.track===i)),u||a&&c?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():c?c.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}function t(s){s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const n=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(u,g){if(!g)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const h=n.apply(this,arguments);return this._shimmedLocalStreams[g.id]?this._shimmedLocalStreams[g.id].indexOf(h)===-1&&this._shimmedLocalStreams[g.id].push(h):this._shimmedLocalStreams[g.id]=[g,h],h};const i=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(C=>{if(this.getSenders().find(E=>E.track===C))throw new DOMException("Track already exists.","InvalidAccessError")});const g=this.getSenders();i.apply(this,arguments);const h=this.getSenders().filter(C=>g.indexOf(C)===-1);this._shimmedLocalStreams[u.id]=[u].concat(h)};const a=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],a.apply(this,arguments)};const c=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(g=>{const h=this._shimmedLocalStreams[g].indexOf(u);h!==-1&&this._shimmedLocalStreams[g].splice(h,1),this._shimmedLocalStreams[g].length===1&&delete this._shimmedLocalStreams[g]}),c.apply(this,arguments)}}function m(s){if(!s.RTCPeerConnection)return;const n=G.detectBrowser(s);if(s.RTCPeerConnection.prototype.addTrack&&n.version>=65)return t(s);const i=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){const E=i.apply(this);return this._reverseStreams=this._reverseStreams||{},E.map(y=>this._reverseStreams[y.id])};const a=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(E){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},E.getTracks().forEach(y=>{if(this.getSenders().find(w=>w.track===y))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[E.id]){const y=new s.MediaStream(E.getTracks());this._streams[E.id]=y,this._reverseStreams[y.id]=E,E=y}a.apply(this,[E])};const c=s.RTCPeerConnection.prototype.removeStream;function u(E,y){let w=y.sdp;return Object.keys(E._reverseStreams||[]).forEach(O=>{const L=E._reverseStreams[O],I=E._streams[L.id];w=w.replace(new RegExp(I.id,"g"),L.id)}),new RTCSessionDescription({type:y.type,sdp:w})}function g(E,y){let w=y.sdp;return Object.keys(E._reverseStreams||[]).forEach(O=>{const L=E._reverseStreams[O],I=E._streams[L.id];w=w.replace(new RegExp(L.id,"g"),I.id)}),new RTCSessionDescription({type:y.type,sdp:w})}s.RTCPeerConnection.prototype.removeStream=function(E){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[E.id]||E]),delete this._reverseStreams[this._streams[E.id]?this._streams[E.id].id:E.id],delete this._streams[E.id]},s.RTCPeerConnection.prototype.addTrack=function(E,y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const w=[].slice.call(arguments,1);if(w.length!==1||!w[0].getTracks().find(I=>I===E))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(I=>I.track===E))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const L=this._streams[y.id];if(L)L.addTrack(E),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const I=new s.MediaStream([E]);this._streams[y.id]=I,this._reverseStreams[I.id]=y,this.addStream(I)}return this.getSenders().find(I=>I.track===E)},["createOffer","createAnswer"].forEach(function(E){const y=s.RTCPeerConnection.prototype[E],w={[E](){const O=arguments;return arguments.length&&typeof arguments[0]=="function"?y.apply(this,[L=>{const I=u(this,L);O[0].apply(null,[I])},L=>{O[1]&&O[1].apply(null,L)},arguments[2]]):y.apply(this,arguments).then(L=>u(this,L))}};s.RTCPeerConnection.prototype[E]=w[E]});const h=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=g(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const C=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get(){const E=C.get.apply(this);return E.type===""?E:u(this,E)}}),s.RTCPeerConnection.prototype.removeTrack=function(E){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!E._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(E._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let y;this._streams=this._streams||{},Object.keys(this._streams).forEach(w=>{this._streams[w].getTracks().find(O=>E.track===O)&&(y=this._streams[w])}),y&&(y.getTracks().length===1?this.removeStream(this._reverseStreams[y.id]):y.removeTrack(E.track),this.dispatchEvent(new Event("negotiationneeded")))}}function f(s){const n=G.detectBrowser(s);if(!s.RTCPeerConnection&&s.webkitRTCPeerConnection&&(s.RTCPeerConnection=s.webkitRTCPeerConnection),!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype.addIceCandidate.length===0;n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=s.RTCPeerConnection.prototype[c],g={[c](){return arguments[0]=new(c==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};s.RTCPeerConnection.prototype[c]=g[c]});const a=s.RTCPeerConnection.prototype.addIceCandidate;s.RTCPeerConnection.prototype.addIceCandidate=function(){return i||arguments[0]?n.version<78&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}function o(s){const n=G.detectBrowser(s);G.wrapPeerConnectionEvent(s,"negotiationneeded",i=>{const a=i.target;if(!(n.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")||a.signalingState==="stable")return i})}K.d(U,"shimGetDisplayMedia",function(){return x.shimGetDisplayMedia})},"./node_modules/webrtc-adapter/src/js/chrome/getdisplaymedia.js":function(Se,U,K){function G(q,x){q.navigator.mediaDevices&&"getDisplayMedia"in q.navigator.mediaDevices||q.navigator.mediaDevices&&(typeof x=="function"?q.navigator.mediaDevices.getDisplayMedia=function(N){return x(N).then(S=>{const p=N.video&&N.video.width,b=N.video&&N.video.height,_=N.video&&N.video.frameRate;return N.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:S,maxFrameRate:_||3}},p&&(N.video.mandatory.maxWidth=p),b&&(N.video.mandatory.maxHeight=b),q.navigator.mediaDevices.getUserMedia(N)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}K.r(U),K.d(U,"shimGetDisplayMedia",function(){return G})},"./node_modules/webrtc-adapter/src/js/chrome/getusermedia.js":function(Se,U,K){K.r(U),K.d(U,"shimGetUserMedia",function(){return x});var G=K("./node_modules/webrtc-adapter/src/js/utils.js");const q=G.log;function x(N){const S=N&&N.navigator;if(!S.mediaDevices)return;const p=G.detectBrowser(N),b=function(m){if(typeof m!="object"||m.mandatory||m.optional)return m;const f={};return Object.keys(m).forEach(o=>{if(o==="require"||o==="advanced"||o==="mediaSource")return;const s=typeof m[o]=="object"?m[o]:{ideal:m[o]};s.exact!==void 0&&typeof s.exact=="number"&&(s.min=s.max=s.exact);const n=function(i,a){return i?i+a.charAt(0).toUpperCase()+a.slice(1):a==="deviceId"?"sourceId":a};if(s.ideal!==void 0){f.optional=f.optional||[];let i={};typeof s.ideal=="number"?(i[n("min",o)]=s.ideal,f.optional.push(i),i={},i[n("max",o)]=s.ideal,f.optional.push(i)):(i[n("",o)]=s.ideal,f.optional.push(i))}s.exact!==void 0&&typeof s.exact!="number"?(f.mandatory=f.mandatory||{},f.mandatory[n("",o)]=s.exact):["min","max"].forEach(i=>{s[i]!==void 0&&(f.mandatory=f.mandatory||{},f.mandatory[n(i,o)]=s[i])})}),m.advanced&&(f.optional=(f.optional||[]).concat(m.advanced)),f},_=function(m,f){if(p.version>=61)return f(m);if((m=JSON.parse(JSON.stringify(m)))&&typeof m.audio=="object"){const o=function(s,n,i){n in s&&!(i in s)&&(s[i]=s[n],delete s[n])};o((m=JSON.parse(JSON.stringify(m))).audio,"autoGainControl","googAutoGainControl"),o(m.audio,"noiseSuppression","googNoiseSuppression"),m.audio=b(m.audio)}if(m&&typeof m.video=="object"){let o=m.video.facingMode;o=o&&(typeof o=="object"?o:{ideal:o});const s=p.version<66;if(o&&(o.exact==="user"||o.exact==="environment"||o.ideal==="user"||o.ideal==="environment")&&(!S.mediaDevices.getSupportedConstraints||!S.mediaDevices.getSupportedConstraints().facingMode||s)){let n;if(delete m.video.facingMode,o.exact==="environment"||o.ideal==="environment"?n=["back","rear"]:o.exact!=="user"&&o.ideal!=="user"||(n=["front"]),n)return S.mediaDevices.enumerateDevices().then(i=>{let a=(i=i.filter(c=>c.kind==="videoinput")).find(c=>n.some(u=>c.label.toLowerCase().includes(u)));return!a&&i.length&&n.includes("back")&&(a=i[i.length-1]),a&&(m.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),m.video=b(m.video),q("chrome: "+JSON.stringify(m)),f(m)})}m.video=b(m.video)}return q("chrome: "+JSON.stringify(m)),f(m)},t=function(m){return p.version>=64?m:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[m.name]||m.name,message:m.message,constraint:m.constraint||m.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(S.getUserMedia=(function(m,f,o){_(m,s=>{S.webkitGetUserMedia(s,f,n=>{o&&o(t(n))})})}).bind(S),S.mediaDevices.getUserMedia){const m=S.mediaDevices.getUserMedia.bind(S.mediaDevices);S.mediaDevices.getUserMedia=function(f){return _(f,o=>m(o).then(s=>{if(o.audio&&!s.getAudioTracks().length||o.video&&!s.getVideoTracks().length)throw s.getTracks().forEach(n=>{n.stop()}),new DOMException("","NotFoundError");return s},s=>Promise.reject(t(s))))}}}},"./node_modules/webrtc-adapter/src/js/common_shim.js":function(Se,U,K){K.r(U),K.d(U,"shimRTCIceCandidate",function(){return N}),K.d(U,"shimMaxMessageSize",function(){return S}),K.d(U,"shimSendThrowTypeError",function(){return p}),K.d(U,"shimConnectionState",function(){return b}),K.d(U,"removeAllowExtmapMixed",function(){return _});var G=K("./node_modules/sdp/sdp.js"),q=K.n(G),x=K("./node_modules/webrtc-adapter/src/js/utils.js");function N(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const m=t.RTCIceCandidate;t.RTCIceCandidate=function(f){if(typeof f=="object"&&f.candidate&&f.candidate.indexOf("a=")===0&&((f=JSON.parse(JSON.stringify(f))).candidate=f.candidate.substr(2)),f.candidate&&f.candidate.length){const o=new m(f),s=q.a.parseCandidate(f.candidate),n=Object.assign(o,s);return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new m(f)},t.RTCIceCandidate.prototype=m.prototype,x.wrapPeerConnectionEvent(t,"icecandidate",f=>(f.candidate&&Object.defineProperty(f,"candidate",{value:new t.RTCIceCandidate(f.candidate),writable:"false"}),f))}function S(t){if(!t.RTCPeerConnection)return;const m=x.detectBrowser(t);"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const f=function(a){if(!a||!a.sdp)return!1;const c=q.a.splitSections(a.sdp);return c.shift(),c.some(u=>{const g=q.a.parseMLine(u);return g&&g.kind==="application"&&g.protocol.indexOf("SCTP")!==-1})},o=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const u=parseInt(c[1],10);return u!==u?-1:u},s=function(a){let c=65536;return m.browser==="firefox"&&(c=m.version<57?a===-1?16384:2147483637:m.version<60?m.version===57?65535:65536:2147483637),c},n=function(a,c){let u=65536;m.browser==="firefox"&&m.version===57&&(u=65535);const g=q.a.matchPrefix(a.sdp,"a=max-message-size:");return g.length>0?u=parseInt(g[0].substr(19),10):m.browser==="firefox"&&c!==-1&&(u=2147483637),u},i=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,m.browser==="chrome"&&m.version>=76){const{sdpSemantics:a}=this.getConfiguration();a==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(f(arguments[0])){const a=o(arguments[0]),c=s(a),u=n(arguments[0],a);let g;g=c===0&&u===0?Number.POSITIVE_INFINITY:c===0||u===0?Math.max(c,u):Math.min(c,u);const h={};Object.defineProperty(h,"maxMessageSize",{get:()=>g}),this._sctp=h}return i.apply(this,arguments)}}function p(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function m(o,s){const n=o.send;o.send=function(){const i=arguments[0],a=i.length||i.size||i.byteLength;if(o.readyState==="open"&&s.sctp&&a>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return n.apply(o,arguments)}}const f=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const o=f.apply(this,arguments);return m(o,this),o},x.wrapPeerConnectionEvent(t,"datachannel",o=>(m(o.channel,o.target),o))}function b(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const m=t.RTCPeerConnection.prototype;Object.defineProperty(m,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(m,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(f){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),f&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=f)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(f=>{const o=m[f];m[f]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const n=s.target;if(n._lastConnectionState!==n.connectionState){n._lastConnectionState=n.connectionState;const i=new Event("connectionstatechange",s);n.dispatchEvent(i)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function _(t){if(!t.RTCPeerConnection)return;const m=x.detectBrowser(t);if(m.browser==="chrome"&&m.version>=71||m.browser==="safari"&&m.version>=605)return;const f=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(o){return o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1&&(o.sdp=o.sdp.split(`
`).filter(s=>s.trim()!=="a=extmap-allow-mixed").join(`
`)),f.apply(this,arguments)}}},"./node_modules/webrtc-adapter/src/js/edge/edge_shim.js":function(Se,U,K){K.r(U),K.d(U,"shimPeerConnection",function(){return b}),K.d(U,"shimReplaceTrack",function(){return _});var G=K("./node_modules/webrtc-adapter/src/js/utils.js"),q=K("./node_modules/webrtc-adapter/src/js/edge/filtericeservers.js"),x=K("./node_modules/rtcpeerconnection-shim/rtcpeerconnection.js"),N=K.n(x),S=K("./node_modules/webrtc-adapter/src/js/edge/getusermedia.js");K.d(U,"shimGetUserMedia",function(){return S.shimGetUserMedia});var p=K("./node_modules/webrtc-adapter/src/js/edge/getdisplaymedia.js");function b(t){const m=G.detectBrowser(t);if(t.RTCIceGatherer&&(t.RTCIceCandidate||(t.RTCIceCandidate=function(o){return o}),t.RTCSessionDescription||(t.RTCSessionDescription=function(o){return o}),m.version<15025)){const o=Object.getOwnPropertyDescriptor(t.MediaStreamTrack.prototype,"enabled");Object.defineProperty(t.MediaStreamTrack.prototype,"enabled",{set(s){o.set.call(this,s);const n=new Event("enabled");n.enabled=s,this.dispatchEvent(n)}})}t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)&&Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new t.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),t.RTCDtmfSender&&!t.RTCDTMFSender&&(t.RTCDTMFSender=t.RTCDtmfSender);const f=N()(t,m.version);t.RTCPeerConnection=function(o){return o&&o.iceServers&&(o.iceServers=Object(q.filterIceServers)(o.iceServers,m.version),G.log("ICE servers after filtering:",o.iceServers)),new f(o)},t.RTCPeerConnection.prototype=f.prototype}function _(t){t.RTCRtpSender&&!("replaceTrack"in t.RTCRtpSender.prototype)&&(t.RTCRtpSender.prototype.replaceTrack=t.RTCRtpSender.prototype.setTrack)}K.d(U,"shimGetDisplayMedia",function(){return p.shimGetDisplayMedia})},"./node_modules/webrtc-adapter/src/js/edge/filtericeservers.js":function(Se,U,K){K.r(U),K.d(U,"filterIceServers",function(){return q});var G=K("./node_modules/webrtc-adapter/src/js/utils.js");function q(x,N){let S=!1;return(x=JSON.parse(JSON.stringify(x))).filter(p=>{if(p&&(p.urls||p.url)){let b=p.urls||p.url;p.url&&!p.urls&&G.deprecated("RTCIceServer.url","RTCIceServer.urls");const _=typeof b=="string";return _&&(b=[b]),b=b.filter(t=>{if(t.indexOf("stun:")===0)return!1;const m=t.startsWith("turn")&&!t.startsWith("turn:[")&&t.includes("transport=udp");return m&&!S?(S=!0,!0):m&&!S}),delete p.url,p.urls=_?b[0]:b,!!b.length}})}},"./node_modules/webrtc-adapter/src/js/edge/getdisplaymedia.js":function(Se,U,K){function G(q){"getDisplayMedia"in q.navigator&&q.navigator.mediaDevices&&(q.navigator.mediaDevices&&"getDisplayMedia"in q.navigator.mediaDevices||(q.navigator.mediaDevices.getDisplayMedia=q.navigator.getDisplayMedia.bind(q.navigator)))}K.r(U),K.d(U,"shimGetDisplayMedia",function(){return G})},"./node_modules/webrtc-adapter/src/js/edge/getusermedia.js":function(Se,U,K){function G(q){const x=q&&q.navigator,N=x.mediaDevices.getUserMedia.bind(x.mediaDevices);x.mediaDevices.getUserMedia=function(S){return N(S).catch(p=>Promise.reject(function(b){return{name:{PermissionDeniedError:"NotAllowedError"}[b.name]||b.name,message:b.message,constraint:b.constraint,toString(){return this.name}}}(p)))}}K.r(U),K.d(U,"shimGetUserMedia",function(){return G})},"./node_modules/webrtc-adapter/src/js/firefox/firefox_shim.js":function(Se,U,K){K.r(U),K.d(U,"shimOnTrack",function(){return N}),K.d(U,"shimPeerConnection",function(){return S}),K.d(U,"shimSenderGetStats",function(){return p}),K.d(U,"shimReceiverGetStats",function(){return b}),K.d(U,"shimRemoveStream",function(){return _}),K.d(U,"shimRTCDataChannel",function(){return t}),K.d(U,"shimAddTransceiver",function(){return m}),K.d(U,"shimGetParameters",function(){return f}),K.d(U,"shimCreateOffer",function(){return o}),K.d(U,"shimCreateAnswer",function(){return s});var G=K("./node_modules/webrtc-adapter/src/js/utils.js"),q=K("./node_modules/webrtc-adapter/src/js/firefox/getusermedia.js");K.d(U,"shimGetUserMedia",function(){return q.shimGetUserMedia});var x=K("./node_modules/webrtc-adapter/src/js/firefox/getdisplaymedia.js");function N(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function S(n){const i=G.detectBrowser(n);if(typeof n!="object"||!n.RTCPeerConnection&&!n.mozRTCPeerConnection)return;if(!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(u){const g=n.RTCPeerConnection.prototype[u],h={[u](){return arguments[0]=new(u==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),g.apply(this,arguments)}};n.RTCPeerConnection.prototype[u]=h[u]}),i.version<68){const u=n.RTCPeerConnection.prototype.addIceCandidate;n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&arguments[0].candidate===""?Promise.resolve():u.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}const a={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},c=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[u,g,h]=arguments;return c.apply(this,[u||null]).then(C=>{if(i.version<53&&!g)try{C.forEach(E=>{E.type=a[E.type]||E.type})}catch(E){if(E.name!=="TypeError")throw E;C.forEach((y,w)=>{C.set(w,Object.assign({},y,{type:a[y.type]||y.type}))})}return C}).then(g,h)}}function p(n){if(typeof n!="object"||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const i=n.RTCPeerConnection.prototype.getSenders;i&&(n.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(u=>u._pc=this),c});const a=n.RTCPeerConnection.prototype.addTrack;a&&(n.RTCPeerConnection.prototype.addTrack=function(){const c=a.apply(this,arguments);return c._pc=this,c}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function b(n){if(typeof n!="object"||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const i=n.RTCPeerConnection.prototype.getReceivers;i&&(n.RTCPeerConnection.prototype.getReceivers=function(){const a=i.apply(this,[]);return a.forEach(c=>c._pc=this),a}),G.wrapPeerConnectionEvent(n,"track",a=>(a.receiver._pc=a.srcElement,a)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function _(n){n.RTCPeerConnection&&!("removeStream"in n.RTCPeerConnection.prototype)&&(n.RTCPeerConnection.prototype.removeStream=function(i){G.deprecated("removeStream","removeTrack"),this.getSenders().forEach(a=>{a.track&&i.getTracks().includes(a.track)&&this.removeTrack(a)})})}function t(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function m(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype.addTransceiver;i&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const a=arguments[1],c=a&&"sendEncodings"in a;c&&a.sendEncodings.forEach(g=>{if("rid"in g&&!/^[a-z0-9]{0,16}$/i.test(g.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in g&&!(parseFloat(g.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in g&&!(parseFloat(g.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const u=i.apply(this,arguments);if(c){const{sender:g}=u,h=g.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=a.sendEncodings,g.sendEncodings=a.sendEncodings,this.setParametersPromises.push(g.setParameters(h).then(()=>{delete g.sendEncodings}).catch(()=>{delete g.sendEncodings})))}return u})}function f(n){if(typeof n!="object"||!n.RTCRtpSender)return;const i=n.RTCRtpSender.prototype.getParameters;i&&(n.RTCRtpSender.prototype.getParameters=function(){const a=i.apply(this,arguments);return"encodings"in a||(a.encodings=[].concat(this.sendEncodings||[{}])),a})}function o(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}function s(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}K.d(U,"shimGetDisplayMedia",function(){return x.shimGetDisplayMedia})},"./node_modules/webrtc-adapter/src/js/firefox/getdisplaymedia.js":function(Se,U,K){function G(q,x){q.navigator.mediaDevices&&"getDisplayMedia"in q.navigator.mediaDevices||q.navigator.mediaDevices&&(q.navigator.mediaDevices.getDisplayMedia=function(N){if(!N||!N.video){const S=new DOMException("getDisplayMedia without video constraints is undefined");return S.name="NotFoundError",S.code=8,Promise.reject(S)}return N.video===!0?N.video={mediaSource:x}:N.video.mediaSource=x,q.navigator.mediaDevices.getUserMedia(N)})}K.r(U),K.d(U,"shimGetDisplayMedia",function(){return G})},"./node_modules/webrtc-adapter/src/js/firefox/getusermedia.js":function(Se,U,K){K.r(U),K.d(U,"shimGetUserMedia",function(){return q});var G=K("./node_modules/webrtc-adapter/src/js/utils.js");function q(x){const N=G.detectBrowser(x),S=x&&x.navigator,p=x&&x.MediaStreamTrack;if(S.getUserMedia=function(b,_,t){G.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),S.mediaDevices.getUserMedia(b).then(_,t)},!(N.version>55&&"autoGainControl"in S.mediaDevices.getSupportedConstraints())){const b=function(t,m,f){m in t&&!(f in t)&&(t[f]=t[m],delete t[m])},_=S.mediaDevices.getUserMedia.bind(S.mediaDevices);if(S.mediaDevices.getUserMedia=function(t){return typeof t=="object"&&typeof t.audio=="object"&&(t=JSON.parse(JSON.stringify(t)),b(t.audio,"autoGainControl","mozAutoGainControl"),b(t.audio,"noiseSuppression","mozNoiseSuppression")),_(t)},p&&p.prototype.getSettings){const t=p.prototype.getSettings;p.prototype.getSettings=function(){const m=t.apply(this,arguments);return b(m,"mozAutoGainControl","autoGainControl"),b(m,"mozNoiseSuppression","noiseSuppression"),m}}if(p&&p.prototype.applyConstraints){const t=p.prototype.applyConstraints;p.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),b(m,"autoGainControl","mozAutoGainControl"),b(m,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[m])}}}}},"./node_modules/webrtc-adapter/src/js/safari/safari_shim.js":function(Se,U,K){K.r(U),K.d(U,"shimLocalStreamsAPI",function(){return q}),K.d(U,"shimRemoteStreamsAPI",function(){return x}),K.d(U,"shimCallbacksAPI",function(){return N}),K.d(U,"shimGetUserMedia",function(){return S}),K.d(U,"shimConstraints",function(){return p}),K.d(U,"shimRTCIceServerUrls",function(){return b}),K.d(U,"shimTrackEventTransceiver",function(){return _}),K.d(U,"shimCreateOfferLegacy",function(){return t}),K.d(U,"shimAudioContext",function(){return m});var G=K("./node_modules/webrtc-adapter/src/js/utils.js");function q(f){if(typeof f=="object"&&f.RTCPeerConnection){if("getLocalStreams"in f.RTCPeerConnection.prototype||(f.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in f.RTCPeerConnection.prototype)){const o=f.RTCPeerConnection.prototype.addTrack;f.RTCPeerConnection.prototype.addStream=function(s){this._localStreams||(this._localStreams=[]),this._localStreams.includes(s)||this._localStreams.push(s),s.getAudioTracks().forEach(n=>o.call(this,n,s)),s.getVideoTracks().forEach(n=>o.call(this,n,s))},f.RTCPeerConnection.prototype.addTrack=function(s,...n){return n&&n.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),o.apply(this,arguments)}}"removeStream"in f.RTCPeerConnection.prototype||(f.RTCPeerConnection.prototype.removeStream=function(o){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(o);if(s===-1)return;this._localStreams.splice(s,1);const n=o.getTracks();this.getSenders().forEach(i=>{n.includes(i.track)&&this.removeTrack(i)})})}}function x(f){if(typeof f=="object"&&f.RTCPeerConnection&&("getRemoteStreams"in f.RTCPeerConnection.prototype||(f.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in f.RTCPeerConnection.prototype))){Object.defineProperty(f.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const a=new Event("addstream");a.stream=i,this.dispatchEvent(a)})})}});const o=f.RTCPeerConnection.prototype.setRemoteDescription;f.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(i=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(i)>=0)return;s._remoteStreams.push(i);const a=new Event("addstream");a.stream=i,s.dispatchEvent(a)})}),o.apply(s,arguments)}}}function N(f){if(typeof f!="object"||!f.RTCPeerConnection)return;const o=f.RTCPeerConnection.prototype,s=o.createOffer,n=o.createAnswer,i=o.setLocalDescription,a=o.setRemoteDescription,c=o.addIceCandidate;o.createOffer=function(g,h){const C=arguments.length>=2?arguments[2]:arguments[0],E=s.apply(this,[C]);return h?(E.then(g,h),Promise.resolve()):E},o.createAnswer=function(g,h){const C=arguments.length>=2?arguments[2]:arguments[0],E=n.apply(this,[C]);return h?(E.then(g,h),Promise.resolve()):E};let u=function(g,h,C){const E=i.apply(this,[g]);return C?(E.then(h,C),Promise.resolve()):E};o.setLocalDescription=u,u=function(g,h,C){const E=a.apply(this,[g]);return C?(E.then(h,C),Promise.resolve()):E},o.setRemoteDescription=u,u=function(g,h,C){const E=c.apply(this,[g]);return C?(E.then(h,C),Promise.resolve()):E},o.addIceCandidate=u}function S(f){const o=f&&f.navigator;if(o.mediaDevices&&o.mediaDevices.getUserMedia){const s=o.mediaDevices,n=s.getUserMedia.bind(s);o.mediaDevices.getUserMedia=i=>n(p(i))}!o.getUserMedia&&o.mediaDevices&&o.mediaDevices.getUserMedia&&(o.getUserMedia=(function(s,n,i){o.mediaDevices.getUserMedia(s).then(n,i)}).bind(o))}function p(f){return f&&f.video!==void 0?Object.assign({},f,{video:G.compactObject(f.video)}):f}function b(f){if(!f.RTCPeerConnection)return;const o=f.RTCPeerConnection;f.RTCPeerConnection=function(s,n){if(s&&s.iceServers){const i=[];for(let a=0;a<s.iceServers.length;a++){let c=s.iceServers[a];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(G.deprecated("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,i.push(c)):i.push(s.iceServers[a])}s.iceServers=i}return new o(s,n)},f.RTCPeerConnection.prototype=o.prototype,"generateCertificate"in o&&Object.defineProperty(f.RTCPeerConnection,"generateCertificate",{get:()=>o.generateCertificate})}function _(f){typeof f=="object"&&f.RTCTrackEvent&&"receiver"in f.RTCTrackEvent.prototype&&!("transceiver"in f.RTCTrackEvent.prototype)&&Object.defineProperty(f.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function t(f){const o=f.RTCPeerConnection.prototype.createOffer;f.RTCPeerConnection.prototype.createOffer=function(s){if(s){typeof s.offerToReceiveAudio<"u"&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const n=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):s.offerToReceiveAudio!==!0||n||this.addTransceiver("audio"),typeof s.offerToReceiveVideo<"u"&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const i=this.getTransceivers().find(a=>a.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):s.offerToReceiveVideo!==!0||i||this.addTransceiver("video")}return o.apply(this,arguments)}}function m(f){typeof f!="object"||f.AudioContext||(f.AudioContext=f.webkitAudioContext)}},"./node_modules/webrtc-adapter/src/js/utils.js":function(Se,U,K){K.r(U),K.d(U,"extractVersion",function(){return x}),K.d(U,"wrapPeerConnectionEvent",function(){return N}),K.d(U,"disableLog",function(){return S}),K.d(U,"disableWarnings",function(){return p}),K.d(U,"log",function(){return b}),K.d(U,"deprecated",function(){return _}),K.d(U,"detectBrowser",function(){return t}),K.d(U,"compactObject",function(){return f}),K.d(U,"walkStats",function(){return o}),K.d(U,"filterStats",function(){return s});let G=!0,q=!0;function x(n,i,a){const c=n.match(i);return c&&c.length>=a&&parseInt(c[a],10)}function N(n,i,a){if(!n.RTCPeerConnection)return;const c=n.RTCPeerConnection.prototype,u=c.addEventListener;c.addEventListener=function(h,C){if(h!==i)return u.apply(this,arguments);const E=y=>{const w=a(y);w&&(C.handleEvent?C.handleEvent(w):C(w))};return this._eventMap=this._eventMap||{},this._eventMap[i]||(this._eventMap[i]=new Map),this._eventMap[i].set(C,E),u.apply(this,[h,E])};const g=c.removeEventListener;c.removeEventListener=function(h,C){if(h!==i||!this._eventMap||!this._eventMap[i])return g.apply(this,arguments);if(!this._eventMap[i].has(C))return g.apply(this,arguments);const E=this._eventMap[i].get(C);return this._eventMap[i].delete(C),this._eventMap[i].size===0&&delete this._eventMap[i],Object.keys(this._eventMap).length===0&&delete this._eventMap,g.apply(this,[h,E])},Object.defineProperty(c,"on"+i,{get(){return this["_on"+i]},set(h){this["_on"+i]&&(this.removeEventListener(i,this["_on"+i]),delete this["_on"+i]),h&&this.addEventListener(i,this["_on"+i]=h)},enumerable:!0,configurable:!0})}function S(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(G=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function p(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(q=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function b(){if(typeof window=="object"){if(G)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function _(n,i){q&&console.warn(n+" is deprecated, please use "+i+" instead.")}function t(n){const i={browser:null,version:null};if(typeof n>"u"||!n.navigator)return i.browser="Not a browser.",i;const{navigator:a}=n;if(a.mozGetUserMedia)i.browser="firefox",i.version=x(a.userAgent,/Firefox\/(\d+)\./,1);else if(a.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection&&!n.RTCIceGatherer)i.browser="chrome",i.version=x(a.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(a.mediaDevices&&a.userAgent.match(/Edge\/(\d+).(\d+)$/))i.browser="edge",i.version=x(a.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!n.RTCPeerConnection||!a.userAgent.match(/AppleWebKit\/(\d+)\./))return i.browser="Not a supported browser.",i;i.browser="safari",i.version=x(a.userAgent,/AppleWebKit\/(\d+)\./,1),i.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype}return i}function m(n){return Object.prototype.toString.call(n)==="[object Object]"}function f(n){return m(n)?Object.keys(n).reduce(function(i,a){const c=m(n[a]),u=c?f(n[a]):n[a],g=c&&!Object.keys(u).length;return u===void 0||g?i:Object.assign(i,{[a]:u})},{}):n}function o(n,i,a){i&&!a.has(i.id)&&(a.set(i.id,i),Object.keys(i).forEach(c=>{c.endsWith("Id")?o(n,n.get(i[c]),a):c.endsWith("Ids")&&i[c].forEach(u=>{o(n,n.get(u),a)})}))}function s(n,i,a){const c=a?"outbound-rtp":"inbound-rtp",u=new Map;if(i===null)return u;const g=[];return n.forEach(h=>{h.type==="track"&&h.trackIdentifier===i.id&&g.push(h)}),g.forEach(h=>{n.forEach(C=>{C.type===c&&C.trackId===h.id&&o(n,C,u)})}),u}},"./package.json":function(Se){Se.exports=JSON.parse(`{"name":"plivo-browser-sdk","title":"plivo-browser-sdk","version":"2.2.18-rc.2","description":"This library allows you to connect with plivo's voice enviroment from browser","main":"./dist/plivobrowsersdk.js","types":"index.d.ts","scripts":{"start":"webpack-dev-server --env.development --env.PLIVO_ENV=production","build:es5":"babel lib -d types/lib","build:ts":"./node_modules/typescript/bin/tsc","clean:ts":"rm -rf types","build:me":"webpack lib/rnnoise/workletProcessor.ts ./bundling.js","build:webpack":"webpack  --env.production --env.PLIVO_ENV=production","build":"npm-run-all build:webpack clean:ts","build:sellular":"npm-run-all build:ts build:es5","build:npm":"webpack  --env.production --env.npm --env.PLIVO_ENV=production","build:nominify":"webpack  --env.production --env.nominify --env.PLIVO_ENV=production","publish:npm":"rm -rf dist && npm run build:npm && npm publish","publish:npm_beta":"rm -rf dist && npm run build:npm && npm publish --tag beta","test":"npm-run-all test:integration test:unit","test:unit":"export USERAGENT_OS=darwin && jest --testPathPattern=test/unit/ --coverage --colors","test:unit-jenkins":"export USERAGENT_OS=linux && jest --testPathPattern=test/unit/ --coverage --colors","test:integration":"karma start --single-run --browsers ChromeWebRTC karma.conf.js","test:integration-safari":"karma start --single-run --browsers Safari karma.conf.js","beta-version-patch":"npm version $(semver $npm_package_version -i prerelease --preid beta)","beta-version-minor":"npm version $(semver $npm_package_version -i preminor --preid beta)","beta-version-major":"npm version $(semver $npm_package_version -i premajor --preid beta)","rc-version":"npm version $(semver $npm_package_version -i prerelease --preid rc)","final-release":"npm version $(semver $npm_package_version -i)","semver":"npm version $(semver $npm_package_version -i $release --preid $preid)","lint":"eslint lib --ext .ts"},"jest":{"preset":"ts-jest"},"author":"Plivo","license":"Apache-2.0","bugs":{"url":"https://github.com/plivo/plivo-websdk-2.0-example/issues"},"homepage":"https://www.plivo.com/docs/sdk/web/","pre-commit":["lint","test:unit","build"],"dependencies":{"@types/audioworklet":"^0.0.50","@types/emscripten":"^1.39.8","compare-versions":"^3.6.0","debug":"^4.2.0","events":"^3.2.0","null-loader":"4.0.1","sdp-transform":"^2.14.0","semver-parser":"^3.0.5","plivo-jssip":"^1.0.5","uuid":"^8.3.0","wasm-feature-detect":"^1.5.1","wasm-pack":"^0.12.1","webrtc-adapter":"^7.7.0"},"devDependencies":{"@types/chrome":"0.0.123","@types/jest":"^26.0.14","@types/mocha":"^8.2.0","@types/node":"^14.11.1","@types/terser-webpack-plugin":"^5.0.2","@types/webpack":"^4.41.26","@typescript-eslint/eslint-plugin":"^4.1.1","@typescript-eslint/parser":"^4.1.1","awesome-typescript-loader":"^5.2.1","babel-cli":"^6.26.0","babel-plugin-transform-class-properties":"^6.24.1","babel-preset-es2015":"^6.24.1","babelify":"^10.0.0","browserify":"^16.5.2","chai":"^4.2.0","create-file-webpack":"^1.0.2","dotenv":"^8.2.0","dts-bundle":"^0.7.3","envify":"^4.1.0","eslint":"^7.22.0","eslint-config-airbnb-base":"^14.2.0","eslint-config-airbnb-typescript":"^10.0.0","eslint-plugin-import":"^2.22.0","file-loader":"^6.2.0","jest":"^26.4.2","karma":"^5.2.3","karma-browserify":"^7.0.0","karma-chai":"^0.1.0","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^1.3.0","karma-html-reporter":"^0.2.7","karma-jasmine-html-reporter":"^1.5.4","karma-mocha":"^2.0.1","karma-mocha-reporter":"^2.2.5","karma-safari-launcher":"^1.0.0","karma-sinon":"^1.0.5","karma-spec-reporter":"0.0.32","karma-summary-reporter":"^2.0.0","karma-typescript":"^5.2.0","karma-typescript-es6-transform":"^5.2.0","mkdirp":"^1.0.4","mocha":"^8.1.3","npm-run-all":"^4.1.5","pre-commit":"^1.2.2","replace-in-file-webpack-plugin":"^1.0.6","script-loader":"^0.7.2","sinon":"^9.2.3","source-map-loader":"^1.1.0","string-replace-loader":"^2.3.0","string-replace-webpack-plugin":"^0.1.3","terser-webpack-plugin":"^4.2.2","ts-jest":"^26.4.0","ts-node":"^9.0.0","tsify":"^5.0.2","tslint-config-airbnb":"^5.11.2","typescript":"^4.0.3","wasm-feature-detect":"^1.5.1","webpack":"^4.47.0","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.0"}}`)},0:function(Se,U,K){Se.exports=K("./lib/index.ts")}})})}(qc)),qc.exports}var Dp=Pp();const Mp=Cp(Dp);function Np(){const[Le,ut]=yi.useState(""),[Se,U]=yi.useState(""),[K,G]=yi.useState(!1),[q,x]=yi.useState("Failed to load processor.js, Noise Reduction cannot be used"),N=yi.useRef(null),S={debug:"ALL",codecs:["OPUS","PCMU"],enableIPV6:!1,dscp:!0,enableTracking:!0,closeProtection:!1,useDefaultAudioDevice:!0,enableNoiseReduction:!0,maxAverageBitrate:48e3,allowMultipleIncomingCalls:!0,preDetectOwa:!1,noiseReductionFilePath:"./processor.js",dtmfOptions:{sendDtmfType:["outband","inband"]}};N.current=new Mp(S),yi.useEffect(()=>{var b,_;(b=N.current)==null||b.client.on("onLogin",()=>{G(!0),console.log("Login Success")}),(_=N.current)==null||_.client.on("onNoiseReductionReady",()=>{x("Noise reduction is ready to use"),console.log("Noise Reduction Ready")})},[]);const p=()=>{var b;if(!Le||!Se||!N.current){alert("Please enter a username and password");return}(b=N.current)==null||b.client.login(Le,Se),ut(""),U("")};return Br.jsxs("div",{className:"App",style:{display:"flex",flexDirection:"column",gap:"1rem",alignItems:"top",justifyContent:"center"},children:[!K&&Br.jsx("input",{type:"text",placeholder:"Username",value:Le,onChange:b=>ut(b.target.value)}),!K&&Br.jsx("input",{type:"text",name:"password",id:"password",placeholder:"Password",value:Se,onChange:b=>U(b.target.value)}),!K&&Br.jsx("button",{onClick:()=>{p()},children:"Login"}),K&&Br.jsx("div",{children:"Login Success"}),K&&q&&Br.jsx("div",{children:q})]})}Lp.createRoot(document.getElementById("root")).render(Br.jsx(yi.StrictMode,{children:Br.jsx(Np,{})}));
